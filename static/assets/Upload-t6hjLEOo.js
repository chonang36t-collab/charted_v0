import{c as E,r,j as e,d as C,v as O,a as V,A as z}from"./index-C1EfavGI.js";import{D as q,C as $,F as H}from"./DashboardLayout-CW5WM83J.js";import{C as o,a as x,b as m,d as p}from"./card-CPY8Tl3L.js";import{B as R}from"./button-CTprCdrR.js";import{I as G}from"./input-D2uFp1Aq.js";import{L as J}from"./label-jAf0d_Gq.js";import{P as K}from"./progress-DV2UgxET.js";import"./users-DDOYf1Jq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=E("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=E("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),Q=O("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),S=r.forwardRef(({className:a,variant:c,...i},h)=>e.jsx("div",{ref:h,role:"alert",className:C(Q({variant:c}),a),...i}));S.displayName="Alert";const X=r.forwardRef(({className:a,...c},i)=>e.jsx("h5",{ref:i,className:C("mb-1 font-medium leading-none tracking-tight",a),...c}));X.displayName="AlertTitle";const k=r.forwardRef(({className:a,...c},i)=>e.jsx("div",{ref:i,className:C("text-sm [&_p]:leading-relaxed",a),...c}));k.displayName="AlertDescription";function ce(){const[a,c]=r.useState(null),[i,h]=r.useState(!1),[D,f]=r.useState(0),[U,Z]=r.useState({}),[g,u]=r.useState("idle"),[M,N]=r.useState(""),[d,v]=r.useState(null),y=r.useRef(null),{toast:b}=V(),B=s=>{var l;const t=(l=s.target.files)==null?void 0:l[0];t&&(t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||t.type==="application/vnd.ms-excel"||t.name.endsWith(".csv")?(c(t),u("idle"),N("")):(b({title:"Invalid file type",description:"Please upload an Excel file (.xlsx, .xls) or CSV file",variant:"destructive"}),c(null)))},I=async()=>{if(!a)return;h(!0),f(0),u("idle"),N(""),v(null);const s=new FormData;s.append("file",a);try{const t=localStorage.getItem("auth_token"),l=await fetch(z.UPLOAD,{method:"POST",body:s,headers:{Authorization:`Bearer ${t}`},credentials:"include"});if(!l.ok)throw new Error(`Upload failed: ${l.statusText}`);if(!l.body)throw new Error("No response body");const j=l.body.getReader(),T=new TextDecoder;let w="";for(;;){const{done:P,value:_}=await j.read();if(P)break;w+=T.decode(_,{stream:!0});const A=w.split(`
`);w=A.pop()||"";for(const F of A)if(F.trim())try{const n=JSON.parse(F);if(n.status==="progress")n.progress&&f(n.progress);else if(n.status==="complete")u("success"),v(n.data),f(100),b({title:"Upload successful",description:"Your file has been uploaded and processed successfully"});else if(n.status==="error")throw new Error(n.message)}catch(n){console.error("Error parsing stream:",n)}}}catch(t){u("error"),N(t.message||"An unexpected error occurred"),b({title:"Upload failed",description:t.message||"An unexpected error occurred",variant:"destructive"})}finally{h(!1)}},L=s=>{if(s===0)return"0 Bytes";const t=1024,l=["Bytes","KB","MB","GB"],j=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,j)).toFixed(2))+" "+l[j]};return e.jsx(q,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Upload Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Upload your Excel or CSV files to import data into the system"})]}),e.jsxs(o,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"File Upload"]})}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"file-upload",children:"Select File"}),e.jsx(G,{id:"file-upload",type:"file",ref:y,onChange:B,accept:".xlsx,.xls,.csv",disabled:i}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported formats: Excel (.xlsx, .xls) and CSV files"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg",children:[e.jsx(H,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:L(a.size)})]})]}),i&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[D,"%"]})]}),e.jsx(K,{value:D})]}),g==="success"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(S,{className:"border-green-200 bg-green-50",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),e.jsx(k,{className:"text-green-800",children:"File uploaded successfully!"})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(o,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm font-medium",children:"Rows Inserted"})}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold",children:d.inserted.toLocaleString()})})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm font-medium",children:"Duplicate Rows"})}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:d.skipped_details.filter(s=>s.reason==="Duplicate").length.toLocaleString()})})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm font-medium",children:"Skipped Rows"})}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.skipped_details.filter(s=>s.reason!=="Duplicate").length.toLocaleString()})})]}),e.jsxs(o,{children:[e.jsx(x,{className:"pb-2",children:e.jsx(m,{className:"text-sm font-medium",children:"Revenue Match"})}),e.jsxs(p,{children:[e.jsx("div",{className:`text-2xl font-bold ${d.verification.match?"text-green-600":"text-red-600"}`,children:d.verification.match?"MATCHED":"MISMATCH"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Excel: £",d.verification.excel_revenue.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["DB: £",d.verification.db_revenue.toLocaleString()]})]})]})]}),d.skipped_details.length>0&&e.jsxs(o,{children:[e.jsx(x,{children:e.jsx(m,{className:"text-base",children:"Skipped Rows Details"})}),e.jsx(p,{children:e.jsx("div",{className:"max-h-60 overflow-y-auto border rounded-md",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 font-medium",children:"Row"}),e.jsx("th",{className:"p-2 font-medium",children:"Reason"}),e.jsx("th",{className:"p-2 font-medium",children:"Details"})]})}),e.jsx("tbody",{children:d.skipped_details.map((s,t)=>e.jsxs("tr",{className:"border-t hover:bg-muted/50",children:[e.jsx("td",{className:"p-2",children:s.row}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${s.reason==="Duplicate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.reason})}),e.jsx("td",{className:"p-2 text-muted-foreground",children:s.details})]},t))})]})})})]})]}),e.jsx(R,{onClick:()=>{u("idle"),f(0),c(null),v(null),y.current&&(y.current.value="")},variant:"outline",className:"w-full",children:"Upload New File"})]}),g==="error"&&e.jsxs(S,{className:"border-red-200 bg-red-50",children:[e.jsx(W,{className:"h-4 w-4 text-red-600"}),e.jsx(k,{className:"text-red-800",children:M})]}),g!=="success"&&e.jsx(R,{onClick:I,disabled:i,className:"w-full",children:i?"Uploading...":"Upload File"})]})]})]}),Object.keys(U).length>0&&e.jsxs(o,{children:[e.jsx(x,{children:e.jsx(m,{children:"Required Columns"})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(U).map(([s,t])=>e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(l=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-md text-sm",children:l},l))})]},s))})})]})]})})}export{ce as default};
