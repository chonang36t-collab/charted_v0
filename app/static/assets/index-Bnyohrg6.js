const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-DukAS5Az.js","assets/index-BIm8U-WF.js","assets/index-B5zp7fOq.css","assets/card-CPYEXJ6G.js","assets/users-CvOqpEy-.js","assets/locationUtils-BqXVJ2N8.js","assets/button-BUooGhA3.js","assets/DashboardLayout-BKG9_D-B.js","assets/ChartCanvas-CnZQDXN9.js","assets/badge-B4zLmiKw.js","assets/generateCategoricalChart-wi_2keqS.js","assets/BarChart-C2Wjm9SA.js","assets/Line-BS70exsV.js","assets/AreaChart-C2p-wx46.js"])))=>i.map(i=>d[i]);
import{c as Me,r as n,s as G,P,t as re,j as t,l as B,X as rt,T as at,m as nt,n as st,o as lt,e as ot,f as De,k as it,g as ct,i as dt,a as ut,S as mt,_ as Te}from"./index-BIm8U-WF.js";import{R as ft,P as ht,O as pt,a as xt,D as gt}from"./DashboardLayout-BKG9_D-B.js";import{L as je}from"./label-Db-7x2DS.js";import{C as vt,u as yt,S as bt,b as wt,c as St,d as jt,e as ie}from"./select-CiYoD-rJ.js";import{B as de}from"./button-BUooGhA3.js";import{P as xe,b as ge,g as Ce,c as ve,j as Ct,C as Ne,f as ce,d as ke}from"./locationUtils-BqXVJ2N8.js";import"./dialog-NFj2ySjd.js";import{C as Nt,a as kt,b as Et,d as It}from"./card-CPYEXJ6G.js";import"./users-CvOqpEy-.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=Me("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=Me("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Mt=()=>{const[e,a]=n.useState(()=>{const o=localStorage.getItem("chartBuilderState"),i={dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0};if(o)try{const m=JSON.parse(o);return{...i,dimensions:m.dimensions||[],metrics:m.metrics||[],chartType:m.chartType||"bar"}}catch(m){console.error("Error parsing saved chart builder state",m)}return i});return n.useEffect(()=>{const{dimensions:o,metrics:i,chartType:m}=e;localStorage.setItem("chartBuilderState",JSON.stringify({dimensions:o,metrics:i,chartType:m}))},[e.dimensions,e.metrics,e.chartType]),{state:e,setDimensions:o=>{a(i=>({...i,dimensions:o}))},setMetrics:o=>{a(i=>({...i,metrics:o}))},setChartType:o=>{a(i=>({...i,chartType:o}))},setDateRange:o=>{a(i=>({...i,dateRange:o}))},addCustomMetric:o=>{a(i=>({...i,customMetrics:[...i.customMetrics,o]}))},setChartData:o=>{a(i=>({...i,chartData:o}))},setDraggedItem:o=>{a(i=>({...i,draggedItem:o}))}}};var Ee=1,Dt=.9,Tt=.8,Lt=.17,fe=.1,he=.999,Bt=.9999,Pt=.99,Ot=/[\\\/_+.#"@\[\(\{&]/,$t=/[\\\/_+.#"@\[\(\{&]/g,_t=/[\s-]/,Le=/[\s-]/g;function ye(e,a,r,f,c,u,l){if(u===a.length)return c===e.length?Ee:Pt;var p=`${c},${u}`;if(l[p]!==void 0)return l[p];for(var x=f.charAt(u),o=r.indexOf(x,c),i=0,m,S,y,k;o>=0;)m=ye(e,a,r,f,o+1,u+1,l),m>i&&(o===c?m*=Ee:Ot.test(e.charAt(o-1))?(m*=Tt,y=e.slice(c,o-1).match($t),y&&c>0&&(m*=Math.pow(he,y.length))):_t.test(e.charAt(o-1))?(m*=Dt,k=e.slice(c,o-1).match(Le),k&&c>0&&(m*=Math.pow(he,k.length))):(m*=Lt,c>0&&(m*=Math.pow(he,o-c))),e.charAt(o)!==a.charAt(u)&&(m*=Bt)),(m<fe&&r.charAt(o-1)===f.charAt(u+1)||f.charAt(u+1)===f.charAt(u)&&r.charAt(o-1)!==f.charAt(u))&&(S=ye(e,a,r,f,o+1,u+2,l),S*fe>m&&(m=S*fe)),m>i&&(i=m),o=r.indexOf(x,o+1);return l[p]=i,i}function Ie(e){return e.toLowerCase().replace(Le," ")}function zt(e,a,r){return e=r&&r.length>0?`${e+" "+r.join(" ")}`:e,ye(e,a,Ie(e),Ie(a),0,0,{})}var ee='[cmdk-group=""]',pe='[cmdk-group-items=""]',Ft='[cmdk-group-heading=""]',Be='[cmdk-item=""]',Re=`${Be}:not([aria-disabled="true"])`,be="cmdk-item-select",J="data-value",Vt=(e,a,r)=>zt(e,a,r),Pe=n.createContext(void 0),ae=()=>n.useContext(Pe),Oe=n.createContext(void 0),Se=()=>n.useContext(Oe),$e=n.createContext(void 0),_e=n.forwardRef((e,a)=>{let r=Y(()=>{var s,v;return{search:"",value:(v=(s=e.value)!=null?s:e.defaultValue)!=null?v:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),f=Y(()=>new Set),c=Y(()=>new Map),u=Y(()=>new Map),l=Y(()=>new Set),p=ze(e),{label:x,children:o,value:i,onValueChange:m,filter:S,shouldFilter:y,loop:k,disablePointerSelection:O=!1,vimBindings:E=!0,...T}=e,$=G(),_=G(),I=G(),z=n.useRef(null),N=Zt();K(()=>{if(i!==void 0){let s=i.trim();r.current.value=s,j.emit()}},[i]),K(()=>{N(6,se)},[]);let j=n.useMemo(()=>({subscribe:s=>(l.current.add(s),()=>l.current.delete(s)),snapshot:()=>r.current,setState:(s,v,b)=>{var h,w,C,L;if(!Object.is(r.current[s],v)){if(r.current[s]=v,s==="search")U(),V(),N(1,W);else if(s==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let M=document.getElementById(I);M?M.focus():(h=document.getElementById($))==null||h.focus()}if(N(7,()=>{var M;r.current.selectedItemId=(M=d())==null?void 0:M.id,j.emit()}),b||N(5,se),((w=p.current)==null?void 0:w.value)!==void 0){let M=v??"";(L=(C=p.current).onValueChange)==null||L.call(C,M);return}}j.emit()}},emit:()=>{l.current.forEach(s=>s())}}),[]),F=n.useMemo(()=>({value:(s,v,b)=>{var h;v!==((h=u.current.get(s))==null?void 0:h.value)&&(u.current.set(s,{value:v,keywords:b}),r.current.filtered.items.set(s,ne(v,b)),N(2,()=>{V(),j.emit()}))},item:(s,v)=>(f.current.add(s),v&&(c.current.has(v)?c.current.get(v).add(s):c.current.set(v,new Set([s]))),N(3,()=>{U(),V(),r.current.value||W(),j.emit()}),()=>{u.current.delete(s),f.current.delete(s),r.current.filtered.items.delete(s);let b=d();N(4,()=>{U(),(b==null?void 0:b.getAttribute("id"))===s&&W(),j.emit()})}),group:s=>(c.current.has(s)||c.current.set(s,new Set),()=>{u.current.delete(s),c.current.delete(s)}),filter:()=>p.current.shouldFilter,label:x||e["aria-label"],getDisablePointerSelection:()=>p.current.disablePointerSelection,listId:$,inputId:I,labelId:_,listInnerRef:z}),[]);function ne(s,v){var b,h;let w=(h=(b=p.current)==null?void 0:b.filter)!=null?h:Vt;return s?w(s,r.current.search,v):0}function V(){if(!r.current.search||p.current.shouldFilter===!1)return;let s=r.current.filtered.items,v=[];r.current.filtered.groups.forEach(h=>{let w=c.current.get(h),C=0;w.forEach(L=>{let M=s.get(L);C=Math.max(M,C)}),v.push([h,C])});let b=z.current;g().sort((h,w)=>{var C,L;let M=h.getAttribute("id"),oe=w.getAttribute("id");return((C=s.get(oe))!=null?C:0)-((L=s.get(M))!=null?L:0)}).forEach(h=>{let w=h.closest(pe);w?w.appendChild(h.parentElement===w?h:h.closest(`${pe} > *`)):b.appendChild(h.parentElement===b?h:h.closest(`${pe} > *`))}),v.sort((h,w)=>w[1]-h[1]).forEach(h=>{var w;let C=(w=z.current)==null?void 0:w.querySelector(`${ee}[${J}="${encodeURIComponent(h[0])}"]`);C==null||C.parentElement.appendChild(C)})}function W(){let s=g().find(b=>b.getAttribute("aria-disabled")!=="true"),v=s==null?void 0:s.getAttribute(J);j.setState("value",v||void 0)}function U(){var s,v,b,h;if(!r.current.search||p.current.shouldFilter===!1){r.current.filtered.count=f.current.size;return}r.current.filtered.groups=new Set;let w=0;for(let C of f.current){let L=(v=(s=u.current.get(C))==null?void 0:s.value)!=null?v:"",M=(h=(b=u.current.get(C))==null?void 0:b.keywords)!=null?h:[],oe=ne(L,M);r.current.filtered.items.set(C,oe),oe>0&&w++}for(let[C,L]of c.current)for(let M of L)if(r.current.filtered.items.get(M)>0){r.current.filtered.groups.add(C);break}r.current.filtered.count=w}function se(){var s,v,b;let h=d();h&&(((s=h.parentElement)==null?void 0:s.firstChild)===h&&((b=(v=h.closest(ee))==null?void 0:v.querySelector(Ft))==null||b.scrollIntoView({block:"nearest"})),h.scrollIntoView({block:"nearest"}))}function d(){var s;return(s=z.current)==null?void 0:s.querySelector(`${Be}[aria-selected="true"]`)}function g(){var s;return Array.from(((s=z.current)==null?void 0:s.querySelectorAll(Re))||[])}function R(s){let v=g()[s];v&&j.setState("value",v.getAttribute(J))}function X(s){var v;let b=d(),h=g(),w=h.findIndex(L=>L===b),C=h[w+s];(v=p.current)!=null&&v.loop&&(C=w+s<0?h[h.length-1]:w+s===h.length?h[0]:h[w+s]),C&&j.setState("value",C.getAttribute(J))}function le(s){let v=d(),b=v==null?void 0:v.closest(ee),h;for(;b&&!h;)b=s>0?Xt(b,ee):Qt(b,ee),h=b==null?void 0:b.querySelector(Re);h?j.setState("value",h.getAttribute(J)):X(s)}let Q=()=>R(g().length-1),A=s=>{s.preventDefault(),s.metaKey?Q():s.altKey?le(1):X(1)},Z=s=>{s.preventDefault(),s.metaKey?R(0):s.altKey?le(-1):X(-1)};return n.createElement(P.div,{ref:a,tabIndex:-1,...T,"cmdk-root":"",onKeyDown:s=>{var v;(v=T.onKeyDown)==null||v.call(T,s);let b=s.nativeEvent.isComposing||s.keyCode===229;if(!(s.defaultPrevented||b))switch(s.key){case"n":case"j":{E&&s.ctrlKey&&A(s);break}case"ArrowDown":{A(s);break}case"p":case"k":{E&&s.ctrlKey&&Z(s);break}case"ArrowUp":{Z(s);break}case"Home":{s.preventDefault(),R(0);break}case"End":{s.preventDefault(),Q();break}case"Enter":{s.preventDefault();let h=d();if(h){let w=new Event(be);h.dispatchEvent(w)}}}}},n.createElement("label",{"cmdk-label":"",htmlFor:F.inputId,id:F.labelId,style:tr},x),ue(e,s=>n.createElement(Oe.Provider,{value:j},n.createElement(Pe.Provider,{value:F},s))))}),qt=n.forwardRef((e,a)=>{var r,f;let c=G(),u=n.useRef(null),l=n.useContext($e),p=ae(),x=ze(e),o=(f=(r=x.current)==null?void 0:r.forceMount)!=null?f:l==null?void 0:l.forceMount;K(()=>{if(!o)return p.item(c,l==null?void 0:l.id)},[o]);let i=Fe(c,u,[e.value,e.children,u],e.keywords),m=Se(),S=q(N=>N.value&&N.value===i.current),y=q(N=>o||p.filter()===!1?!0:N.search?N.filtered.items.get(c)>0:!0);n.useEffect(()=>{let N=u.current;if(!(!N||e.disabled))return N.addEventListener(be,k),()=>N.removeEventListener(be,k)},[y,e.onSelect,e.disabled]);function k(){var N,j;O(),(j=(N=x.current).onSelect)==null||j.call(N,i.current)}function O(){m.setState("value",i.current,!0)}if(!y)return null;let{disabled:E,value:T,onSelect:$,forceMount:_,keywords:I,...z}=e;return n.createElement(P.div,{ref:re(u,a),...z,id:c,"cmdk-item":"",role:"option","aria-disabled":!!E,"aria-selected":!!S,"data-disabled":!!E,"data-selected":!!S,onPointerMove:E||p.getDisablePointerSelection()?void 0:O,onClick:E?void 0:k},e.children)}),Ut=n.forwardRef((e,a)=>{let{heading:r,children:f,forceMount:c,...u}=e,l=G(),p=n.useRef(null),x=n.useRef(null),o=G(),i=ae(),m=q(y=>c||i.filter()===!1?!0:y.search?y.filtered.groups.has(l):!0);K(()=>i.group(l),[]),Fe(l,p,[e.value,e.heading,x]);let S=n.useMemo(()=>({id:l,forceMount:c}),[c]);return n.createElement(P.div,{ref:re(p,a),...u,"cmdk-group":"",role:"presentation",hidden:m?void 0:!0},r&&n.createElement("div",{ref:x,"cmdk-group-heading":"","aria-hidden":!0,id:o},r),ue(e,y=>n.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?o:void 0},n.createElement($e.Provider,{value:S},y))))}),Kt=n.forwardRef((e,a)=>{let{alwaysRender:r,...f}=e,c=n.useRef(null),u=q(l=>!l.search);return!r&&!u?null:n.createElement(P.div,{ref:re(c,a),...f,"cmdk-separator":"",role:"separator"})}),Ht=n.forwardRef((e,a)=>{let{onValueChange:r,...f}=e,c=e.value!=null,u=Se(),l=q(o=>o.search),p=q(o=>o.selectedItemId),x=ae();return n.useEffect(()=>{e.value!=null&&u.setState("search",e.value)},[e.value]),n.createElement(P.input,{ref:a,...f,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":x.listId,"aria-labelledby":x.labelId,"aria-activedescendant":p,id:x.inputId,type:"text",value:c?e.value:l,onChange:o=>{c||u.setState("search",o.target.value),r==null||r(o.target.value)}})}),Jt=n.forwardRef((e,a)=>{let{children:r,label:f="Suggestions",...c}=e,u=n.useRef(null),l=n.useRef(null),p=q(o=>o.selectedItemId),x=ae();return n.useEffect(()=>{if(l.current&&u.current){let o=l.current,i=u.current,m,S=new ResizeObserver(()=>{m=requestAnimationFrame(()=>{let y=o.offsetHeight;i.style.setProperty("--cmdk-list-height",y.toFixed(1)+"px")})});return S.observe(o),()=>{cancelAnimationFrame(m),S.unobserve(o)}}},[]),n.createElement(P.div,{ref:re(u,a),...c,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":p,"aria-label":f,id:x.listId},ue(e,o=>n.createElement("div",{ref:re(l,x.listInnerRef),"cmdk-list-sizer":""},o)))}),Yt=n.forwardRef((e,a)=>{let{open:r,onOpenChange:f,overlayClassName:c,contentClassName:u,container:l,...p}=e;return n.createElement(ft,{open:r,onOpenChange:f},n.createElement(ht,{container:l},n.createElement(pt,{"cmdk-overlay":"",className:c}),n.createElement(xt,{"aria-label":e.label,"cmdk-dialog":"",className:u},n.createElement(_e,{ref:a,...p}))))}),Gt=n.forwardRef((e,a)=>q(r=>r.filtered.count===0)?n.createElement(P.div,{ref:a,...e,"cmdk-empty":"",role:"presentation"}):null),Wt=n.forwardRef((e,a)=>{let{progress:r,children:f,label:c="Loading...",...u}=e;return n.createElement(P.div,{ref:a,...u,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":c},ue(e,l=>n.createElement("div",{"aria-hidden":!0},l)))}),D=Object.assign(_e,{List:Jt,Item:qt,Input:Ht,Group:Ut,Separator:Kt,Dialog:Yt,Empty:Gt,Loading:Wt});function Xt(e,a){let r=e.nextElementSibling;for(;r;){if(r.matches(a))return r;r=r.nextElementSibling}}function Qt(e,a){let r=e.previousElementSibling;for(;r;){if(r.matches(a))return r;r=r.previousElementSibling}}function ze(e){let a=n.useRef(e);return K(()=>{a.current=e}),a}var K=typeof window>"u"?n.useEffect:n.useLayoutEffect;function Y(e){let a=n.useRef();return a.current===void 0&&(a.current=e()),a}function q(e){let a=Se(),r=()=>e(a.snapshot());return n.useSyncExternalStore(a.subscribe,r,r)}function Fe(e,a,r,f=[]){let c=n.useRef(),u=ae();return K(()=>{var l;let p=(()=>{var o;for(let i of r){if(typeof i=="string")return i.trim();if(typeof i=="object"&&"current"in i)return i.current?(o=i.current.textContent)==null?void 0:o.trim():c.current}})(),x=f.map(o=>o.trim());u.value(e,p,x),(l=a.current)==null||l.setAttribute(J,p),c.current=p}),c}var Zt=()=>{let[e,a]=n.useState(),r=Y(()=>new Map);return K(()=>{r.current.forEach(f=>f()),r.current=new Map},[e]),(f,c)=>{r.current.set(f,c),a({})}};function er(e){let a=e.type;return typeof a=="function"?a(e.props):"render"in a?a.render(e.props):e}function ue({asChild:e,children:a},r){return e&&n.isValidElement(a)?n.cloneElement(er(a),{ref:a.ref},r(a.props.children)):r(a)}var tr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ve=n.forwardRef(({className:e,...a},r)=>t.jsx(D,{ref:r,className:B("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...a}));Ve.displayName=D.displayName;const qe=n.forwardRef(({className:e,...a},r)=>t.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[t.jsx(At,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),t.jsx(D.Input,{ref:r,className:B("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...a})]}));qe.displayName=D.Input.displayName;const rr=n.forwardRef(({className:e,...a},r)=>t.jsx(D.List,{ref:r,className:B("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...a}));rr.displayName=D.List.displayName;const Ue=n.forwardRef((e,a)=>t.jsx(D.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));Ue.displayName=D.Empty.displayName;const Ke=n.forwardRef(({className:e,...a},r)=>t.jsx(D.Group,{ref:r,className:B("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...a}));Ke.displayName=D.Group.displayName;const ar=n.forwardRef(({className:e,...a},r)=>t.jsx(D.Separator,{ref:r,className:B("-mx-1 h-px bg-border",e),...a}));ar.displayName=D.Separator.displayName;const He=n.forwardRef(({className:e,...a},r)=>t.jsx(D.Item,{ref:r,className:B("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...a}));He.displayName=D.Item.displayName;var nr="Separator",Ae="horizontal",sr=["horizontal","vertical"],Je=n.forwardRef((e,a)=>{const{decorative:r,orientation:f=Ae,...c}=e,u=lr(f)?f:Ae,p=r?{role:"none"}:{"aria-orientation":u==="vertical"?u:void 0,role:"separator"};return t.jsx(P.div,{"data-orientation":u,...p,...c,ref:a})});Je.displayName=nr;function lr(e){return sr.includes(e)}var Ye=Je;const Ge=n.forwardRef(({className:e,orientation:a="horizontal",decorative:r=!0,...f},c)=>t.jsx(Ye,{ref:c,decorative:r,orientation:a,className:B("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...f}));Ge.displayName=Ye.displayName;function H({title:e,options:a,selected:r,onChange:f,placeholder:c="Select...",isLocation:u=!1}){const[l,p]=n.useState(!1),x=i=>{r.includes(i)?f(r.filter(m=>m!==i)):f([...r,i])},o=i=>{i.stopPropagation(),f([])};return t.jsxs("div",{className:"flex flex-col gap-1.5 min-w-[180px]",children:[t.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:e}),t.jsxs(xe,{open:l,onOpenChange:p,children:[t.jsx(ge,{asChild:!0,children:t.jsxs(de,{variant:"outline",role:"combobox","aria-expanded":l,className:"w-full justify-between h-9 px-3 text-sm",children:[t.jsxs("div",{className:"flex flex-wrap gap-1 items-center overflow-hidden",children:[r.length===0&&t.jsx("span",{className:"text-muted-foreground font-normal truncate",children:c}),r.length===1&&t.jsx("span",{className:"truncate",children:u?Ce(r[0]):r[0]}),r.length>1&&t.jsxs("span",{className:"truncate",children:[r.length," selected"]})]}),t.jsxs("div",{className:"flex items-center gap-2 shrink-0 opacity-50 ml-2",children:[r.length>0&&t.jsx(rt,{className:"h-3 w-3 cursor-pointer hover:opacity-100",onClick:o}),t.jsx(Rt,{className:"h-3 w-3"})]})]})}),t.jsx(ve,{className:"w-[200px] p-0",align:"start",children:t.jsxs(Ve,{children:[t.jsx(qe,{placeholder:`Search ${e.toLowerCase()}...`}),t.jsxs(Ue,{children:["No ",e.toLowerCase()," found."]}),t.jsx(Ke,{className:"max-h-64 overflow-auto",children:a.map(i=>t.jsxs(He,{value:i,onSelect:()=>x(i),children:[t.jsx(vt,{className:B("mr-2 h-4 w-4",r.includes(i)?"opacity-100":"opacity-0")}),u?t.jsx(at,{delayDuration:300,children:t.jsxs(nt,{children:[t.jsx(st,{asChild:!0,children:t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"font-medium",children:Ce(i)}),t.jsx("span",{className:"text-[10px] text-muted-foreground truncate opacity-70",children:i})]})}),t.jsx(lt,{side:"right",children:t.jsx("p",{children:i})})]})}):i]},i))})]})})]})]})}function or({availableFilters:e,filters:a,onFilterChange:r,orientation:f="vertical",hideSites:c=!1}){n.useMemo(()=>{if(a.locations.length===0)return e.clients;const o=e.locations.filter(m=>a.locations.includes(m.name)),i=new Set;return o.forEach(m=>{m.clients&&m.clients.forEach(S=>i.add(S))}),Array.from(i).sort()},[e,a.locations]);const u=n.useMemo(()=>{if(a.locations.length===0)return Array.from(new Set(e.locations.flatMap(m=>m.sites))).sort();const o=e.locations.filter(m=>a.locations.includes(m.name)),i=new Set;return o.forEach(m=>{m.sites.forEach(S=>i.add(S))}),Array.from(i).sort()},[e.locations,a.locations]),l=o=>{const i=e.locations.filter(y=>o.includes(y.name)),m=o.length===0?e.clients:Array.from(new Set(i.flatMap(y=>y.clients||[]))),S=o.length===0?Array.from(new Set(e.locations.flatMap(y=>y.sites))):Array.from(new Set(i.flatMap(y=>y.sites)));r({...a,locations:o,clients:a.clients.filter(y=>m.includes(y)),sites:a.sites.filter(y=>S.includes(y))})},p=o=>{r({...a,clients:o})},x=o=>{r({...a,sites:o})};return f==="horizontal"?t.jsxs("div",{className:"flex flex-wrap items-end gap-4 p-1",children:[t.jsx("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mr-2 pb-2",children:t.jsx("span",{children:"ðŸŒªï¸ Filters:"})}),t.jsx(H,{title:"Clients",options:e.clients,selected:a.clients,onChange:p,placeholder:"All Clients"}),t.jsx(H,{title:"Locations",options:e.locations.map(o=>o.name),selected:a.locations,onChange:l,placeholder:"All Locations",isLocation:!0}),!c&&t.jsx(H,{title:"Sites",options:u,selected:a.sites,onChange:x,placeholder:"All Sites"})]}):t.jsxs(Nt,{className:"h-full flex flex-col",children:[t.jsx(kt,{className:"pb-3",children:t.jsx(Et,{className:"text-lg flex items-center gap-2",children:"ðŸŒªï¸ Filters"})}),t.jsxs(It,{className:"space-y-4 flex-1 overflow-y-auto",children:[t.jsx(H,{title:"Clients",options:e.clients,selected:a.clients,onChange:p,placeholder:"All Clients"}),t.jsx(Ge,{}),t.jsx(H,{title:"Locations",options:e.locations.map(o=>o.name),selected:a.locations,onChange:l,placeholder:"All Locations",isLocation:!0}),t.jsx(H,{title:"Sites",options:u,selected:a.sites,onChange:x,placeholder:"All Sites"})]})]})}var me="Switch",[ir,jr]=ot(me),[cr,dr]=ir(me),We=n.forwardRef((e,a)=>{const{__scopeSwitch:r,name:f,checked:c,defaultChecked:u,required:l,disabled:p,value:x="on",onCheckedChange:o,form:i,...m}=e,[S,y]=n.useState(null),k=De(a,_=>y(_)),O=n.useRef(!1),E=S?i||!!S.closest("form"):!0,[T,$]=it({prop:c,defaultProp:u??!1,onChange:o,caller:me});return t.jsxs(cr,{scope:r,checked:T,disabled:p,children:[t.jsx(P.button,{type:"button",role:"switch","aria-checked":T,"aria-required":l,"data-state":et(T),"data-disabled":p?"":void 0,disabled:p,value:x,...m,ref:k,onClick:ct(e.onClick,_=>{$(I=>!I),E&&(O.current=_.isPropagationStopped(),O.current||_.stopPropagation())})}),E&&t.jsx(Ze,{control:S,bubbles:!O.current,name:f,value:x,checked:T,required:l,disabled:p,form:i,style:{transform:"translateX(-100%)"}})]})});We.displayName=me;var Xe="SwitchThumb",Qe=n.forwardRef((e,a)=>{const{__scopeSwitch:r,...f}=e,c=dr(Xe,r);return t.jsx(P.span,{"data-state":et(c.checked),"data-disabled":c.disabled?"":void 0,...f,ref:a})});Qe.displayName=Xe;var ur="SwitchBubbleInput",Ze=n.forwardRef(({__scopeSwitch:e,control:a,checked:r,bubbles:f=!0,...c},u)=>{const l=n.useRef(null),p=De(l,u),x=yt(r),o=dt(a);return n.useEffect(()=>{const i=l.current;if(!i)return;const m=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(m,"checked").set;if(x!==r&&y){const k=new Event("click",{bubbles:f});y.call(i,r),i.dispatchEvent(k)}},[x,r,f]),t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...c,tabIndex:-1,ref:p,style:{...c.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ze.displayName=ur;function et(e){return e?"checked":"unchecked"}var tt=We,mr=Qe;const we=n.forwardRef(({className:e,...a},r)=>t.jsx(tt,{className:B("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...a,ref:r,children:t.jsx(mr,{className:B("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));we.displayName=tt.displayName;const fr=n.lazy(()=>Te(()=>import("./MetricPalette-DukAS5Az.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),te=n.lazy(()=>Te(()=>import("./ChartCanvas-CnZQDXN9.js"),__vite__mapDeps([8,1,2,9,10,11,12,13])));function Cr(){const{state:e,setDimensions:a,setMetrics:r,setChartType:f,setDateRange:c}=Mt(),{toast:u}=ut(),[l,p]=n.useState(()=>{const d=localStorage.getItem("chartBuilderDate");if(d)try{const g=JSON.parse(d);return{from:g.from?new Date(g.from):void 0,to:g.to?new Date(g.to):void 0}}catch(g){console.error(g)}return{from:new Date,to:Ct(new Date,30)}}),[x,o]=n.useState(()=>{const d=localStorage.getItem("chartBuilderAppliedDate");if(d)try{const g=JSON.parse(d);return{from:g.from?new Date(g.from):void 0,to:g.to?new Date(g.to):void 0}}catch(g){console.error(g)}return l});n.useEffect(()=>{l&&localStorage.setItem("chartBuilderDate",JSON.stringify(l))},[l]),n.useEffect(()=>{x&&localStorage.setItem("chartBuilderAppliedDate",JSON.stringify(x))},[x]);const[i,m]=n.useState(!1),[S,y]=n.useState(!1),[k,O]=n.useState(()=>localStorage.getItem("chartBuilderSplitByLocation")==="true"),[E,T]=n.useState(()=>localStorage.getItem("chartBuilderSplitBySite")==="true"&&!k);n.useEffect(()=>{localStorage.setItem("chartBuilderSplitByLocation",String(k))},[k]),n.useEffect(()=>{localStorage.setItem("chartBuilderSplitBySite",String(E))},[E]);const[$,_]=n.useState({clients:[],locations:[]}),[I,z]=n.useState({clients:[],locations:[],sites:[]});n.useEffect(()=>{(async()=>{try{const g=await fetch("/api/filters",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(g.ok){const R=await g.json();_(R)}}catch(g){console.error("Error fetching filters:",g)}})()},[]);const N=()=>{o(l)},[j,F]=n.useState([]),[ne,V]=n.useState([]);n.useEffect(()=>{(async()=>{var Q;if(e.dimensions.length===0||e.metrics.length===0||!(x!=null&&x.from)||!(x!=null&&x.to)){F([]),V([]);return}const g=e.dimensions[0],R=e.metrics,X=ce(x.from,"yyyy-MM-dd"),le=ce(x.to,"yyyy-MM-dd");try{const A=new URLSearchParams;A.append("start",X),A.append("end",le),A.append("dimension",g),R.forEach(s=>A.append("metrics",s)),I.clients.forEach(s=>A.append("clients",s)),I.locations.forEach(s=>A.append("locations",s)),I.sites.forEach(s=>A.append("sites",s)),k&&A.append("split_by_location","true"),E&&A.append("split_by_site","true");const Z=await fetch(`/api/chart-data?${A.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(Z.ok){const s=await Z.json();F(s.data||[]),V(((Q=s.summary)==null?void 0:Q.topClients)||[])}else console.error("Failed to fetch chart data"),F([]),V([])}catch(A){console.error("Error fetching chart data:",A),F([]),V([])}})()},[e.dimensions,e.metrics,x,I,k,E]);const{showSiteFilter:W,showSiteSplit:U}=n.useMemo(()=>{const d=I.locations.length===0?$.locations.flatMap(R=>R.sites):$.locations.filter(R=>I.locations.includes(R.name)).flatMap(R=>R.sites),g=Array.from(new Set(d));return{showSiteFilter:g.length>1,showSiteSplit:g.length>1}},[$.locations,I.locations]);n.useEffect(()=>{!U&&E&&T(!1)},[U,E]);const se=d=>{d.type==="dimension"?e.dimensions.includes(d.name)?(a([]),u({description:`Removed ${d.name} from chart`,duration:2e3})):(a([d.name]),u({description:`Added ${d.name} to chart`,duration:2e3})):d.type==="metric"&&(e.metrics.includes(d.name)?(r(e.metrics.filter(g=>g!==d.name)),u({description:`Removed ${d.name} from chart`,duration:2e3})):(r([...e.metrics,d.name]),u({description:`Added ${d.name} to chart`,duration:2e3})))};return t.jsx(gt,{noPadding:!0,fullWidth:!0,children:t.jsx("div",{className:"p-2 md:p-3 h-full flex flex-col",children:t.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[t.jsx("div",{className:"sticky lg:top-0 z-30 pb-2 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-1 shadow-sm bg-background",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[t.jsx("div",{children:t.jsx("h1",{className:"text-xl font-bold",children:"Chart Builder"})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("div",{className:"w-32",children:t.jsxs(bt,{value:e.chartType,onValueChange:f,children:[t.jsx(wt,{className:"h-8 text-xs",children:t.jsx(St,{placeholder:"Chart Type"})}),t.jsxs(jt,{children:[t.jsx(ie,{value:"bar",children:"Bar Chart"}),t.jsx(ie,{value:"line",children:"Line Chart"}),t.jsx(ie,{value:"area",children:"Area Chart"}),t.jsx(ie,{value:"pie",children:"Pie Chart"})]})]})}),t.jsxs("div",{className:"flex items-center gap-6 px-2 border-l ml-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(we,{id:"split-location",checked:k,onCheckedChange:d=>{O(d),d&&T(!1)}}),t.jsx(je,{htmlFor:"split-location",className:"text-xs font-medium cursor-pointer flex items-center gap-1.5",children:"Split by Location"})]}),U&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(we,{id:"split-site",checked:E,onCheckedChange:d=>{T(d),d&&O(!1)}}),t.jsx(je,{htmlFor:"split-site",className:"text-xs font-medium cursor-pointer flex items-center gap-1.5",children:"Split by Site"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(xe,{open:i,onOpenChange:m,children:[t.jsx(ge,{asChild:!0,children:t.jsxs(de,{variant:"outline",className:B("w-32 justify-start text-left font-normal h-8 text-xs",!(l!=null&&l.from)&&"text-muted-foreground"),children:[t.jsx(Ne,{className:"mr-2 h-3 w-3"}),l!=null&&l.from?ce(l.from,"MMM dd, y"):t.jsx("span",{children:"From"})]})}),t.jsx(ve,{className:"w-auto p-0",align:"start",children:t.jsx(ke,{mode:"single",selected:l==null?void 0:l.from,onSelect:d=>{p(g=>({...g,from:d})),m(!1)},defaultMonth:l==null?void 0:l.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),t.jsxs(xe,{open:S,onOpenChange:y,children:[t.jsx(ge,{asChild:!0,children:t.jsxs(de,{variant:"outline",className:B("w-32 justify-start text-left font-normal h-8 text-xs",!(l!=null&&l.to)&&"text-muted-foreground"),children:[t.jsx(Ne,{className:"mr-2 h-3 w-3"}),l!=null&&l.to?ce(l.to,"MMM dd, y"):t.jsx("span",{children:"To"})]})}),t.jsx(ve,{className:"w-auto p-0",align:"start",children:t.jsx(ke,{mode:"single",selected:l==null?void 0:l.to,onSelect:d=>{p(g=>({...g,to:d})),y(!1)},defaultMonth:l==null?void 0:l.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),t.jsx(de,{onClick:N,className:"h-8 text-xs px-4",disabled:!(l!=null&&l.from)||!(l!=null&&l.to),children:"Apply Range"})]})]})]})}),t.jsx(n.Suspense,{fallback:t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx(mt,{className:"h-8 w-8 rounded-full"})}),children:t.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-2 min-h-0 h-full",children:[t.jsx("div",{className:"lg:w-72 shrink-0 h-full flex flex-col overflow-hidden",children:t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2",children:t.jsx(fr,{selectedDimensions:e.dimensions,selectedMetrics:e.metrics,onItemClick:se})})}),t.jsxs("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:[t.jsx("div",{className:"shrink-0 pb-2 border-b mb-2",children:t.jsx(or,{availableFilters:$,filters:I,onFilterChange:z,orientation:"horizontal",hideSites:!W})}),t.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2 custom-scrollbar",children:[!k&&!E&&t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 h-full min-h-[500px]",children:t.jsx(te,{chartData:j,chartType:e.chartType,metrics:e.metrics,title:"Aggregated View",topClients:ne})}),k&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[I.locations.length>0?I.locations.map(d=>{const g=j.filter(R=>R.location===d);return g.length===0?null:t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(te,{chartData:g,chartType:e.chartType,metrics:e.metrics,title:d,isCompact:!0})},d)}):Array.from(new Set(j.map(d=>d.location).filter(Boolean))).map(d=>t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(te,{chartData:j.filter(g=>g.location===d),chartType:e.chartType,metrics:e.metrics,title:d,isCompact:!0})},d)),j.length===0&&t.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground bg-muted/20 rounded-xl border border-dashed",children:"No data available for selected locations"})]}),E&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[I.sites.length>0?I.sites.map(d=>{const g=j.filter(R=>R.site===d);return g.length===0?null:t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(te,{chartData:g,chartType:e.chartType,metrics:e.metrics,title:d,isCompact:!0})},d)}):Array.from(new Set(j.map(d=>d.site).filter(Boolean))).map(d=>t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(te,{chartData:j.filter(g=>g.site===d),chartType:e.chartType,metrics:e.metrics,title:d,isCompact:!0})},d)),j.length===0&&t.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground bg-muted/20 rounded-xl border border-dashed",children:"No data available for selected sites"})]})]})]})]})})]})})})}export{Cr as default};
