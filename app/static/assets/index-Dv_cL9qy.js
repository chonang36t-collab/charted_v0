const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-DEW8y1m8.js","assets/index-CK9fz1PI.js","assets/index-24ssbFSf.css","assets/card-DQFTdnw1.js","assets/users-CiQWVQQZ.js","assets/locationUtils-BoVcwD9w.js","assets/button-BJ9YmwoQ.js","assets/DashboardLayout-xjVNuA9L.js","assets/ChartCanvas-KvcqN-Pn.js","assets/badge-BChOAYsq.js","assets/AreaChart-BSZSBSr1.js","assets/BarChart-Cem2JUXM.js"])))=>i.map(i=>d[i]);
import{c as Ie,r as n,q as W,P as $,s as Z,j as r,k as L,X as st,T as De,l as Ae,m as Me,n as Te,d as ot,e as Pe,i as lt,f as it,h as ct,a as dt,S as ut,_ as Le}from"./index-CK9fz1PI.js";import{R as mt,P as ft,O as ht,a as pt,D as xt}from"./DashboardLayout-xjVNuA9L.js";import{L as vt}from"./label-C26IXUOF.js";import{C as gt,u as bt,S as yt,b as wt,c as jt,d as St,e as ae}from"./select-BMfFOrbP.js";import{B as se}from"./button-BJ9YmwoQ.js";import{P as ue,b as me,g as fe,c as he,j as Ct,C as je,f as ne,d as Se}from"./locationUtils-BoVcwD9w.js";import"./dialog-D18P4PT6.js";import{C as Nt,a as kt,b as Et,d as Rt}from"./card-DQFTdnw1.js";import"./users-CiQWVQQZ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=Ie("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=Ie("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),At=()=>{const[e,a]=n.useState(()=>{const o=localStorage.getItem("chartBuilderState"),i={dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0};if(o)try{const v=JSON.parse(o);return{...i,dimensions:v.dimensions||[],metrics:v.metrics||[],chartType:v.chartType||"bar"}}catch(v){console.error("Error parsing saved chart builder state",v)}return i});return n.useEffect(()=>{const{dimensions:o,metrics:i,chartType:v}=e;localStorage.setItem("chartBuilderState",JSON.stringify({dimensions:o,metrics:i,chartType:v}))},[e.dimensions,e.metrics,e.chartType]),{state:e,setDimensions:o=>{a(i=>({...i,dimensions:o}))},setMetrics:o=>{a(i=>({...i,metrics:o}))},setChartType:o=>{a(i=>({...i,chartType:o}))},setDateRange:o=>{a(i=>({...i,dateRange:o}))},addCustomMetric:o=>{a(i=>({...i,customMetrics:[...i.customMetrics,o]}))},setChartData:o=>{a(i=>({...i,chartData:o}))},setDraggedItem:o=>{a(i=>({...i,draggedItem:o}))}}};var Ce=1,Mt=.9,Tt=.8,Pt=.17,ie=.1,ce=.999,Lt=.9999,Ot=.99,$t=/[\\\/_+.#"@\[\(\{&]/,Bt=/[\\\/_+.#"@\[\(\{&]/g,_t=/[\s-]/,Oe=/[\s-]/g;function pe(e,a,t,m,c,d,u){if(d===a.length)return c===e.length?Ce:Ot;var l=`${c},${d}`;if(u[l]!==void 0)return u[l];for(var p=m.charAt(d),o=t.indexOf(p,c),i=0,v,C,S,E;o>=0;)v=pe(e,a,t,m,o+1,d+1,u),v>i&&(o===c?v*=Ce:$t.test(e.charAt(o-1))?(v*=Tt,S=e.slice(c,o-1).match(Bt),S&&c>0&&(v*=Math.pow(ce,S.length))):_t.test(e.charAt(o-1))?(v*=Mt,E=e.slice(c,o-1).match(Oe),E&&c>0&&(v*=Math.pow(ce,E.length))):(v*=Pt,c>0&&(v*=Math.pow(ce,o-c))),e.charAt(o)!==a.charAt(d)&&(v*=Lt)),(v<ie&&t.charAt(o-1)===m.charAt(d+1)||m.charAt(d+1)===m.charAt(d)&&t.charAt(o-1)!==m.charAt(d))&&(C=pe(e,a,t,m,o+1,d+2,u),C*ie>v&&(v=C*ie)),v>i&&(i=v),o=t.indexOf(p,o+1);return u[l]=i,i}function Ne(e){return e.toLowerCase().replace(Oe," ")}function zt(e,a,t){return e=t&&t.length>0?`${e+" "+t.join(" ")}`:e,pe(e,a,Ne(e),Ne(a),0,0,{})}var Q='[cmdk-group=""]',de='[cmdk-group-items=""]',Ft='[cmdk-group-heading=""]',$e='[cmdk-item=""]',ke=`${$e}:not([aria-disabled="true"])`,xe="cmdk-item-select",Y="data-value",qt=(e,a,t)=>zt(e,a,t),Be=n.createContext(void 0),ee=()=>n.useContext(Be),_e=n.createContext(void 0),ve=()=>n.useContext(_e),ze=n.createContext(void 0),Fe=n.forwardRef((e,a)=>{let t=G(()=>{var s,x;return{search:"",value:(x=(s=e.value)!=null?s:e.defaultValue)!=null?x:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),m=G(()=>new Set),c=G(()=>new Map),d=G(()=>new Map),u=G(()=>new Set),l=qe(e),{label:p,children:o,value:i,onValueChange:v,filter:C,shouldFilter:S,loop:E,disablePointerSelection:A=!1,vimBindings:P=!0,...O}=e,F=W(),R=W(),q=W(),B=n.useRef(null),j=Zt();U(()=>{if(i!==void 0){let s=i.trim();t.current.value=s,k.emit()}},[i]),U(()=>{j(6,te)},[]);let k=n.useMemo(()=>({subscribe:s=>(u.current.add(s),()=>u.current.delete(s)),snapshot:()=>t.current,setState:(s,x,b)=>{var f,y,w,T;if(!Object.is(t.current[s],x)){if(t.current[s]=x,s==="search")V(),h(),j(1,g);else if(s==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let I=document.getElementById(q);I?I.focus():(f=document.getElementById(F))==null||f.focus()}if(j(7,()=>{var I;t.current.selectedItemId=(I=_())==null?void 0:I.id,k.emit()}),b||j(5,te),((y=l.current)==null?void 0:y.value)!==void 0){let I=x??"";(T=(w=l.current).onValueChange)==null||T.call(w,I);return}}k.emit()}},emit:()=>{u.current.forEach(s=>s())}}),[]),K=n.useMemo(()=>({value:(s,x,b)=>{var f;x!==((f=d.current.get(s))==null?void 0:f.value)&&(d.current.set(s,{value:x,keywords:b}),t.current.filtered.items.set(s,X(x,b)),j(2,()=>{h(),k.emit()}))},item:(s,x)=>(m.current.add(s),x&&(c.current.has(x)?c.current.get(x).add(s):c.current.set(x,new Set([s]))),j(3,()=>{V(),h(),t.current.value||g(),k.emit()}),()=>{d.current.delete(s),m.current.delete(s),t.current.filtered.items.delete(s);let b=_();j(4,()=>{V(),(b==null?void 0:b.getAttribute("id"))===s&&g(),k.emit()})}),group:s=>(c.current.has(s)||c.current.set(s,new Set),()=>{d.current.delete(s),c.current.delete(s)}),filter:()=>l.current.shouldFilter,label:p||e["aria-label"],getDisablePointerSelection:()=>l.current.disablePointerSelection,listId:F,inputId:q,labelId:R,listInnerRef:B}),[]);function X(s,x){var b,f;let y=(f=(b=l.current)==null?void 0:b.filter)!=null?f:qt;return s?y(s,t.current.search,x):0}function h(){if(!t.current.search||l.current.shouldFilter===!1)return;let s=t.current.filtered.items,x=[];t.current.filtered.groups.forEach(f=>{let y=c.current.get(f),w=0;y.forEach(T=>{let I=s.get(T);w=Math.max(I,w)}),x.push([f,w])});let b=B.current;N().sort((f,y)=>{var w,T;let I=f.getAttribute("id"),re=y.getAttribute("id");return((w=s.get(re))!=null?w:0)-((T=s.get(I))!=null?T:0)}).forEach(f=>{let y=f.closest(de);y?y.appendChild(f.parentElement===y?f:f.closest(`${de} > *`)):b.appendChild(f.parentElement===b?f:f.closest(`${de} > *`))}),x.sort((f,y)=>y[1]-f[1]).forEach(f=>{var y;let w=(y=B.current)==null?void 0:y.querySelector(`${Q}[${Y}="${encodeURIComponent(f[0])}"]`);w==null||w.parentElement.appendChild(w)})}function g(){let s=N().find(b=>b.getAttribute("aria-disabled")!=="true"),x=s==null?void 0:s.getAttribute(Y);k.setState("value",x||void 0)}function V(){var s,x,b,f;if(!t.current.search||l.current.shouldFilter===!1){t.current.filtered.count=m.current.size;return}t.current.filtered.groups=new Set;let y=0;for(let w of m.current){let T=(x=(s=d.current.get(w))==null?void 0:s.value)!=null?x:"",I=(f=(b=d.current.get(w))==null?void 0:b.keywords)!=null?f:[],re=X(T,I);t.current.filtered.items.set(w,re),re>0&&y++}for(let[w,T]of c.current)for(let I of T)if(t.current.filtered.items.get(I)>0){t.current.filtered.groups.add(w);break}t.current.filtered.count=y}function te(){var s,x,b;let f=_();f&&(((s=f.parentElement)==null?void 0:s.firstChild)===f&&((b=(x=f.closest(Q))==null?void 0:x.querySelector(Ft))==null||b.scrollIntoView({block:"nearest"})),f.scrollIntoView({block:"nearest"}))}function _(){var s;return(s=B.current)==null?void 0:s.querySelector(`${$e}[aria-selected="true"]`)}function N(){var s;return Array.from(((s=B.current)==null?void 0:s.querySelectorAll(ke))||[])}function H(s){let x=N()[s];x&&k.setState("value",x.getAttribute(Y))}function M(s){var x;let b=_(),f=N(),y=f.findIndex(T=>T===b),w=f[y+s];(x=l.current)!=null&&x.loop&&(w=y+s<0?f[f.length-1]:y+s===f.length?f[0]:f[y+s]),w&&k.setState("value",w.getAttribute(Y))}function ge(s){let x=_(),b=x==null?void 0:x.closest(Q),f;for(;b&&!f;)b=s>0?Xt(b,Q):Qt(b,Q),f=b==null?void 0:b.querySelector(ke);f?k.setState("value",f.getAttribute(Y)):M(s)}let be=()=>H(N().length-1),ye=s=>{s.preventDefault(),s.metaKey?be():s.altKey?ge(1):M(1)},we=s=>{s.preventDefault(),s.metaKey?H(0):s.altKey?ge(-1):M(-1)};return n.createElement($.div,{ref:a,tabIndex:-1,...O,"cmdk-root":"",onKeyDown:s=>{var x;(x=O.onKeyDown)==null||x.call(O,s);let b=s.nativeEvent.isComposing||s.keyCode===229;if(!(s.defaultPrevented||b))switch(s.key){case"n":case"j":{P&&s.ctrlKey&&ye(s);break}case"ArrowDown":{ye(s);break}case"p":case"k":{P&&s.ctrlKey&&we(s);break}case"ArrowUp":{we(s);break}case"Home":{s.preventDefault(),H(0);break}case"End":{s.preventDefault(),be();break}case"Enter":{s.preventDefault();let f=_();if(f){let y=new Event(xe);f.dispatchEvent(y)}}}}},n.createElement("label",{"cmdk-label":"",htmlFor:K.inputId,id:K.labelId,style:tr},p),oe(e,s=>n.createElement(_e.Provider,{value:k},n.createElement(Be.Provider,{value:K},s))))}),Vt=n.forwardRef((e,a)=>{var t,m;let c=W(),d=n.useRef(null),u=n.useContext(ze),l=ee(),p=qe(e),o=(m=(t=p.current)==null?void 0:t.forceMount)!=null?m:u==null?void 0:u.forceMount;U(()=>{if(!o)return l.item(c,u==null?void 0:u.id)},[o]);let i=Ve(c,d,[e.value,e.children,d],e.keywords),v=ve(),C=z(j=>j.value&&j.value===i.current),S=z(j=>o||l.filter()===!1?!0:j.search?j.filtered.items.get(c)>0:!0);n.useEffect(()=>{let j=d.current;if(!(!j||e.disabled))return j.addEventListener(xe,E),()=>j.removeEventListener(xe,E)},[S,e.onSelect,e.disabled]);function E(){var j,k;A(),(k=(j=p.current).onSelect)==null||k.call(j,i.current)}function A(){v.setState("value",i.current,!0)}if(!S)return null;let{disabled:P,value:O,onSelect:F,forceMount:R,keywords:q,...B}=e;return n.createElement($.div,{ref:Z(d,a),...B,id:c,"cmdk-item":"",role:"option","aria-disabled":!!P,"aria-selected":!!C,"data-disabled":!!P,"data-selected":!!C,onPointerMove:P||l.getDisablePointerSelection()?void 0:A,onClick:P?void 0:E},e.children)}),Ut=n.forwardRef((e,a)=>{let{heading:t,children:m,forceMount:c,...d}=e,u=W(),l=n.useRef(null),p=n.useRef(null),o=W(),i=ee(),v=z(S=>c||i.filter()===!1?!0:S.search?S.filtered.groups.has(u):!0);U(()=>i.group(u),[]),Ve(u,l,[e.value,e.heading,p]);let C=n.useMemo(()=>({id:u,forceMount:c}),[c]);return n.createElement($.div,{ref:Z(l,a),...d,"cmdk-group":"",role:"presentation",hidden:v?void 0:!0},t&&n.createElement("div",{ref:p,"cmdk-group-heading":"","aria-hidden":!0,id:o},t),oe(e,S=>n.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":t?o:void 0},n.createElement(ze.Provider,{value:C},S))))}),Kt=n.forwardRef((e,a)=>{let{alwaysRender:t,...m}=e,c=n.useRef(null),d=z(u=>!u.search);return!t&&!d?null:n.createElement($.div,{ref:Z(c,a),...m,"cmdk-separator":"",role:"separator"})}),Ht=n.forwardRef((e,a)=>{let{onValueChange:t,...m}=e,c=e.value!=null,d=ve(),u=z(o=>o.search),l=z(o=>o.selectedItemId),p=ee();return n.useEffect(()=>{e.value!=null&&d.setState("search",e.value)},[e.value]),n.createElement($.input,{ref:a,...m,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":p.listId,"aria-labelledby":p.labelId,"aria-activedescendant":l,id:p.inputId,type:"text",value:c?e.value:u,onChange:o=>{c||d.setState("search",o.target.value),t==null||t(o.target.value)}})}),Jt=n.forwardRef((e,a)=>{let{children:t,label:m="Suggestions",...c}=e,d=n.useRef(null),u=n.useRef(null),l=z(o=>o.selectedItemId),p=ee();return n.useEffect(()=>{if(u.current&&d.current){let o=u.current,i=d.current,v,C=new ResizeObserver(()=>{v=requestAnimationFrame(()=>{let S=o.offsetHeight;i.style.setProperty("--cmdk-list-height",S.toFixed(1)+"px")})});return C.observe(o),()=>{cancelAnimationFrame(v),C.unobserve(o)}}},[]),n.createElement($.div,{ref:Z(d,a),...c,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":l,"aria-label":m,id:p.listId},oe(e,o=>n.createElement("div",{ref:Z(u,p.listInnerRef),"cmdk-list-sizer":""},o)))}),Yt=n.forwardRef((e,a)=>{let{open:t,onOpenChange:m,overlayClassName:c,contentClassName:d,container:u,...l}=e;return n.createElement(mt,{open:t,onOpenChange:m},n.createElement(ft,{container:u},n.createElement(ht,{"cmdk-overlay":"",className:c}),n.createElement(pt,{"aria-label":e.label,"cmdk-dialog":"",className:d},n.createElement(Fe,{ref:a,...l}))))}),Gt=n.forwardRef((e,a)=>z(t=>t.filtered.count===0)?n.createElement($.div,{ref:a,...e,"cmdk-empty":"",role:"presentation"}):null),Wt=n.forwardRef((e,a)=>{let{progress:t,children:m,label:c="Loading...",...d}=e;return n.createElement($.div,{ref:a,...d,"cmdk-loading":"",role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":100,"aria-label":c},oe(e,u=>n.createElement("div",{"aria-hidden":!0},u)))}),D=Object.assign(Fe,{List:Jt,Item:Vt,Input:Ht,Group:Ut,Separator:Kt,Dialog:Yt,Empty:Gt,Loading:Wt});function Xt(e,a){let t=e.nextElementSibling;for(;t;){if(t.matches(a))return t;t=t.nextElementSibling}}function Qt(e,a){let t=e.previousElementSibling;for(;t;){if(t.matches(a))return t;t=t.previousElementSibling}}function qe(e){let a=n.useRef(e);return U(()=>{a.current=e}),a}var U=typeof window>"u"?n.useEffect:n.useLayoutEffect;function G(e){let a=n.useRef();return a.current===void 0&&(a.current=e()),a}function z(e){let a=ve(),t=()=>e(a.snapshot());return n.useSyncExternalStore(a.subscribe,t,t)}function Ve(e,a,t,m=[]){let c=n.useRef(),d=ee();return U(()=>{var u;let l=(()=>{var o;for(let i of t){if(typeof i=="string")return i.trim();if(typeof i=="object"&&"current"in i)return i.current?(o=i.current.textContent)==null?void 0:o.trim():c.current}})(),p=m.map(o=>o.trim());d.value(e,l,p),(u=a.current)==null||u.setAttribute(Y,l),c.current=l}),c}var Zt=()=>{let[e,a]=n.useState(),t=G(()=>new Map);return U(()=>{t.current.forEach(m=>m()),t.current=new Map},[e]),(m,c)=>{t.current.set(m,c),a({})}};function er(e){let a=e.type;return typeof a=="function"?a(e.props):"render"in a?a.render(e.props):e}function oe({asChild:e,children:a},t){return e&&n.isValidElement(a)?n.cloneElement(er(a),{ref:a.ref},t(a.props.children)):t(a)}var tr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ue=n.forwardRef(({className:e,...a},t)=>r.jsx(D,{ref:t,className:L("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...a}));Ue.displayName=D.displayName;const Ke=n.forwardRef(({className:e,...a},t)=>r.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[r.jsx(Dt,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),r.jsx(D.Input,{ref:t,className:L("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...a})]}));Ke.displayName=D.Input.displayName;const rr=n.forwardRef(({className:e,...a},t)=>r.jsx(D.List,{ref:t,className:L("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...a}));rr.displayName=D.List.displayName;const He=n.forwardRef((e,a)=>r.jsx(D.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));He.displayName=D.Empty.displayName;const Je=n.forwardRef(({className:e,...a},t)=>r.jsx(D.Group,{ref:t,className:L("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...a}));Je.displayName=D.Group.displayName;const ar=n.forwardRef(({className:e,...a},t)=>r.jsx(D.Separator,{ref:t,className:L("-mx-1 h-px bg-border",e),...a}));ar.displayName=D.Separator.displayName;const Ye=n.forwardRef(({className:e,...a},t)=>r.jsx(D.Item,{ref:t,className:L("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...a}));Ye.displayName=D.Item.displayName;var nr="Separator",Ee="horizontal",sr=["horizontal","vertical"],Ge=n.forwardRef((e,a)=>{const{decorative:t,orientation:m=Ee,...c}=e,d=or(m)?m:Ee,l=t?{role:"none"}:{"aria-orientation":d==="vertical"?d:void 0,role:"separator"};return r.jsx($.div,{"data-orientation":d,...l,...c,ref:a})});Ge.displayName=nr;function or(e){return sr.includes(e)}var We=Ge;const Xe=n.forwardRef(({className:e,orientation:a="horizontal",decorative:t=!0,...m},c)=>r.jsx(We,{ref:c,decorative:t,orientation:a,className:L("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...m}));Xe.displayName=We.displayName;function J({title:e,options:a,selected:t,onChange:m,placeholder:c="Select...",isLocation:d=!1}){const[u,l]=n.useState(!1),p=i=>{t.includes(i)?m(t.filter(v=>v!==i)):m([...t,i])},o=i=>{i.stopPropagation(),m([])};return r.jsxs("div",{className:"flex flex-col gap-1.5 min-w-[180px]",children:[r.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:e}),r.jsxs(ue,{open:u,onOpenChange:l,children:[r.jsx(me,{asChild:!0,children:r.jsxs(se,{variant:"outline",role:"combobox","aria-expanded":u,className:"w-full justify-between h-9 px-3 text-sm",children:[r.jsxs("div",{className:"flex flex-wrap gap-1 items-center overflow-hidden",children:[t.length===0&&r.jsx("span",{className:"text-muted-foreground font-normal truncate",children:c}),t.length===1&&r.jsx("span",{className:"truncate",children:d?fe(t[0]):t[0]}),t.length>1&&r.jsxs("span",{className:"truncate",children:[t.length," selected"]})]}),r.jsxs("div",{className:"flex items-center gap-2 shrink-0 opacity-50 ml-2",children:[t.length>0&&r.jsx(st,{className:"h-3 w-3 cursor-pointer hover:opacity-100",onClick:o}),r.jsx(It,{className:"h-3 w-3"})]})]})}),r.jsx(he,{className:"w-[200px] p-0",align:"start",children:r.jsxs(Ue,{children:[r.jsx(Ke,{placeholder:`Search ${e.toLowerCase()}...`}),r.jsxs(He,{children:["No ",e.toLowerCase()," found."]}),r.jsx(Je,{className:"max-h-64 overflow-auto",children:a.map(i=>r.jsxs(Ye,{value:i,onSelect:()=>p(i),children:[r.jsx(gt,{className:L("mr-2 h-4 w-4",t.includes(i)?"opacity-100":"opacity-0")}),d?r.jsx(De,{delayDuration:300,children:r.jsxs(Ae,{children:[r.jsx(Me,{asChild:!0,children:r.jsxs("div",{className:"flex flex-col min-w-0",children:[r.jsx("span",{className:"font-medium",children:fe(i)}),r.jsx("span",{className:"text-[10px] text-muted-foreground truncate opacity-70",children:i})]})}),r.jsx(Te,{side:"right",children:r.jsx("p",{children:i})})]})}):i]},i))})]})})]})]})}function lr({availableFilters:e,filters:a,onFilterChange:t,orientation:m="vertical"}){const c=n.useMemo(()=>{if(a.locations.length===0){const p=new Set;return e.locations.forEach(o=>{o.sites.forEach(i=>p.add(i))}),Array.from(p).sort()}else{const p=new Set;return e.locations.filter(o=>a.locations.includes(o.name)).forEach(o=>{o.sites.forEach(i=>p.add(i))}),Array.from(p).sort()}},[e.locations,a.locations]),d=p=>{t({...a,clients:p})},u=p=>{t({...a,locations:p})},l=p=>{t({...a,sites:p})};return m==="horizontal"?r.jsxs("div",{className:"flex flex-wrap items-end gap-4 p-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mr-2 pb-2",children:r.jsx("span",{children:"ðŸŒªï¸ Filters:"})}),r.jsx(J,{title:"Clients",options:e.clients,selected:a.clients,onChange:d,placeholder:"All Clients"}),r.jsx(J,{title:"Locations",options:e.locations.map(p=>p.name),selected:a.locations,onChange:u,placeholder:"All Locations",isLocation:!0}),r.jsx(J,{title:"Sites",options:c,selected:a.sites,onChange:l,placeholder:"All Sites"})]}):r.jsxs(Nt,{className:"h-full flex flex-col",children:[r.jsx(kt,{className:"pb-3",children:r.jsx(Et,{className:"text-lg flex items-center gap-2",children:"ðŸŒªï¸ Filters"})}),r.jsxs(Rt,{className:"space-y-4 flex-1 overflow-y-auto",children:[r.jsx(J,{title:"Clients",options:e.clients,selected:a.clients,onChange:d,placeholder:"All Clients"}),r.jsx(Xe,{}),r.jsx(J,{title:"Locations",options:e.locations.map(p=>p.name),selected:a.locations,onChange:u,placeholder:"All Locations",isLocation:!0}),r.jsx(J,{title:"Sites",options:c,selected:a.sites,onChange:l,placeholder:"All Sites"})]})]})}var le="Switch",[ir,Sr]=ot(le),[cr,dr]=ir(le),Qe=n.forwardRef((e,a)=>{const{__scopeSwitch:t,name:m,checked:c,defaultChecked:d,required:u,disabled:l,value:p="on",onCheckedChange:o,form:i,...v}=e,[C,S]=n.useState(null),E=Pe(a,R=>S(R)),A=n.useRef(!1),P=C?i||!!C.closest("form"):!0,[O,F]=lt({prop:c,defaultProp:d??!1,onChange:o,caller:le});return r.jsxs(cr,{scope:t,checked:O,disabled:l,children:[r.jsx($.button,{type:"button",role:"switch","aria-checked":O,"aria-required":u,"data-state":rt(O),"data-disabled":l?"":void 0,disabled:l,value:p,...v,ref:E,onClick:it(e.onClick,R=>{F(q=>!q),P&&(A.current=R.isPropagationStopped(),A.current||R.stopPropagation())})}),P&&r.jsx(tt,{control:C,bubbles:!A.current,name:m,value:p,checked:O,required:u,disabled:l,form:i,style:{transform:"translateX(-100%)"}})]})});Qe.displayName=le;var Ze="SwitchThumb",et=n.forwardRef((e,a)=>{const{__scopeSwitch:t,...m}=e,c=dr(Ze,t);return r.jsx($.span,{"data-state":rt(c.checked),"data-disabled":c.disabled?"":void 0,...m,ref:a})});et.displayName=Ze;var ur="SwitchBubbleInput",tt=n.forwardRef(({__scopeSwitch:e,control:a,checked:t,bubbles:m=!0,...c},d)=>{const u=n.useRef(null),l=Pe(u,d),p=bt(t),o=ct(a);return n.useEffect(()=>{const i=u.current;if(!i)return;const v=window.HTMLInputElement.prototype,S=Object.getOwnPropertyDescriptor(v,"checked").set;if(p!==t&&S){const E=new Event("click",{bubbles:m});S.call(i,t),i.dispatchEvent(E)}},[p,t,m]),r.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...c,tabIndex:-1,ref:l,style:{...c.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});tt.displayName=ur;function rt(e){return e?"checked":"unchecked"}var at=Qe,mr=et;const nt=n.forwardRef(({className:e,...a},t)=>r.jsx(at,{className:L("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...a,ref:t,children:r.jsx(mr,{className:L("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));nt.displayName=at.displayName;const fr=n.lazy(()=>Le(()=>import("./MetricPalette-DEW8y1m8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Re=n.lazy(()=>Le(()=>import("./ChartCanvas-KvcqN-Pn.js"),__vite__mapDeps([8,1,2,9,10,11])));function Cr(){const{state:e,setDimensions:a,setMetrics:t,setChartType:m,setDateRange:c,setChartData:d}=At(),{toast:u}=dt(),[l,p]=n.useState(()=>{const h=localStorage.getItem("chartBuilderDate");if(h)try{const g=JSON.parse(h);return{from:g.from?new Date(g.from):void 0,to:g.to?new Date(g.to):void 0}}catch(g){console.error(g)}return{from:new Date,to:Ct(new Date,30)}}),[o,i]=n.useState(()=>{const h=localStorage.getItem("chartBuilderAppliedDate");if(h)try{const g=JSON.parse(h);return{from:g.from?new Date(g.from):void 0,to:g.to?new Date(g.to):void 0}}catch(g){console.error(g)}return l});n.useEffect(()=>{l&&localStorage.setItem("chartBuilderDate",JSON.stringify(l))},[l]),n.useEffect(()=>{o&&localStorage.setItem("chartBuilderAppliedDate",JSON.stringify(o))},[o]);const[v,C]=n.useState(!1),[S,E]=n.useState(!1),[A,P]=n.useState(!1),[O,F]=n.useState({clients:[],locations:[]}),[R,q]=n.useState({clients:[],locations:[],sites:[]});n.useEffect(()=>{(async()=>{try{const g=await fetch("/api/filters",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(g.ok){const V=await g.json();F(V)}}catch(g){console.error("Error fetching filters:",g)}})()},[]);const B=()=>{i(l)};n.useEffect(()=>{(async()=>{if(e.dimensions.length===0||e.metrics.length===0||!(o!=null&&o.from)||!(o!=null&&o.to)){d([]);return}const g=e.dimensions[0],V=e.metrics,te=ne(o.from,"yyyy-MM-dd"),_=ne(o.to,"yyyy-MM-dd");try{const N=new URLSearchParams;N.append("start",te),N.append("end",_),N.append("dimension",g),V.forEach(M=>N.append("metrics",M)),R.clients.forEach(M=>N.append("clients",M)),R.locations.forEach(M=>N.append("locations",M)),R.sites.forEach(M=>N.append("sites",M)),A&&N.append("split_by_location","true");const H=await fetch(`/api/chart-data?${N.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(H.ok){const M=await H.json();d(M)}else console.error("Failed to fetch chart data"),d([])}catch(N){console.error("Error fetching chart data:",N),d([])}})()},[e.dimensions,e.metrics,o,R,A]);const j=h=>{h.type==="dimension"?e.dimensions.includes(h.name)||(a([h.name]),u({description:`Added ${h.name} to chart`,duration:2e3})):h.type==="metric"&&(e.metrics.includes(h.name)||(t([...e.metrics,h.name]),u({description:`Added ${h.name} to chart`,duration:2e3})))},k=h=>{h.type==="dimension"?e.dimensions.includes(h.name)&&(a(e.dimensions.filter(g=>g!==h.name)),u({description:`Removed ${h.name} from chart`,duration:2e3})):h.type==="metric"&&e.metrics.includes(h.name)&&(t(e.metrics.filter(g=>g!==h.name)),u({description:`Removed ${h.name} from chart`,duration:2e3}))},K=h=>{a(e.dimensions.filter(g=>g!==h))},X=h=>{t(e.metrics.filter(g=>g!==h))};return r.jsx(xt,{noPadding:!0,fullWidth:!0,children:r.jsx("div",{className:"p-2 md:p-3 h-full flex flex-col",children:r.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[r.jsx("div",{className:"sticky lg:top-0 z-30 pb-2 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-1 shadow-sm bg-background",children:r.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[r.jsx("div",{children:r.jsx("h1",{className:"text-xl font-bold",children:"Chart Builder"})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("div",{className:"w-32",children:r.jsxs(yt,{value:e.chartType,onValueChange:m,children:[r.jsx(wt,{className:"h-8 text-xs",children:r.jsx(jt,{placeholder:"Chart Type"})}),r.jsxs(St,{children:[r.jsx(ae,{value:"bar",children:"Bar Chart"}),r.jsx(ae,{value:"line",children:"Line Chart"}),r.jsx(ae,{value:"area",children:"Area Chart"}),r.jsx(ae,{value:"pie",children:"Pie Chart"})]})]})}),r.jsxs("div",{className:"flex items-center gap-2 px-2 border-l h-8",children:[r.jsx(vt,{htmlFor:"split-mode",className:"text-[10px] font-medium uppercase tracking-wider text-muted-foreground mr-1",children:"Split by Location"}),r.jsx(nt,{id:"split-mode",checked:A,onCheckedChange:P,disabled:R.locations.length<=1&&!A&&R.locations.length!==0})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(ue,{open:v,onOpenChange:C,children:[r.jsx(me,{asChild:!0,children:r.jsxs(se,{variant:"outline",className:L("w-32 justify-start text-left font-normal h-8 text-xs",!(l!=null&&l.from)&&"text-muted-foreground"),children:[r.jsx(je,{className:"mr-2 h-3 w-3"}),l!=null&&l.from?ne(l.from,"MMM dd, y"):r.jsx("span",{children:"From"})]})}),r.jsx(he,{className:"w-auto p-0",align:"start",children:r.jsx(Se,{mode:"single",selected:l==null?void 0:l.from,onSelect:h=>{p(g=>({...g,from:h})),C(!1)},defaultMonth:l==null?void 0:l.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),r.jsx("span",{className:"text-muted-foreground text-xs",children:"-"}),r.jsxs(ue,{open:S,onOpenChange:E,children:[r.jsx(me,{asChild:!0,children:r.jsxs(se,{variant:"outline",className:L("w-32 justify-start text-left font-normal h-8 text-xs",!(l!=null&&l.to)&&"text-muted-foreground"),children:[r.jsx(je,{className:"mr-2 h-3 w-3"}),l!=null&&l.to?ne(l.to,"MMM dd, y"):r.jsx("span",{children:"To"})]})}),r.jsx(he,{className:"w-auto p-0",align:"start",children:r.jsx(Se,{mode:"single",selected:l==null?void 0:l.to,onSelect:h=>{p(g=>({...g,to:h})),E(!1)},defaultMonth:l==null?void 0:l.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030,disabled:h=>h<((l==null?void 0:l.from)||new Date(0))})})]}),r.jsx(se,{onClick:B,size:"sm",className:"h-8 text-xs",disabled:!(l!=null&&l.from)||!(l!=null&&l.to),children:"Apply"})]})]})]})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:r.jsx(n.Suspense,{fallback:r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsx(ut,{className:"h-8 w-8 rounded-full"})}),children:r.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-2 min-h-0 h-full",children:[r.jsx("div",{className:"lg:w-72 shrink-0 h-full flex flex-col overflow-hidden",children:r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2",children:r.jsx(fr,{selectedDimensions:e.dimensions,selectedMetrics:e.metrics,onItemClick:j,onItemDoubleClick:k})})}),r.jsxs("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:[r.jsx("div",{className:"shrink-0 pb-2 border-b mb-2",children:r.jsx(lr,{availableFilters:O,filters:R,onFilterChange:q,orientation:"horizontal"})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:A?r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 p-1",children:[Array.from(new Set(e.chartData.map(h=>h.location))).map(h=>r.jsxs("div",{className:"border rounded-lg p-4 bg-card shadow-sm",children:[r.jsx("div",{className:"flex items-center justify-between mb-4 border-b pb-2",children:r.jsx(De,{children:r.jsxs(Ae,{children:[r.jsx(Me,{asChild:!0,children:r.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",children:[r.jsx("span",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded text-[10px]",children:fe(h)}),h.length>25?h.substring(0,25)+"...":h]})}),r.jsx(Te,{children:r.jsx("p",{children:h})})]})})}),r.jsx("div",{className:"h-[300px]",children:r.jsx(Re,{dimensions:e.dimensions,metrics:e.metrics,chartType:e.chartType,chartData:e.chartData.filter(g=>g.location===h),onRemoveDimension:K,onRemoveMetric:X})})]},h)),e.chartData.length===0&&r.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground italic",children:"No data available for the selected filters"})]}):r.jsx(Re,{dimensions:e.dimensions,metrics:e.metrics,chartType:e.chartType,chartData:e.chartData,onRemoveDimension:K,onRemoveMetric:X})})]})]})})})]})})})}export{Cr as default};
