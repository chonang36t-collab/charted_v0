import{c as wt,ab as ys,R as O,ac as js,r as f,h as bs,U as Ns,p as ws,j as e,v as Ss,P as Ee,q as De,w as Cs,e as We,B as te,I as Z,A as oe,L as As,y as X,ad as Ts,u as _s,d as $s,b as Es,a3 as ks,a4 as Ms,a5 as Os,a6 as Ls,a7 as Is,a8 as Ds,a9 as Ps,aa as Rs}from"./index-Klibvxa4.js";import{D as Fs}from"./DashboardLayout-nsE_-Rs8.js";import{C as F,d as B,a as se,b as ae}from"./card-BO8-srDA.js";import{c as St,R as Bs,I as Ks}from"./index-CbIXlYEH.js";import{D as Us}from"./DashboardHeader-DHzYBLd_.js";import{S as Ve,Z as Hs,C as Ct,u as Ws,O as Vs,T as zs}from"./TargetPerformanceChart-lqTbVBe3.js";import{u as Gs,L as qs,R as Ys}from"./LoadingOverlay-oGDTbsaD.js";import{_ as At,e as Qs,k as Tt,i as ze,a as _t,b as Js,c as Xs,d as Zs,f as $t,g as ea,h as Et,s as ta,j as sa,l as aa,m as ra,n as Ge,o as kt,p as Mt,q as Ot,r as na,t as ia,u as oa,v as la,w as ca,x as da,y as Lt,z as ha,D as ua,E as ma,F as fa,G as xa,H as ga,I as pa,J as we,K as va,M as ya,N as Pe,O as Re,P as st,Q as at,S as rt,U as ja,V as ba,W as Na,Z as wa,$ as Sa,a0 as nt,a1 as It,T as z,a2 as Ca,X as ce,Y as de,a3 as Aa,R as re,C as ve,B as ee,a4 as qe,L as Ta,a5 as it,a6 as ot}from"./generateCategoricalChart-CNf0BJui.js";import{B as Dt}from"./BarChart-B-oj905p.js";import{P as _a,a as $a,b as Ea}from"./PieChart-xFXULM4I.js";import{T as Pt,a as Rt,b as Ae,c as W,d as Ft,e as V}from"./table-3aBVd9li.js";import{P as ka}from"./pen-BTGc-D7s.js";import{T as Ma}from"./trash-2-C8hASoY8.js";import{L}from"./label-Buc4PXWu.js";import{f as E,P as Oa,a as La,b as Ia}from"./popover-CJsCkGE0.js";import{D as Da,b as Pa,c as Ra,d as Fa,f as Ba,e as Ka}from"./dialog-Cnq_-bJ4.js";import{S as ue,a as me,b as fe,c as xe,d as ie}from"./select-DH1kJ961.js";import{u as Ua}from"./useRecords-Cqi_hoAe.js";import{P as Ha}from"./plus-Bh30GZSS.js";import"./users-DpAGG94V.js";import"./locationUtils-CnFzmUsH.js";import"./checkbox-WuU7vfka.js";import"./index-XFqAjoT_.js";import"./AreaChart-BhXrfKy6.js";import"./useQuery-Dw1JntAP.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=wt("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=wt("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);function za(t,a){for(var s=-1,r=t==null?0:t.length;++s<r&&a(t[s],s,t)!==!1;);return t}var Ga=za,qa=At,Ya=Qs,Qa=Object.prototype,Ja=Qa.hasOwnProperty;function Xa(t,a,s){var r=t[a];(!(Ja.call(t,a)&&Ya(r,s))||s===void 0&&!(a in t))&&qa(t,a,s)}var Bt=Xa,Za=Bt,er=At;function tr(t,a,s,r){var n=!s;s||(s={});for(var i=-1,l=a.length;++i<l;){var o=a[i],h=r?r(s[o],t[o],o,s,t):void 0;h===void 0&&(h=t[o]),n?er(s,o,h):Za(s,o,h)}return s}var ye=tr,sr=ye,ar=Tt;function rr(t,a){return t&&sr(a,ar(a),t)}var nr=rr;function ir(t){var a=[];if(t!=null)for(var s in Object(t))a.push(s);return a}var or=ir,lr=ze,cr=_t,dr=or,hr=Object.prototype,ur=hr.hasOwnProperty;function mr(t){if(!lr(t))return dr(t);var a=cr(t),s=[];for(var r in t)r=="constructor"&&(a||!ur.call(t,r))||s.push(r);return s}var fr=mr,xr=Js,gr=fr,pr=Xs;function vr(t){return pr(t)?xr(t,!0):gr(t)}var Ye=vr,yr=ye,jr=Ye;function br(t,a){return t&&yr(a,jr(a),t)}var Nr=br,Te={exports:{}};Te.exports;(function(t,a){var s=Zs,r=a&&!a.nodeType&&a,n=r&&!0&&t&&!t.nodeType&&t,i=n&&n.exports===r,l=i?s.Buffer:void 0,o=l?l.allocUnsafe:void 0;function h(c,u){if(u)return c.slice();var d=c.length,x=o?o(d):new c.constructor(d);return c.copy(x),x}t.exports=h})(Te,Te.exports);var wr=Te.exports;function Sr(t,a){var s=-1,r=t.length;for(a||(a=Array(r));++s<r;)a[s]=t[s];return a}var Cr=Sr,Ar=ye,Tr=$t;function _r(t,a){return Ar(t,Tr(t),a)}var $r=_r,Er=ea,kr=Et,Mr=$t,Or=ta,Lr=Object.getOwnPropertySymbols,Ir=Lr?function(t){for(var a=[];t;)Er(a,Mr(t)),t=kr(t);return a}:Or,Kt=Ir,Dr=ye,Pr=Kt;function Rr(t,a){return Dr(t,Pr(t),a)}var Fr=Rr,Br=sa,Kr=Kt,Ur=Ye;function Hr(t){return Br(t,Ur,Kr)}var Ut=Hr,Wr=Object.prototype,Vr=Wr.hasOwnProperty;function zr(t){var a=t.length,s=new t.constructor(a);return a&&typeof t[0]=="string"&&Vr.call(t,"index")&&(s.index=t.index,s.input=t.input),s}var Gr=zr,lt=aa;function qr(t){var a=new t.constructor(t.byteLength);return new lt(a).set(new lt(t)),a}var Qe=qr,Yr=Qe;function Qr(t,a){var s=a?Yr(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.byteLength)}var Jr=Qr,Xr=/\w*$/;function Zr(t){var a=new t.constructor(t.source,Xr.exec(t));return a.lastIndex=t.lastIndex,a}var en=Zr,ct=ra,dt=ct?ct.prototype:void 0,ht=dt?dt.valueOf:void 0;function tn(t){return ht?Object(ht.call(t)):{}}var sn=tn,an=Qe;function rn(t,a){var s=a?an(t.buffer):t.buffer;return new t.constructor(s,t.byteOffset,t.length)}var nn=rn,on=Qe,ln=Jr,cn=en,dn=sn,hn=nn,un="[object Boolean]",mn="[object Date]",fn="[object Map]",xn="[object Number]",gn="[object RegExp]",pn="[object Set]",vn="[object String]",yn="[object Symbol]",jn="[object ArrayBuffer]",bn="[object DataView]",Nn="[object Float32Array]",wn="[object Float64Array]",Sn="[object Int8Array]",Cn="[object Int16Array]",An="[object Int32Array]",Tn="[object Uint8Array]",_n="[object Uint8ClampedArray]",$n="[object Uint16Array]",En="[object Uint32Array]";function kn(t,a,s){var r=t.constructor;switch(a){case jn:return on(t);case un:case mn:return new r(+t);case bn:return ln(t,s);case Nn:case wn:case Sn:case Cn:case An:case Tn:case _n:case $n:case En:return hn(t,s);case fn:return new r;case xn:case vn:return new r(t);case gn:return cn(t);case pn:return new r;case yn:return dn(t)}}var Mn=kn,On=ze,ut=Object.create,Ln=function(){function t(){}return function(a){if(!On(a))return{};if(ut)return ut(a);t.prototype=a;var s=new t;return t.prototype=void 0,s}}(),In=Ln,Dn=In,Pn=Et,Rn=_t;function Fn(t){return typeof t.constructor=="function"&&!Rn(t)?Dn(Pn(t)):{}}var Bn=Fn,Kn=Ge,Un=kt,Hn="[object Map]";function Wn(t){return Un(t)&&Kn(t)==Hn}var Vn=Wn,zn=Vn,Gn=Ot,mt=Mt,ft=mt&&mt.isMap,qn=ft?Gn(ft):zn,Yn=qn,Qn=Ge,Jn=kt,Xn="[object Set]";function Zn(t){return Jn(t)&&Qn(t)==Xn}var ei=Zn,ti=ei,si=Ot,xt=Mt,gt=xt&&xt.isSet,ai=gt?si(gt):ti,ri=ai,ni=na,ii=Ga,oi=Bt,li=nr,ci=Nr,di=wr,hi=Cr,ui=$r,mi=Fr,fi=oa,xi=Ut,gi=Ge,pi=Gr,vi=Mn,yi=Bn,ji=la,bi=ia,Ni=Yn,wi=ze,Si=ri,Ci=Tt,Ai=Ye,Ti=1,_i=2,$i=4,Ht="[object Arguments]",Ei="[object Array]",ki="[object Boolean]",Mi="[object Date]",Oi="[object Error]",Wt="[object Function]",Li="[object GeneratorFunction]",Ii="[object Map]",Di="[object Number]",Vt="[object Object]",Pi="[object RegExp]",Ri="[object Set]",Fi="[object String]",Bi="[object Symbol]",Ki="[object WeakMap]",Ui="[object ArrayBuffer]",Hi="[object DataView]",Wi="[object Float32Array]",Vi="[object Float64Array]",zi="[object Int8Array]",Gi="[object Int16Array]",qi="[object Int32Array]",Yi="[object Uint8Array]",Qi="[object Uint8ClampedArray]",Ji="[object Uint16Array]",Xi="[object Uint32Array]",w={};w[Ht]=w[Ei]=w[Ui]=w[Hi]=w[ki]=w[Mi]=w[Wi]=w[Vi]=w[zi]=w[Gi]=w[qi]=w[Ii]=w[Di]=w[Vt]=w[Pi]=w[Ri]=w[Fi]=w[Bi]=w[Yi]=w[Qi]=w[Ji]=w[Xi]=!0;w[Oi]=w[Wt]=w[Ki]=!1;function Ce(t,a,s,r,n,i){var l,o=a&Ti,h=a&_i,c=a&$i;if(s&&(l=n?s(t,r,n,i):s(t)),l!==void 0)return l;if(!wi(t))return t;var u=ji(t);if(u){if(l=pi(t),!o)return hi(t,l)}else{var d=gi(t),x=d==Wt||d==Li;if(bi(t))return di(t,o);if(d==Vt||d==Ht||x&&!n){if(l=h||x?{}:yi(t),!o)return h?mi(t,ci(l,t)):ui(t,li(l,t))}else{if(!w[d])return n?t:{};l=vi(t,d,o)}}i||(i=new ni);var g=i.get(t);if(g)return g;i.set(t,l),Si(t)?t.forEach(function(N){l.add(Ce(N,a,s,N,t,i))}):Ni(t)&&t.forEach(function(N,j){l.set(j,Ce(N,a,s,j,t,i))});var C=c?h?xi:fi:h?Ai:Ci,y=u?void 0:C(t);return ii(y||t,function(N,j){y&&(j=N,N=t[j]),oi(l,j,Ce(N,a,s,j,t,i))}),l}var Zi=Ce,eo=ca,to=da;function so(t,a){return a.length<2?t:eo(t,to(a,0,-1))}var ao=so,ro=Lt,no=ha,io=ao,oo=ua;function lo(t,a){return a=ro(a,t),t=io(t,a),t==null||delete t[oo(no(a))]}var co=lo,ho=ma;function uo(t){return ho(t)?void 0:t}var mo=uo,fo=fa;function xo(t){var a=t==null?0:t.length;return a?fo(t,1):[]}var go=xo,po=go,vo=xa,yo=ga;function jo(t){return yo(vo(t,void 0,po),t+"")}var bo=jo,No=pa,wo=Zi,So=co,Co=Lt,Ao=ye,To=mo,_o=bo,$o=Ut,Eo=1,ko=2,Mo=4,Oo=_o(function(t,a){var s={};if(t==null)return s;var r=!1;a=No(a,function(i){return i=Co(i,t),r||(r=i.length>1),i}),Ao(t,$o(t),s),r&&(s=wo(s,Eo|ko|Mo,To));for(var n=a.length;n--;)So(s,a[n]);return s}),Lo=Oo;const Io=ys(Lo);var Do=["#1890FF","#66B5FF","#41D9C7","#2FC25B","#6EDB8F","#9AE65C","#FACC14","#E6965C","#57AD71","#223273","#738AE6","#7564CC","#8543E0","#A877ED","#5C8EE6","#13C2C2","#70E0E0","#5CA3E6","#3436C7","#8082FF","#DD81E6","#F04864","#FA7D92","#D598D9"],Po=["width","height","className","style","children","type"];function le(t){"@babel/helpers - typeof";return le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},le(t)}function _e(){return _e=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},_e.apply(this,arguments)}function Ro(t,a){if(t==null)return{};var s=Fo(t,a),r,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],!(a.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(s[r]=t[r])}return s}function Fo(t,a){if(t==null)return{};var s={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(a.indexOf(r)>=0)continue;s[r]=t[r]}return s}function Bo(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}function pt(t,a){for(var s=0;s<a.length;s++){var r=a[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Gt(r.key),r)}}function Ko(t,a,s){return a&&pt(t.prototype,a),s&&pt(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Uo(t,a,s){return a=$e(a),Ho(t,zt()?Reflect.construct(a,s||[],$e(t).constructor):a.apply(t,s))}function Ho(t,a){if(a&&(le(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Wo(t)}function Wo(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zt=function(){return!!t})()}function $e(t){return $e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},$e(t)}function Vo(t,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),a&&He(t,a)}function He(t,a){return He=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},He(t,a)}function vt(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,r)}return s}function S(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?vt(Object(s),!0).forEach(function(r){Q(t,r,s[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):vt(Object(s)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(s,r))})}return t}function Q(t,a,s){return a=Gt(a),a in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function Gt(t){var a=zo(t,"string");return le(a)=="symbol"?a:a+""}function zo(t,a){if(le(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var r=s.call(t,a||"default");if(le(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}var pe="value",Fe=function t(a){var s=a.depth,r=a.node,n=a.index,i=a.valueKey,l=r.children,o=s+1,h=l&&l.length?l.map(function(u,d){return t({depth:o,node:u,index:d,valueKey:i})}):null,c;return l&&l.length?c=h.reduce(function(u,d){return u+d[pe]},0):c=It(r[i])||r[i]<=0?0:r[i],S(S({},r),{},Q(Q(Q({children:h},pe,c),"depth",s),"index",n))},Go=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}},qo=function(a,s){var r=s<0?0:s;return a.map(function(n){var i=n[pe]*r;return S(S({},n),{},{area:It(i)||i<=0?0:i})})},Yo=function(a,s,r){var n=s*s,i=a.area*a.area,l=a.reduce(function(c,u){return{min:Math.min(c.min,u.area),max:Math.max(c.max,u.area)}},{min:1/0,max:0}),o=l.min,h=l.max;return i?Math.max(n*h*r/i,i/(n*o*r)):1/0},Qo=function(a,s,r,n){var i=s?Math.round(a.area/s):0;(n||i>r.height)&&(i=r.height);for(var l=r.x,o,h=0,c=a.length;h<c;h++)o=a[h],o.x=l,o.y=r.y,o.height=i,o.width=Math.min(i?Math.round(o.area/i):0,r.x+r.width-l),l+=o.width;return o.width+=r.x+r.width-l,S(S({},r),{},{y:r.y+i,height:r.height-i})},Jo=function(a,s,r,n){var i=s?Math.round(a.area/s):0;(n||i>r.width)&&(i=r.width);for(var l=r.y,o,h=0,c=a.length;h<c;h++)o=a[h],o.x=r.x,o.y=l,o.width=i,o.height=Math.min(i?Math.round(o.area/i):0,r.y+r.height-l),l+=o.height;return o&&(o.height+=r.y+r.height-l),S(S({},r),{},{x:r.x+i,width:r.width-i})},yt=function(a,s,r,n){return s===r.width?Qo(a,s,r,n):Jo(a,s,r,n)},Be=function t(a,s){var r=a.children;if(r&&r.length){var n=Go(a),i=[],l=1/0,o,h,c=Math.min(n.width,n.height),u=qo(r,n.width*n.height/a[pe]),d=u.slice();for(i.area=0;d.length>0;)i.push(o=d[0]),i.area+=o.area,h=Yo(i,c,s),h<=l?(d.shift(),l=h):(i.area-=i.pop().area,n=yt(i,c,n,!1),c=Math.min(n.width,n.height),i.length=i.area=0,l=1/0);return i.length&&(n=yt(i,c,n,!0),i.length=i.area=0),S(S({},a),{},{children:u.map(function(x){return t(x,s)})})}return a},Xo={isTooltipActive:!1,isAnimationFinished:!1,activeNode:null,formatRoot:null,currentRoot:null,nestIndex:[]},Je=function(t){function a(){var s;Bo(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return s=Uo(this,a,[].concat(n)),Q(s,"state",S({},Xo)),Q(s,"handleAnimationEnd",function(){var l=s.props.onAnimationEnd;s.setState({isAnimationFinished:!0}),we(l)&&l()}),Q(s,"handleAnimationStart",function(){var l=s.props.onAnimationStart;s.setState({isAnimationFinished:!1}),we(l)&&l()}),s}return Vo(a,t),Ko(a,[{key:"handleMouseEnter",value:function(r,n){n.persist();var i=this.props,l=i.onMouseEnter,o=i.children,h=Pe(o,z);h?this.setState({isTooltipActive:!0,activeNode:r},function(){l&&l(r,n)}):l&&l(r,n)}},{key:"handleMouseLeave",value:function(r,n){n.persist();var i=this.props,l=i.onMouseLeave,o=i.children,h=Pe(o,z);h?this.setState({isTooltipActive:!1,activeNode:null},function(){l&&l(r,n)}):l&&l(r,n)}},{key:"handleClick",value:function(r){var n=this.props,i=n.onClick,l=n.type;if(l==="nest"&&r.children){var o=this.props,h=o.width,c=o.height,u=o.dataKey,d=o.aspectRatio,x=Fe({depth:0,node:S(S({},r),{},{x:0,y:0,width:h,height:c}),index:0,valueKey:u}),g=Be(x,d),C=this.state.nestIndex;C.push(r),this.setState({formatRoot:g,currentRoot:x,nestIndex:C})}i&&i(r)}},{key:"handleNestIndex",value:function(r,n){var i=this.state.nestIndex,l=this.props,o=l.width,h=l.height,c=l.dataKey,u=l.aspectRatio,d=Fe({depth:0,node:S(S({},r),{},{x:0,y:0,width:o,height:h}),index:0,valueKey:c}),x=Be(d,u);i=i.slice(0,n+1),this.setState({formatRoot:x,currentRoot:r,nestIndex:i})}},{key:"renderItem",value:function(r,n,i){var l=this,o=this.props,h=o.isAnimationActive,c=o.animationBegin,u=o.animationDuration,d=o.animationEasing,x=o.isUpdateAnimationActive,g=o.type,C=o.animationId,y=o.colorPanel,N=this.state.isAnimationFinished,j=n.width,k=n.height,M=n.x,K=n.y,J=n.depth,U=parseInt("".concat((Math.random()*2-1)*j),10),I={};return(i||g==="nest")&&(I={onMouseEnter:this.handleMouseEnter.bind(this,n),onMouseLeave:this.handleMouseLeave.bind(this,n),onClick:this.handleClick.bind(this,n)}),h?O.createElement(st,{begin:c,duration:u,isActive:h,easing:d,key:"treemap-".concat(C),from:{x:M,y:K,width:j,height:k},to:{x:M,y:K,width:j,height:k},onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(v){var m=v.x,$=v.y,D=v.width,P=v.height;return O.createElement(st,{from:"translate(".concat(U,"px, ").concat(U,"px)"),to:"translate(0, 0)",attributeName:"transform",begin:c,easing:d,isActive:h,duration:u},O.createElement(Re,I,function(){return J>2&&!N?null:l.constructor.renderContentItem(r,S(S({},n),{},{isAnimationActive:h,isUpdateAnimationActive:!x,width:D,height:P,x:m,y:$}),g,y)}()))}):O.createElement(Re,I,this.constructor.renderContentItem(r,S(S({},n),{},{isAnimationActive:!1,isUpdateAnimationActive:!1,width:j,height:k,x:M,y:K}),g,y))}},{key:"renderNode",value:function(r,n){var i=this,l=this.props,o=l.content,h=l.type,c=S(S(S({},at(this.props,!1)),n),{},{root:r}),u=!n.children||!n.children.length,d=this.state.currentRoot,x=(d.children||[]).filter(function(g){return g.depth===n.depth&&g.name===n.name});return!x.length&&r.depth&&h==="nest"?null:O.createElement(Re,{key:"recharts-treemap-node-".concat(c.x,"-").concat(c.y,"-").concat(c.name),className:"recharts-treemap-depth-".concat(n.depth)},this.renderItem(o,c,u),n.children&&n.children.length?n.children.map(function(g){return i.renderNode(n,g)}):null)}},{key:"renderAllNodes",value:function(){var r=this.state.formatRoot;return r?this.renderNode(r,r):null}},{key:"renderTooltip",value:function(){var r=this.props,n=r.children,i=r.nameKey,l=Pe(n,z);if(!l)return null;var o=this.props,h=o.width,c=o.height,u=this.state,d=u.isTooltipActive,x=u.activeNode,g={x:0,y:0,width:h,height:c},C=x?{x:x.x+x.width/2,y:x.y+x.height/2}:null,y=d&&x?[{payload:x,name:rt(x,i,""),value:rt(x,pe)}]:[];return O.cloneElement(l,{viewBox:g,active:d,coordinate:C,label:"",payload:y})}},{key:"renderNestIndex",value:function(){var r=this,n=this.props,i=n.nameKey,l=n.nestIndexContent,o=this.state.nestIndex;return O.createElement("div",{className:"recharts-treemap-nest-index-wrapper",style:{marginTop:"8px",textAlign:"center"}},o.map(function(h,c){var u=ja(h,i,"root"),d=null;return O.isValidElement(l)&&(d=O.cloneElement(l,h,c)),we(l)?d=l(h,c):d=u,O.createElement("div",{onClick:r.handleNestIndex.bind(r,h,c),key:"nest-index-".concat(ba()),className:"recharts-treemap-nest-index-box",style:{cursor:"pointer",display:"inline-block",padding:"0 7px",background:"#000",color:"#fff",marginRight:"3px"}},d)}))}},{key:"render",value:function(){if(!Na(this))return null;var r=this.props,n=r.width,i=r.height,l=r.className,o=r.style,h=r.children,c=r.type,u=Ro(r,Po),d=at(u,!1);return O.createElement("div",{className:js("recharts-wrapper",l),style:S(S({},o),{},{position:"relative",cursor:"default",width:n,height:i}),role:"region"},O.createElement(wa,_e({},d,{width:n,height:c==="nest"?i-30:i}),this.renderAllNodes(),Sa(h)),this.renderTooltip(),c==="nest"&&this.renderNestIndex())}}],[{key:"getDerivedStateFromProps",value:function(r,n){if(r.data!==n.prevData||r.type!==n.prevType||r.width!==n.prevWidth||r.height!==n.prevHeight||r.dataKey!==n.prevDataKey||r.aspectRatio!==n.prevAspectRatio){var i=Fe({depth:0,node:{children:r.data,x:0,y:0,width:r.width,height:r.height},index:0,valueKey:r.dataKey}),l=Be(i,r.aspectRatio);return S(S({},n),{},{formatRoot:l,currentRoot:i,nestIndex:[i],prevAspectRatio:r.aspectRatio,prevData:r.data,prevWidth:r.width,prevHeight:r.height,prevDataKey:r.dataKey,prevType:r.type})}return null}},{key:"renderContentItem",value:function(r,n,i,l){if(O.isValidElement(r))return O.cloneElement(r,n);if(we(r))return r(n);var o=n.x,h=n.y,c=n.width,u=n.height,d=n.index,x=null;c>10&&u>10&&n.children&&i==="nest"&&(x=O.createElement(_a,{points:[{x:o+2,y:h+u/2},{x:o+6,y:h+u/2+3},{x:o+2,y:h+u/2+6}]}));var g=null,C=va(n.name);c>20&&u>20&&C.width<c&&C.height<u&&(g=O.createElement("text",{x:o+8,y:h+u/2+7,fontSize:14},n.name));var y=l||Do;return O.createElement("g",null,O.createElement(ya,_e({fill:n.depth<2?y[d%y.length]:"rgba(255,255,255,0)",stroke:"#fff"},Io(n,"children"),{role:"img"})),x,g)}}])}(f.PureComponent);Q(Je,"displayName","Treemap");Q(Je,"defaultProps",{aspectRatio:.5*(1+Math.sqrt(5)),dataKey:"value",type:"flat",isAnimationActive:!nt.isSsr,isUpdateAnimationActive:!nt.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"linear"});var Zo=Ca({chartName:"ScatterChart",GraphicalChild:Ve,defaultTooltipEventType:"item",validateTooltipEventTypes:["item"],axisComponents:[{axisType:"xAxis",AxisComp:ce},{axisType:"yAxis",AxisComp:de},{axisType:"zAxis",AxisComp:Hs}],formatAxisMap:Aa}),ke="Tabs",[el,Vl]=bs(ke,[St]),qt=St(),[tl,Xe]=el(ke),Yt=f.forwardRef((t,a)=>{const{__scopeTabs:s,value:r,onValueChange:n,defaultValue:i,orientation:l="horizontal",dir:o,activationMode:h="automatic",...c}=t,u=Ns(o),[d,x]=ws({prop:r,onChange:n,defaultProp:i??"",caller:ke});return e.jsx(tl,{scope:s,baseId:Ss(),value:d,onValueChange:x,orientation:l,dir:u,activationMode:h,children:e.jsx(Ee.div,{dir:u,"data-orientation":l,...c,ref:a})})});Yt.displayName=ke;var Qt="TabsList",Jt=f.forwardRef((t,a)=>{const{__scopeTabs:s,loop:r=!0,...n}=t,i=Xe(Qt,s),l=qt(s);return e.jsx(Bs,{asChild:!0,...l,orientation:i.orientation,dir:i.dir,loop:r,children:e.jsx(Ee.div,{role:"tablist","aria-orientation":i.orientation,...n,ref:a})})});Jt.displayName=Qt;var Xt="TabsTrigger",Zt=f.forwardRef((t,a)=>{const{__scopeTabs:s,value:r,disabled:n=!1,...i}=t,l=Xe(Xt,s),o=qt(s),h=ss(l.baseId,r),c=as(l.baseId,r),u=r===l.value;return e.jsx(Ks,{asChild:!0,...o,focusable:!n,active:u,children:e.jsx(Ee.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":c,"data-state":u?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:h,...i,ref:a,onMouseDown:De(t.onMouseDown,d=>{!n&&d.button===0&&d.ctrlKey===!1?l.onValueChange(r):d.preventDefault()}),onKeyDown:De(t.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&l.onValueChange(r)}),onFocus:De(t.onFocus,()=>{const d=l.activationMode!=="manual";!u&&!n&&d&&l.onValueChange(r)})})})});Zt.displayName=Xt;var es="TabsContent",ts=f.forwardRef((t,a)=>{const{__scopeTabs:s,value:r,forceMount:n,children:i,...l}=t,o=Xe(es,s),h=ss(o.baseId,r),c=as(o.baseId,r),u=r===o.value,d=f.useRef(u);return f.useEffect(()=>{const x=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(x)},[]),e.jsx(Cs,{present:n||u,children:({present:x})=>e.jsx(Ee.div,{"data-state":u?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":h,hidden:!x,id:c,tabIndex:0,...l,ref:a,style:{...t.style,animationDuration:d.current?"0s":void 0},children:x&&i})})});ts.displayName=es;function ss(t,a){return`${t}-trigger-${a}`}function as(t,a){return`${t}-content-${a}`}var sl=Yt,rs=Jt,ns=Zt,is=ts;const Ze=sl,Me=f.forwardRef(({className:t,...a},s)=>e.jsx(rs,{ref:s,className:We("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...a}));Me.displayName=rs.displayName;const H=f.forwardRef(({className:t,...a},s)=>e.jsx(ns,{ref:s,className:We("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...a}));H.displayName=ns.displayName;const Y=f.forwardRef(({className:t,...a},s)=>e.jsx(is,{ref:s,className:We("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...a}));Y.displayName=is.displayName;const al=({active:t,payload:a,label:s,metric:r})=>{if(t&&a&&a.length){const n=["clients","employees","shifts","hours","targetAchievement","missedTargets"].includes(r),i=a[0].value;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:s}),e.jsx("p",{className:"text-sm",children:n?i.toLocaleString():i.toLocaleString(void 0,{style:"currency",currency:"GBP"})})]})}return null},Ke=({data:t,metric:a,onBarClick:s})=>!t||t.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No breakdown data available"})}):e.jsx(F,{children:e.jsx(B,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(re,{width:"100%",height:"100%",children:e.jsxs(Dt,{data:t,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(ve,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(ce,{type:"number",hide:!0}),e.jsx(de,{dataKey:"name",type:"category",width:120,tick:{fontSize:12}}),e.jsx(z,{content:e.jsx(al,{metric:a})}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0],onClick:s,children:t.map((r,n)=>e.jsx(qe,{fill:"hsl(var(--primary))",fillOpacity:.8+n*.05},`cell-${n}`))})]})})})})}),jt=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#8dd1e1","#a4de6c","#d0ed57"],rl=({active:t,payload:a,metric:s})=>{if(t&&a&&a.length){const r=["revenue","costs","profit","overheads"].includes(s);return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:a[0].name}),e.jsx("p",{className:"text-sm",children:r?Number(a[0].value).toLocaleString(void 0,{style:"currency",currency:"GBP"}):Number(a[0].value).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:`${(a[0].payload.percentage||0).toFixed(1)}%`})]})}return null},Se=({data:t,metric:a})=>{if(!t||t.length===0)return e.jsx(F,{children:e.jsx(B,{className:"pt-6",children:e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No distribution data available"})})})});const s=[...t].sort((i,l)=>l.value-i.value),r=s.reduce((i,l)=>i+l.value,0),n=s.map(i=>({...i,percentage:r>0?i.value/r*100:0}));return e.jsx(F,{children:e.jsx(B,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(re,{width:"100%",height:"100%",children:e.jsxs($a,{children:[e.jsx(Ea,{data:n,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",children:n.map((i,l)=>e.jsx(qe,{fill:jt[l%jt.length]},`cell-${l}`))}),e.jsx(z,{content:e.jsx(rl,{metric:a})}),e.jsx(Ta,{})]})})})})})},nl=({data:t,onEdit:a,onDelete:s})=>!t||t.length===0?e.jsx("div",{className:"h-[200px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No overhead details available"})}):e.jsxs(F,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Overheads Details"})}),e.jsx(B,{children:e.jsxs(Pt,{children:[e.jsx(Rt,{children:e.jsxs(Ae,{children:[e.jsx(W,{children:"Title"}),e.jsx(W,{children:"Month"}),e.jsx(W,{children:"Location"}),e.jsx(W,{children:"Site"}),e.jsx(W,{className:"text-right",children:"Amount"}),e.jsx(W,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Ft,{children:t.map(r=>e.jsxs(Ae,{children:[e.jsx(V,{className:"font-medium",children:r.name}),e.jsxs(V,{children:[r.month," ",r.year]}),e.jsx(V,{children:r.location||"-"}),e.jsx(V,{children:r.site||"-"}),e.jsx(V,{className:"text-right",children:r.value.toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx(V,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-500 hover:text-blue-600",onClick:()=>a(r),children:e.jsx(ka,{className:"h-4 w-4"})}),e.jsx(te,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600",onClick:()=>s(r.id),children:e.jsx(Ma,{className:"h-4 w-4"})})]})})]},r.id))})]})})]}),il=t=>{const a=[];for(let s=0;s<t;s++)a.push(s*360/t%360);return a.map(s=>`hsl(${s}, 70%, 60%)`)},ol=({active:t,payload:a})=>{if(t&&a&&a.length){const s=a[0].payload;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg max-w-xs",children:[e.jsx("p",{className:"font-semibold text-foreground mb-2",children:s.tierName}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Clients:"})," ",s.clientCount]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total Revenue:"})," £",s.totalRevenue.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Avg/Client:"})," £",s.avgRevenue.toLocaleString()]})]}),s.hoveredClient&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border",children:[e.jsx("p",{className:"font-medium text-primary",children:s.hoveredClient.name}),e.jsxs("p",{className:"text-sm",children:["£",s.hoveredClient.revenue.toLocaleString()]})]})]})}return null},ll=({data:t})=>{if(!t||t.length===0)return e.jsx("div",{className:"h-[400px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No tier data available"})});const a=t.map(s=>{const r=il(s.clients.length);return{tierName:s.name,totalRevenue:s.value,clientCount:s.clientCount,avgRevenue:s.avgRevenue,clients:s.clients,colors:r}});return e.jsxs(F,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Revenue Distribution by Tier & Client"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Each bar is segmented by individual clients within the tier"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"h-[500px]",children:e.jsx(re,{width:"100%",height:"100%",children:e.jsxs(Dt,{data:a,layout:"vertical",margin:{top:20,right:30,left:100,bottom:20},children:[e.jsx(ve,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(ce,{type:"number",hide:!0}),e.jsx(de,{dataKey:"tierName",type:"category",width:90,tick:{fontSize:13,fontWeight:500}}),e.jsx(z,{content:e.jsx(ol,{})}),a.map((s,r)=>s.clients.map((n,i)=>e.jsx(ee,{dataKey:()=>n.revenue,stackId:r,fill:s.colors[i],radius:i===s.clients.length-1?[0,4,4,0]:[0,0,0,0],children:a.map((l,o)=>{const h=o===r;return e.jsx(qe,{fill:h?s.colors[i]:"transparent",stroke:h?"rgba(0,0,0,0.1)":"none",strokeWidth:.5,style:{cursor:"pointer"},onMouseEnter:c=>{h&&(c.target.style.opacity="0.8")},onMouseLeave:c=>{h&&(c.target.style.opacity="1")}},`cell-${r}-${i}-${o}`)})},`${r}-${i}`)))]})})}),e.jsx("div",{className:"mt-4 space-y-3",children:a.map((s,r)=>e.jsxs("div",{className:"border-t pt-3 first:border-t-0 first:pt-0",children:[e.jsx("p",{className:"font-semibold mb-2",children:s.tierName}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:s.clients.map((n,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm flex-shrink-0",style:{backgroundColor:s.colors[i]}}),e.jsx("span",{className:"truncate",title:`${n.name}: £${n.revenue.toLocaleString()}`,children:n.name})]},i))})]},r))})]})]})},cl=({active:t,payload:a})=>{if(t&&a&&a.length){const s=a[0].payload;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground mb-2",children:s.clientName}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total Hours:"})," ",s.totalHours.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Staff Assigned:"})," ",s.staffCount]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Shifts:"})," ",s.shiftCount]})]})]})}return null},dl=({data:t,medianHours:a,medianStaff:s})=>!t||t.length===0?e.jsxs(F,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Client Workload vs Staff Coverage"})}),e.jsx(B,{children:e.jsx("div",{className:"h-[500px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(F,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Client Workload vs Staff Coverage"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Each dot represents a client. Dashed lines show median values."})]}),e.jsxs(B,{children:[e.jsx("div",{className:"h-[550px]",children:e.jsx(re,{width:"100%",height:"100%",children:e.jsxs(Zo,{margin:{top:20,right:30,bottom:70,left:70},children:[e.jsx(ve,{strokeDasharray:"3 3"}),e.jsx(ce,{type:"number",dataKey:"totalHours",name:"Total Paid Hours",tickFormatter:r=>r.toLocaleString(),children:e.jsx(it,{value:"Total Paid Hours",position:"bottom",offset:50,style:{fontSize:14,fontWeight:500}})}),e.jsx(de,{type:"number",dataKey:"staffCount",name:"Staff Count",allowDecimals:!1,children:e.jsx(it,{value:"Staff Assigned",angle:-90,position:"left",offset:50,style:{fontSize:14,fontWeight:500}})}),e.jsx(z,{content:e.jsx(cl,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(ot,{x:a,stroke:"hsl(var(--primary))",strokeDasharray:"5 5",strokeWidth:2,label:{value:`Median: ${a.toLocaleString()}h`,position:"top",fill:"hsl(var(--primary))",fontSize:12}}),e.jsx(ot,{y:s,stroke:"hsl(var(--chart-2))",strokeDasharray:"5 5",strokeWidth:2,label:{value:`Median: ${s} staff`,position:"right",fill:"hsl(var(--chart-2))",fontSize:12}}),e.jsx(Ve,{data:t,fill:"hsl(var(--primary))",fillOpacity:.7,strokeWidth:1,stroke:"hsl(var(--primary))"})]})})}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Median Hours"}),e.jsx("p",{className:"text-2xl font-bold",children:a.toLocaleString()})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Median Staff"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(s)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:t.reduce((r,n)=>r+n.shiftCount,0).toLocaleString()})]})]})]})]}),hl=({dateRange:t,locations:a=[],sites:s=[]})=>{const[r,n]=f.useState("calendar"),[i,l]=f.useState([]),[o,h]=f.useState([]),[c,u]=f.useState([]),[d,x]=f.useState([]),[g,C]=f.useState(!1),[y,N]=f.useState(33),[j,k]=f.useState(67),[M,K]=f.useState(!1);f.useEffect(()=>{(async()=>{C(!0);try{const m=new URLSearchParams({start:E(t.from,"yyyy-MM-dd"),end:E(t.to,"yyyy-MM-dd"),view_type:r});a&&a.length>0&&a.forEach(ne=>m.append("locations",ne)),s&&s.length>0&&s.forEach(ne=>m.append("sites",ne));const $={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},D=await fetch(`/api/dashboard/shifts-heatmap?${m.toString()}`,{headers:$,credentials:"include"});if(!D.ok){console.error(`Heatmap API returned ${D.status}`);return}const P=await D.json();P.view_type==="calendar"?l(P.data||[]):(h(P.data||[]),u(P.locations||[]),x(P.dates||[]))}catch(m){console.error("Error fetching heatmap data:",m)}finally{C(!1)}})()},[t,a,s,r]);const J=()=>Math.max(...r==="calendar"?i.map(v=>v.shift_count):o.map(v=>v.shift_count),1),U=v=>{const m=J(),$=v/m*100;return $===0?"#f8f9fa":$<y?"#d4edda":$<j?"#fff3cd":"#f8d7da"},I=(v,m)=>{const $=o.find(D=>D.location===v&&D.date===m);return $?$.shift_count:0};return e.jsxs(F,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Shift Density Heatmap"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Visualize shift distribution to identify peak workload periods"}),e.jsxs("div",{className:"mt-4 p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(L,{className:"font-semibold",children:"Intensity Thresholds (%)"}),e.jsx(te,{variant:"outline",size:"sm",onClick:()=>K(!M),children:M?"Done":"Edit"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs(L,{className:"text-xs",children:["Low (","<"," ",y,"%)"]}),M?e.jsx(Z,{type:"number",min:"0",max:"100",value:y,onChange:v=>N(Number(v.target.value)),className:"mt-1"}):e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#d4edda"}}),e.jsxs("span",{className:"text-sm",children:["0-",y,"%"]})]})]}),e.jsxs("div",{children:[e.jsxs(L,{className:"text-xs",children:["Medium (",y,"-",j,"%)"]}),M?e.jsx(Z,{type:"number",min:"0",max:"100",value:j,onChange:v=>k(Number(v.target.value)),className:"mt-1"}):e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#fff3cd"}}),e.jsxs("span",{className:"text-sm",children:[y,"-",j,"%"]})]})]}),e.jsxs("div",{children:[e.jsxs(L,{className:"text-xs",children:["High (",">="," ",j,"%)"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#f8d7da"}}),e.jsxs("span",{className:"text-sm",children:[j,"-100%"]})]})]})]})]})]}),e.jsx(B,{children:e.jsxs(Ze,{value:r,onValueChange:v=>n(v),children:[e.jsxs(Me,{className:"mb-4",children:[e.jsx(H,{value:"calendar",children:"Calendar View"}),e.jsx(H,{value:"location_day",children:"By Location"})]}),e.jsx(Y,{value:"calendar",children:g?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):i.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No shift data available"}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2",children:i.map((v,m)=>e.jsxs("div",{className:"relative p-3 rounded-md border text-center cursor-pointer transition-all hover:shadow-md",style:{backgroundColor:U(v.shift_count)},title:`${v.date} (${v.day_of_week}): ${v.shift_count} shifts`,children:[e.jsx("div",{className:"text-xs font-medium",children:E(new Date(v.date),"MMM d")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:v.day_of_week.slice(0,3)}),e.jsx("div",{className:"text-lg font-bold mt-1",children:v.shift_count})]},m))}),e.jsxs("div",{className:"flex items-center justify-center gap-4 pt-4 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Intensity:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#d4edda"}}),e.jsx("span",{className:"text-xs",children:"Low"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#fff3cd"}}),e.jsx("span",{className:"text-xs",children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#f8d7da"}}),e.jsx("span",{className:"text-xs",children:"High"})]})]})]})}),e.jsx(Y,{value:"location_day",children:g?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):c.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No location data available"}):e.jsxs("div",{className:"overflow-x-scroll max-w-full",children:[e.jsx("div",{className:"inline-block min-w-full",children:e.jsxs("table",{className:"border-collapse",style:{minWidth:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 bg-background border p-2 text-left font-medium text-sm",children:"Location"}),d.slice(0,31).map((v,m)=>e.jsx("th",{className:"border p-2 text-center text-xs whitespace-nowrap",children:E(new Date(v),"MMM d")},m))]})}),e.jsx("tbody",{children:c.map((v,m)=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-background border p-2 font-medium text-sm",children:v}),d.slice(0,31).map(($,D)=>{const P=I(v,$);return e.jsx("td",{className:"border p-2 text-center text-sm cursor-pointer hover:opacity-80",style:{backgroundColor:U(P)},title:`${v} - ${$}: ${P} shifts`,children:P>0?P:""},D)})]},m))})]})}),d.length>31&&e.jsx("div",{className:"text-center text-sm text-muted-foreground mt-2",children:"Showing first 31 days. Adjust date range for focused view."}),e.jsxs("div",{className:"flex items-center justify-center gap-4 pt-4 border-t mt-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Intensity:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#d4edda"}}),e.jsx("span",{className:"text-xs",children:"Low"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#fff3cd"}}),e.jsx("span",{className:"text-xs",children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#f8d7da"}}),e.jsx("span",{className:"text-xs",children:"High"})]})]})]})})]})})]})},ul=t=>{const{x:a,y:s,width:r,height:n,stroke:i,fill:l,payload:o}=t;if(!o||!o.median||n===0)return null;const h=n/o.median,c=s+n,u=k=>c-k*h,d=u(o.min),x=u(o.q1),g=u(o.median),C=u(o.q3),y=u(o.max),N=a+r/2,j=r/2;return e.jsxs("g",{children:[e.jsx("line",{x1:N,y1:y,x2:N,y2:d,stroke:i,strokeWidth:1}),e.jsx("line",{x1:N-j/2,y1:y,x2:N+j/2,y2:y,stroke:i,strokeWidth:1}),e.jsx("line",{x1:N-j/2,y1:d,x2:N+j/2,y2:d,stroke:i,strokeWidth:1}),e.jsx("rect",{x:a,y:C,width:r,height:Math.abs(x-C),stroke:i,fill:l,fillOpacity:.6}),e.jsx("line",{x1:a,y1:g,x2:a+r,y2:g,stroke:i,strokeWidth:2}),o.outliers&&o.outliers.map((k,M)=>e.jsx("circle",{cx:N,cy:u(k),r:2,fill:"#ef4444",opacity:.6},M))]})},ml=({active:t,payload:a,label:s})=>{if(t&&a&&a.length){const r=a[0].payload;return e.jsxs("div",{className:"bg-popover border text-popover-foreground p-3 rounded-lg shadow-md text-sm",children:[e.jsx("p",{className:"font-semibold mb-2",children:r.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Max:"}),e.jsxs("span",{className:"font-medium",children:[r.max.toFixed(1),"h"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Q3 (75%):"}),e.jsxs("span",{className:"font-medium",children:[r.q3.toFixed(1),"h"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Median:"}),e.jsxs("span",{className:"font-medium text-primary",children:[r.median.toFixed(1),"h"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Q1 (25%):"}),e.jsxs("span",{className:"font-medium",children:[r.q1.toFixed(1),"h"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Min:"}),e.jsxs("span",{className:"font-medium",children:[r.min.toFixed(1),"h"]})]}),r.outliers.length>0&&e.jsxs("div",{className:"flex justify-between gap-4 pt-1 border-t mt-1",children:[e.jsx("span",{className:"text-destructive",children:"Outliers:"}),e.jsx("span",{className:"font-medium",children:r.outliers.length})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 pt-1 border-t",children:["Sample size: ",r.count," shifts"]})]})]})}return null},fl=({dateRange:t,limit:a=15})=>{const[s,r]=f.useState("client"),[n,i]=f.useState([]),[l,o]=f.useState(!1);return f.useEffect(()=>{(async()=>{o(!0);try{const c=new URLSearchParams({start:E(t.from,"yyyy-MM-dd"),end:E(t.to,"yyyy-MM-dd"),dimension:s,limit:a.toString()}),u={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},d=await fetch(`${oe.HOURS_DISTRIBUTION}?${c.toString()}`,{headers:u});if(d.ok){const x=await d.json();i(x)}}catch(c){console.error("Error fetching distribution data:",c)}finally{o(!1)}})()},[t,s,a]),e.jsxs(F,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Hours Distribution"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Showing spread of shift durations. Box represents middle 50% of data."})]}),e.jsx(B,{children:e.jsxs(Ze,{value:s,onValueChange:h=>r(h),children:[e.jsxs(Me,{className:"mb-6",children:[e.jsx(H,{value:"client",children:"By Client"}),e.jsx(H,{value:"site",children:"By Site"})]}),e.jsxs("div",{className:"h-[400px] w-full",children:[l?e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"Loading distribution data..."}):n.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"No data available for selected period"}):e.jsx(re,{width:"100%",height:"100%",children:e.jsxs(Ct,{data:n,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(ve,{strokeDasharray:"3 3",vertical:!1,opacity:.3}),e.jsx(ce,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:{fontSize:12}}),e.jsx(de,{label:{value:"Hours Worked",angle:-90,position:"insideLeft",style:{textAnchor:"middle"}}}),e.jsx(z,{content:e.jsx(ml,{}),cursor:{fill:"transparent"}}),e.jsx(ee,{dataKey:"max",fill:"transparent",barSize:1}),e.jsx(ee,{dataKey:"median",shape:ul,fill:"#3b82f6",stroke:"#1e40af",barSize:40})]})}),!l&&n.length>0&&e.jsx("div",{className:"text-center text-xs text-muted-foreground mt-2",children:"* Whiskers extend to 1.5x IQR. Dots represent outliers."})]})]})})]})},xl=t=>{const{cx:a,cy:s,payload:r}=t;if(!a||!s)return null;const n=20;return e.jsx("line",{x1:a,y1:s-n/2,x2:a,y2:s+n/2,stroke:"#000",strokeWidth:3})},gl=({active:t,payload:a,label:s})=>{if(t&&a&&a.length){const r=a.find(i=>i.dataKey==="actual"),n=r?r.payload:a[0].payload;return e.jsxs("div",{className:"bg-white p-3 border rounded shadow-lg text-sm",children:[e.jsx("p",{className:"font-bold mb-1",children:n.name}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:[e.jsx("span",{className:"text-gray-500",children:"Actual:"}),e.jsx("span",{className:"font-mono font-medium",children:n.actual}),e.jsx("span",{className:"text-gray-500",children:"Target:"}),e.jsx("span",{className:"font-mono font-medium",children:n.target}),e.jsx("span",{className:"text-gray-500",children:"Achievement:"}),e.jsxs("span",{className:`font-mono font-bold ${n.achievement>=100?"text-green-600":n.achievement>=80?"text-yellow-600":"text-red-600"}`,children:[n.achievement,"%"]})]})]})}return null},pl=({dateRange:t,limit:a=15,dimension:s="site"})=>{const[r,n]=f.useState([]),[i,l]=f.useState(!1);return f.useEffect(()=>{(async()=>{if(!(!(t!=null&&t.from)||!(t!=null&&t.to))){l(!0);try{const h=E(t.from,"yyyy-MM-dd"),c=E(t.to,"yyyy-MM-dd"),u=localStorage.getItem("auth_token"),d=await fetch(`${oe.TARGET_ACHIEVEMENT_BULLET}?start=${h}&end=${c}&dimension=${s}&limit=${a}`,{headers:{Authorization:`Bearer ${u}`}});if(d.ok){const x=await d.json();n(x)}}catch(h){console.error("Error fetching bullet chart data:",h)}finally{l(!1)}}})()},[t,a,s]),i?e.jsx("div",{className:"h-[400px] w-full flex items-center justify-center",children:"Loading chart data..."}):r.length?e.jsxs("div",{className:"w-full",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4",children:["Target Achievement by ",s==="client"?"Client":"Site"]}),e.jsx("div",{className:"h-[600px] w-full",children:e.jsx(re,{width:"100%",height:"100%",children:e.jsxs(Ct,{layout:"vertical",data:r,margin:{top:20,right:30,left:100,bottom:20},children:[e.jsx(ve,{stroke:"#f5f5f5",horizontal:!0,vertical:!0}),e.jsx(ce,{type:"number"}),e.jsx(de,{type:"category",dataKey:"name",width:100,tick:{fontSize:12}}),e.jsx(z,{content:e.jsx(gl,{}),cursor:{fill:"transparent"}}),e.jsx(ee,{dataKey:"range_poor",stackId:"ranges",fill:"#fee2e2",barSize:30,isAnimationActive:!1}),e.jsx(ee,{dataKey:"range_good",stackId:"ranges",fill:"#fef3c7",barSize:30,isAnimationActive:!1}),e.jsx(ee,{dataKey:"range_excellent",stackId:"ranges",fill:"#dcfce7",barSize:30,isAnimationActive:!1}),e.jsx(ee,{dataKey:"actual",barSize:12,fill:"#1f2937"}),e.jsx(Ve,{dataKey:"marker",shape:e.jsx(xl,{}),legendType:"none"})]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-red-100 border border-red-200 block"}),e.jsx("span",{children:"Poor (<80%)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-yellow-100 border border-yellow-200 block"}),e.jsx("span",{children:"Good (80-95%)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-green-100 border border-green-200 block"}),e.jsx("span",{children:"Excellent (>95%)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-1 bg-gray-800 block"}),e.jsx("span",{children:"Actual"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-3 bg-black block"}),e.jsx("span",{children:"Target"})]})]})]}):e.jsx("div",{className:"h-[400px] w-full flex items-center justify-center text-gray-500",children:"No data available for this period"})},vl={low:10,midLow:20,mid:30,high:40},ge=["#ef4444","#f97316","#eab308","#84cc16","#22c55e"],bt=({data:t,title:a="Revenue Composition (Margin Color-Coded)"})=>{const[s,r]=f.useState(vl),n=o=>o<s.low?ge[0]:o<s.midLow?ge[1]:o<s.mid?ge[2]:o<s.high?ge[3]:ge[4],i=o=>{const{root:h,depth:c,x:u,y:d,width:x,height:g,index:C,payload:y,colors:N,rank:j,name:k,margin:M}=o;return e.jsxs("g",{children:[e.jsx("rect",{x:u,y:d,width:x,height:g,style:{fill:n(M),stroke:"#fff",strokeWidth:2/(c+1e-10),strokeOpacity:1/(c+1e-10)}}),x>50&&g>30&&e.jsx("text",{x:u+x/2,y:d+g/2,textAnchor:"middle",fill:"#fff",fontSize:12,style:{pointerEvents:"none"},children:k})]})},l=({active:o,payload:h})=>{var c;if(o&&h&&h.length){const u=h[0].payload;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground mb-1",children:u.name}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Revenue:"}),e.jsxs("span",{className:"font-mono",children:["£",u.revenue.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cost:"}),e.jsxs("span",{className:"font-mono",children:["£",(c=u.cost)==null?void 0:c.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Profit:"}),e.jsxs("span",{className:`font-mono ${u.profit>=0?"text-green-600":"text-red-600"}`,children:["£",u.profit.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between gap-4 border-t pt-1 mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Margin:"}),e.jsxs("span",{className:`font-mono font-bold ${u.margin>=0?"text-green-600":"text-red-600"}`,children:[u.margin.toFixed(1),"%"]})]})]})]})}return null};return!t||t.length===0?e.jsx("div",{className:"h-[400px] w-full flex items-center justify-center text-muted-foreground",children:"No data available"}):e.jsxs(F,{children:[e.jsxs(se,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(ae,{className:"text-base font-medium",children:a}),e.jsxs(Oa,{children:[e.jsx(La,{asChild:!0,children:e.jsx(te,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Va,{className:"h-4 w-4"})})}),e.jsx(Ia,{className:"w-80",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Margin Thresholds (%)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adjust color coding boundaries."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(L,{htmlFor:"low",children:"Low (Red)"}),e.jsx(Z,{id:"low",type:"number",className:"col-span-2 h-8",value:s.low,onChange:o=>r({...s,low:Number(o.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(L,{htmlFor:"midLow",children:"Mid-Low (Org)"}),e.jsx(Z,{id:"midLow",type:"number",className:"col-span-2 h-8",value:s.midLow,onChange:o=>r({...s,midLow:Number(o.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(L,{htmlFor:"mid",children:"Mid (Ylw)"}),e.jsx(Z,{id:"mid",type:"number",className:"col-span-2 h-8",value:s.mid,onChange:o=>r({...s,mid:Number(o.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-4",children:[e.jsx(L,{htmlFor:"high",children:"High (Lime)"}),e.jsx(Z,{id:"high",type:"number",className:"col-span-2 h-8",value:s.high,onChange:o=>r({...s,high:Number(o.target.value)})})]})]})]})})]})]}),e.jsxs(B,{children:[e.jsx("div",{className:"h-[400px] w-full",children:e.jsx(re,{width:"100%",height:"100%",children:e.jsx(Je,{data:t,dataKey:"size",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",content:e.jsx(i,{}),children:e.jsx(z,{content:e.jsx(l,{})})})})}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsxs("span",{children:["< ",s.low,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsxs("span",{children:[s.low,"-",s.midLow,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsxs("span",{children:[s.midLow,"-",s.mid,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-lime-500"}),e.jsxs("span",{children:[s.mid,"-",s.high,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsxs("span",{children:["> ",s.high,"%"]})]})]})]})]})},Ue=["January","February","March","April","May","June","July","August","September","October","November","December"],Nt=["Rent","Salaries","Utilities","Software","Equipment","Marketing","Travel","Insurance","Taxes","Maintenance","Custom..."],yl=({open:t,onOpenChange:a,initialData:s,onSave:r})=>{var I,v;const{data:n}=Ua(),[i,l]=f.useState(!1),[o,h]=f.useState(new Date().getFullYear()),[c,u]=f.useState(Ue[new Date().getMonth()]),[d,x]=f.useState(""),[g,C]=f.useState(""),[y,N]=f.useState(""),[j,k]=f.useState(""),[M,K]=f.useState("");f.useEffect(()=>{t&&(s?(h(s.year),u(s.month),x(s.location||""),C(s.site||""),K(s.value.toString()),Nt.includes(s.name)?(N(s.name),k("")):(N("Custom..."),k(s.name))):(h(new Date().getFullYear()),u(Ue[new Date().getMonth()]),x(""),C(""),N(""),k(""),K("")))},[t,s]);const J=async()=>{if(!d||!y||!M){X.error("Please fill in all required fields");return}const m=y==="Custom..."?j:y;if(!m){X.error("Please specify the overhead name");return}l(!0);try{await r({id:s==null?void 0:s.id,year:o,month:c,location:d,site:g||null,name:m,value:parseFloat(M)}),a(!1)}catch($){console.error("Failed to save overhead:",$)}finally{l(!1)}},U=((I=n==null?void 0:n.jobs)==null?void 0:I.filter(m=>m.location===d&&m.site).map(m=>m.site).filter((m,$,D)=>D.indexOf(m)===$))||[];return e.jsx(Da,{open:t,onOpenChange:a,children:e.jsxs(Pa,{className:"sm:max-w-[500px]",children:[e.jsxs(Ra,{children:[e.jsx(Fa,{children:s?"Edit Overhead":"Add Overhead"}),e.jsx(Ba,{children:s?"Update existing overhead record.":"Create a new overhead record."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Year"}),e.jsxs(ue,{value:o.toString(),onValueChange:m=>h(Number(m)),children:[e.jsx(me,{children:e.jsx(fe,{})}),e.jsx(xe,{children:[2024,2025,2026,2027,2028].map(m=>e.jsx(ie,{value:m.toString(),children:m},m))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Month"}),e.jsxs(ue,{value:c,onValueChange:u,children:[e.jsx(me,{children:e.jsx(fe,{})}),e.jsx(xe,{children:Ue.map(m=>e.jsx(ie,{value:m,children:m},m))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Location"}),e.jsxs(ue,{value:d,onValueChange:m=>{x(m),C("")},children:[e.jsx(me,{children:e.jsx(fe,{placeholder:"Select location..."})}),e.jsx(xe,{children:Array.from(new Set((v=n==null?void 0:n.jobs)==null?void 0:v.map(m=>m.location).filter(Boolean))).map(m=>e.jsx(ie,{value:m,children:m},m))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Site (Optional)"}),e.jsxs(ue,{value:g,onValueChange:C,disabled:!d||U.length===0,children:[e.jsx(me,{children:e.jsx(fe,{placeholder:U.length===0?"No sites available":"Select site..."})}),e.jsxs(xe,{children:[e.jsx(ie,{value:"all_sites",children:"All Sites (if applicable)"}),U.map(m=>e.jsx(ie,{value:m,children:m},m))]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Category"}),e.jsxs(ue,{value:y,onValueChange:N,children:[e.jsx(me,{children:e.jsx(fe,{placeholder:"Select category..."})}),e.jsx(xe,{children:Nt.map(m=>e.jsx(ie,{value:m,children:m},m))})]})]}),y==="Custom..."&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Custom Name"}),e.jsx(Z,{placeholder:"Enter overhead name",value:j,onChange:m=>k(m.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{children:"Value (£)"}),e.jsx(Z,{type:"number",placeholder:"0.00",value:M,onChange:m=>K(m.target.value)})]})]}),e.jsxs(Ka,{children:[e.jsx(te,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsxs(te,{onClick:J,disabled:i,children:[i&&e.jsx(As,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})})},zl=()=>{const{metricId:t}=Ts(),a=_s(),{dateRange:s,setDateRange:r}=$s(),{role:n}=Es(),[i,l]=f.useState(!1),[o,h]=f.useState(s),[c,u]=f.useState([]),[d,x]=f.useState([]),[g,C]=f.useState("trend"),[y,N]=f.useState([]),[j,k]=f.useState([]),[M,K]=f.useState([]),[J,U]=f.useState({hours:0,staffCount:0}),[I,v]=f.useState([]),[m,$]=f.useState(!1),[D,P]=f.useState([]),[ne,os]=f.useState([]);f.useEffect(()=>{if(t!=="revenue"&&t!=="cost"||g!=="trend")return;(async()=>{try{const p=new URLSearchParams({start:E(s.from,"yyyy-MM-dd"),end:E(s.to,"yyyy-MM-dd"),metric:t});c&&c.forEach(_=>p.append("locations",_)),d&&d.forEach(_=>p.append("sites",_));const T={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},b=await fetch(`/api/dashboard/client-margin-treemap?${p.toString()}`,{headers:T});if(b.ok){const _=await b.json();os(_)}}catch(p){console.error("Error fetching treemap:",p)}})()},[t,g,s,c,d]);const[ls,je]=f.useState(!1),[cs,et]=f.useState(null),[be,Oe]=f.useState(null),Ne=["revenue","cost","profit","employees","clientRate","staffRate","overheads"].includes(t||""),Le=["shifts","hours","clients","targetAchievement","missedTargets"].includes(t||""),tt=t==="overheads",Ie=n==="admin",{operationalData:G,isLoading:ds}=Ws(s,c,d),{financialData:q,isLoading:hs}=Gs(s,c,d),us=Ne?hs:Le?ds:!1;f.useEffect(()=>{if(t!=="missedTargets")return;(async()=>{try{const p=new URLSearchParams({start:E(s.from,"yyyy-MM-dd"),end:E(s.to,"yyyy-MM-dd")}),T={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},b=await fetch(`${oe.TARGETS_PERFORMANCE}?${p.toString()}`,{headers:T});if(b.ok){const _=await b.json();P(_)}}catch(p){console.error("Error fetching targets performance:",p)}})()},[s,t]),f.useEffect(()=>{if(g==="trend"||!t)return;(async()=>{$(!0);try{const p=new URLSearchParams({start:E(s.from,"yyyy-MM-dd"),end:E(s.to,"yyyy-MM-dd"),metric:t,limit:"20"});c&&c.length>0&&c.forEach(b=>p.append("locations",b)),d&&d.length>0&&d.forEach(b=>p.append("sites",b));const T={Authorization:`Bearer ${localStorage.getItem("auth_token")}`};if(g==="details"&&tt){const b=await fetch(`${oe.FINANCIAL_METRICS_LIST}?${p.toString()}`,{headers:T});if(b.ok){const _=await b.json();v(_)}}else if(["location","site","client"].includes(g)){p.append("dimension",g);const b=await fetch(`${oe.BREAKDOWN}?${p.toString()}`,{headers:T});if(b.ok){const _=await b.json();N(_)}}}catch(p){console.error("Error fetching breakdown:",p)}finally{$(!1)}})()},[g,t,s,c,d]),f.useEffect(()=>{t==="clients"&&g==="revenueTier"&&Ie&&(async()=>{try{const p=new URLSearchParams({start:E(s.from,"yyyy-MM-dd"),end:E(s.to,"yyyy-MM-dd")});c&&c.length>0&&c.forEach(_=>p.append("locations",_)),d&&d.length>0&&d.forEach(_=>p.append("sites",_));const T={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},b=await fetch(`/api/dashboard/client-revenue-tiers?${p.toString()}`,{headers:T});if(b.ok){const R=(await b.json()).tiers.map(he=>({name:he.tier,value:he.totalRevenue,clientCount:he.clientCount,avgRevenue:he.avgRevenue,clients:he.clients||[]}));k(R)}}catch(p){console.error("Error fetching revenue tiers:",p)}})()},[t,g,Ie,s,c,d]),f.useEffect(()=>{g==="trend"&&(async()=>{try{const p=new URLSearchParams({start:E(s.from,"yyyy-MM-dd"),end:E(s.to,"yyyy-MM-dd")});c&&c.length>0&&c.forEach(R=>p.append("locations",R)),d&&d.length>0&&d.forEach(R=>p.append("sites",R));const T={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},b=await fetch(`/api/dashboard/client-workload-scatter?${p.toString()}`,{headers:T});if(!b.ok){console.error(`❌ Workload scatter API failed (${b.status}): /api/dashboard/client-workload-scatter`);const R=await b.text();console.error("Response preview:",R.substring(0,200));return}const _=await b.json();K(_.data||[]),U(_.medians||{hours:0,staffCount:0})}catch(p){console.error("Error fetching workload data:",p)}})()},[g,s,c,d]);const ms=()=>{et(null),je(!0)},fs=A=>{et(A),je(!0)},xs=async()=>{if(be)try{const A=await fetch(`/api/admin/financial-metrics/${be}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(A.ok)X.success("Overhead deleted"),g==="details"&&v(p=>p.filter(T=>T.id!==be));else{const p=await A.json();X.error(p.error||"Failed to delete")}}catch(A){console.error(A),X.error("Failed to delete")}finally{Oe(null)}},gs=async A=>{try{const p=await fetch("/api/admin/financial-metrics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(A)});if(p.ok){X.success("Overhead saved"),je(!1);const T=new URLSearchParams({start:E(s.from,"yyyy-MM-dd"),end:E(s.to,"yyyy-MM-dd"),metric:t||"overheads",limit:"20"});c&&c.forEach(R=>T.append("locations",R)),d&&d.forEach(R=>T.append("sites",R));const b={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},_=await fetch(`${oe.FINANCIAL_METRICS_LIST}?${T.toString()}`,{headers:b});if(_.ok){const R=await _.json();v(R)}}else{const T=await p.json();X.error(T.error||"Failed to save")}}catch(p){console.error(p),X.error("Failed to save")}},ps=A=>{switch(A){case"revenue":return"Revenue Analysis";case"cost":return"Cost Analysis";case"profit":return"Profit Analysis";case"shifts":return"Shifts Analysis";case"hours":return"Hours Analysis";case"clients":return"Client Analysis";case"employees":return"Employee Analysis";case"targetAchievement":return"Target Achievement Analysis";case"missedTargets":return"Missed Targets Analysis";case"clientRate":return"Client Rate Analysis";case"staffRate":return"Staff Rate Analysis";case"overheads":return"Overheads Analysis";default:return"Metric Analysis"}},vs=f.useMemo(()=>{if(!I||I.length===0)return[];const A=I.reduce((p,T)=>{const b=T.name||"Unknown";return p[b]||(p[b]=0),p[b]+=T.value,p},{});return Object.entries(A).map(([p,T])=>({name:p,value:T}))},[I]);return Ne?q==null||q.timeSeries:G==null||G.timeSeries,e.jsx(Fs,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(Us,{dateRange:s,onDateRangeChange:r,calendarOpen:i,onCalendarOpenChange:l,tempDateRange:o,onTempDateRangeChange:h,selectedLocations:c,onLocationsChange:u,selectedSites:d,onSitesChange:x}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6 relative",children:[(us||m)&&e.jsx(qs,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{variant:"ghost",size:"sm",onClick:()=>a(-1),className:"gap-2",children:[e.jsx(Wa,{className:"h-4 w-4"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold",children:ps(t)})]}),e.jsxs(Ze,{value:g,onValueChange:C,className:"space-y-4",children:[e.jsxs(Me,{children:[e.jsx(H,{value:"trend",children:"Trend"}),e.jsx(H,{value:"location",children:"By Location"}),e.jsx(H,{value:"site",children:"By Site"}),t!=="clients"&&t!=="targetAchievement"&&e.jsx(H,{value:"client",children:"By Clients"}),t==="clients"&&Ie&&e.jsx(H,{value:"revenueTier",children:"By Revenue Tier"}),tt&&e.jsx(H,{value:"details",children:"All Details"})]}),e.jsx(Y,{value:"trend",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[t==="clients"&&e.jsx(dl,{data:M,medianHours:J.hours,medianStaff:J.staffCount}),t==="shifts"&&e.jsx(hl,{dateRange:s,locations:c,sites:d}),Ne&&t!=="revenue"&&t!=="cost"&&e.jsx(Ys,{data:(q==null?void 0:q.timeSeries)||[],aggregationLevel:(q==null?void 0:q.aggregationLevel)||"monthly",selectedMetric:t}),t==="revenue"&&e.jsx(bt,{data:ne,title:"Revenue Composition (Margin Color-Coded)"}),t==="cost"&&e.jsx(bt,{data:ne,title:"Cost Composition (Margin Color-Coded)"}),Le&&t!=="missedTargets"&&t!=="shifts"&&t!=="hours"&&t!=="targetAchievement"&&e.jsx(Vs,{data:(G==null?void 0:G.timeSeries)||[],aggregationLevel:(G==null?void 0:G.aggregationLevel)||"monthly",selectedMetric:t}),t==="hours"&&e.jsx(fl,{dateRange:s}),t==="targetAchievement"&&e.jsx(pl,{dateRange:s,dimension:"client"}),t==="missedTargets"&&e.jsx(zs,{data:D}),!Ne&&!Le&&e.jsx(F,{children:e.jsx(B,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Metric type not recognized or data unavailable."})})})]})}),e.jsx(Y,{value:"location",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Ke,{data:y,metric:t||"revenue"}),e.jsx(Se,{data:y,metric:t||"revenue"})]})}),e.jsx(Y,{value:"site",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Ke,{data:y,metric:t||"revenue"}),e.jsx(Se,{data:y,metric:t||"revenue"})]})}),e.jsx(Y,{value:"client",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Ke,{data:y,metric:t||"revenue"}),e.jsx(Se,{data:y,metric:t||"revenue"})]})}),e.jsx(Y,{value:"revenueTier",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(ll,{data:j}),e.jsxs(F,{children:[e.jsx(se,{children:e.jsx(ae,{children:"Tier Breakdown"})}),e.jsx(B,{children:e.jsxs(Pt,{children:[e.jsx(Rt,{children:e.jsxs(Ae,{children:[e.jsx(W,{children:"Tier"}),e.jsx(W,{className:"text-right",children:"Clients"}),e.jsx(W,{className:"text-right",children:"Total Revenue"}),e.jsx(W,{className:"text-right",children:"Avg Revenue/Client"})]})}),e.jsx(Ft,{children:j.map(A=>e.jsxs(Ae,{children:[e.jsx(V,{className:"font-medium",children:A.name}),e.jsx(V,{className:"text-right",children:A.clientCount}),e.jsxs(V,{className:"text-right",children:["£",A.value.toLocaleString()]}),e.jsxs(V,{className:"text-right",children:["£",A.avgRevenue.toLocaleString()]})]},A.name))})]})})]})]})}),e.jsx(Y,{value:"details",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(Se,{data:vs,metric:"overheads"})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(te,{onClick:ms,className:"gap-2",children:[e.jsx(Ha,{className:"h-4 w-4"}),"Add Overhead"]})}),e.jsx(nl,{data:I,onEdit:fs,onDelete:Oe}),e.jsx(yl,{open:ls,onOpenChange:je,initialData:cs,onSave:gs}),e.jsx(ks,{open:!!be,onOpenChange:A=>!A&&Oe(null),children:e.jsxs(Ms,{children:[e.jsxs(Os,{children:[e.jsx(Ls,{children:"Are you sure?"}),e.jsx(Is,{children:"This will permanently delete this overhead record."})]}),e.jsxs(Ds,{children:[e.jsx(Ps,{children:"Cancel"}),e.jsx(Rs,{onClick:xs,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})})]})]})]})})};export{zl as default};
