import{r as o,a as N,A as w,j as e,u as D}from"./index-C9Xvk_Mh.js";import{D as L,L as S}from"./DashboardLayout-Dy9fBXuT.js";import{f as u}from"./locationUtils-CzTH1835.js";import{M as m,c as b,D as A,L as R,A as T}from"./LoadingOverlay-BNMyDbNJ.js";import{C as f,a as p,b as v,d as g}from"./card-DKWA8Mal.js";import{R as k,C as M,X as P,Y as E,T as F,L as O,A as j}from"./generateCategoricalChart-CAMbkyR6.js";import{A as $}from"./AreaChart-BRTvF8VM.js";import{B as y}from"./button-xOT2x8Rw.js";import{T as K}from"./users-CiSG5V5y.js";import"./select-DiQeDqP8.js";import"./badge-yvcuWxJT.js";const z=(a,s)=>{const[r,n]=o.useState(null),[i,h]=o.useState(!1),{toast:x}=N(),l=async()=>{h(!0);try{const c=new URLSearchParams({start:u(a.from,"yyyy-MM-dd"),end:u(a.to,"yyyy-MM-dd")});s&&s.length>0&&s.forEach(d=>c.append("locations",d));const t=await fetch(`${w.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${c}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(t.ok){const d=await t.json();n(d)}else x({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch{x({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{h(!1)}};return o.useEffect(()=>{l()},[a,s]),{financialData:r,isLoading:i,refetch:l}},I=({metrics:a})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 w-full",children:[e.jsx(m,{title:"Total Revenue",value:`£${a.revenue.value.toLocaleString()}`,change:a.revenue.text,trend:a.revenue.trend}),e.jsx(m,{title:"Average Client Pay",value:`£${a.clientPay.value.toFixed(2)}`,change:a.clientPay.text,trend:a.clientPay.trend}),e.jsx(m,{title:"Average Staff Pay",value:`£${a.staffPay.value.toFixed(2)}`,change:a.staffPay.text,trend:a.staffPay.trend})]}),B=({active:a,payload:s,label:r})=>a&&s&&s.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:r}),s.map((n,i)=>e.jsxs("p",{className:"text-sm",style:{color:n.color},children:[n.name,": £",Number(n.value).toLocaleString()]},i))]}):null,U=({data:a,aggregationLevel:s})=>{const r={dataKey:"display",interval:0};return!a||a.length===0?e.jsxs(f,{children:[e.jsx(p,{children:e.jsx(v,{children:"Revenue vs Cost Trend"})}),e.jsx(g,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(f,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s==="daily"&&"Daily view",s==="weekly"&&"Weekly view",s==="monthly"&&"Monthly view"]})]}),e.jsx(g,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs($,{data:a,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:r.dataKey,tick:{fontSize:12},interval:r.interval}),e.jsx(E,{}),e.jsx(F,{content:e.jsx(B,{})}),e.jsx(O,{}),e.jsx(j,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(j,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]})})})})]})};function ee(){const a=D(),[s,r]=o.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[n,i]=o.useState(!1),[h,x]=o.useState(s),[l,c]=o.useState([]),{financialData:t,isLoading:d}=z(s,l),C=b(t,s);return e.jsx(L,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(A,{dateRange:s,onDateRangeChange:r,calendarOpen:n,onCalendarOpenChange:i,tempDateRange:h,onTempDateRangeChange:x,selectedLocations:l,onLocationsChange:c}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(y,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(K,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(y,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>a("/dashboard/operational"),children:[e.jsx(S,{className:"h-4 w-4"}),"Operational View"]})]})}),d&&e.jsx(R,{}),e.jsx(I,{metrics:C}),e.jsx(T,{salesData:t}),e.jsx(U,{data:(t==null?void 0:t.timeSeries)||[],aggregationLevel:(t==null?void 0:t.aggregationLevel)||"monthly"})]})})]})})}export{ee as default};
