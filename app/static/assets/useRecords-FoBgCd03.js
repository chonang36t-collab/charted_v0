var q=e=>{throw TypeError(e)};var R=(e,t,s)=>t.has(e)||q("Cannot "+s);var o=(e,t,s)=>(R(e,t,"read from private field"),s?s.call(e):t.get(e)),y=(e,t,s)=>t.has(e)?q("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),f=(e,t,s,r)=>(R(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),b=(e,t,s)=>(R(e,t,"access private method"),s);import{u as D}from"./useQuery-CddlU5wy.js";import{af as K,ag as M,ah as _,ai as A,aj as F,a2 as C,r as S,ak as I,al as T,A as g}from"./index-Cwa0VGn5.js";var h,c,i,a,u,O,m,$,x=($=class extends K{constructor(t,s){super();y(this,u);y(this,h);y(this,c);y(this,i);y(this,a);f(this,h,t),this.setOptions(s),this.bindMethods(),b(this,u,O).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const s=this.options;this.options=o(this,h).defaultMutationOptions(t),M(this.options,s)||o(this,h).getMutationCache().notify({type:"observerOptionsUpdated",mutation:o(this,i),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&_(s.mutationKey)!==_(this.options.mutationKey)?this.reset():((r=o(this,i))==null?void 0:r.state.status)==="pending"&&o(this,i).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=o(this,i))==null||t.removeObserver(this)}onMutationUpdate(t){b(this,u,O).call(this),b(this,u,m).call(this,t)}getCurrentResult(){return o(this,c)}reset(){var t;(t=o(this,i))==null||t.removeObserver(this),f(this,i,void 0),b(this,u,O).call(this),b(this,u,m).call(this)}mutate(t,s){var r;return f(this,a,s),(r=o(this,i))==null||r.removeObserver(this),f(this,i,o(this,h).getMutationCache().build(o(this,h),this.options)),o(this,i).addObserver(this),o(this,i).execute(t)}},h=new WeakMap,c=new WeakMap,i=new WeakMap,a=new WeakMap,u=new WeakSet,O=function(){var s;const t=((s=o(this,i))==null?void 0:s.state)??A();f(this,c,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},m=function(t){F.batch(()=>{var s,r,n,d,l,w,j,k;if(o(this,a)&&this.hasListeners()){const p=o(this,c).variables,E=o(this,c).context;(t==null?void 0:t.type)==="success"?((r=(s=o(this,a)).onSuccess)==null||r.call(s,t.data,p,E),(d=(n=o(this,a)).onSettled)==null||d.call(n,t.data,null,p,E)):(t==null?void 0:t.type)==="error"&&((w=(l=o(this,a)).onError)==null||w.call(l,t.error,p,E),(k=(j=o(this,a)).onSettled)==null||k.call(j,void 0,t.error,p,E))}this.listeners.forEach(p=>{p(o(this,c))})})},$);function v(e,t){const s=C(),[r]=S.useState(()=>new x(s,e));S.useEffect(()=>{r.setOptions(e)},[r,e]);const n=S.useSyncExternalStore(S.useCallback(l=>r.subscribe(F.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),d=S.useCallback((l,w)=>{r.mutate(l,w).catch(I)},[r]);if(n.error&&T(r.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:d,mutateAsync:n.mutate}}const B=e=>D({queryKey:["records",e],queryFn:async()=>{const t=new URLSearchParams;t.append("page",e.page.toString()),t.append("limit",e.limit.toString()),e.sort_by&&t.append("sort_by",e.sort_by),e.sort_order&&t.append("sort_order",e.sort_order),e.search&&t.append("search",e.search),e.start&&t.append("start",e.start),e.end&&t.append("end",e.end),e.locations&&t.append("locations",e.locations),e.sites&&t.append("sites",e.sites),e.clients&&t.append("clients",e.clients);const s=await fetch(`${g.RECORDS}?${t.toString()}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(!s.ok){const r=await s.json().catch(()=>({}));throw new Error(r.error||"Failed to fetch records")}return s.json()},placeholderData:t=>t}),Q=()=>D({queryKey:["records-options"],queryFn:async()=>{const e=await fetch(`${g.RECORDS}/options`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!e.ok)throw new Error("Failed to fetch options");return e.json()}}),L=()=>{const e=C();return v({mutationFn:async t=>{const s=await fetch(g.RECORDS,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(t)});if(!s.ok){const r=await s.json();throw new Error(r.error||"Failed to create record")}return s.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["records"]})}})},N=()=>{const e=C();return v({mutationFn:async t=>{const{id:s,...r}=t,n=await fetch(`${g.RECORDS}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(r)});if(!n.ok){const d=await n.json();throw new Error(d.error||"Failed to update record")}return n.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["records"]})}})},J=()=>{const e=C();return v({mutationFn:async t=>{const s=await fetch(`${g.RECORDS}/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!s.ok){const r=await s.json();throw new Error(r.error||"Failed to delete record")}return s.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["records"]})}})};export{L as a,N as b,B as c,J as d,v as e,Q as u};
