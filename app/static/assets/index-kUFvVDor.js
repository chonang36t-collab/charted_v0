import{r as v,a as W,R as S,j as e,b as $}from"./index-D5sHHh7x.js";import{D as _}from"./DashboardLayout-9gof42I3.js";import{A as q}from"./api-DS5URhHX.js";import{a as G,f as M,P as I,b as Y,C as B,c as K,d as z,i as R,e as Q,s as A,g as L}from"./popover-CWQhK9ZY.js";import{B as O}from"./button-YvUjDop0.js";import{S as U,a as X,b as J,C as Z,c as ee,d as k}from"./select-DEZqt59o.js";import{C as j,a as D,b as H,d as p}from"./card-DB3Z6Hsp.js";import{R as te,A as se,C as re,X as ne,Y as ae,T as oe,L as le,a as V}from"./AreaChart-CB8uxAiP.js";import"./users-JqqqgulX.js";function F(t,s){return G(t,-s)}const ie=t=>{const[s,o]=v.useState(null),[l,u]=v.useState(!1),{toast:m}=W(),i=async()=>{u(!0);try{const r=new URLSearchParams({start:M(t.from,"yyyy-MM-dd"),end:M(t.to,"yyyy-MM-dd")});console.log("Fetching sales data with params:",r.toString());const d=await fetch(`${q.SALES_SUMMARY}?${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(d.ok){const n=await d.json();console.log("DASHBOARD DATA RECEIVED:",n),o(n)}else console.error("Dashboard fetch failed:",d.status,d.statusText),m({title:"Error",description:"Could not fetch data from server",variant:"destructive"})}catch(r){console.error("Dashboard fetch error:",r),m({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{u(!1)}};return v.useEffect(()=>{i()},[t]),{salesData:s,isLoading:l,refetch:i}},ce=(t,s)=>{var P,T,c;if(!t)return{revenue:{value:0,change:0,trend:"neutral",text:"No data available"},clientPay:{value:0,change:0,trend:"neutral",text:"No data available"},staffPay:{value:0,change:0,trend:"neutral",text:"No data available"}};const o=t.totalRevenue||0,l=t.avgClientPayPerHour||0,u=t.avgStaffPayPerHour||0,m=((P=t.previousPeriod)==null?void 0:P.totalRevenue)||0,i=((T=t.previousPeriod)==null?void 0:T.avgClientPayPerHour)||0,r=((c=t.previousPeriod)==null?void 0:c.avgStaffPayPerHour)||0,d=(a,x)=>x>0?(a-x)/x*100:0,n=d(o,m),f=d(l,i),g=d(u,r),y=a=>a>0?"up":a<0?"down":"neutral",N=(a,x,h)=>{if(!x)return"No previous data";let w="";return h<=7?w="last week":h<=31?w="last month":h<=93?w="last quarter":w="last period",`${a>0?"+":""}${Math.abs(a).toFixed(1)}% from ${w}`},b=Math.ceil((s.to.getTime()-s.from.getTime())/(1e3*60*60*24)),C=!!t.previousPeriod;return{revenue:{value:o,change:n,trend:y(n),text:N(n,C,b)},clientPay:{value:l,change:f,trend:y(f),text:N(f,C,b)},staffPay:{value:u,change:g,trend:y(g),text:N(g,C,b)}}},de=({dateRange:t,onDateRangeChange:s,calendarOpen:o,onCalendarOpenChange:l,tempDateRange:u,onTempDateRangeChange:m})=>{const i=c=>{const a=new Date;let x,h;switch(c){case"this-month":x=A(a),h=L(a);break;case"last-month":x=A(F(a,1)),h=L(F(a,1));break;case"last-3-months":x=A(F(a,2)),h=L(a);break;case"this-year":x=new Date(a.getFullYear(),0,1),h=new Date(a.getFullYear(),11,31);break;default:return}s({from:x,to:h})},[r,d]=S.useState(t==null?void 0:t.from),[n,f]=S.useState(t==null?void 0:t.to),[g,y]=S.useState(!1),[N,b]=S.useState(!1);S.useEffect(()=>{d(t==null?void 0:t.from),f(t==null?void 0:t.to)},[t]);const C=c=>{c&&(d(c),n&&R(c,n)&&f(void 0))},P=c=>{c&&f(c)},T=()=>{r&&n&&s({from:r,to:n})};return e.jsx("div",{className:"sticky top-0 z-40 bg-background border-b border-border",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Overview of your analytics"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(U,{onValueChange:i,children:[e.jsxs(X,{className:"w-[140px]",children:[e.jsx(J,{placeholder:"Quick Select"}),e.jsx(Z,{className:"h-4 w-4 opacity-50"})]}),e.jsxs(ee,{children:[e.jsx(k,{value:"this-month",children:"This Month"}),e.jsx(k,{value:"last-month",children:"Last Month"}),e.jsx(k,{value:"last-3-months",children:"Last 3 Months"}),e.jsx(k,{value:"this-year",children:"This Year"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(I,{open:g,onOpenChange:y,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:$("w-[140px] justify-start text-left font-normal",!r&&"text-muted-foreground"),children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),r?M(r,"LLL dd, y"):"From"]})}),e.jsx(K,{className:"w-auto p-0",align:"start",children:e.jsx(z,{mode:"single",selected:r,onSelect:C,initialFocus:!0,disabled:c=>n?R(c,n):!1})})]}),e.jsx("div",{className:"text-muted-foreground",children:"to"}),e.jsxs(I,{open:N,onOpenChange:b,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:$("w-[140px] justify-start text-left font-normal",!n&&"text-muted-foreground"),disabled:!r,children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),n?M(n,"LLL dd, y"):"To"]})}),e.jsx(K,{className:"w-auto p-0",align:"start",children:e.jsx(z,{mode:"single",selected:n,onSelect:P,initialFocus:!0,disabled:c=>r?Q(c,r):!1})})]}),e.jsx(O,{onClick:T,disabled:!r||!n,className:"ml-2",children:"Apply"})]})]})]})})})};function E({title:t,value:s,change:o,trend:l="neutral"}){return e.jsxs(j,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(D,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(H,{className:"text-sm font-medium text-muted-foreground",children:t})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s}),o&&e.jsx("p",{className:$("text-xs mt-1",l==="up"&&"text-accent",l==="down"&&"text-destructive",l==="neutral"&&"text-muted-foreground"),children:o})]})]})}const xe=({metrics:t})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 w-full",children:[e.jsx(E,{title:"Total Revenue",value:`£${t.revenue.value.toLocaleString()}`,change:t.revenue.text,trend:t.revenue.trend}),e.jsx(E,{title:"Average Client Pay",value:`£${t.clientPay.value.toFixed(2)}`,change:t.clientPay.text,trend:t.clientPay.trend}),e.jsx(E,{title:"Average Staff Pay",value:`£${t.staffPay.value.toFixed(2)}`,change:t.staffPay.text,trend:t.staffPay.trend})]}),ue=({salesData:t})=>{var s;return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(j,{children:e.jsx(p,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.totalShifts)||0})]})})})}),e.jsx(j,{children:e.jsx(p,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.totalClients)||0})]})})})}),e.jsx(j,{children:e.jsx(p,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.uniqueEmployees)||0})]})})})}),e.jsx(j,{children:e.jsx(p,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((s=t==null?void 0:t.profitMargin)==null?void 0:s.toFixed(1))||0,"%"]})]})})})})]})},he=({active:t,payload:s,label:o})=>t&&s&&s.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:o}),s.map((l,u)=>e.jsxs("p",{className:"text-sm",style:{color:l.color},children:[l.name,": £",Number(l.value).toLocaleString()]},u))]}):null,me=({data:t,aggregationLevel:s})=>{const o={dataKey:"display",interval:0};return!t||t.length===0?e.jsxs(j,{children:[e.jsx(D,{children:e.jsx(H,{children:"Revenue vs Cost Trend"})}),e.jsx(p,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(j,{children:[e.jsxs(D,{children:[e.jsx(H,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s==="daily"&&"Daily view",s==="weekly"&&"Weekly view",s==="monthly"&&"Monthly view"]})]}),e.jsx(p,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(se,{data:t,children:[e.jsx(re,{strokeDasharray:"3 3"}),e.jsx(ne,{dataKey:o.dataKey,tick:{fontSize:12},interval:o.interval}),e.jsx(ae,{}),e.jsx(oe,{content:e.jsx(he,{})}),e.jsx(le,{}),e.jsx(V,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(V,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]})})})})]})},fe=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})});function Pe(){const[t,s]=v.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[o,l]=v.useState(!1),[u,m]=v.useState(t),{salesData:i,isLoading:r}=ie(t),d=ce(i,t);return e.jsx(_,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(de,{dateRange:t,onDateRangeChange:s,calendarOpen:o,onCalendarOpenChange:l,tempDateRange:u,onTempDateRangeChange:m}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[r&&e.jsx(fe,{}),e.jsx(xe,{metrics:d}),e.jsx(ue,{salesData:i}),e.jsx(me,{data:(i==null?void 0:i.timeSeries)||[],aggregationLevel:(i==null?void 0:i.aggregationLevel)||"monthly"})]})})]})})}export{Pe as default};
