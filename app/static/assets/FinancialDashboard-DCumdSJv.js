import{r as o,a as T,c as w,A,j as e,d as O,u as P,b as F,e as E,B as N}from"./index-xBVSQyN9.js";import{D as $,L as K}from"./DashboardLayout-D7-9ID1Z.js";import{a as z}from"./metricCalculations-hGWkQfSx.js";import{f as C}from"./popover-B7Y4xlS9.js";import{u as I,c as W,D as U,R as B,C as Y}from"./CustomMetricsModal-BrvpsOZC.js";import{C as c,a as v,b as y,d}from"./card-BJv0IlGP.js";import{R as _,C as G,X as H,Y as V,T as X,L as q,A as b,a as J}from"./generateCategoricalChart-CMKj6K9M.js";import{A as Q}from"./AreaChart-Bw8Zo9Yk.js";import{T as Z}from"./users-DVkhtm4k.js";import{P as D}from"./pound-sterling-BqBTDkk9.js";import"./locationUtils-C3CGT2UK.js";import"./index-CUZU75tp.js";import"./progress-CWnKR804.js";import"./ellipsis-DMkZ7yPv.js";import"./dialog-C5leLp47.js";import"./label-CfRPrtL3.js";import"./plus-C5yPFgbR.js";const ee=(s,t,r)=>{const[a,l]=o.useState(null),[u,f]=o.useState(!1),{toast:x}=T(),{customMetrics:p}=w(),m=async()=>{f(!0);try{const h=new URLSearchParams({start:C(s.from,"yyyy-MM-dd"),end:C(s.to,"yyyy-MM-dd")});t&&t.length>0&&t.forEach(n=>h.append("locations",n)),r&&r.length>0&&r.forEach(n=>h.append("sites",n));const j=await fetch(`${A.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${h}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(j.ok){const n=await j.json();n.timeSeries&&(n.timeSeries=z(n.timeSeries,p,n.totalOverhead||0)),l(n)}else x({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch{x({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{f(!1)}};return o.useEffect(()=>{m()},[s,t,r,p]),{financialData:a,isLoading:u,refetch:m}};function g({title:s,value:t,change:r,trend:a="neutral"}){return e.jsxs(c,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(v,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:s})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t}),r&&e.jsx("p",{className:O("text-xs mt-1",a==="up"&&"text-accent",a==="down"&&"text-destructive",a==="neutral"&&"text-muted-foreground"),children:r})]})]})}const se=({metrics:s,totalOverhead:t})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(g,{title:"Total Revenue",value:`£${s.revenue.value.toLocaleString()}`,change:s.revenue.text,trend:s.revenue.trend}),e.jsx(g,{title:"Average Client Pay",value:`£${s.clientPay.value.toFixed(2)}`,change:s.clientPay.text,trend:s.clientPay.trend}),e.jsx(g,{title:"Average Staff Pay",value:`£${s.staffPay.value.toFixed(2)}`,change:s.staffPay.text,trend:s.staffPay.trend}),t!==void 0&&e.jsx(g,{title:"Total Overheads",value:`£${t.toLocaleString()}`,change:"Fixed costs",trend:"neutral"})]}),te=({salesData:s})=>{var t;return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalShifts)||0})]})})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalClients)||0})]})})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.uniqueEmployees)||0})]})})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((t=s==null?void 0:s.profitMargin)==null?void 0:t.toFixed(1))||0,"%"]})]})})})})]})},ae=({active:s,payload:t,label:r})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:r}),t.map((a,l)=>e.jsxs("p",{className:"text-sm",style:{color:a.color},children:[a.name,": £",Number(a.value).toLocaleString()]},l))]}):null,re=({data:s,aggregationLevel:t})=>{const{customMetrics:r}=w(),a={dataKey:"display",interval:0};return!s||s.length===0?e.jsxs(c,{children:[e.jsx(v,{children:e.jsx(y,{children:"Revenue vs Cost Trend"})}),e.jsx(d,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(c,{children:[e.jsxs(v,{children:[e.jsx(y,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t==="daily"&&"Daily view",t==="weekly"&&"Weekly view",t==="monthly"&&"Monthly view"]})]}),e.jsx(d,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(Q,{data:s,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:a.dataKey,tick:{fontSize:12},interval:a.interval}),e.jsx(V,{}),e.jsx(X,{content:e.jsx(ae,{})}),e.jsx(q,{}),e.jsx(b,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(b,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2}),r.map((l,u)=>e.jsx(J,{type:"monotone",dataKey:l.name,name:l.name,stroke:`hsl(${(u*137+200)%360}, 70%, 50%)`,strokeWidth:2,dot:!1},l.id))]})})})})]})},ne=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})}),be=()=>{const s=P();F();const{dateRange:t,setDateRange:r}=E(),[a,l]=o.useState(!1),[u,f]=o.useState(t),[x,p]=o.useState([]),[m,h]=o.useState([]),[j,n]=o.useState(!1),{financialData:i,isLoading:S}=ee(t,x,m),{topClientsRevenue:M,isLoadingClientsRev:L}=I(t,x,m),R=W(i,t);return e.jsxs($,{fullWidth:!0,children:[e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(U,{dateRange:t,onDateRangeChange:r,calendarOpen:a,onCalendarOpenChange:l,tempDateRange:u,onTempDateRangeChange:f,selectedLocations:x,onLocationsChange:p,selectedSites:m,onSitesChange:h,onCustomMetricsClick:()=>n(!0)}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"px-4 pt-6 pb-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(N,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(Z,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(N,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>s("/dashboard/operational"),children:[e.jsx(K,{className:"h-4 w-4"}),"Operational View"]})]})}),S&&e.jsx(ne,{}),e.jsx(se,{metrics:R,totalOverhead:i==null?void 0:i.totalOverhead}),e.jsx(te,{salesData:i}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(c,{className:"col-span-5",children:[e.jsx(v,{children:e.jsx(y,{children:"Revenue Overview"})}),e.jsx(d,{className:"pl-2",children:e.jsx(re,{data:(i==null?void 0:i.timeSeries)||[],aggregationLevel:(i==null?void 0:i.aggregationLevel)||"monthly"})})]}),e.jsx("div",{className:"col-span-2 flex flex-col gap-4 h-full",children:e.jsx(B,{title:"Top Clients (Revenue)",data:M,isLoading:L,valueFormatter:k=>`£${k.toLocaleString()}`,icon:e.jsx(D,{className:"h-4 w-4"}),className:"h-full",barColor:"bg-green-500"})})]})]})})]}),e.jsx(Y,{isOpen:j,onClose:()=>n(!1)})]})};export{be as FinancialDashboard,be as default};
