import{c as $,d as Z,r as o,j as e,P as T,k as w,o as ee,a as se,A as te}from"./index-DWPBWOl0.js";import{D as re,C as ae,F as le}from"./DashboardLayout-DZ_oUd_i.js";import{C as f,a as h,b as g,d as v}from"./card-DJmU84DF.js";import{B as F}from"./button-BTpW4BhF.js";import{I as ie}from"./input-BVIRi8Av.js";import{L as ne}from"./label-BQwjAc41.js";import"./users-BDg8tE3w.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=$("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=$("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var I="Progress",E=100,[ce,Pe]=Z(I),[xe,ue]=ce(I),V=o.forwardRef((s,t)=>{const{__scopeProgress:l,value:i=null,max:n,getValueLabel:j=me,...N}=s;(n||n===0)&&!_(n)&&console.error(pe(`${n}`,"Progress"));const m=_(n)?n:E;i!==null&&!L(i,m)&&console.error(fe(`${i}`,"Progress"));const c=L(i,m)?i:null,p=y(c)?j(c,m):void 0;return e.jsx(xe,{scope:l,value:c,max:m,children:e.jsx(T.div,{"aria-valuemax":m,"aria-valuemin":0,"aria-valuenow":y(c)?c:void 0,"aria-valuetext":p,role:"progressbar","data-state":z(c,m),"data-value":c??void 0,"data-max":m,...N,ref:t})})});V.displayName=I;var B="ProgressIndicator",O=o.forwardRef((s,t)=>{const{__scopeProgress:l,...i}=s,n=ue(B,l);return e.jsx(T.div,{"data-state":z(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...i,ref:t})});O.displayName=B;function me(s,t){return`${Math.round(s/t*100)}%`}function z(s,t){return s==null?"indeterminate":s===t?"complete":"loading"}function y(s){return typeof s=="number"}function _(s){return y(s)&&!isNaN(s)&&s>0}function L(s,t){return y(s)&&!isNaN(s)&&s<=t&&s>=0}function pe(s,t){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${E}\`.`}function fe(s,t){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${E} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var q=V,he=O;const G=o.forwardRef(({className:s,value:t,...l},i)=>e.jsx(q,{ref:i,className:w("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...l,children:e.jsx(he,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));G.displayName=q.displayName;const ge=ee("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),A=o.forwardRef(({className:s,variant:t,...l},i)=>e.jsx("div",{ref:i,role:"alert",className:w(ge({variant:t}),s),...l}));A.displayName="Alert";const ve=o.forwardRef(({className:s,...t},l)=>e.jsx("h5",{ref:l,className:w("mb-1 font-medium leading-none tracking-tight",s),...t}));ve.displayName="AlertTitle";const D=o.forwardRef(({className:s,...t},l)=>e.jsx("div",{ref:l,className:w("text-sm [&_p]:leading-relaxed",s),...t}));D.displayName="AlertDescription";function ke(){const[s,t]=o.useState(null),[l,i]=o.useState(!1),[n,j]=o.useState(0),[N,m]=o.useState({}),[c,p]=o.useState("idle"),[H,S]=o.useState(""),[x,C]=o.useState(null),P=o.useRef(null),{toast:k}=se(),X=r=>{var d;const a=(d=r.target.files)==null?void 0:d[0];a&&(a.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||a.type==="application/vnd.ms-excel"||a.name.endsWith(".csv")?(t(a),p("idle"),S("")):(k({title:"Invalid file type",description:"Please upload an Excel file (.xlsx, .xls) or CSV file",variant:"destructive"}),t(null)))},J=async()=>{if(!s)return;i(!0),j(0),p("idle"),S(""),C(null);const r=new FormData;r.append("file",s);try{const a=localStorage.getItem("auth_token"),d=await fetch(te.UPLOAD,{method:"POST",body:r,headers:{Authorization:`Bearer ${a}`},credentials:"include"});if(!d.ok)throw new Error(`Upload failed: ${d.statusText}`);if(!d.body)throw new Error("No response body");const b=d.body.getReader(),W=new TextDecoder;let R="";for(;;){const{done:Y,value:Q}=await b.read();if(Y)break;R+=W.decode(Q,{stream:!0});const U=R.split(`
`);R=U.pop()||"";for(const M of U)if(M.trim())try{const u=JSON.parse(M);if(u.status==="progress")u.progress&&j(u.progress);else if(u.status==="complete")p("success"),C(u.data),j(100),k({title:"Upload successful",description:"Your file has been uploaded and processed successfully"});else if(u.status==="error")throw new Error(u.message)}catch(u){console.error("Error parsing stream:",u)}}}catch(a){p("error"),S(a.message||"An unexpected error occurred"),k({title:"Upload failed",description:a.message||"An unexpected error occurred",variant:"destructive"})}finally{i(!1)}},K=r=>{if(r===0)return"0 Bytes";const a=1024,d=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(r)/Math.log(a));return parseFloat((r/Math.pow(a,b)).toFixed(2))+" "+d[b]};return e.jsx(re,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Upload Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Upload your Excel or CSV files to import data into the system"})]}),e.jsxs(f,{children:[e.jsx(h,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"File Upload"]})}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"file-upload",children:"Select File"}),e.jsx(ie,{id:"file-upload",type:"file",ref:P,onChange:X,accept:".xlsx,.xls,.csv",disabled:l}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported formats: Excel (.xlsx, .xls) and CSV files"})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg",children:[e.jsx(le,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:K(s.size)})]})]}),l&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[n,"%"]})]}),e.jsx(G,{value:n})]}),c==="success"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(A,{className:"border-green-200 bg-green-50",children:[e.jsx(de,{className:"h-4 w-4 text-green-600"}),e.jsx(D,{className:"text-green-800",children:"File uploaded successfully!"})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(f,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Rows Inserted"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold",children:x.inserted.toLocaleString()})})]}),e.jsxs(f,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Duplicate Rows"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:x.skipped_details.filter(r=>r.reason==="Duplicate").length.toLocaleString()})})]}),e.jsxs(f,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Skipped Rows"})}),e.jsx(v,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.skipped_details.filter(r=>r.reason!=="Duplicate").length.toLocaleString()})})]}),e.jsxs(f,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium",children:"Revenue Match"})}),e.jsxs(v,{children:[e.jsx("div",{className:`text-2xl font-bold ${x.verification.match?"text-green-600":"text-red-600"}`,children:x.verification.match?"MATCHED":"MISMATCH"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Excel: £",x.verification.excel_revenue.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["DB: £",x.verification.db_revenue.toLocaleString()]})]})]})]}),x.skipped_details.length>0&&e.jsxs(f,{children:[e.jsx(h,{children:e.jsx(g,{className:"text-base",children:"Skipped Rows Details"})}),e.jsx(v,{children:e.jsx("div",{className:"max-h-60 overflow-y-auto border rounded-md",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-muted sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 font-medium",children:"Row"}),e.jsx("th",{className:"p-2 font-medium",children:"Reason"}),e.jsx("th",{className:"p-2 font-medium",children:"Details"})]})}),e.jsx("tbody",{children:x.skipped_details.map((r,a)=>e.jsxs("tr",{className:"border-t hover:bg-muted/50",children:[e.jsx("td",{className:"p-2",children:r.row}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${r.reason==="Duplicate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:r.reason})}),e.jsx("td",{className:"p-2 text-muted-foreground",children:r.details})]},a))})]})})})]})]}),e.jsx(F,{onClick:()=>{p("idle"),j(0),t(null),C(null),P.current&&(P.current.value="")},variant:"outline",className:"w-full",children:"Upload New File"})]}),c==="error"&&e.jsxs(A,{className:"border-red-200 bg-red-50",children:[e.jsx(oe,{className:"h-4 w-4 text-red-600"}),e.jsx(D,{className:"text-red-800",children:H})]}),c!=="success"&&e.jsx(F,{onClick:J,disabled:l,className:"w-full",children:l?"Uploading...":"Upload File"})]})]})]}),Object.keys(N).length>0&&e.jsxs(f,{children:[e.jsx(h,{children:e.jsx(g,{children:"Required Columns"})}),e.jsx(v,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(N).map(([r,a])=>e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:r}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(d=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-md text-sm",children:d},d))})]},r))})})]})]})})}export{ke as default};
