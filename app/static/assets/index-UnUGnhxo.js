import{e as se,z as G,A as v,r as d,j as e,L as N,B as O,I as j,E as p}from"./index-Cmp3SBtg.js";import{D as E}from"./DashboardLayout-CCxWjJqY.js";import{u as ae,a as J}from"./useMutation-BXVDRkyJ.js";import{T as I,a as P,b as h,c as u,d as B,e as i}from"./table-CcehA1j-.js";import{S as $,a as F,b as L,c as z,d as V}from"./select-Dx--iTY3.js";import{T as te,a as re,b as D,c as q}from"./tabs-BH3l7JrC.js";import{C as R,a as _,b as H,c as Q,d as K}from"./card-DY8SD6M5.js";import"./users-CCzvHyiO.js";import"./index-DxluRzuh.js";import"./index-DRrp-lUW.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=se("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),ne=(r,l)=>ae({queryKey:["parameters",r,l],queryFn:async()=>{const t=new URLSearchParams;r&&t.append("month",r.toString()),l&&t.append("year",l.toString());const[m,c]=await Promise.all([fetch(`${v.BASE}/parameters/targets?${t.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),fetch(`${v.BASE}/parameters/overheads?${t.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})]);if(!m.ok||!c.ok)throw new Error("Failed to fetch parameters");return{targets:await m.json(),overheads:await c.json()}}}),oe=()=>{const r=G();return J({mutationFn:async l=>{const t=await fetch(`${v.BASE}/parameters/targets`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(l)});if(!t.ok)throw new Error("Failed to save targets");return t.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["parameters"]})}})},le=()=>{const r=G();return J({mutationFn:async l=>{const t=await fetch(`${v.BASE}/parameters/overheads`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(l)});if(!t.ok)throw new Error("Failed to save overheads");return t.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["parameters"]})}})};function fe(){const[r,l]=d.useState(new Date().getMonth()+1),[t,m]=d.useState(new Date().getFullYear()),[c,T]=d.useState(new Map),[f,b]=d.useState(new Map),[x,M]=d.useState(""),[y,k]=d.useState(""),{data:n,isLoading:U,refetch:ie}=ne(r,t),S=oe(),w=le(),W=(s,a,o)=>{const g=`${s}::${a}`;T(new Map(c.set(g,parseInt(o)||0)))},X=(s,a)=>{const o=s;b(new Map(f.set(o,parseFloat(a)||0)))},Z=async()=>{if(c.size===0)return;const s=[];c.forEach((a,o)=>{const[g,A]=o.split("::");s.push({month:r,year:t,location:g==="null"?null:g,site:A==="null"?null:A,target:a})});try{await S.mutateAsync(s),p.success("Targets saved successfully"),T(new Map)}catch{p.error("Failed to save targets")}},ee=async()=>{const s=[];if(f.forEach((a,o)=>{s.push({month:r,year:t,category:o,amount:a})}),x&&y&&s.push({month:r,year:t,category:x,amount:parseFloat(y)||0}),s.length!==0)try{await w.mutateAsync(s),p.success("Overheads saved successfully"),b(new Map),M(""),k("")}catch{p.error("Failed to save overheads")}};if(U)return e.jsx(E,{children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(N,{className:"animate-spin"})})});const C=new Map;return n==null||n.targets.forEach(s=>{var o;const a=s.location||"Global";C.has(a)||C.set(a,[]),(o=C.get(a))==null||o.push(s)}),e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col gap-6 p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Business Parameters"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs($,{value:r.toString(),onValueChange:s=>l(parseInt(s)),children:[e.jsx(F,{className:"w-[120px]",children:e.jsx(L,{placeholder:"Month"})}),e.jsx(z,{children:Array.from({length:12},(s,a)=>e.jsx(V,{value:(a+1).toString(),children:new Date(0,a).toLocaleString("default",{month:"long"})},a+1))})]}),e.jsxs($,{value:t.toString(),onValueChange:s=>m(parseInt(s)),children:[e.jsx(F,{className:"w-[100px]",children:e.jsx(L,{placeholder:"Year"})}),e.jsx(z,{children:[2024,2025,2026,2027].map(s=>e.jsx(V,{value:s.toString(),children:s},s))})]})]})]}),e.jsxs(te,{defaultValue:"targets",children:[e.jsxs(re,{children:[e.jsx(D,{value:"targets",children:"Shift Targets"}),e.jsx(D,{value:"overheads",children:"Monthly Overheads"})]}),e.jsx(q,{value:"targets",children:e.jsxs(R,{children:[e.jsxs(_,{children:[e.jsx(H,{children:"Monthly Shift Targets"}),e.jsx(Q,{children:"Set monthly shift goals per location or site."})]}),e.jsx(K,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(O,{onClick:Z,disabled:c.size===0||S.isPending,children:[S.isPending?e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Save Changes"]})}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(I,{children:[e.jsx(P,{children:e.jsxs(h,{children:[e.jsx(u,{children:"Location"}),e.jsx(u,{children:"Site"}),e.jsx(u,{children:"Target Shifts"})]})}),e.jsxs(B,{children:[(n==null?void 0:n.targets.length)===0&&e.jsx(h,{children:e.jsx(i,{colSpan:3,className:"text-center text-muted-foreground",children:"No targets set for this month. Start by adding via Import or API (for now)."})}),n==null?void 0:n.targets.map(s=>e.jsxs(h,{children:[e.jsx(i,{children:s.location||"Global"}),e.jsx(i,{children:s.site||"All Sites"}),e.jsx(i,{children:e.jsx(j,{type:"number",defaultValue:s.target,onChange:a=>W(s.location||"null",s.site||"null",a.target.value),className:"w-32"})})]},s.id))]})]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"* Note: Currently only listing existing targets. To add new targets for locations not listed here, use the bulk importer (Coming Soon) or ensure at least one record exists."})]})})]})}),e.jsx(q,{value:"overheads",children:e.jsxs(R,{children:[e.jsxs(_,{children:[e.jsx(H,{children:"Monthly Overheads"}),e.jsx(Q,{children:"Track fixed costs for the month (e.g., Rent, Software, Insurance)."})]}),e.jsx(K,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border rounded-md",children:e.jsxs(I,{children:[e.jsx(P,{children:e.jsxs(h,{children:[e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Amount (Â£)"})]})}),e.jsxs(B,{children:[n==null?void 0:n.overheads.map(s=>e.jsxs(h,{children:[e.jsx(i,{children:s.category}),e.jsx(i,{children:e.jsx(j,{type:"number",defaultValue:s.amount,onChange:a=>X(s.category,a.target.value),className:"w-32"})})]},s.id)),e.jsxs(h,{className:"bg-muted/30",children:[e.jsx(i,{children:e.jsx(j,{placeholder:"New Category (e.g. Marketing)",value:x,onChange:s=>M(s.target.value)})}),e.jsx(i,{children:e.jsx(j,{type:"number",placeholder:"0.00",value:y,onChange:s=>k(s.target.value),className:"w-32"})})]})]})]})}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsxs(O,{onClick:ee,disabled:f.size===0&&!x||w.isPending,children:[w.isPending?e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]})})]})})]})]})})}export{fe as default};
