import{c as me,ab as Y,r as b,ac as fe,j as e,e as H,B as I,T as ae,k as le,l as oe,m as ne,I as R}from"./index-D6em82Qm.js";import{D as he,T as pe}from"./DashboardLayout-Mif_kDNp.js";import{D as V,b as Z,c as G,d as K,e as U,a as Q}from"./dialog-CGKwqDbc.js";import{L as be}from"./label-D02nLNkK.js";import{e as xe}from"./endOfMonth-D_Kh25Qw.js";import{f as z}from"./format-5mdouWNS.js";import{T as X}from"./trash-2-D3eKLy8S.js";import{P as ee}from"./plus-05UA9AJD.js";import"./users-B9fAecTf.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=me("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);function ye(r,s){const i=Y(r.start),a=Y(r.end);let u=+i>+a;const c=u?+i:+a,o=u?a:i;o.setHours(0,0,0,0),o.setDate(1);let n=1;const d=[];for(;+o<=c;)d.push(Y(o)),o.setMonth(o.getMonth()+n);return u?d.reverse():d}const ie=r=>{let s="";for(;r>=0;)s=String.fromCharCode(r%26+65)+s,r=Math.floor(r/26)-1;return s},te=(r,s)=>`${ie(s)}${r+1}`,de=r=>{const s=r.match(/^([A-Z]+)([0-9]+)$/);if(!s)return null;const i=s[1],a=s[2];let u=0;for(let o=0;o<i.length;o++)u=u*26+(i.charCodeAt(o)-64);return u-=1,{rowIdx:parseInt(a,10)-1,colIdx:u}},L=r=>{if(!(r!=null&&r.from)||!(r!=null&&r.to))return new Date().getFullYear(),[{id:"jan",label:"January",isProtected:!0},{id:"feb",label:"February",isProtected:!0},{id:"mar",label:"March",isProtected:!0},{id:"apr",label:"April",isProtected:!0},{id:"may",label:"May",isProtected:!0},{id:"jun",label:"June",isProtected:!0},{id:"jul",label:"July",isProtected:!0},{id:"aug",label:"August",isProtected:!0},{id:"sep",label:"September",isProtected:!0},{id:"oct",label:"October",isProtected:!0},{id:"nov",label:"November",isProtected:!0},{id:"dec",label:"December",isProtected:!0},{id:"year_end",label:"Year End",isProtected:!0,isYearEnd:!0}];const i=ye({start:fe(r.from),end:xe(r.to)}).map(a=>({id:z(a,"MMM-yyyy").toLowerCase(),label:z(a,"MMM yyyy"),isProtected:!0}));return i.push({id:"year_end",label:"Period Total",isProtected:!0,isYearEnd:!0}),i},re=(r,s,i)=>{var a,u;try{const c=Object.keys(s).sort((d,m)=>m.length-d.length);let o=r;o=o.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(d,m,g)=>{var v,k;return`(${((k=(v=s[m])==null?void 0:v[g])==null?void 0:k.value)??0})`});for(const d of c){const m=new RegExp(`\\b${d}\\b`,"g");if(m.test(o)){const g=((u=(a=s[d])==null?void 0:a[i])==null?void 0:u.value)??0;o=o.replace(m,`(${g})`)}}if(!/^[0-9+\-*/().\s]*$/.test(o))return null;const n=new Function(`return ${o}`)();return typeof n=="number"&&!isNaN(n)&&isFinite(n)?n:null}catch{return null}},B=[{id:"total_sales",label:"Total Sales",isAutoCalculated:!1,isCurrency:!0},{id:"sales_split_pct",label:"% Sales Split for the Year",isAutoCalculated:!0,isPercentage:!0,formulaString:"total_sales / total_sales:year_end"},{id:"cost_sales_se",label:"Cost of Sales SE",isAutoCalculated:!1,isCurrency:!0},{id:"cost_sales_paye",label:"Cost of Sales PAYE Gross",isAutoCalculated:!1,isCurrency:!0},{id:"employee_ni",label:"Employee NI",isAutoCalculated:!1,isCurrency:!0},{id:"employee_pension",label:"Employee Pension",isAutoCalculated:!1,isCurrency:!0},{id:"total_cost_sales",label:"Total Cost of Sales",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"cost_sales_se + cost_sales_paye + employee_ni + employee_pension"},{id:"apprenticeship_levy",label:"Apprenticeship Levy",isAutoCalculated:!1,isCurrency:!0},{id:"annual_leave",label:"Annual Leave Accrual",isAutoCalculated:!1,isCurrency:!0},{id:"other_expenses",label:"Other Expenses",isAutoCalculated:!1,isCurrency:!0},{id:"recruitment_cost",label:"Recruitment & Pass Cost",isAutoCalculated:!1,isCurrency:!0},{id:"overheads_mgmt",label:"Mgmt & Office Cost",isAutoCalculated:!1,isCurrency:!0},{id:"bank_interest",label:"Bank Interest",isAutoCalculated:!1,isCurrency:!0},{id:"cooperation_tax",label:"Cooperation Tax",isAutoCalculated:!1,isCurrency:!0},{id:"total_overheads",label:"Total Overheads",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"apprenticeship_levy + annual_leave + other_expenses + recruitment_cost + overheads_mgmt + bank_interest + cooperation_tax"},{id:"total_cost",label:"Total Cost",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"total_cost_sales + total_overheads"},{id:"avg_hourly_charge",label:"Avg Hourly Charge",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_pay",label:"Gross Hourly Pay",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_margin",label:"Gross Hourly Margin",isAutoCalculated:!0,isCurrency:!0,formulaString:"avg_hourly_charge - gross_hourly_pay"},{id:"net_cost_per_hour",label:"Net Cost per Hour",isAutoCalculated:!1,isCurrency:!0},{id:"gross_pl_value",label:"Gross P&L",isAutoCalculated:!1,isCurrency:!0},{id:"net_pl",label:"Net P&L",isAutoCalculated:!1,isCurrency:!0},{id:"total_net_margin",label:"Total Net Margin",isAutoCalculated:!1,isPercentage:!0},{id:"worked_hours",label:"Worked Hours",isAutoCalculated:!1},{id:"hours_breakeven",label:"Hours for Breakeven",isAutoCalculated:!0,formula:(r,s,i)=>{var c,o,n,d;const a=((o=(c=r.total_cost)==null?void 0:c[i])==null?void 0:o.value)??0,u=((d=(n=r.gross_hourly_margin)==null?void 0:n[i])==null?void 0:d.value)??0;return u!==0?a/u:0}},{id:"value_breakeven",label:"Total Value for Breakeven",isAutoCalculated:!0,isCurrency:!0,formulaString:"hours_breakeven * avg_hourly_charge"},{id:"sales_budget_2026",label:"Projeted Sales Budget 30% Uplift",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales * 1.3"},{id:"avg_hourly_charge_2026",label:"Average Hourly Charge Rate Future",isAutoCalculated:!1,isCurrency:!0},{id:"sales_target_hours",label:"Sales Target in Hours",isAutoCalculated:!1},{id:"variance_2025",label:"Variance",isAutoCalculated:!1,isCurrency:!0}];function se(r,s){const i={};for(const a of r){i[a.id]={};for(const u of s)i[a.id][u.id]={value:null,isEditable:!a.isAutoCalculated&&!u.isYearEnd,source:"manual"}}return i}function F(r,s,i){const a=JSON.parse(JSON.stringify(r)),u=i.filter(n=>!n.isYearEnd),c=i.find(n=>n.isYearEnd);for(const n of u)for(const d of s)d.id!=="sales_split_pct"&&(d.formulaString?a[d.id][n.id]={...a[d.id][n.id],value:re(d.formulaString,a,n.id),isEditable:!1,source:"formula"}:d.formula&&(a[d.id][n.id]={...a[d.id][n.id],value:d.formula(a,d.id,n.id),isEditable:!1,source:"formula"}));if(c)for(const n of s){if(n.id==="sales_split_pct")continue;const d=u.reduce((m,g)=>{var w,v;return m+(((v=(w=a[n.id])==null?void 0:w[g.id])==null?void 0:v.value)??0)},0);a[n.id][c.id]={value:d,isEditable:!1,source:"calculated"}}const o=s.find(n=>n.id==="sales_split_pct");if(o&&o.formulaString&&c){for(const n of u){const d=re(o.formulaString,a,n.id);a[o.id][n.id]={value:d?d*100:0,isEditable:!1,source:"formula"}}a[o.id][c.id]={value:100,isEditable:!1,source:"calculated"}}return a}function Ce(r){const[s,i]=b.useState(B),[a,u]=b.useState(()=>L(r)),[c,o]=b.useState(()=>F(se(B,L(r)),B,L(r))),[n,d]=b.useState(null);b.useEffect(()=>{const f=L(r);u(f);let t=se(s,f);r!=null&&r.from&&(r!=null&&r.to)?(async()=>{try{const h=z(r.from,"yyyy-MM-dd"),p=z(r.to,"yyyy-MM-dd"),_=localStorage.getItem("auth_token"),y=await fetch(`undefined/api/financial-summary/metrics?start=${h}&end=${p}`,{headers:{Authorization:`Bearer ${_}`}});if(y.ok){const l=await y.json(),C={January:"jan",February:"feb",March:"mar",April:"apr",May:"may",June:"jun",July:"jul",August:"aug",September:"sep",October:"oct",November:"nov",December:"dec"};for(const[A,j]of Object.entries(l)){const[$,P]=A.split("-"),T=C[P];if(!T)continue;const S=`${T}-${$}`;f.find(O=>O.id===S)&&(t.total_sales&&t.total_sales[S]&&(t.total_sales[S].value=j.total_sales,t.total_sales[S].source="database"),t.cost_sales_paye&&t.cost_sales_paye[S]&&(t.cost_sales_paye[S].value=j.cost_sales_paye,t.cost_sales_paye[S].source="database"))}o(F(t,s,f))}else o(F(t,s,f))}catch(h){console.error("Failed to fetch metrics",h),o(F(t,s,f))}})():o(F(t,s,f))},[r]);const m=b.useCallback((f,t,x)=>{o(h=>{const p={...h};return p[f]={...p[f]},p[f][t]={...p[f][t],value:x,source:"manual"},F(p,s,a)})},[s,a]),g=b.useCallback((f,t)=>{i(x=>{const h=x.map(p=>p.id===f?{...p,formulaString:t}:p);return o(p=>F(p,h,a)),h})},[a]),w=b.useCallback(f=>{const t=`custom_${Date.now()}`,x={id:t,label:f,isAutoCalculated:!1,isCurrency:!0};i(h=>{const p=[...h,x];return o(_=>{const y={..._};y[t]={};for(const l of a)y[t][l.id]={value:null,isEditable:!l.isYearEnd,source:"manual"};return F(y,p,a)}),p})},[a]),v=b.useCallback(f=>{i(t=>t.filter(x=>x.id!==f)),o(t=>{const x={...t};return delete x[f],x})},[]),k=b.useCallback(f=>{const t=`col_${Date.now()}`,x={id:t,label:f};u(h=>{const p=h.findIndex(y=>y.isYearEnd),_=[...h];return _.splice(p,0,x),o(y=>{const l={...y};for(const C of s)l[C.id]={...l[C.id]},l[C.id][t]={value:null,isEditable:!C.isAutoCalculated,source:"manual"};return F(l,s,_)}),_})},[s]),D=b.useCallback(f=>{u(t=>{const x=t.filter(h=>h.id!==f);return o(h=>{const p={...h};for(const _ of Object.keys(p)){const{[f]:y,...l}=p[_];p[_]=l}return F(p,s,x)}),x})},[s]),E=b.useCallback((f,t)=>{u(x=>x.map(h=>h.id===f?{...h,label:t}:h))},[]),N=b.useCallback(f=>{if(!n)return;const t=s.filter(l=>!l.isAutoCalculated),x=a.filter(l=>!l.isYearEnd),h=t.findIndex(l=>l.id===n.row),p=x.findIndex(l=>l.id===n.col);if(h===-1||p===-1)return;let _=h,y=p;switch(f){case"up":_=Math.max(0,h-1);break;case"down":_=Math.min(t.length-1,h+1);break;case"left":y=Math.max(0,p-1);break;case"right":y=Math.min(x.length-1,p+1);break}d({row:t[_].id,col:x[y].id})},[n,s,a]),M=b.useCallback(async f=>{if(f)try{const t={year:new Date().getFullYear(),data:c,rows:s,columns:a},x=localStorage.getItem("auth_token");if(!(await fetch("undefined/api/financial-summary/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify(t)})).ok)throw new Error("Failed to save")}catch(t){throw console.error("Save failed",t),t}},[c,s,a]);return{rows:s,columns:a,data:c,activeCell:n,setActiveCell:d,updateCell:m,addRow:w,deleteRow:v,addColumn:k,deleteColumn:D,renameColumn:E,navigateCell:N,saveData:M,updateRowFormula:g}}function ue(r,s){return r===null||r===0?"":s.isPercentage?`${r.toFixed(2)}%`:s.isCurrency?`Â£${r.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}`:r.toLocaleString("en-GB",{maximumFractionDigits:2})}const J=(r,s,i,a)=>{if(!r)return"";const u=i.findIndex(m=>m.id===a),c=new Map(s.map((m,g)=>[m.id,g])),o=new Map(i.map((m,g)=>[m.id,g]));let n=r;n=n.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(m,g,w)=>{const v=c.get(g),k=o.get(w);return v!==void 0&&k!==void 0?te(v,k):m});const d=Array.from(c.keys()).sort((m,g)=>g.length-m.length);for(const m of d){const g=new RegExp(`\\b${m}\\b`,"g");if(g.test(n)){const w=c.get(m);n=n.replace(g,te(w,u))}}return n},je=(r,s,i,a)=>{if(!r)return"";let u=r;const c=i.findIndex(o=>o.id===a);return u=u.replace(/\b([A-Z]+)([0-9]+)\b/g,o=>{const n=de(o);if(!n)return o;const d=s[n.rowIdx],m=i[n.colIdx];return!d||!m?o:n.colIdx===c?d.id:`${d.id}:${m.id}`}),u};function ce({source:r,formula:s,displayFormula:i,value:a}){return e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Source:"})," ",r==="backend"?"Database":r||"Unknown"]}),i&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Formula:"}),e.jsx("code",{className:"bg-muted px-1 rounded ml-1",children:i})]})]})}function ve({rowId:r,colId:s,value:i,row:a,isActive:u,source:c,isHighlighted:o,onFocus:n,onUpdate:d,onNavigate:m,onHover:g}){const[w,v]=b.useState(!1),[k,D]=b.useState(""),E=b.useRef(null),N=b.useCallback(()=>{v(!0),D(i!==null?String(i):""),setTimeout(()=>{var t;return(t=E.current)==null?void 0:t.focus()},0)},[i]),M=b.useCallback(()=>{v(!1);const t=parseFloat(k);d(k===""?null:isNaN(t)?i:t)},[k,d,i]),f=t=>{w?t.key==="Enter"||t.key==="Tab"?(t.preventDefault(),M(),m(t.shiftKey?"up":"down")):t.key==="Escape"&&v(!1):t.key==="Enter"||t.key==="F2"?(t.preventDefault(),N()):t.key==="ArrowUp"?(t.preventDefault(),m("up")):t.key==="ArrowDown"?(t.preventDefault(),m("down")):t.key==="ArrowLeft"?(t.preventDefault(),m("left")):t.key==="ArrowRight"?(t.preventDefault(),m("right")):t.key==="Delete"||t.key==="Backspace"?(t.preventDefault(),d(null)):/^[0-9.\-]$/.test(t.key)&&(t.preventDefault(),D(t.key),v(!0),setTimeout(()=>{var x;return(x=E.current)==null?void 0:x.focus()},0))};return e.jsx(ae,{children:e.jsxs(le,{delayDuration:500,children:[e.jsx(oe,{asChild:!0,children:e.jsxs("td",{className:H("border border-border px-2 py-1 text-right text-sm min-w-[110px] cursor-cell transition-colors relative",u&&"ring-2 ring-primary ring-inset bg-primary/5",!u&&"hover:bg-muted/50",c==="database"&&"bg-blue-50/30 dark:bg-blue-900/10",c==="formula"&&"bg-purple-50/30 dark:bg-purple-900/10",o&&"ring-2 ring-orange-400 bg-orange-100/20"),onClick:n,onDoubleClick:N,onKeyDown:f,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),tabIndex:0,onFocus:n,children:[c==="database"&&e.jsx("div",{className:"absolute top-0 right-0 w-1.5 h-1.5 bg-blue-400 rounded-bl-sm opacity-50"}),w?e.jsx("input",{ref:E,type:"text",value:k,onChange:t=>D(t.target.value),onBlur:M,className:"w-full bg-transparent text-right outline-none text-sm font-mono"}):e.jsx("span",{className:"font-mono text-sm",children:ue(i,a)})]})}),e.jsx(ne,{children:e.jsx(ce,{source:c,value:i})})]})})}function _e({value:r,row:s,source:i,formula:a,displayFormula:u,isHighlighted:c,onHover:o}){return e.jsx(ae,{children:e.jsxs(le,{delayDuration:500,children:[e.jsx(oe,{asChild:!0,children:e.jsxs("td",{className:H("border border-border px-2 py-1 text-right text-sm min-w-[110px] relative",s.isHeader?"bg-primary/10 font-semibold":"bg-muted/30",i==="calculated"&&"bg-orange-50/30 dark:bg-orange-900/10",c&&"ring-2 ring-orange-400 bg-orange-100/20"),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[a&&e.jsx("div",{className:"absolute top-0 right-0 w-1.5 h-1.5 bg-orange-400 rounded-bl-sm opacity-50"}),e.jsx("span",{className:"font-mono text-sm",children:ue(r,s)})]})}),e.jsx(ne,{children:e.jsx(ce,{source:i,displayFormula:u,value:r})})]})})}function we({isOpen:r,onClose:s,row:i,initialFormula:a,onSave:u}){const[c,o]=b.useState(a);return b.useEffect(()=>{o(a)},[a]),i?e.jsx(V,{open:r,onOpenChange:n=>!n&&s(),children:e.jsxs(Z,{children:[e.jsx(G,{children:e.jsxs(K,{children:["Edit Formula: ",i.label]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(be,{htmlFor:"formula",className:"text-right",children:"Formula"}),e.jsx(R,{id:"formula",value:c,onChange:n=>o(n.target.value),className:"col-span-3 font-mono"})]}),e.jsx("div",{className:"text-xs text-muted-foreground ml-[25%]",children:"Supported: A1, B2, +, -, *, /, ( )"})]}),e.jsx(U,{children:e.jsx(I,{type:"submit",onClick:()=>u(c),children:"Save changes"})})]})}):null}function ke({rows:r,columns:s,data:i,activeCell:a,setActiveCell:u,updateCell:c,deleteRow:o,deleteColumn:n,navigateCell:d,onRenameColumn:m,updateRowFormula:g}){const[w,v]=b.useState(null),[k,D]=b.useState(""),E=b.useRef(null),[N,M]=b.useState(null),[f,t]=b.useState(new Set),x=l=>{v(l.id),D(l.label),setTimeout(()=>{var C;return(C=E.current)==null?void 0:C.focus()},0)},h=()=>{w&&m&&m(w,k),v(null)},p=l=>{M(l)},_=l=>{if(N&&g){const C=je(l,r,s,s[0].id);g(N.id,C)}M(null)},y=b.useCallback((l,C,A)=>{if(!A){t(new Set);return}const j=l.formulaString;if(!j)return;const $=J(j,r,s,C),P=new Set,T=/\b[A-Z]+[0-9]+\b/g;let S;for(;(S=T.exec($))!==null;){const O=de(S[0]);if(O){const W=r[O.rowIdx],q=s[O.colIdx];W&&q&&P.add(`${W.id}:${q.id}`)}}t(P)},[r,s]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto border border-border rounded-lg bg-card max-w-full",children:e.jsxs("table",{className:"border-collapse w-full text-xs",children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"bg-muted/30 border border-border w-[50px]"}),e.jsx("th",{className:"bg-muted/30 border border-border w-[240px]"}),s.map((l,C)=>e.jsx("th",{className:"bg-muted/30 border border-border text-center font-normal text-muted-foreground",children:ie(C)},`letter-${l.id}`)),e.jsx("th",{className:"bg-muted/30 border border-border w-16"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 bg-muted/30 border border-border text-center text-muted-foreground font-mono w-[50px]",children:"#"}),e.jsx("th",{className:"sticky left-[50px] z-20 bg-card border border-border px-2 py-2 text-left font-semibold text-muted-foreground uppercase tracking-wider w-[240px] min-w-[240px]",children:"Description"}),s.map(l=>e.jsx("th",{className:H("sticky top-0 z-10 border border-border px-1 py-1 text-center font-semibold uppercase tracking-wider min-w-[80px]",l.isYearEnd?"bg-primary/10 text-primary":"bg-muted/50 text-muted-foreground"),onDoubleClick:()=>!l.isProtected&&x(l),children:e.jsx("div",{className:"flex items-center justify-center gap-1 h-8 group relative px-2",children:w===l.id?e.jsx("input",{ref:E,value:k,onChange:C=>D(C.target.value),onBlur:h,onKeyDown:C=>C.key==="Enter"&&h(),className:"w-full bg-background border rounded px-1 text-center"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"truncate",children:l.label}),!l.isProtected&&e.jsx(I,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 absolute -right-1 hover:text-destructive hover:bg-destructive/10",onClick:C=>{C.stopPropagation(),n(l.id)},children:e.jsx(X,{className:"h-3 w-3"})})]})})},l.id)),e.jsx("th",{className:"sticky top-0 z-10 bg-card border border-border w-16"})]})]}),e.jsx("tbody",{children:r.map((l,C)=>e.jsxs("tr",{className:H("group hover:bg-muted/20",l.isHeader&&"bg-primary/5"),children:[e.jsx("td",{className:"sticky left-0 bg-muted/30 border border-border text-center text-muted-foreground font-mono w-[50px]",children:C+1}),e.jsxs("td",{className:H("sticky left-[50px] z-10 border border-border px-2 py-1 whitespace-nowrap bg-card text-xs truncate max-w-[240px] flex items-center justify-between gap-2",l.isHeader&&"font-bold text-primary bg-primary/5",l.isAutoCalculated&&!l.isHeader&&"text-muted-foreground italic"),title:`ID: ${l.id}`,children:[e.jsx("span",{className:"truncate",children:l.label}),(l.formulaString||l.isAutoCalculated)&&e.jsx(I,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:text-primary shrink-0",title:"Edit Formula",onClick:()=>p(l),children:e.jsx(ge,{className:"h-3 w-3"})})]}),s.map(A=>{var T;const j=(T=i[l.id])==null?void 0:T[A.id],$=(j==null?void 0:j.isEditable)&&!l.isAutoCalculated&&!A.isYearEnd,P=f.has(`${l.id}:${A.id}`);return $?e.jsx(ve,{rowId:l.id,colId:A.id,value:(j==null?void 0:j.value)??null,row:l,isActive:(a==null?void 0:a.row)===l.id&&(a==null?void 0:a.col)===A.id,source:j==null?void 0:j.source,isHighlighted:P,onFocus:()=>u({row:l.id,col:A.id}),onUpdate:S=>c(l.id,A.id,S),onNavigate:d,onHover:S=>y(l,A.id,S)},A.id):e.jsx(_e,{value:(j==null?void 0:j.value)??null,row:l,source:j==null?void 0:j.source,formula:l.formulaString,displayFormula:J(l.formulaString||"",r,s,A.id),isHighlighted:P,onHover:S=>y(l,A.id,S)},A.id)}),e.jsx("td",{className:"border border-border bg-card w-16 text-center p-0",children:!l.isAutoCalculated&&e.jsx(I,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:text-destructive",onClick:()=>o(l.id),children:e.jsx(X,{className:"h-3 w-3"})})})]},l.id))})]})}),N&&e.jsx(we,{isOpen:!0,onClose:()=>M(null),row:N,initialFormula:J(N.formulaString||"",r,s,s[0].id),onSave:_})]})}function Te(){const[r,s]=b.useState(void 0),{rows:i,columns:a,data:u,activeCell:c,setActiveCell:o,updateCell:n,addRow:d,deleteRow:m,addColumn:g,deleteColumn:w,navigateCell:v,updateRowFormula:k}=Ce(r),[D,E]=b.useState(""),[N,M]=b.useState(""),[f,t]=b.useState(!1),[x,h]=b.useState(!1),p=()=>{D.trim()&&(d(D.trim()),E(""),t(!1))},_=()=>{N.trim()&&(g(N.trim()),M(""),h(!1))};return e.jsx(he,{noPadding:!0,fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-card/50 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(pe,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Financial Summary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Annual budget and performance spreadsheet"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(V,{open:f,onOpenChange:t,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"})," Add Row"]})}),e.jsxs(Z,{children:[e.jsx(G,{children:e.jsx(K,{children:"Add New Row"})}),e.jsx(R,{placeholder:"Row label...",value:D,onChange:y=>E(y.target.value),onKeyDown:y=>y.key==="Enter"&&p()}),e.jsx(U,{children:e.jsx(I,{onClick:p,disabled:!D.trim(),children:"Add"})})]})]}),e.jsxs(V,{open:x,onOpenChange:h,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"})," Add Column"]})}),e.jsxs(Z,{children:[e.jsx(G,{children:e.jsx(K,{children:"Add New Column"})}),e.jsx(R,{placeholder:"Column label...",value:N,onChange:y=>M(y.target.value),onKeyDown:y=>y.key==="Enter"&&_()}),e.jsx(U,{children:e.jsx(I,{onClick:_,disabled:!N.trim(),children:"Add"})})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx(ke,{rows:i,columns:a,data:u,activeCell:c,setActiveCell:o,updateCell:n,deleteRow:m,deleteColumn:w,navigateCell:v,updateRowFormula:k})})]})})}export{Te as default};
