import{g as xe,r as h,Y as je,m as ge,j as e,z as fe,P as R,i as k,k as pe,d as B,a8 as ve,I as w,B as K,L as F,D as A}from"./index-BjNw3qEE.js";import{D as be}from"./DashboardLayout-CZMNrpH6.js";import{C as I,a as M,b as L,d as E}from"./card-C2eWodu1.js";import{L as f}from"./label-B1V-ReH7.js";import{S as N,a as T,b as S,c as C,d as b}from"./select-TVU3DgWm.js";import{T as z,a as G,b as y,c as v,d as H,e as g}from"./table-D4JFbEVf.js";import{c as Y,R as ye,I as Ne,u as Te,f as J}from"./index-Bk6cOZEG.js";import{u as Q}from"./useQuery-CC13hZqr.js";import"./users-BjecRXlB.js";import"./index-dzqjn2v4.js";var _="Tabs",[Se,Ve]=xe(_,[Y]),W=Y(),[Ce,O]=Se(_),U=h.forwardRef((s,r)=>{const{__scopeTabs:o,value:n,onValueChange:l,defaultValue:m,orientation:i="horizontal",dir:u,activationMode:p="automatic",...j}=s,t=je(u),[c,d]=ge({prop:n,onChange:l,defaultProp:m??"",caller:_});return e.jsx(Ce,{scope:o,baseId:fe(),value:c,onValueChange:d,orientation:i,dir:t,activationMode:p,children:e.jsx(R.div,{dir:t,"data-orientation":i,...j,ref:r})})});U.displayName=_;var X="TabsList",Z=h.forwardRef((s,r)=>{const{__scopeTabs:o,loop:n=!0,...l}=s,m=O(X,o),i=W(o);return e.jsx(ye,{asChild:!0,...i,orientation:m.orientation,dir:m.dir,loop:n,children:e.jsx(R.div,{role:"tablist","aria-orientation":m.orientation,...l,ref:r})})});Z.displayName=X;var ee="TabsTrigger",ae=h.forwardRef((s,r)=>{const{__scopeTabs:o,value:n,disabled:l=!1,...m}=s,i=O(ee,o),u=W(o),p=ne(i.baseId,n),j=re(i.baseId,n),t=n===i.value;return e.jsx(Ne,{asChild:!0,...u,focusable:!l,active:t,children:e.jsx(R.button,{type:"button",role:"tab","aria-selected":t,"aria-controls":j,"data-state":t?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:p,...m,ref:r,onMouseDown:k(s.onMouseDown,c=>{!l&&c.button===0&&c.ctrlKey===!1?i.onValueChange(n):c.preventDefault()}),onKeyDown:k(s.onKeyDown,c=>{[" ","Enter"].includes(c.key)&&i.onValueChange(n)}),onFocus:k(s.onFocus,()=>{const c=i.activationMode!=="manual";!t&&!l&&c&&i.onValueChange(n)})})})});ae.displayName=ee;var se="TabsContent",te=h.forwardRef((s,r)=>{const{__scopeTabs:o,value:n,forceMount:l,children:m,...i}=s,u=O(se,o),p=ne(u.baseId,n),j=re(u.baseId,n),t=n===u.value,c=h.useRef(t);return h.useEffect(()=>{const d=requestAnimationFrame(()=>c.current=!1);return()=>cancelAnimationFrame(d)},[]),e.jsx(pe,{present:l||t,children:({present:d})=>e.jsx(R.div,{"data-state":t?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":p,hidden:!d,id:j,tabIndex:0,...i,ref:r,style:{...s.style,animationDuration:c.current?"0s":void 0},children:d&&m})})});te.displayName=se;function ne(s,r){return`${s}-trigger-${r}`}function re(s,r){return`${s}-content-${r}`}var we=U,ie=Z,oe=ae,le=te;const Fe=we,ce=h.forwardRef(({className:s,...r},o)=>e.jsx(ie,{ref:o,className:B("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r}));ce.displayName=ie.displayName;const V=h.forwardRef(({className:s,...r},o)=>e.jsx(oe,{ref:o,className:B("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...r}));V.displayName=oe.displayName;const $=h.forwardRef(({className:s,...r},o)=>e.jsx(le,{ref:o,className:B("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r}));$.displayName=le.displayName;const P=["January","February","March","April","May","June","July","August","September","October","November","December"],$e=()=>{const[s,r]=h.useState(new Date().getFullYear()),o=ve(),{data:n}=Te(),{data:l,isLoading:m}=Q({queryKey:["admin-targets",s],queryFn:async()=>{const a=await fetch(`/api/admin/targets?year=${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!a.ok)throw new Error("Failed to fetch targets");return a.json()}}),i=J({mutationFn:async a=>{const x=await fetch("/api/admin/targets",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(a)});if(!x.ok)throw new Error("Failed to save target");return x.json()},onSuccess:()=>{o.invalidateQueries({queryKey:["admin-targets"]}),A.success("Target saved")},onError:a=>A.error(a.message)}),{data:u,isLoading:p}=Q({queryKey:["admin-financials",s],queryFn:async()=>{const a=await fetch(`/api/admin/financial-metrics?year=${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!a.ok)throw new Error("Failed to fetch metrics");return a.json()}}),j=J({mutationFn:async a=>{const x=await fetch("/api/admin/financial-metrics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(a)});if(!x.ok)throw new Error("Failed to save metric");return x.json()},onSuccess:()=>{o.invalidateQueries({queryKey:["admin-financials"]}),A.success("Metric saved")},onError:a=>A.error(a.message)}),[t,c]=h.useState({month:P[new Date().getMonth()],location:"",site:"",target:0}),[d,D]=h.useState({month:P[new Date().getMonth()],name:"",value:0}),de=Array.from(new Set((n==null?void 0:n.jobs.map(a=>a.location).filter(Boolean))||[])),ue=Array.from(new Set((n==null?void 0:n.jobs.filter(a=>a.location===t.location).map(a=>a.site).filter(Boolean))||[])),he=a=>{a.preventDefault(),i.mutate({year:s,month:t.month,location:t.location,site:t.site||null,target:Number(t.target)})},me=a=>{a.preventDefault(),j.mutate({year:s,month:d.month,name:d.name,value:Number(d.value)})};return e.jsxs(be,{fullWidth:!0,children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Admin Metrics & Targets"})}),e.jsxs(Fe,{defaultValue:"targets",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(ce,{children:[e.jsx(V,{value:"targets",children:"Shift Targets"}),e.jsx(V,{value:"financials",children:"Financial Parameters"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{htmlFor:"year-select",children:"Year:"}),e.jsxs(N,{value:s.toString(),onValueChange:a=>r(Number(a)),children:[e.jsx(T,{className:"w-[100px]",children:e.jsx(S,{})}),e.jsx(C,{children:[2024,2025,2026,2027,2028].map(a=>e.jsx(b,{value:a.toString(),children:a},a))})]})]})]}),e.jsx($,{value:"targets",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(I,{className:"md:col-span-1 h-fit",children:[e.jsx(M,{children:e.jsx(L,{children:"Set Target"})}),e.jsx(E,{children:e.jsxs("form",{onSubmit:he,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Month"}),e.jsxs(N,{value:t.month,onValueChange:a=>c({...t,month:a}),children:[e.jsx(T,{children:e.jsx(S,{})}),e.jsx(C,{children:P.map(a=>e.jsx(b,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Location"}),e.jsxs(N,{value:t.location,onValueChange:a=>c({...t,location:a,site:""}),children:[e.jsx(T,{children:e.jsx(S,{placeholder:"Select Location"})}),e.jsx(C,{children:de.map(a=>e.jsx(b,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Site (Optional)"}),e.jsxs(N,{value:t.site,onValueChange:a=>c({...t,site:a}),disabled:!t.location,children:[e.jsx(T,{children:e.jsx(S,{placeholder:"All Sites"})}),e.jsxs(C,{children:[e.jsx(b,{value:"ALL_SITES_PLACEHOLDER",children:"All Sites"}),ue.map(a=>e.jsx(b,{value:a,children:a},a))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If no site is selected, the target applies to the whole location. Currently, this means each site is compared against this total target."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Target Shift Count"}),e.jsx(w,{type:"number",value:t.target,onChange:a=>c({...t,target:Number(a.target.value)})})]}),e.jsxs(K,{type:"submit",disabled:i.isPending,className:"w-full",children:[i.isPending&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Target"]})]})})]}),e.jsxs(I,{className:"md:col-span-2",children:[e.jsx(M,{children:e.jsxs(L,{children:["Existing Targets (",s,")"]})}),e.jsx(E,{children:m?e.jsx(F,{className:"animate-spin"}):e.jsxs(z,{children:[e.jsx(G,{children:e.jsxs(y,{children:[e.jsx(v,{children:"Month"}),e.jsx(v,{children:"Location"}),e.jsx(v,{children:"Site"}),e.jsx(v,{children:"Target"})]})}),e.jsxs(H,{children:[l==null?void 0:l.map(a=>e.jsxs(y,{children:[e.jsx(g,{children:a.month}),e.jsx(g,{children:a.location}),e.jsx(g,{children:a.site||e.jsx("span",{className:"text-muted-foreground italic",children:"All"})}),e.jsx(g,{width:150,children:e.jsx(w,{type:"number",defaultValue:a.target,className:"h-8",onBlur:x=>{const q=Number(x.target.value);q!==a.target&&i.mutate({year:a.year,month:a.month,location:a.location,site:a.site,target:q})},onKeyDown:x=>{x.key==="Enter"&&x.currentTarget.blur()}})})]},a.id)),(l==null?void 0:l.length)===0&&e.jsx(y,{children:e.jsx(g,{colSpan:4,className:"text-center",children:"No targets set"})})]})]})})]})]})}),e.jsx($,{value:"financials",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(I,{className:"md:col-span-1 h-fit",children:[e.jsx(M,{children:e.jsx(L,{children:"Add Metric"})}),e.jsx(E,{children:e.jsxs("form",{onSubmit:me,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Month"}),e.jsxs(N,{value:d.month,onValueChange:a=>D({...d,month:a}),children:[e.jsx(T,{children:e.jsx(S,{})}),e.jsx(C,{children:P.map(a=>e.jsx(b,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Metric Name"}),e.jsx(w,{placeholder:"e.g. Overheads",value:d.name,onChange:a=>D({...d,name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Value (£)"}),e.jsx(w,{type:"number",step:"0.01",value:d.value,onChange:a=>D({...d,value:Number(a.target.value)})})]}),e.jsxs(K,{type:"submit",disabled:j.isPending,className:"w-full",children:[j.isPending&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Metric"]})]})})]}),e.jsxs(I,{className:"md:col-span-2",children:[e.jsx(M,{children:e.jsxs(L,{children:["Financial Parameters (",s,")"]})}),e.jsx(E,{children:p?e.jsx(F,{className:"animate-spin"}):e.jsxs(z,{children:[e.jsx(G,{children:e.jsxs(y,{children:[e.jsx(v,{children:"Month"}),e.jsx(v,{children:"Metric"}),e.jsx(v,{children:"Value"})]})}),e.jsxs(H,{children:[u==null?void 0:u.map(a=>e.jsxs(y,{children:[e.jsx(g,{children:a.month}),e.jsx(g,{children:a.name}),e.jsxs(g,{children:["£",a.value.toLocaleString()]})]},a.id)),(u==null?void 0:u.length)===0&&e.jsx(y,{children:e.jsx(g,{colSpan:3,className:"text-center",children:"No metrics set"})})]})]})})]})]})})]})]})};export{$e as default};
