const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-DZb1VNBj.js","assets/index-CIsg3ZQC.js","assets/index-yZwKteGu.css","assets/card-BKvzk5lQ.js","assets/trending-up-CSNUa59h.js","assets/popover-DGkwIh27.js","assets/button-Cl2TMjwf.js","assets/DashboardLayout-D9raQjY5.js","assets/users-kzLJn6vp.js","assets/ChartCanvas-DGFheY-g.js","assets/badge-D87o4TlP.js","assets/AreaChart-m2q11Ogy.js","assets/BarChart-CcqGcT7M.js"])))=>i.map(i=>d[i]);
import{r as i,j as e,b as D,S as V,_}from"./index-CIsg3ZQC.js";import{D as Y}from"./DashboardLayout-D9raQjY5.js";import{L as h}from"./label-7j4XL8SI.js";import{S as F,a as $,b as U,c as q,d as f}from"./select-D1S0KsRA.js";import{B as g}from"./button-Cl2TMjwf.js";import{g as N,P as S,b,C as M,f as x,c as L,d as T}from"./popover-DGkwIh27.js";import"./users-kzLJn6vp.js";const G=()=>{const[t,o]=i.useState({dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0});return{state:t,setDimensions:n=>{o(r=>({...r,dimensions:n}))},setMetrics:n=>{o(r=>({...r,metrics:n}))},setChartType:n=>{o(r=>({...r,chartType:n}))},setDateRange:n=>{o(r=>({...r,dateRange:n}))},addCustomMetric:n=>{o(r=>({...r,customMetrics:[...r.customMetrics,n]}))},setChartData:n=>{o(r=>({...r,chartData:n}))},setDraggedItem:n=>{o(r=>({...r,draggedItem:n}))}}},H=i.lazy(()=>_(()=>import("./MetricPalette-DZb1VNBj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),J=i.lazy(()=>_(()=>import("./ChartCanvas-DGFheY-g.js"),__vite__mapDeps([9,1,2,10,11,12])));function te(){const{state:t,setDimensions:o,setMetrics:u,setChartType:y,setDateRange:k,setChartData:m}=G(),[s,p]=i.useState({from:new Date,to:N(new Date,30)}),[l,n]=i.useState({from:new Date,to:N(new Date,30)}),[r,v]=i.useState(!1),[P,w]=i.useState(!1),R=()=>{n(s)};i.useEffect(()=>{(async()=>{if(t.dimensions.length===0||t.metrics.length===0||!(l!=null&&l.from)||!(l!=null&&l.to)){m([]);return}const c=t.dimensions[0],O=t.metrics,B=x(l.from,"yyyy-MM-dd"),z=x(l.to,"yyyy-MM-dd");try{const d=new URLSearchParams;d.append("start",B),d.append("end",z),d.append("dimension",c),O.forEach(j=>d.append("metrics",j));const C=await fetch(`/api/chart-data?${d.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(C.ok){const j=await C.json();m(j)}else console.error("Failed to fetch chart data"),m([])}catch(d){console.error("Error fetching chart data:",d),m([])}})()},[t.dimensions,t.metrics,l]);const A=a=>{a.type==="dimension"?t.dimensions.includes(a.name)||o([a.name]):a.type==="metric"&&(t.metrics.includes(a.name)||u([...t.metrics,a.name]))},E=a=>{o(t.dimensions.filter(c=>c!==a))},I=a=>{u(t.metrics.filter(c=>c!==a))};return e.jsx(Y,{children:e.jsx("div",{className:"p-4 md:p-6 h-full flex flex-col",children:e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsx("div",{className:"sticky lg:top-0 z-30 pb-4 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-2 shadow-sm bg-background",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Chart Builder"}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-base",children:"Click on metrics and dimensions to build your chart"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1",children:[e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"Chart Type"}),e.jsxs(F,{value:t.chartType,onValueChange:y,children:[e.jsx($,{className:"w-full",children:e.jsx(U,{placeholder:"Select chart type"})}),e.jsxs(q,{children:[e.jsx(f,{value:"bar",children:"Bar Chart"}),e.jsx(f,{value:"line",children:"Line Chart"}),e.jsx(f,{value:"area",children:"Area Chart"}),e.jsx(f,{value:"pie",children:"Pie Chart"})]})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"From Date"}),e.jsxs(S,{open:r,onOpenChange:v,children:[e.jsx(b,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:D("w-full justify-start text-left font-normal",!(s!=null&&s.from)&&"text-muted-foreground"),children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),s!=null&&s.from?x(s.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(L,{className:"w-auto p-0",align:"start",children:e.jsx(T,{mode:"single",selected:s==null?void 0:s.from,onSelect:a=>{p(c=>({...c,from:a})),v(!1)},defaultMonth:s==null?void 0:s.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(h,{className:"text-xs text-muted-foreground",children:"To Date"}),e.jsxs(S,{open:P,onOpenChange:w,children:[e.jsx(b,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:D("w-full justify-start text-left font-normal",!(s!=null&&s.to)&&"text-muted-foreground"),children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),s!=null&&s.to?x(s.to,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(L,{className:"w-auto p-0",align:"start",children:e.jsx(T,{mode:"single",selected:s==null?void 0:s.to,onSelect:a=>{p(c=>({...c,to:a})),w(!1)},defaultMonth:s==null?void 0:s.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030,disabled:a=>a<((s==null?void 0:s.from)||new Date(0))})})]})]}),e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsx(h,{className:"text-xs text-muted-foreground opacity-0",children:"Apply"}),e.jsx(g,{onClick:R,className:"w-full",disabled:!(s!=null&&s.from)||!(s!=null&&s.to),children:"Apply Dates"})]})]})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(V,{className:"h-8 w-8 rounded-full"})}),children:e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 min-h-0 h-full",children:[e.jsx("div",{className:"lg:w-72 shrink-0 overflow-y-auto h-full pr-2",children:e.jsx(H,{onItemClick:A})}),e.jsx("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-y-auto",children:e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsx(J,{dimensions:t.dimensions,metrics:t.metrics,chartType:t.chartType,chartData:t.chartData,onRemoveDimension:E,onRemoveMetric:I})})})]})})})]})})})}export{te as default};
