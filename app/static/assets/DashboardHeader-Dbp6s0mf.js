import{h as fe,r as j,o as W,j as e,P as R,q as U,w as pe,s as xe,p as he,e as $,b as be,R as g,B as E,T as je,k as ve,l as ge,m as Ne,A as H}from"./index-DNQinrEY.js";import{g as G,C as K,b as X,i as J,c as ke}from"./locationUtils-CPrlR3dp.js";import{P as F,a as B,b as Y,f as Q}from"./popover-iV-3pSF1.js";import{u as Ce,C as we,a as V}from"./index-BeNVWpEg.js";var M="Checkbox",[ye,Ae]=fe(M),[Pe,q]=ye(M);function Ee(t){const{__scopeCheckbox:u,checked:m,children:N,defaultChecked:x,disabled:r,form:a,name:c,onCheckedChange:n,required:o,value:k="on",internal_do_not_use_render:h}=t,[i,C]=he({prop:m,defaultProp:x??!1,onChange:n,caller:M}),[b,w]=j.useState(null),[P,d]=j.useState(null),f=j.useRef(!1),S=b?!!a||!!b.closest("form"):!0,_={checked:i,disabled:r,setChecked:C,control:b,setControl:w,name:c,form:a,value:k,hasConsumerStoppedPropagationRef:f,required:o,defaultChecked:y(x)?!1:x,isFormControl:S,bubbleInput:P,setBubbleInput:d};return e.jsx(Pe,{scope:u,..._,children:Se(h)?h(_):N})}var Z="CheckboxTrigger",ee=j.forwardRef(({__scopeCheckbox:t,onKeyDown:u,onClick:m,...N},x)=>{const{control:r,value:a,disabled:c,checked:n,required:o,setControl:k,setChecked:h,hasConsumerStoppedPropagationRef:i,isFormControl:C,bubbleInput:b}=q(Z,t),w=W(x,k),P=j.useRef(n);return j.useEffect(()=>{const d=r==null?void 0:r.form;if(d){const f=()=>h(P.current);return d.addEventListener("reset",f),()=>d.removeEventListener("reset",f)}},[r,h]),e.jsx(R.button,{type:"button",role:"checkbox","aria-checked":y(n)?"mixed":n,"aria-required":o,"data-state":ne(n),"data-disabled":c?"":void 0,disabled:c,value:a,...N,ref:w,onKeyDown:U(u,d=>{d.key==="Enter"&&d.preventDefault()}),onClick:U(m,d=>{h(f=>y(f)?!0:!f),b&&C&&(i.current=d.isPropagationStopped(),i.current||d.stopPropagation())})})});ee.displayName=Z;var L=j.forwardRef((t,u)=>{const{__scopeCheckbox:m,name:N,checked:x,defaultChecked:r,required:a,disabled:c,value:n,onCheckedChange:o,form:k,...h}=t;return e.jsx(Ee,{__scopeCheckbox:m,checked:x,defaultChecked:r,disabled:c,required:a,onCheckedChange:o,name:N,form:k,value:n,internal_do_not_use_render:({isFormControl:i})=>e.jsxs(e.Fragment,{children:[e.jsx(ee,{...h,ref:u,__scopeCheckbox:m}),i&&e.jsx(ae,{__scopeCheckbox:m})]})})});L.displayName=M;var se="CheckboxIndicator",te=j.forwardRef((t,u)=>{const{__scopeCheckbox:m,forceMount:N,...x}=t,r=q(se,m);return e.jsx(pe,{present:N||y(r.checked)||r.checked===!0,children:e.jsx(R.span,{"data-state":ne(r.checked),"data-disabled":r.disabled?"":void 0,...x,ref:u,style:{pointerEvents:"none",...t.style}})})});te.displayName=se;var re="CheckboxBubbleInput",ae=j.forwardRef(({__scopeCheckbox:t,...u},m)=>{const{control:N,hasConsumerStoppedPropagationRef:x,checked:r,defaultChecked:a,required:c,disabled:n,name:o,value:k,form:h,bubbleInput:i,setBubbleInput:C}=q(re,t),b=W(m,C),w=Ce(r),P=xe(N);j.useEffect(()=>{const f=i;if(!f)return;const S=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(S,"checked").set,p=!x.current;if(w!==r&&A){const O=new Event("click",{bubbles:p});f.indeterminate=y(r),A.call(f,y(r)?!1:r),f.dispatchEvent(O)}},[i,w,r,x]);const d=j.useRef(y(r)?!1:r);return e.jsx(R.input,{type:"checkbox","aria-hidden":!0,defaultChecked:a??d.current,required:c,disabled:n,name:o,value:k,form:h,...u,tabIndex:-1,ref:b,style:{...u.style,...P,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ae.displayName=re;function Se(t){return typeof t=="function"}function y(t){return t==="indeterminate"}function ne(t){return y(t)?"indeterminate":t?"checked":"unchecked"}const T=j.forwardRef(({className:t,...u},m)=>e.jsx(L,{ref:m,className:$("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...u,children:e.jsx(te,{className:$("flex items-center justify-center text-current"),children:e.jsx(we,{className:"h-4 w-4"})})}));T.displayName=L.displayName;const Oe=({dateRange:t,onDateRangeChange:u,calendarOpen:m,onCalendarOpenChange:N,tempDateRange:x,onTempDateRangeChange:r,selectedLocations:a=[],onLocationsChange:c,selectedSites:n=[],onSitesChange:o})=>{const{role:k,locations:h}=be(),[i,C]=g.useState([]),[b,w]=g.useState([]),[P,d]=g.useState(!1),[f,S]=g.useState(!1);g.useEffect(()=>{(async()=>{try{const l=await fetch(`${H.SALES_SUMMARY.replace("sales-summary","locations")}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(l.ok){const D=await l.json();C(k==="admin"?D:D.filter(I=>h.includes(I)))}}catch(l){console.error("Failed to fetch locations:",l)}})()},[k,h]),g.useEffect(()=>{o&&(async()=>{try{const l=new URLSearchParams;a.length>0&&a.forEach(I=>l.append("locations",I));const D=await fetch(`${H.SITES}?${l}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(D.ok){const I=await D.json();w(I)}}catch(l){console.error("Failed to fetch sites:",l)}})()},[a,o]);const _=s=>{c&&(a.includes(s)?c(a.filter(l=>l!==s)):c([...a,s]))},A=s=>{o&&(n.includes(s)?o(n.filter(l=>l!==s)):o([...n,s]))},[p,O]=g.useState(t==null?void 0:t.from),[v,z]=g.useState(t==null?void 0:t.to),[oe,le]=g.useState(!1),[ce,ie]=g.useState(!1);g.useEffect(()=>{O(t==null?void 0:t.from),z(t==null?void 0:t.to)},[t]);const de=s=>{s&&(O(s),v&&J(s,v)&&z(void 0))},ue=s=>{s&&z(s)},me=()=>{p&&v&&u({from:p,to:v})};return e.jsx("div",{className:"sticky top-0 z-40 bg-background border-b border-border",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Overview of your analytics"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end justify-start sm:justify-end flex-1",children:[c&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Location"}),e.jsxs(F,{open:P,onOpenChange:d,children:[e.jsx(B,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:e.jsx("span",{className:"truncate",children:a.length===0?"All Locations":a.length===1?G(a[0]):`${a.length} locations`})}),e.jsx(V,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),e.jsx(Y,{className:"w-[200px] p-0",align:"start",children:e.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:s=>{s.stopPropagation(),a.length===i.length?c([]):c(i)},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{checked:i.length>0&&a.length===i.length,className:"pointer-events-none"}),e.jsx("span",{className:"text-sm font-medium",children:"All Locations"})]}),a.length>0&&e.jsx(E,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:s=>{s.stopPropagation(),c([])},children:"Clear"})]}),e.jsx("div",{className:"h-px bg-border my-1"}),e.jsx(je,{children:i.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:l=>{l.stopPropagation(),_(s)},children:[e.jsx(T,{checked:a.includes(s),className:"pointer-events-none"}),e.jsxs(ve,{children:[e.jsx(ge,{asChild:!0,children:e.jsx("span",{className:"text-sm truncate font-medium",children:G(s)})}),e.jsx(Ne,{side:"right",children:e.jsx("p",{children:s})})]})]},s))})]})})]})]}),o&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Site"}),e.jsxs(F,{open:f,onOpenChange:S,children:[e.jsx(B,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:e.jsx("span",{className:"truncate",children:n.length===0?"All Sites":`${n.length} sites`})}),e.jsx(V,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),e.jsx(Y,{className:"w-[200px] p-0",align:"start",children:e.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:s=>{s.stopPropagation(),n.length===b.length?o([]):o(b)},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{checked:b.length>0&&n.length===b.length,className:"pointer-events-none"}),e.jsx("span",{className:"text-sm font-medium",children:"All Sites"})]}),n.length>0&&e.jsx(E,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:s=>{s.stopPropagation(),o([])},children:"Clear"})]}),e.jsx("div",{className:"h-px bg-border my-1"}),b.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:l=>{l.stopPropagation(),A(s)},children:[e.jsx(T,{checked:n.includes(s),className:"pointer-events-none"}),e.jsx("span",{className:"text-sm truncate font-medium",children:s})]},s))]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"From Date"}),e.jsxs(F,{open:oe,onOpenChange:le,children:[e.jsx(B,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:$("w-[140px] justify-start text-left font-normal",!p&&"text-muted-foreground"),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),p?Q(p,"LLL dd, y"):"From"]})}),e.jsx(Y,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(X,{mode:"single",selected:p,onSelect:de,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:s=>v?J(s,v):!1,className:"rounded-md border"})})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Till Date"}),e.jsxs(F,{open:ce,onOpenChange:ie,children:[e.jsx(B,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:$("w-[140px] justify-start text-left font-normal",!v&&"text-muted-foreground"),disabled:!p,children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),v?Q(v,"LLL dd, y"):"To"]})}),e.jsx(Y,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(X,{mode:"single",selected:v,onSelect:ue,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:p?p.getFullYear():new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:s=>p?ke(s,p):!1,className:"rounded-md border"})})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 pb-0.5",children:[e.jsx("div",{className:"h-4"})," ",e.jsx(E,{onClick:me,disabled:!p||!v,className:"",children:"Apply"})]})]})]})})})};export{Oe as D};
