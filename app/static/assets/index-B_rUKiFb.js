const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-CfFXjD0K.js","assets/index-CBe1sITz.js","assets/index-A2fAa3dO.css","assets/card-3ZnNc8Bx.js","assets/users-CuwDk9Vb.js","assets/locationUtils-g-xZZTOa.js","assets/button-D1YWo77J.js","assets/DashboardLayout-Cgov8RRq.js","assets/ChartCanvas-CwsbGfna.js","assets/badge-CpO8mm8q.js","assets/AreaChart-By77bjUX.js","assets/BarChart-b0x9zfcx.js"])))=>i.map(i=>d[i]);
import{c as De,r as n,q as W,P,s as te,j as t,k as B,X as rt,T as at,l as nt,m as st,n as lt,d as ot,e as Me,i as it,f as ct,h as dt,a as ut,S as mt,_ as Te}from"./index-CBe1sITz.js";import{R as ft,P as ht,O as pt,a as xt,D as gt}from"./DashboardLayout-Cgov8RRq.js";import{L as je}from"./label-CGw-7R6x.js";import{C as vt,u as yt,S as bt,b as wt,c as St,d as jt,e as ie}from"./select-CJr_CTJx.js";import{B as de}from"./button-D1YWo77J.js";import{P as xe,b as ge,g as Ce,c as ve,j as Ct,C as Ne,f as ce,d as ke}from"./locationUtils-g-xZZTOa.js";import"./dialog-D6QQs6TK.js";import{C as Nt,a as kt,b as Et,d as It}from"./card-3ZnNc8Bx.js";import"./users-CuwDk9Vb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=De("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=De("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Dt=()=>{const[e,a]=n.useState(()=>{const o=localStorage.getItem("chartBuilderState"),i={dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0};if(o)try{const m=JSON.parse(o);return{...i,dimensions:m.dimensions||[],metrics:m.metrics||[],chartType:m.chartType||"bar"}}catch(m){console.error("Error parsing saved chart builder state",m)}return i});return n.useEffect(()=>{const{dimensions:o,metrics:i,chartType:m}=e;localStorage.setItem("chartBuilderState",JSON.stringify({dimensions:o,metrics:i,chartType:m}))},[e.dimensions,e.metrics,e.chartType]),{state:e,setDimensions:o=>{a(i=>({...i,dimensions:o}))},setMetrics:o=>{a(i=>({...i,metrics:o}))},setChartType:o=>{a(i=>({...i,chartType:o}))},setDateRange:o=>{a(i=>({...i,dateRange:o}))},addCustomMetric:o=>{a(i=>({...i,customMetrics:[...i.customMetrics,o]}))},setChartData:o=>{a(i=>({...i,chartData:o}))},setDraggedItem:o=>{a(i=>({...i,draggedItem:o}))}}};var Ee=1,Mt=.9,Tt=.8,Lt=.17,fe=.1,he=.999,Bt=.9999,Pt=.99,Ot=/[\\\/_+.#"@\[\(\{&]/,$t=/[\\\/_+.#"@\[\(\{&]/g,_t=/[\s-]/,Le=/[\s-]/g;function ye(e,a,r,f,d,u,l){if(u===a.length)return d===e.length?Ee:Pt;var x=`${d},${u}`;if(l[x]!==void 0)return l[x];for(var g=f.charAt(u),o=r.indexOf(g,d),i=0,m,S,y,k;o>=0;)m=ye(e,a,r,f,o+1,u+1,l),m>i&&(o===d?m*=Ee:Ot.test(e.charAt(o-1))?(m*=Tt,y=e.slice(d,o-1).match($t),y&&d>0&&(m*=Math.pow(he,y.length))):_t.test(e.charAt(o-1))?(m*=Mt,k=e.slice(d,o-1).match(Le),k&&d>0&&(m*=Math.pow(he,k.length))):(m*=Lt,d>0&&(m*=Math.pow(he,o-d))),e.charAt(o)!==a.charAt(u)&&(m*=Bt)),(m<fe&&r.charAt(o-1)===f.charAt(u+1)||f.charAt(u+1)===f.charAt(u)&&r.charAt(o-1)!==f.charAt(u))&&(S=ye(e,a,r,f,o+1,u+2,l),S*fe>m&&(m=S*fe)),m>i&&(i=m),o=r.indexOf(g,o+1);return l[x]=i,i}function Ie(e){return e.toLowerCase().replace(Le," ")}function zt(e,a,r){return e=r&&r.length>0?`${e+" "+r.join(" ")}`:e,ye(e,a,Ie(e),Ie(a),0,0,{})}var Z='[cmdk-group=""]',pe='[cmdk-group-items=""]',qt='[cmdk-group-heading=""]',Be='[cmdk-item=""]',Re=`${Be}:not([aria-disabled="true"])`,be="cmdk-item-select",Y="data-value",Ft=(e,a,r)=>zt(e,a,r),Pe=n.createContext(void 0),re=()=>n.useContext(Pe),Oe=n.createContext(void 0),Se=()=>n.useContext(Oe),$e=n.createContext(void 0),_e=n.forwardRef((e,a)=>{let r=G(()=>{var s,h;return{search:"",value:(h=(s=e.value)!=null?s:e.defaultValue)!=null?h:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),f=G(()=>new Set),d=G(()=>new Map),u=G(()=>new Map),l=G(()=>new Set),x=ze(e),{label:g,children:o,value:i,onValueChange:m,filter:S,shouldFilter:y,loop:k,disablePointerSelection:O=!1,vimBindings:E=!0,...T}=e,$=W(),_=W(),I=W(),z=n.useRef(null),N=Zt();H(()=>{if(i!==void 0){let s=i.trim();r.current.value=s,j.emit()}},[i]),H(()=>{N(6,ne)},[]);let j=n.useMemo(()=>({subscribe:s=>(l.current.add(s),()=>l.current.delete(s)),snapshot:()=>r.current,setState:(s,h,b)=>{var p,w,C,L;if(!Object.is(r.current[s],h)){if(r.current[s]=h,s==="search")K(),F(),N(1,X);else if(s==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let D=document.getElementById(I);D?D.focus():(p=document.getElementById($))==null||p.focus()}if(N(7,()=>{var D;r.current.selectedItemId=(D=V())==null?void 0:D.id,j.emit()}),b||N(5,ne),((w=x.current)==null?void 0:w.value)!==void 0){let D=h??"";(L=(C=x.current).onValueChange)==null||L.call(C,D);return}}j.emit()}},emit:()=>{l.current.forEach(s=>s())}}),[]),q=n.useMemo(()=>({value:(s,h,b)=>{var p;h!==((p=u.current.get(s))==null?void 0:p.value)&&(u.current.set(s,{value:h,keywords:b}),r.current.filtered.items.set(s,ae(h,b)),N(2,()=>{F(),j.emit()}))},item:(s,h)=>(f.current.add(s),h&&(d.current.has(h)?d.current.get(h).add(s):d.current.set(h,new Set([s]))),N(3,()=>{K(),F(),r.current.value||X(),j.emit()}),()=>{u.current.delete(s),f.current.delete(s),r.current.filtered.items.delete(s);let b=V();N(4,()=>{K(),(b==null?void 0:b.getAttribute("id"))===s&&X(),j.emit()})}),group:s=>(d.current.has(s)||d.current.set(s,new Set),()=>{u.current.delete(s),d.current.delete(s)}),filter:()=>x.current.shouldFilter,label:g||e["aria-label"],getDisablePointerSelection:()=>x.current.disablePointerSelection,listId:$,inputId:I,labelId:_,listInnerRef:z}),[]);function ae(s,h){var b,p;let w=(p=(b=x.current)==null?void 0:b.filter)!=null?p:Ft;return s?w(s,r.current.search,h):0}function F(){if(!r.current.search||x.current.shouldFilter===!1)return;let s=r.current.filtered.items,h=[];r.current.filtered.groups.forEach(p=>{let w=d.current.get(p),C=0;w.forEach(L=>{let D=s.get(L);C=Math.max(D,C)}),h.push([p,C])});let b=z.current;c().sort((p,w)=>{var C,L;let D=p.getAttribute("id"),oe=w.getAttribute("id");return((C=s.get(oe))!=null?C:0)-((L=s.get(D))!=null?L:0)}).forEach(p=>{let w=p.closest(pe);w?w.appendChild(p.parentElement===w?p:p.closest(`${pe} > *`)):b.appendChild(p.parentElement===b?p:p.closest(`${pe} > *`))}),h.sort((p,w)=>w[1]-p[1]).forEach(p=>{var w;let C=(w=z.current)==null?void 0:w.querySelector(`${Z}[${Y}="${encodeURIComponent(p[0])}"]`);C==null||C.parentElement.appendChild(C)})}function X(){let s=c().find(b=>b.getAttribute("aria-disabled")!=="true"),h=s==null?void 0:s.getAttribute(Y);j.setState("value",h||void 0)}function K(){var s,h,b,p;if(!r.current.search||x.current.shouldFilter===!1){r.current.filtered.count=f.current.size;return}r.current.filtered.groups=new Set;let w=0;for(let C of f.current){let L=(h=(s=u.current.get(C))==null?void 0:s.value)!=null?h:"",D=(p=(b=u.current.get(C))==null?void 0:b.keywords)!=null?p:[],oe=ae(L,D);r.current.filtered.items.set(C,oe),oe>0&&w++}for(let[C,L]of d.current)for(let D of L)if(r.current.filtered.items.get(D)>0){r.current.filtered.groups.add(C);break}r.current.filtered.count=w}function ne(){var s,h,b;let p=V();p&&(((s=p.parentElement)==null?void 0:s.firstChild)===p&&((b=(h=p.closest(Z))==null?void 0:h.querySelector(qt))==null||b.scrollIntoView({block:"nearest"})),p.scrollIntoView({block:"nearest"}))}function V(){var s;return(s=z.current)==null?void 0:s.querySelector(`${Be}[aria-selected="true"]`)}function c(){var s;return Array.from(((s=z.current)==null?void 0:s.querySelectorAll(Re))||[])}function v(s){let h=c()[s];h&&j.setState("value",h.getAttribute(Y))}function R(s){var h;let b=V(),p=c(),w=p.findIndex(L=>L===b),C=p[w+s];(h=x.current)!=null&&h.loop&&(C=w+s<0?p[p.length-1]:w+s===p.length?p[0]:p[w+s]),C&&j.setState("value",C.getAttribute(Y))}function se(s){let h=V(),b=h==null?void 0:h.closest(Z),p;for(;b&&!p;)b=s>0?Xt(b,Z):Qt(b,Z),p=b==null?void 0:b.querySelector(Re);p?j.setState("value",p.getAttribute(Y)):R(s)}let le=()=>v(c().length-1),Q=s=>{s.preventDefault(),s.metaKey?le():s.altKey?se(1):R(1)},A=s=>{s.preventDefault(),s.metaKey?v(0):s.altKey?se(-1):R(-1)};return n.createElement(P.div,{ref:a,tabIndex:-1,...T,"cmdk-root":"",onKeyDown:s=>{var h;(h=T.onKeyDown)==null||h.call(T,s);let b=s.nativeEvent.isComposing||s.keyCode===229;if(!(s.defaultPrevented||b))switch(s.key){case"n":case"j":{E&&s.ctrlKey&&Q(s);break}case"ArrowDown":{Q(s);break}case"p":case"k":{E&&s.ctrlKey&&A(s);break}case"ArrowUp":{A(s);break}case"Home":{s.preventDefault(),v(0);break}case"End":{s.preventDefault(),le();break}case"Enter":{s.preventDefault();let p=V();if(p){let w=new Event(be);p.dispatchEvent(w)}}}}},n.createElement("label",{"cmdk-label":"",htmlFor:q.inputId,id:q.labelId,style:tr},g),ue(e,s=>n.createElement(Oe.Provider,{value:j},n.createElement(Pe.Provider,{value:q},s))))}),Vt=n.forwardRef((e,a)=>{var r,f;let d=W(),u=n.useRef(null),l=n.useContext($e),x=re(),g=ze(e),o=(f=(r=g.current)==null?void 0:r.forceMount)!=null?f:l==null?void 0:l.forceMount;H(()=>{if(!o)return x.item(d,l==null?void 0:l.id)},[o]);let i=qe(d,u,[e.value,e.children,u],e.keywords),m=Se(),S=U(N=>N.value&&N.value===i.current),y=U(N=>o||x.filter()===!1?!0:N.search?N.filtered.items.get(d)>0:!0);n.useEffect(()=>{let N=u.current;if(!(!N||e.disabled))return N.addEventListener(be,k),()=>N.removeEventListener(be,k)},[y,e.onSelect,e.disabled]);function k(){var N,j;O(),(j=(N=g.current).onSelect)==null||j.call(N,i.current)}function O(){m.setState("value",i.current,!0)}if(!y)return null;let{disabled:E,value:T,onSelect:$,forceMount:_,keywords:I,...z}=e;return n.createElement(P.div,{ref:te(u,a),...z,id:d,"cmdk-item":"",role:"option","aria-disabled":!!E,"aria-selected":!!S,"data-disabled":!!E,"data-selected":!!S,onPointerMove:E||x.getDisablePointerSelection()?void 0:O,onClick:E?void 0:k},e.children)}),Ut=n.forwardRef((e,a)=>{let{heading:r,children:f,forceMount:d,...u}=e,l=W(),x=n.useRef(null),g=n.useRef(null),o=W(),i=re(),m=U(y=>d||i.filter()===!1?!0:y.search?y.filtered.groups.has(l):!0);H(()=>i.group(l),[]),qe(l,x,[e.value,e.heading,g]);let S=n.useMemo(()=>({id:l,forceMount:d}),[d]);return n.createElement(P.div,{ref:te(x,a),...u,"cmdk-group":"",role:"presentation",hidden:m?void 0:!0},r&&n.createElement("div",{ref:g,"cmdk-group-heading":"","aria-hidden":!0,id:o},r),ue(e,y=>n.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?o:void 0},n.createElement($e.Provider,{value:S},y))))}),Kt=n.forwardRef((e,a)=>{let{alwaysRender:r,...f}=e,d=n.useRef(null),u=U(l=>!l.search);return!r&&!u?null:n.createElement(P.div,{ref:te(d,a),...f,"cmdk-separator":"",role:"separator"})}),Ht=n.forwardRef((e,a)=>{let{onValueChange:r,...f}=e,d=e.value!=null,u=Se(),l=U(o=>o.search),x=U(o=>o.selectedItemId),g=re();return n.useEffect(()=>{e.value!=null&&u.setState("search",e.value)},[e.value]),n.createElement(P.input,{ref:a,...f,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":g.listId,"aria-labelledby":g.labelId,"aria-activedescendant":x,id:g.inputId,type:"text",value:d?e.value:l,onChange:o=>{d||u.setState("search",o.target.value),r==null||r(o.target.value)}})}),Jt=n.forwardRef((e,a)=>{let{children:r,label:f="Suggestions",...d}=e,u=n.useRef(null),l=n.useRef(null),x=U(o=>o.selectedItemId),g=re();return n.useEffect(()=>{if(l.current&&u.current){let o=l.current,i=u.current,m,S=new ResizeObserver(()=>{m=requestAnimationFrame(()=>{let y=o.offsetHeight;i.style.setProperty("--cmdk-list-height",y.toFixed(1)+"px")})});return S.observe(o),()=>{cancelAnimationFrame(m),S.unobserve(o)}}},[]),n.createElement(P.div,{ref:te(u,a),...d,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":x,"aria-label":f,id:g.listId},ue(e,o=>n.createElement("div",{ref:te(l,g.listInnerRef),"cmdk-list-sizer":""},o)))}),Yt=n.forwardRef((e,a)=>{let{open:r,onOpenChange:f,overlayClassName:d,contentClassName:u,container:l,...x}=e;return n.createElement(ft,{open:r,onOpenChange:f},n.createElement(ht,{container:l},n.createElement(pt,{"cmdk-overlay":"",className:d}),n.createElement(xt,{"aria-label":e.label,"cmdk-dialog":"",className:u},n.createElement(_e,{ref:a,...x}))))}),Gt=n.forwardRef((e,a)=>U(r=>r.filtered.count===0)?n.createElement(P.div,{ref:a,...e,"cmdk-empty":"",role:"presentation"}):null),Wt=n.forwardRef((e,a)=>{let{progress:r,children:f,label:d="Loading...",...u}=e;return n.createElement(P.div,{ref:a,...u,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":d},ue(e,l=>n.createElement("div",{"aria-hidden":!0},l)))}),M=Object.assign(_e,{List:Jt,Item:Vt,Input:Ht,Group:Ut,Separator:Kt,Dialog:Yt,Empty:Gt,Loading:Wt});function Xt(e,a){let r=e.nextElementSibling;for(;r;){if(r.matches(a))return r;r=r.nextElementSibling}}function Qt(e,a){let r=e.previousElementSibling;for(;r;){if(r.matches(a))return r;r=r.previousElementSibling}}function ze(e){let a=n.useRef(e);return H(()=>{a.current=e}),a}var H=typeof window>"u"?n.useEffect:n.useLayoutEffect;function G(e){let a=n.useRef();return a.current===void 0&&(a.current=e()),a}function U(e){let a=Se(),r=()=>e(a.snapshot());return n.useSyncExternalStore(a.subscribe,r,r)}function qe(e,a,r,f=[]){let d=n.useRef(),u=re();return H(()=>{var l;let x=(()=>{var o;for(let i of r){if(typeof i=="string")return i.trim();if(typeof i=="object"&&"current"in i)return i.current?(o=i.current.textContent)==null?void 0:o.trim():d.current}})(),g=f.map(o=>o.trim());u.value(e,x,g),(l=a.current)==null||l.setAttribute(Y,x),d.current=x}),d}var Zt=()=>{let[e,a]=n.useState(),r=G(()=>new Map);return H(()=>{r.current.forEach(f=>f()),r.current=new Map},[e]),(f,d)=>{r.current.set(f,d),a({})}};function er(e){let a=e.type;return typeof a=="function"?a(e.props):"render"in a?a.render(e.props):e}function ue({asChild:e,children:a},r){return e&&n.isValidElement(a)?n.cloneElement(er(a),{ref:a.ref},r(a.props.children)):r(a)}var tr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Fe=n.forwardRef(({className:e,...a},r)=>t.jsx(M,{ref:r,className:B("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...a}));Fe.displayName=M.displayName;const Ve=n.forwardRef(({className:e,...a},r)=>t.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[t.jsx(At,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),t.jsx(M.Input,{ref:r,className:B("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...a})]}));Ve.displayName=M.Input.displayName;const rr=n.forwardRef(({className:e,...a},r)=>t.jsx(M.List,{ref:r,className:B("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...a}));rr.displayName=M.List.displayName;const Ue=n.forwardRef((e,a)=>t.jsx(M.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));Ue.displayName=M.Empty.displayName;const Ke=n.forwardRef(({className:e,...a},r)=>t.jsx(M.Group,{ref:r,className:B("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...a}));Ke.displayName=M.Group.displayName;const ar=n.forwardRef(({className:e,...a},r)=>t.jsx(M.Separator,{ref:r,className:B("-mx-1 h-px bg-border",e),...a}));ar.displayName=M.Separator.displayName;const He=n.forwardRef(({className:e,...a},r)=>t.jsx(M.Item,{ref:r,className:B("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...a}));He.displayName=M.Item.displayName;var nr="Separator",Ae="horizontal",sr=["horizontal","vertical"],Je=n.forwardRef((e,a)=>{const{decorative:r,orientation:f=Ae,...d}=e,u=lr(f)?f:Ae,x=r?{role:"none"}:{"aria-orientation":u==="vertical"?u:void 0,role:"separator"};return t.jsx(P.div,{"data-orientation":u,...x,...d,ref:a})});Je.displayName=nr;function lr(e){return sr.includes(e)}var Ye=Je;const Ge=n.forwardRef(({className:e,orientation:a="horizontal",decorative:r=!0,...f},d)=>t.jsx(Ye,{ref:d,decorative:r,orientation:a,className:B("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...f}));Ge.displayName=Ye.displayName;function J({title:e,options:a,selected:r,onChange:f,placeholder:d="Select...",isLocation:u=!1}){const[l,x]=n.useState(!1),g=i=>{r.includes(i)?f(r.filter(m=>m!==i)):f([...r,i])},o=i=>{i.stopPropagation(),f([])};return t.jsxs("div",{className:"flex flex-col gap-1.5 min-w-[180px]",children:[t.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:e}),t.jsxs(xe,{open:l,onOpenChange:x,children:[t.jsx(ge,{asChild:!0,children:t.jsxs(de,{variant:"outline",role:"combobox","aria-expanded":l,className:"w-full justify-between h-9 px-3 text-sm",children:[t.jsxs("div",{className:"flex flex-wrap gap-1 items-center overflow-hidden",children:[r.length===0&&t.jsx("span",{className:"text-muted-foreground font-normal truncate",children:d}),r.length===1&&t.jsx("span",{className:"truncate",children:u?Ce(r[0]):r[0]}),r.length>1&&t.jsxs("span",{className:"truncate",children:[r.length," selected"]})]}),t.jsxs("div",{className:"flex items-center gap-2 shrink-0 opacity-50 ml-2",children:[r.length>0&&t.jsx(rt,{className:"h-3 w-3 cursor-pointer hover:opacity-100",onClick:o}),t.jsx(Rt,{className:"h-3 w-3"})]})]})}),t.jsx(ve,{className:"w-[200px] p-0",align:"start",children:t.jsxs(Fe,{children:[t.jsx(Ve,{placeholder:`Search ${e.toLowerCase()}...`}),t.jsxs(Ue,{children:["No ",e.toLowerCase()," found."]}),t.jsx(Ke,{className:"max-h-64 overflow-auto",children:a.map(i=>t.jsxs(He,{value:i,onSelect:()=>g(i),children:[t.jsx(vt,{className:B("mr-2 h-4 w-4",r.includes(i)?"opacity-100":"opacity-0")}),u?t.jsx(at,{delayDuration:300,children:t.jsxs(nt,{children:[t.jsx(st,{asChild:!0,children:t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"font-medium",children:Ce(i)}),t.jsx("span",{className:"text-[10px] text-muted-foreground truncate opacity-70",children:i})]})}),t.jsx(lt,{side:"right",children:t.jsx("p",{children:i})})]})}):i]},i))})]})})]})]})}function or({availableFilters:e,filters:a,onFilterChange:r,orientation:f="vertical",hideSites:d=!1}){n.useMemo(()=>{if(a.locations.length===0)return e.clients;const o=e.locations.filter(m=>a.locations.includes(m.name)),i=new Set;return o.forEach(m=>{m.clients&&m.clients.forEach(S=>i.add(S))}),Array.from(i).sort()},[e,a.locations]);const u=n.useMemo(()=>{if(a.locations.length===0)return Array.from(new Set(e.locations.flatMap(m=>m.sites))).sort();const o=e.locations.filter(m=>a.locations.includes(m.name)),i=new Set;return o.forEach(m=>{m.sites.forEach(S=>i.add(S))}),Array.from(i).sort()},[e.locations,a.locations]),l=o=>{const i=e.locations.filter(y=>o.includes(y.name)),m=o.length===0?e.clients:Array.from(new Set(i.flatMap(y=>y.clients||[]))),S=o.length===0?Array.from(new Set(e.locations.flatMap(y=>y.sites))):Array.from(new Set(i.flatMap(y=>y.sites)));r({...a,locations:o,clients:a.clients.filter(y=>m.includes(y)),sites:a.sites.filter(y=>S.includes(y))})},x=o=>{r({...a,clients:o})},g=o=>{r({...a,sites:o})};return f==="horizontal"?t.jsxs("div",{className:"flex flex-wrap items-end gap-4 p-1",children:[t.jsx("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mr-2 pb-2",children:t.jsx("span",{children:"ðŸŒªï¸ Filters:"})}),t.jsx(J,{title:"Clients",options:e.clients,selected:a.clients,onChange:x,placeholder:"All Clients"}),t.jsx(J,{title:"Locations",options:e.locations.map(o=>o.name),selected:a.locations,onChange:l,placeholder:"All Locations",isLocation:!0}),!d&&t.jsx(J,{title:"Sites",options:u,selected:a.sites,onChange:g,placeholder:"All Sites"})]}):t.jsxs(Nt,{className:"h-full flex flex-col",children:[t.jsx(kt,{className:"pb-3",children:t.jsx(Et,{className:"text-lg flex items-center gap-2",children:"ðŸŒªï¸ Filters"})}),t.jsxs(It,{className:"space-y-4 flex-1 overflow-y-auto",children:[t.jsx(J,{title:"Clients",options:e.clients,selected:a.clients,onChange:x,placeholder:"All Clients"}),t.jsx(Ge,{}),t.jsx(J,{title:"Locations",options:e.locations.map(o=>o.name),selected:a.locations,onChange:l,placeholder:"All Locations",isLocation:!0}),t.jsx(J,{title:"Sites",options:u,selected:a.sites,onChange:g,placeholder:"All Sites"})]})]})}var me="Switch",[ir,jr]=ot(me),[cr,dr]=ir(me),We=n.forwardRef((e,a)=>{const{__scopeSwitch:r,name:f,checked:d,defaultChecked:u,required:l,disabled:x,value:g="on",onCheckedChange:o,form:i,...m}=e,[S,y]=n.useState(null),k=Me(a,_=>y(_)),O=n.useRef(!1),E=S?i||!!S.closest("form"):!0,[T,$]=it({prop:d,defaultProp:u??!1,onChange:o,caller:me});return t.jsxs(cr,{scope:r,checked:T,disabled:x,children:[t.jsx(P.button,{type:"button",role:"switch","aria-checked":T,"aria-required":l,"data-state":et(T),"data-disabled":x?"":void 0,disabled:x,value:g,...m,ref:k,onClick:ct(e.onClick,_=>{$(I=>!I),E&&(O.current=_.isPropagationStopped(),O.current||_.stopPropagation())})}),E&&t.jsx(Ze,{control:S,bubbles:!O.current,name:f,value:g,checked:T,required:l,disabled:x,form:i,style:{transform:"translateX(-100%)"}})]})});We.displayName=me;var Xe="SwitchThumb",Qe=n.forwardRef((e,a)=>{const{__scopeSwitch:r,...f}=e,d=dr(Xe,r);return t.jsx(P.span,{"data-state":et(d.checked),"data-disabled":d.disabled?"":void 0,...f,ref:a})});Qe.displayName=Xe;var ur="SwitchBubbleInput",Ze=n.forwardRef(({__scopeSwitch:e,control:a,checked:r,bubbles:f=!0,...d},u)=>{const l=n.useRef(null),x=Me(l,u),g=yt(r),o=dt(a);return n.useEffect(()=>{const i=l.current;if(!i)return;const m=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(m,"checked").set;if(g!==r&&y){const k=new Event("click",{bubbles:f});y.call(i,r),i.dispatchEvent(k)}},[g,r,f]),t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...d,tabIndex:-1,ref:x,style:{...d.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ze.displayName=ur;function et(e){return e?"checked":"unchecked"}var tt=We,mr=Qe;const we=n.forwardRef(({className:e,...a},r)=>t.jsx(tt,{className:B("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...a,ref:r,children:t.jsx(mr,{className:B("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));we.displayName=tt.displayName;const fr=n.lazy(()=>Te(()=>import("./MetricPalette-CfFXjD0K.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),ee=n.lazy(()=>Te(()=>import("./ChartCanvas-CwsbGfna.js"),__vite__mapDeps([8,1,2,9,10,11])));function Cr(){const{state:e,setDimensions:a,setMetrics:r,setChartType:f,setDateRange:d}=Dt(),{toast:u}=ut(),[l,x]=n.useState(()=>{const c=localStorage.getItem("chartBuilderDate");if(c)try{const v=JSON.parse(c);return{from:v.from?new Date(v.from):void 0,to:v.to?new Date(v.to):void 0}}catch(v){console.error(v)}return{from:new Date,to:Ct(new Date,30)}}),[g,o]=n.useState(()=>{const c=localStorage.getItem("chartBuilderAppliedDate");if(c)try{const v=JSON.parse(c);return{from:v.from?new Date(v.from):void 0,to:v.to?new Date(v.to):void 0}}catch(v){console.error(v)}return l});n.useEffect(()=>{l&&localStorage.setItem("chartBuilderDate",JSON.stringify(l))},[l]),n.useEffect(()=>{g&&localStorage.setItem("chartBuilderAppliedDate",JSON.stringify(g))},[g]);const[i,m]=n.useState(!1),[S,y]=n.useState(!1),[k,O]=n.useState(()=>localStorage.getItem("chartBuilderSplitByLocation")==="true"),[E,T]=n.useState(()=>localStorage.getItem("chartBuilderSplitBySite")==="true"&&!k);n.useEffect(()=>{localStorage.setItem("chartBuilderSplitByLocation",String(k))},[k]),n.useEffect(()=>{localStorage.setItem("chartBuilderSplitBySite",String(E))},[E]);const[$,_]=n.useState({clients:[],locations:[]}),[I,z]=n.useState({clients:[],locations:[],sites:[]});n.useEffect(()=>{(async()=>{try{const v=await fetch("/api/filters",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(v.ok){const R=await v.json();_(R)}}catch(v){console.error("Error fetching filters:",v)}})()},[]);const N=()=>{o(l)},[j,q]=n.useState([]),[ae,F]=n.useState([]);n.useEffect(()=>{(async()=>{var Q;if(e.dimensions.length===0||e.metrics.length===0||!(g!=null&&g.from)||!(g!=null&&g.to)){q([]),F([]);return}const v=e.dimensions[0],R=e.metrics,se=ce(g.from,"yyyy-MM-dd"),le=ce(g.to,"yyyy-MM-dd");try{const A=new URLSearchParams;A.append("start",se),A.append("end",le),A.append("dimension",v),R.forEach(h=>A.append("metrics",h)),I.clients.forEach(h=>A.append("clients",h)),I.locations.forEach(h=>A.append("locations",h)),I.sites.forEach(h=>A.append("sites",h)),k&&A.append("split_by_location","true"),E&&A.append("split_by_site","true");const s=await fetch(`/api/chart-data?${A.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(s.ok){const h=await s.json();q(h.data||[]),F(((Q=h.summary)==null?void 0:Q.topClients)||[])}else console.error("Failed to fetch chart data"),q([]),F([])}catch(A){console.error("Error fetching chart data:",A),q([]),F([])}})()},[e.dimensions,e.metrics,g,I,k,E]);const{showSiteFilter:X,showSiteSplit:K}=n.useMemo(()=>{const c=I.locations.length===0?$.locations.flatMap(R=>R.sites):$.locations.filter(R=>I.locations.includes(R.name)).flatMap(R=>R.sites),v=Array.from(new Set(c));return{showSiteFilter:v.length>1,showSiteSplit:v.length>1}},[$.locations,I.locations]);n.useEffect(()=>{!K&&E&&T(!1)},[K,E]);const ne=c=>{c.type==="dimension"?e.dimensions.includes(c.name)||(a([c.name]),u({description:`Added ${c.name} to chart`,duration:2e3})):c.type==="metric"&&(e.metrics.includes(c.name)||(r([...e.metrics,c.name]),u({description:`Added ${c.name} to chart`,duration:2e3})))},V=c=>{c.type==="dimension"?e.dimensions.includes(c.name)&&(a(e.dimensions.filter(v=>v!==c.name)),u({description:`Removed ${c.name} from chart`,duration:2e3})):c.type==="metric"&&e.metrics.includes(c.name)&&(r(e.metrics.filter(v=>v!==c.name)),u({description:`Removed ${c.name} from chart`,duration:2e3}))};return t.jsx(gt,{noPadding:!0,fullWidth:!0,children:t.jsx("div",{className:"p-2 md:p-3 h-full flex flex-col",children:t.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[t.jsx("div",{className:"sticky lg:top-0 z-30 pb-2 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-1 shadow-sm bg-background",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[t.jsx("div",{children:t.jsx("h1",{className:"text-xl font-bold",children:"Chart Builder"})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("div",{className:"w-32",children:t.jsxs(bt,{value:e.chartType,onValueChange:f,children:[t.jsx(wt,{className:"h-8 text-xs",children:t.jsx(St,{placeholder:"Chart Type"})}),t.jsxs(jt,{children:[t.jsx(ie,{value:"bar",children:"Bar Chart"}),t.jsx(ie,{value:"line",children:"Line Chart"}),t.jsx(ie,{value:"area",children:"Area Chart"}),t.jsx(ie,{value:"pie",children:"Pie Chart"})]})]})}),t.jsxs("div",{className:"flex items-center gap-6 px-2 border-l ml-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(we,{id:"split-location",checked:k,onCheckedChange:c=>{O(c),c&&T(!1)}}),t.jsx(je,{htmlFor:"split-location",className:"text-xs font-medium cursor-pointer flex items-center gap-1.5",children:"Split by Location"})]}),K&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(we,{id:"split-site",checked:E,onCheckedChange:c=>{T(c),c&&O(!1)}}),t.jsx(je,{htmlFor:"split-site",className:"text-xs font-medium cursor-pointer flex items-center gap-1.5",children:"Split by Site"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(xe,{open:i,onOpenChange:m,children:[t.jsx(ge,{asChild:!0,children:t.jsxs(de,{variant:"outline",className:B("w-32 justify-start text-left font-normal h-8 text-xs",!(l!=null&&l.from)&&"text-muted-foreground"),children:[t.jsx(Ne,{className:"mr-2 h-3 w-3"}),l!=null&&l.from?ce(l.from,"MMM dd, y"):t.jsx("span",{children:"From"})]})}),t.jsx(ve,{className:"w-auto p-0",align:"start",children:t.jsx(ke,{mode:"single",selected:l==null?void 0:l.from,onSelect:c=>{x(v=>({...v,from:c})),m(!1)},defaultMonth:l==null?void 0:l.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),t.jsx("span",{className:"text-muted-foreground text-xs",children:"-"}),t.jsxs(xe,{open:S,onOpenChange:y,children:[t.jsx(ge,{asChild:!0,children:t.jsxs(de,{variant:"outline",className:B("w-32 justify-start text-left font-normal h-8 text-xs",!(l!=null&&l.to)&&"text-muted-foreground"),children:[t.jsx(Ne,{className:"mr-2 h-3 w-3"}),l!=null&&l.to?ce(l.to,"MMM dd, y"):t.jsx("span",{children:"To"})]})}),t.jsx(ve,{className:"w-auto p-0",align:"start",children:t.jsx(ke,{mode:"single",selected:l==null?void 0:l.to,onSelect:c=>{x(v=>({...v,to:c})),y(!1)},defaultMonth:l==null?void 0:l.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030,disabled:c=>c<((l==null?void 0:l.from)||new Date(0))})})]}),t.jsx(de,{onClick:N,size:"sm",className:"h-8 text-xs",disabled:!(l!=null&&l.from)||!(l!=null&&l.to),children:"Apply"})]})]})]})}),t.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:t.jsx(n.Suspense,{fallback:t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx(mt,{className:"h-8 w-8 rounded-full"})}),children:t.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-2 min-h-0 h-full",children:[t.jsx("div",{className:"lg:w-72 shrink-0 h-full flex flex-col overflow-hidden",children:t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2",children:t.jsx(fr,{selectedDimensions:e.dimensions,selectedMetrics:e.metrics,onItemClick:ne,onItemDoubleClick:V})})}),t.jsxs("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:[t.jsx("div",{className:"shrink-0 pb-2 border-b mb-2",children:t.jsx(or,{availableFilters:$,filters:I,onFilterChange:z,orientation:"horizontal",hideSites:!X})}),t.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2 custom-scrollbar",children:[!k&&!E&&t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 h-full min-h-[500px]",children:t.jsx(ee,{chartData:j,chartType:e.chartType,metrics:e.metrics,title:"Aggregated View",topClients:ae})}),k&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[I.locations.length>0?I.locations.map(c=>{const v=j.filter(R=>R.location===c);return v.length===0?null:t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(ee,{chartData:v,chartType:e.chartType,metrics:e.metrics,title:c,isCompact:!0})},c)}):Array.from(new Set(j.map(c=>c.location).filter(Boolean))).map(c=>t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(ee,{chartData:j.filter(v=>v.location===c),chartType:e.chartType,metrics:e.metrics,title:c,isCompact:!0})},c)),j.length===0&&t.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground bg-muted/20 rounded-xl border border-dashed",children:"No data available for selected locations"})]}),E&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[I.sites.length>0?I.sites.map(c=>{const v=j.filter(R=>R.site===c);return v.length===0?null:t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(ee,{chartData:v,chartType:e.chartType,metrics:e.metrics,title:c,isCompact:!0})},c)}):Array.from(new Set(j.map(c=>c.site).filter(Boolean))).map(c=>t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(ee,{chartData:j.filter(v=>v.site===c),chartType:e.chartType,metrics:e.metrics,title:c,isCompact:!0})},c)),j.length===0&&t.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground bg-muted/20 rounded-xl border border-dashed",children:"No data available for selected sites"})]})]})]})]})})})]})})})}export{Cr as default};
