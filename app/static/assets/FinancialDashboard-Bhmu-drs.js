import{r as l,a as R,A as T,j as e,d as k,u as A,b as M}from"./index-BCxjYy-L.js";import{D as P,L as E}from"./DashboardLayout-DW3aFuu-.js";import{f as v,s as F}from"./locationUtils-C7G14Asw.js";import{u as O,c as $,D as z,R as K}from"./RankingList-wH8hXofk.js";import{C as o,a as f,b as j,d}from"./card-DwD9tNN9.js";import{R as I,C as U,X as B,Y as W,T as Y,L as _,A as y}from"./generateCategoricalChart-DRixoTgO.js";import{A as G}from"./AreaChart-EeBv7ZYw.js";import{B as N}from"./button-CooRjy1X.js";import{T as H}from"./users-tZXB2N9_.js";import{P as V}from"./pound-sterling-BXIQyj86.js";import"./select-DVBTyhAc.js";import"./progress-Bnha8m7n.js";const X=(s,t,a)=>{const[r,x]=l.useState(null),[p,m]=l.useState(!1),{toast:c}=R(),h=async()=>{m(!0);try{const i=new URLSearchParams({start:v(s.from,"yyyy-MM-dd"),end:v(s.to,"yyyy-MM-dd")});t&&t.length>0&&t.forEach(n=>i.append("locations",n)),a&&a.length>0&&a.forEach(n=>i.append("sites",n));const u=await fetch(`${T.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(u.ok){const n=await u.json();x(n)}else c({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch{c({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{m(!1)}};return l.useEffect(()=>{h()},[s,t,a]),{financialData:r,isLoading:p,refetch:h}};function g({title:s,value:t,change:a,trend:r="neutral"}){return e.jsxs(o,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(f,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:s})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t}),a&&e.jsx("p",{className:k("text-xs mt-1",r==="up"&&"text-accent",r==="down"&&"text-destructive",r==="neutral"&&"text-muted-foreground"),children:a})]})]})}const q=({metrics:s})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 w-full",children:[e.jsx(g,{title:"Total Revenue",value:`£${s.revenue.value.toLocaleString()}`,change:s.revenue.text,trend:s.revenue.trend}),e.jsx(g,{title:"Average Client Pay",value:`£${s.clientPay.value.toFixed(2)}`,change:s.clientPay.text,trend:s.clientPay.trend}),e.jsx(g,{title:"Average Staff Pay",value:`£${s.staffPay.value.toFixed(2)}`,change:s.staffPay.text,trend:s.staffPay.trend})]}),D=({salesData:s})=>{var t;return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(o,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalShifts)||0})]})})})}),e.jsx(o,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalClients)||0})]})})})}),e.jsx(o,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.uniqueEmployees)||0})]})})})}),e.jsx(o,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((t=s==null?void 0:s.profitMargin)==null?void 0:t.toFixed(1))||0,"%"]})]})})})})]})},J=({active:s,payload:t,label:a})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:a}),t.map((r,x)=>e.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": £",Number(r.value).toLocaleString()]},x))]}):null,Q=({data:s,aggregationLevel:t})=>{const a={dataKey:"display",interval:0};return!s||s.length===0?e.jsxs(o,{children:[e.jsx(f,{children:e.jsx(j,{children:"Revenue vs Cost Trend"})}),e.jsx(d,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(o,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t==="daily"&&"Daily view",t==="weekly"&&"Weekly view",t==="monthly"&&"Monthly view"]})]}),e.jsx(d,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(G,{data:s,children:[e.jsx(U,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:a.dataKey,tick:{fontSize:12},interval:a.interval}),e.jsx(W,{}),e.jsx(Y,{content:e.jsx(J,{})}),e.jsx(_,{}),e.jsx(y,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(y,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]})})})})]})},Z=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})}),me=()=>{const s=A();M();const[t,a]=l.useState({from:F(new Date),to:new Date}),[r,x]=l.useState(!1),[p,m]=l.useState(t),[c,h]=l.useState([]),[i,u]=l.useState([]),{financialData:n,isLoading:b}=X(t,c,i),{topClientsRevenue:C,isLoadingClientsRev:w}=O(t,c,i),S=$(n,t);return e.jsx(P,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(z,{dateRange:t,onDateRangeChange:a,calendarOpen:r,onCalendarOpenChange:x,tempDateRange:p,onTempDateRangeChange:m,selectedLocations:c,onLocationsChange:h,selectedSites:i,onSitesChange:u}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(N,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(H,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(N,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>s("/dashboard/operational"),children:[e.jsx(E,{className:"h-4 w-4"}),"Operational View"]})]})}),b&&e.jsx(Z,{}),e.jsx(q,{metrics:S}),e.jsx(D,{salesData:n}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(o,{className:"col-span-4",children:[e.jsx(f,{children:e.jsx(j,{children:"Revenue Overview"})}),e.jsx(d,{className:"pl-2",children:e.jsx(Q,{data:(n==null?void 0:n.timeSeries)||[],aggregationLevel:(n==null?void 0:n.aggregationLevel)||"monthly"})})]}),e.jsx("div",{className:"col-span-3 flex flex-col gap-4 h-full",children:e.jsx(K,{title:"Top Clients (Revenue)",data:C,isLoading:w,valueFormatter:L=>`£${L.toLocaleString()}`,icon:e.jsx(V,{className:"h-4 w-4"}),className:"h-full",barColor:"bg-green-500"})})]})]})})]})})};export{me as FinancialDashboard,me as default};
