import{g as me,r as N,h as ne,j as e,P as Q,i as D,k as pe,l as he,m as xe,d as O,b as ve,R as E,B as $,T as ge,n as je,o as be,p as Ne,A as B,a as ye,S as Ce}from"./index-Dk6ud5U0.js";import{g as ee,C as te,a as se,i as re,b as ke}from"./locationUtils-Cxm3dRnk.js";import{P as G,a as K,b as X,f as V}from"./popover-Dcp1pZq5.js";import{u as Pe,C as we,a as ae}from"./index-Bz_318Hj.js";import{C as Se,a as Ee,b as Te,d as Ie}from"./card-Cq2D-SSs.js";import{P as Ae}from"./progress-BBo9Mxxt.js";import{E as _e}from"./ellipsis-CHUar6O8.js";const Ue=(t,l)=>{var S,g,b,i,x,w,k,A,P,F,M,q,z,Y,U;if(!t)return{revenue:{value:0,change:0,trend:"neutral",text:"No data available"},clientPay:{value:0,change:0,trend:"neutral",text:"No data available"},staffPay:{value:0,change:0,trend:"neutral",text:"No data available"},totalShifts:{value:0,change:0,trend:"neutral",text:"No data available"},paidHours:{value:0,change:0,trend:"neutral",text:"No data available"},uniqueEmployees:{value:0,change:0,trend:"neutral",text:"No data available"},avgShiftDuration:{value:0,change:0,trend:"neutral",text:"No data available"},totalClients:{value:0,change:0,trend:"neutral",text:"No data available"}};const f=t.totalRevenue||0,C=t.avgClientPayPerHour||0,h=t.avgStaffPayPerHour||0,o=((S=t.previousPeriod)==null?void 0:S.totalRevenue)||0,n=((g=t.previousPeriod)==null?void 0:g.avgClientPayPerHour)||0,d=((b=t.previousPeriod)==null?void 0:b.avgStaffPayPerHour)||0,r=(T,_)=>_>0?(T-_)/_*100:0,a=r(f,o),u=r(C,n),j=r(h,d),c=T=>T>0?"up":T<0?"down":"neutral",y=(T,_,s)=>{if(!_)return"No previous data";let p="";return s<=7?p="last week":s<=31?p="last month":s<=93?p="last quarter":p="last period",`${T>0?"+":""}${Math.abs(T).toFixed(1)}% from ${p}`},m=Math.ceil((l.to.getTime()-l.from.getTime())/(1e3*60*60*24)),v=!!t.previousPeriod;return{revenue:{value:f,change:a,trend:c(a),text:y(a,v,m)},clientPay:{value:C,change:u,trend:c(u),text:y(u,v,m)},staffPay:{value:h,change:j,trend:c(j),text:y(j,v,m)},totalShifts:{value:t.totalShifts,change:r(t.totalShifts,((i=t.previousPeriod)==null?void 0:i.totalShifts)||0),trend:c(r(t.totalShifts,((x=t.previousPeriod)==null?void 0:x.totalShifts)||0)),text:y(r(t.totalShifts,((w=t.previousPeriod)==null?void 0:w.totalShifts)||0),v,m)},paidHours:{value:t.totalPaidHours||0,change:r(t.totalPaidHours||0,((k=t.previousPeriod)==null?void 0:k.totalPaidHours)||0)||0,trend:c(r(t.totalPaidHours||0,((A=t.previousPeriod)==null?void 0:A.totalPaidHours)||0)),text:y(r(t.totalPaidHours||0,((P=t.previousPeriod)==null?void 0:P.totalPaidHours)||0),v,m)},uniqueEmployees:{value:t.uniqueEmployees,change:r(t.uniqueEmployees,((F=t.previousPeriod)==null?void 0:F.uniqueEmployees)||0),trend:c(r(t.uniqueEmployees,((M=t.previousPeriod)==null?void 0:M.uniqueEmployees)||0)),text:y(r(t.uniqueEmployees,((q=t.previousPeriod)==null?void 0:q.uniqueEmployees)||0),v,m)},avgShiftDuration:{value:t.totalPaidHours&&t.totalShifts?t.totalPaidHours/t.totalShifts:0,change:0,trend:"neutral",text:"Average hours per shift"},totalClients:{value:t.totalClients,change:r(t.totalClients,((z=t.previousPeriod)==null?void 0:z.totalClients)||0),trend:c(r(t.totalClients,((Y=t.previousPeriod)==null?void 0:Y.totalClients)||0)),text:y(r(t.totalClients,((U=t.previousPeriod)==null?void 0:U.totalClients)||0),v,m)}}};var J="Checkbox",[$e,Ge]=me(J),[Fe,W]=$e(J);function He(t){const{__scopeCheckbox:l,checked:f,children:C,defaultChecked:h,disabled:o,form:n,name:d,onCheckedChange:r,required:a,value:u="on",internal_do_not_use_render:j}=t,[c,y]=xe({prop:f,defaultProp:h??!1,onChange:r,caller:J}),[m,v]=N.useState(null),[S,g]=N.useState(null),b=N.useRef(!1),i=m?!!n||!!m.closest("form"):!0,x={checked:c,disabled:o,setChecked:y,control:m,setControl:v,name:d,form:n,value:u,hasConsumerStoppedPropagationRef:b,required:a,defaultChecked:I(h)?!1:h,isFormControl:i,bubbleInput:S,setBubbleInput:g};return e.jsx(Fe,{scope:l,...x,children:Oe(j)?j(x):C})}var oe="CheckboxTrigger",ie=N.forwardRef(({__scopeCheckbox:t,onKeyDown:l,onClick:f,...C},h)=>{const{control:o,value:n,disabled:d,checked:r,required:a,setControl:u,setChecked:j,hasConsumerStoppedPropagationRef:c,isFormControl:y,bubbleInput:m}=W(oe,t),v=ne(h,u),S=N.useRef(r);return N.useEffect(()=>{const g=o==null?void 0:o.form;if(g){const b=()=>j(S.current);return g.addEventListener("reset",b),()=>g.removeEventListener("reset",b)}},[o,j]),e.jsx(Q.button,{type:"button",role:"checkbox","aria-checked":I(r)?"mixed":r,"aria-required":a,"data-state":fe(r),"data-disabled":d?"":void 0,disabled:d,value:n,...C,ref:v,onKeyDown:D(l,g=>{g.key==="Enter"&&g.preventDefault()}),onClick:D(f,g=>{j(b=>I(b)?!0:!b),m&&y&&(c.current=g.isPropagationStopped(),c.current||g.stopPropagation())})})});ie.displayName=oe;var Z=N.forwardRef((t,l)=>{const{__scopeCheckbox:f,name:C,checked:h,defaultChecked:o,required:n,disabled:d,value:r,onCheckedChange:a,form:u,...j}=t;return e.jsx(He,{__scopeCheckbox:f,checked:h,defaultChecked:o,disabled:d,required:n,onCheckedChange:a,name:C,form:u,value:r,internal_do_not_use_render:({isFormControl:c})=>e.jsxs(e.Fragment,{children:[e.jsx(ie,{...j,ref:l,__scopeCheckbox:f}),c&&e.jsx(ue,{__scopeCheckbox:f})]})})});Z.displayName=J;var le="CheckboxIndicator",ce=N.forwardRef((t,l)=>{const{__scopeCheckbox:f,forceMount:C,...h}=t,o=W(le,f);return e.jsx(pe,{present:C||I(o.checked)||o.checked===!0,children:e.jsx(Q.span,{"data-state":fe(o.checked),"data-disabled":o.disabled?"":void 0,...h,ref:l,style:{pointerEvents:"none",...t.style}})})});ce.displayName=le;var de="CheckboxBubbleInput",ue=N.forwardRef(({__scopeCheckbox:t,...l},f)=>{const{control:C,hasConsumerStoppedPropagationRef:h,checked:o,defaultChecked:n,required:d,disabled:r,name:a,value:u,form:j,bubbleInput:c,setBubbleInput:y}=W(de,t),m=ne(f,y),v=Pe(o),S=he(C);N.useEffect(()=>{const b=c;if(!b)return;const i=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(i,"checked").set,k=!h.current;if(v!==o&&w){const A=new Event("click",{bubbles:k});b.indeterminate=I(o),w.call(b,I(o)?!1:o),b.dispatchEvent(A)}},[c,v,o,h]);const g=N.useRef(I(o)?!1:o);return e.jsx(Q.input,{type:"checkbox","aria-hidden":!0,defaultChecked:n??g.current,required:d,disabled:r,name:a,value:u,form:j,...l,tabIndex:-1,ref:m,style:{...l.style,...S,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ue.displayName=de;function Oe(t){return typeof t=="function"}function I(t){return t==="indeterminate"}function fe(t){return I(t)?"indeterminate":t?"checked":"unchecked"}const L=N.forwardRef(({className:t,...l},f)=>e.jsx(Z,{ref:f,className:O("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...l,children:e.jsx(ce,{className:O("flex items-center justify-center text-current"),children:e.jsx(we,{className:"h-4 w-4"})})}));L.displayName=Z.displayName;const Ke=({dateRange:t,onDateRangeChange:l,calendarOpen:f,onCalendarOpenChange:C,tempDateRange:h,onTempDateRangeChange:o,selectedLocations:n=[],onLocationsChange:d,selectedSites:r=[],onSitesChange:a})=>{const{role:u,locations:j}=ve(),[c,y]=E.useState([]),[m,v]=E.useState([]),[S,g]=E.useState(!1),[b,i]=E.useState(!1);E.useEffect(()=>{(async()=>{try{const p=await fetch(`${B.SALES_SUMMARY.replace("sales-summary","locations")}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(p.ok){const H=await p.json();y(u==="admin"?H:H.filter(R=>j.includes(R)))}}catch(p){console.error("Failed to fetch locations:",p)}})()},[u,j]),E.useEffect(()=>{a&&(async()=>{try{const p=new URLSearchParams;n.length>0&&n.forEach(R=>p.append("locations",R));const H=await fetch(`${B.SITES}?${p}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(H.ok){const R=await H.json();v(R)}}catch(p){console.error("Failed to fetch sites:",p)}})()},[n,a]);const x=s=>{d&&(n.includes(s)?d(n.filter(p=>p!==s)):d([...n,s]))},w=s=>{a&&(r.includes(s)?a(r.filter(p=>p!==s)):a([...r,s]))},[k,A]=E.useState(t==null?void 0:t.from),[P,F]=E.useState(t==null?void 0:t.to),[M,q]=E.useState(!1),[z,Y]=E.useState(!1);E.useEffect(()=>{A(t==null?void 0:t.from),F(t==null?void 0:t.to)},[t]);const U=s=>{s&&(A(s),P&&re(s,P)&&F(void 0))},T=s=>{s&&F(s)},_=()=>{k&&P&&l({from:k,to:P})};return e.jsx("div",{className:"sticky top-0 z-40 bg-background border-b border-border",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Overview of your analytics"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end justify-start sm:justify-end flex-1",children:[d&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Location"}),e.jsxs(G,{open:S,onOpenChange:g,children:[e.jsx(K,{asChild:!0,children:e.jsxs($,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:e.jsx("span",{className:"truncate",children:n.length===0?"All Locations":n.length===1?ee(n[0]):`${n.length} locations`})}),e.jsx(ae,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),e.jsx(X,{className:"w-[200px] p-0",align:"start",children:e.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:s=>{s.stopPropagation(),n.length===c.length?d([]):d(c)},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:c.length>0&&n.length===c.length,className:"pointer-events-none"}),e.jsx("span",{className:"text-sm font-medium",children:"All Locations"})]}),n.length>0&&e.jsx($,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:s=>{s.stopPropagation(),d([])},children:"Clear"})]}),e.jsx("div",{className:"h-px bg-border my-1"}),e.jsx(ge,{children:c.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:p=>{p.stopPropagation(),x(s)},children:[e.jsx(L,{checked:n.includes(s),className:"pointer-events-none"}),e.jsxs(je,{children:[e.jsx(be,{asChild:!0,children:e.jsx("span",{className:"text-sm truncate font-medium",children:ee(s)})}),e.jsx(Ne,{side:"right",children:e.jsx("p",{children:s})})]})]},s))})]})})]})]}),a&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Site"}),e.jsxs(G,{open:b,onOpenChange:i,children:[e.jsx(K,{asChild:!0,children:e.jsxs($,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:e.jsx("span",{className:"truncate",children:r.length===0?"All Sites":`${r.length} sites`})}),e.jsx(ae,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),e.jsx(X,{className:"w-[200px] p-0",align:"start",children:e.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:s=>{s.stopPropagation(),r.length===m.length?a([]):a(m)},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:m.length>0&&r.length===m.length,className:"pointer-events-none"}),e.jsx("span",{className:"text-sm font-medium",children:"All Sites"})]}),r.length>0&&e.jsx($,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:s=>{s.stopPropagation(),a([])},children:"Clear"})]}),e.jsx("div",{className:"h-px bg-border my-1"}),m.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:p=>{p.stopPropagation(),w(s)},children:[e.jsx(L,{checked:r.includes(s),className:"pointer-events-none"}),e.jsx("span",{className:"text-sm truncate font-medium",children:s})]},s))]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"From Date"}),e.jsxs(G,{open:M,onOpenChange:q,children:[e.jsx(K,{asChild:!0,children:e.jsxs($,{variant:"outline",className:O("w-[140px] justify-start text-left font-normal",!k&&"text-muted-foreground"),children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),k?V(k,"LLL dd, y"):"From"]})}),e.jsx(X,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(se,{mode:"single",selected:k,onSelect:U,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:s=>P?re(s,P):!1,className:"rounded-md border"})})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Till Date"}),e.jsxs(G,{open:z,onOpenChange:Y,children:[e.jsx(K,{asChild:!0,children:e.jsxs($,{variant:"outline",className:O("w-[140px] justify-start text-left font-normal",!P&&"text-muted-foreground"),disabled:!k,children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),P?V(P,"LLL dd, y"):"To"]})}),e.jsx(X,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(se,{mode:"single",selected:P,onSelect:T,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:k?k.getFullYear():new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:s=>k?ke(s,k):!1,className:"rounded-md border"})})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 pb-0.5",children:[e.jsx("div",{className:"h-4"})," ",e.jsx($,{onClick:_,disabled:!k||!P,className:"",children:"Apply"})]})]})]})})})},Xe=(t,l,f)=>{const[C,h]=N.useState([]),[o,n]=N.useState([]),[d,r]=N.useState([]),[a,u]=N.useState(!1),[j,c]=N.useState(!1),[y,m]=N.useState(!1);ye();const v=()=>{const i=new URLSearchParams({start:V(t.from,"yyyy-MM-dd"),end:V(t.to,"yyyy-MM-dd")});return l&&l.length>0&&l.forEach(x=>i.append("locations",x)),f&&f.length>0&&f.forEach(x=>i.append("sites",x)),i},S=async()=>{u(!0);try{const i=v();i.append("limit","100");const x=await fetch(`${B.RANKINGS_STAFF}?${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(x.ok){const w=await x.json();h(w)}}catch(i){console.error(i)}finally{u(!1)}},g=async()=>{c(!0);try{const i=v();i.append("limit","100"),i.append("metric","revenue");const x=await fetch(`${B.RANKINGS_CLIENTS}?${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(x.ok){const w=await x.json();n(w)}}catch(i){console.error(i)}finally{c(!1)}},b=async()=>{m(!0);try{const i=v();i.append("limit","100"),i.append("metric","shifts");const x=await fetch(`${B.RANKINGS_CLIENTS}?${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(x.ok){const w=await x.json();r(w)}}catch(i){console.error(i)}finally{m(!1)}};return N.useEffect(()=>{S(),g(),b()},[t,l,f]),{topStaff:C,isLoadingStaff:a,topClientsRevenue:o,isLoadingClientsRev:j,topClientsShifts:d,isLoadingClientsShifts:y}},Ve=({title:t,data:l,isLoading:f=!1,valueFormatter:C=d=>d.toLocaleString(),icon:h,className:o,barColor:n="bg-primary"})=>{const d=Math.max(...l.map(a=>a.value),0),r=a=>a.toLowerCase().split(" ").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(" ");return e.jsxs(Se,{className:O("flex flex-col h-full shadow-sm hover:shadow-md transition-shadow min-w-0",o),children:[e.jsxs(Ee,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[h&&e.jsx("div",{className:"p-1.5 bg-muted rounded-md",children:h}),e.jsx(Te,{className:"text-sm font-medium",children:t})]}),e.jsx(_e,{className:"h-4 w-4 text-muted-foreground cursor-pointer hover:text-foreground"})]}),e.jsx(Ie,{className:"pt-4 flex-1 min-w-0",children:f?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((a,u)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"h-4 w-1/3 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-2 w-full bg-muted animate-pulse rounded"})]},u))}):l.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground p-4",children:"No data available"}):e.jsx(Ce,{className:"h-[240px]",children:e.jsx("div",{className:"space-y-6 pr-4",children:l.map((a,u)=>e.jsxs("div",{className:"flex flex-col gap-2 group min-w-0",children:[e.jsx("div",{className:"flex items-center justify-between text-sm gap-2",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:"flex h-5 w-5 flex-shrink-0 items-center justify-center rounded-full bg-muted text-[10px] font-medium text-muted-foreground group-hover:bg-primary group-hover:text-primary-foreground transition-colors",children:u+1}),e.jsx("span",{className:"font-medium",title:a.name,children:r(a.name)})]})}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(Ae,{value:d>0?a.value/d*100:0,className:O("h-1.5 w-full",n&&`[&>*]:${n}`)}),e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:"text-xs font-semibold text-muted-foreground whitespace-nowrap",children:C(a.value)})})]})]},u))})})})]})};export{Ke as D,Ve as R,Ue as c,Xe as u};
