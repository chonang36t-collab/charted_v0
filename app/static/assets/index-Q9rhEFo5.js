import{j as e,e as k,B as j,r as C,I as R}from"./index-C_3AfGDz.js";import{D as V,T as G}from"./DashboardLayout-Bo66Dkpi.js";import{T as P}from"./trash-2-Cb4s6jxD.js";import{D as O,a as T,b as H,c as L,d as F,e as I}from"./dialog-C5QBlLPY.js";import{P as Y}from"./plus-XdRRMdkp.js";import"./users-CuEpcHz2.js";function z(r,n){return r===null||r===0?"":n.isPercentage?`${r.toFixed(2)}%`:n.isCurrency?`Â£${r.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}`:r.toLocaleString("en-GB",{maximumFractionDigits:2})}function W({rowId:r,colId:n,value:a,row:s,isActive:u,onFocus:l,onUpdate:i,onNavigate:d}){const[y,o]=C.useState(!1),[p,h]=C.useState(""),w=C.useRef(null),v=C.useCallback(()=>{o(!0),h(a!==null?String(a):""),setTimeout(()=>{var t;return(t=w.current)==null?void 0:t.focus()},0)},[a]),f=C.useCallback(()=>{o(!1);const t=parseFloat(p);i(p===""?null:isNaN(t)?a:t)},[p,i,a]),m=t=>{y?t.key==="Enter"||t.key==="Tab"?(t.preventDefault(),f(),d(t.shiftKey?"up":"down")):t.key==="Escape"&&o(!1):t.key==="Enter"||t.key==="F2"?(t.preventDefault(),v()):t.key==="ArrowUp"?(t.preventDefault(),d("up")):t.key==="ArrowDown"?(t.preventDefault(),d("down")):t.key==="ArrowLeft"?(t.preventDefault(),d("left")):t.key==="ArrowRight"?(t.preventDefault(),d("right")):t.key==="Delete"||t.key==="Backspace"?(t.preventDefault(),i(null)):/^[0-9.\-]$/.test(t.key)&&(t.preventDefault(),h(t.key),o(!0),setTimeout(()=>{var x;return(x=w.current)==null?void 0:x.focus()},0))};return e.jsx("td",{className:k("border border-border px-2 py-1 text-right text-sm min-w-[110px] cursor-cell transition-colors",u&&"ring-2 ring-primary ring-inset bg-primary/5",!u&&"hover:bg-muted/50"),onClick:l,onDoubleClick:v,onKeyDown:m,tabIndex:0,onFocus:l,children:y?e.jsx("input",{ref:w,type:"text",value:p,onChange:t=>h(t.target.value),onBlur:f,className:"w-full bg-transparent text-right outline-none text-sm font-mono"}):e.jsx("span",{className:"font-mono text-sm",children:z(a,s)})})}function J({value:r,row:n}){return e.jsx("td",{className:k("border border-border px-2 py-1 text-right text-sm min-w-[110px]",n.isHeader?"bg-primary/10 font-semibold":"bg-muted/30"),children:e.jsx("span",{className:"font-mono text-sm",children:z(r,n)})})}function K({rows:r,columns:n,data:a,activeCell:s,setActiveCell:u,updateCell:l,deleteRow:i,deleteColumn:d,navigateCell:y}){return e.jsx("div",{className:"overflow-auto border border-border rounded-lg bg-card",children:e.jsxs("table",{className:"border-collapse w-max min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-20 bg-card border border-border px-4 py-3 text-left text-xs font-semibold text-muted-foreground uppercase tracking-wider min-w-[280px]",children:"Description"}),n.map(o=>e.jsx("th",{className:k("sticky top-0 z-10 border border-border px-2 py-3 text-center text-xs font-semibold uppercase tracking-wider min-w-[110px]",o.isYearEnd?"bg-primary/10 text-primary":"bg-muted/50 text-muted-foreground"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("span",{children:o.label}),!o.isProtected&&e.jsx(j,{variant:"ghost",size:"icon",className:"h-4 w-4 opacity-0 group-hover:opacity-100 hover:text-destructive",onClick:()=>d(o.id),children:e.jsx(P,{className:"h-3 w-3"})})]})},o.id)),e.jsx("th",{className:"sticky top-0 z-10 bg-card border border-border w-10"})]})}),e.jsx("tbody",{children:r.map(o=>e.jsxs("tr",{className:k("group",o.isHeader&&"bg-primary/5"),children:[e.jsx("td",{className:k("sticky left-0 z-10 border border-border px-4 py-2 text-sm whitespace-nowrap bg-card",o.isHeader&&"font-bold text-primary bg-primary/5",o.isAutoCalculated&&!o.isHeader&&"text-muted-foreground italic"),children:o.label}),n.map(p=>{var v;const h=(v=a[o.id])==null?void 0:v[p.id];return(h==null?void 0:h.isEditable)&&!o.isAutoCalculated&&!p.isYearEnd?e.jsx(W,{rowId:o.id,colId:p.id,value:(h==null?void 0:h.value)??null,row:o,isActive:(s==null?void 0:s.row)===o.id&&(s==null?void 0:s.col)===p.id,onFocus:()=>u({row:o.id,col:p.id}),onUpdate:f=>l(o.id,p.id,f),onNavigate:y},p.id):e.jsx(J,{value:(h==null?void 0:h.value)??null,row:o},p.id)}),e.jsx("td",{className:"border border-border bg-card w-10",children:!o.isAutoCalculated&&o.id.startsWith("custom_")&&e.jsx(j,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 hover:text-destructive",onClick:()=>i(o.id),children:e.jsx(P,{className:"h-3 w-3"})})})]},o.id))})]})})}const D=[{id:"jan",label:"January",isProtected:!0},{id:"feb",label:"February",isProtected:!0},{id:"mar",label:"March",isProtected:!0},{id:"apr",label:"April",isProtected:!0},{id:"may",label:"May",isProtected:!0},{id:"jun",label:"June",isProtected:!0},{id:"jul",label:"July",isProtected:!0},{id:"aug",label:"August",isProtected:!0},{id:"sep",label:"September",isProtected:!0},{id:"oct",label:"October",isProtected:!0},{id:"nov",label:"November",isProtected:!0},{id:"dec",label:"December",isProtected:!0},{id:"year_end",label:"Year End",isProtected:!0,isYearEnd:!0}],N=(r,n,a)=>n.reduce((s,u)=>{var i,d;const l=((d=(i=r[u])==null?void 0:i[a])==null?void 0:d.value)??0;return s+l},0),B=["cost_sales_se","cost_sales_paye","employee_ni","employee_pension"],M=["apprenticeship_levy","annual_leave","other_expenses","recruitment_cost","overheads_mgmt","bank_interest","cooperation_tax"],S=[{id:"total_sales",label:"Total Sales",isAutoCalculated:!1,isCurrency:!0},{id:"sales_split_pct",label:"% Sales Split for the Year",isAutoCalculated:!1,isPercentage:!0},{id:"cost_sales_se",label:"Cost of Sales SE",isAutoCalculated:!1,isCurrency:!0},{id:"cost_sales_paye",label:"Cost of Sales PAYE Gross",isAutoCalculated:!1,isCurrency:!0},{id:"employee_ni",label:"Employee NI",isAutoCalculated:!1,isCurrency:!0},{id:"employee_pension",label:"Employee Pension",isAutoCalculated:!1,isCurrency:!0},{id:"total_cost_sales",label:"Total Cost of Sales",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formula:(r,n,a)=>N(r,B,a)},{id:"apprenticeship_levy",label:"Apprenticeship Levy",isAutoCalculated:!1,isCurrency:!0},{id:"annual_leave",label:"Annual Leave Accrual",isAutoCalculated:!1,isCurrency:!0},{id:"other_expenses",label:"Other Expenses",isAutoCalculated:!1,isCurrency:!0},{id:"recruitment_cost",label:"Recruitment and Pass Cost",isAutoCalculated:!1,isCurrency:!0},{id:"overheads_mgmt",label:"Overheads (Total Mgmt & Office Cost)",isAutoCalculated:!1,isCurrency:!0},{id:"bank_interest",label:"Bank Interest",isAutoCalculated:!1,isCurrency:!0},{id:"cooperation_tax",label:"Cooperation Tax",isAutoCalculated:!1,isCurrency:!0},{id:"total_overheads",label:"Total Overheads",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formula:(r,n,a)=>N(r,M,a)},{id:"total_cost",label:"Total Cost",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formula:(r,n,a)=>{const s=N(r,B,a),u=N(r,M,a);return s+u}},{id:"avg_hourly_charge",label:"Average Hourly Charge Rate",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_pay",label:"Gross Hourly Pay",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_margin",label:"Gross Hourly Margin",isAutoCalculated:!0,isCurrency:!0,formula:(r,n,a)=>{var l,i,d,y;const s=((i=(l=r.avg_hourly_charge)==null?void 0:l[a])==null?void 0:i.value)??0,u=((y=(d=r.gross_hourly_pay)==null?void 0:d[a])==null?void 0:y.value)??0;return s-u}},{id:"net_cost_per_hour",label:"Net Cost per Hour",isAutoCalculated:!1,isCurrency:!0},{id:"gross_pl_value",label:"Gross P&L Value",isAutoCalculated:!1,isCurrency:!0},{id:"net_pl",label:"Net P&L",isAutoCalculated:!1,isCurrency:!0},{id:"total_net_margin",label:"Total Net Margin",isAutoCalculated:!1,isPercentage:!0},{id:"worked_hours",label:"Worked Hours",isAutoCalculated:!1},{id:"hours_breakeven",label:"Hours for Breakeven",isAutoCalculated:!0,formula:(r,n,a)=>{var l,i,d,y;const s=((i=(l=r.total_cost)==null?void 0:l[a])==null?void 0:i.value)??0,u=((y=(d=r.gross_hourly_margin)==null?void 0:d[a])==null?void 0:y.value)??0;return u!==0?s/u:0}},{id:"value_breakeven",label:"Total Value for Breakeven",isAutoCalculated:!0,isCurrency:!0,formula:(r,n,a)=>{var l,i,d,y;const s=((i=(l=r.hours_breakeven)==null?void 0:l[a])==null?void 0:i.value)??0,u=((y=(d=r.avg_hourly_charge)==null?void 0:d[a])==null?void 0:y.value)??0;return s*u}},{id:"sales_budget_2026",label:"2026 Sales Budget 30% Uplift",isAutoCalculated:!0,isCurrency:!0,formula:(r,n,a)=>{var u,l;return(((l=(u=r.total_sales)==null?void 0:u[a])==null?void 0:l.value)??0)*1.3}},{id:"avg_hourly_charge_2026",label:"Average Hourly Charge Rate 2026",isAutoCalculated:!1,isCurrency:!0},{id:"sales_target_hours",label:"Sales Target in Hours",isAutoCalculated:!1},{id:"variance_2025",label:"Variance Against 2025",isAutoCalculated:!1,isCurrency:!0}];function $(r,n){const a={};for(const s of r){a[s.id]={};for(const u of n)a[s.id][u.id]={value:null,isEditable:!s.isAutoCalculated&&!u.isYearEnd}}return a}function A(r,n,a){const s=JSON.parse(JSON.stringify(r));for(const l of a.filter(i=>!i.isYearEnd))for(const i of n)i.formula&&(s[i.id][l.id]={...s[i.id][l.id],value:i.formula(s,i.id,l.id),isEditable:!1});const u=a.find(l=>l.isYearEnd);if(u)for(const l of n){const i=a.filter(d=>!d.isYearEnd).reduce((d,y)=>{var o,p;return d+(((p=(o=s[l.id])==null?void 0:o[y.id])==null?void 0:p.value)??0)},0);s[l.id][u.id]={value:i,isEditable:!1}}return s}function U(){const[r,n]=C.useState(S),[a,s]=C.useState(D),[u,l]=C.useState(()=>A($(S,D),S,D)),[i,d]=C.useState(null),y=C.useCallback((f,m,t)=>{l(x=>{const b={...x};return b[f]={...b[f]},b[f][m]={...b[f][m],value:t},A(b,r,a)})},[r,a]),o=C.useCallback(f=>{const m=`custom_${Date.now()}`,t={id:m,label:f,isAutoCalculated:!1,isCurrency:!0};n(x=>{const b=[...x,t];return l(g=>{const _={...g};_[m]={};for(const c of a)_[m][c.id]={value:null,isEditable:!c.isYearEnd};return A(_,b,a)}),b})},[a]),p=C.useCallback(f=>{n(m=>m.filter(t=>t.id!==f)),l(m=>{const t={...m};return delete t[f],t})},[]),h=C.useCallback(f=>{const m=`col_${Date.now()}`,t={id:m,label:f};s(x=>{const b=x.findIndex(_=>_.isYearEnd),g=[...x];return g.splice(b,0,t),l(_=>{const c={..._};for(const E of r)c[E.id]={...c[E.id]},c[E.id][m]={value:null,isEditable:!E.isAutoCalculated};return A(c,r,g)}),g})},[r]),w=C.useCallback(f=>{s(m=>{const t=m.filter(x=>x.id!==f);return l(x=>{const b={...x};for(const g of Object.keys(b)){const{[f]:_,...c}=b[g];b[g]=c}return A(b,r,t)}),t})},[r]),v=C.useCallback(f=>{if(!i)return;const m=r.filter(c=>!c.isAutoCalculated),t=a.filter(c=>!c.isYearEnd),x=m.findIndex(c=>c.id===i.row),b=t.findIndex(c=>c.id===i.col);if(x===-1||b===-1)return;let g=x,_=b;switch(f){case"up":g=Math.max(0,x-1);break;case"down":g=Math.min(m.length-1,x+1);break;case"left":_=Math.max(0,b-1);break;case"right":_=Math.min(t.length-1,b+1);break}d({row:m[g].id,col:t[_].id})},[i,r,a]);return{rows:r,columns:a,data:u,activeCell:i,setActiveCell:d,updateCell:y,addRow:o,deleteRow:p,addColumn:h,deleteColumn:w,navigateCell:v}}function re(){const{rows:r,columns:n,data:a,activeCell:s,setActiveCell:u,updateCell:l,addRow:i,deleteRow:d,addColumn:y,deleteColumn:o,navigateCell:p}=U(),[h,w]=C.useState(""),[v,f]=C.useState(""),[m,t]=C.useState(!1),[x,b]=C.useState(!1),g=()=>{h.trim()&&(i(h.trim()),w(""),t(!1))},_=()=>{v.trim()&&(y(v.trim()),f(""),b(!1))};return e.jsx(V,{noPadding:!0,fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-card/50 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(G,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Financial Summary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Annual budget and performance spreadsheet"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(O,{open:m,onOpenChange:t,children:[e.jsx(T,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"})," Add Row"]})}),e.jsxs(H,{children:[e.jsx(L,{children:e.jsx(F,{children:"Add New Row"})}),e.jsx(R,{placeholder:"Row label...",value:h,onChange:c=>w(c.target.value),onKeyDown:c=>c.key==="Enter"&&g()}),e.jsx(I,{children:e.jsx(j,{onClick:g,disabled:!h.trim(),children:"Add"})})]})]}),e.jsxs(O,{open:x,onOpenChange:b,children:[e.jsx(T,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"})," Add Column"]})}),e.jsxs(H,{children:[e.jsx(L,{children:e.jsx(F,{children:"Add New Column"})}),e.jsx(R,{placeholder:"Column label...",value:v,onChange:c=>f(c.target.value),onKeyDown:c=>c.key==="Enter"&&_()}),e.jsx(I,{children:e.jsx(j,{onClick:_,disabled:!v.trim(),children:"Add"})})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx(K,{rows:r,columns:n,data:a,activeCell:s,setActiveCell:u,updateCell:l,deleteRow:d,deleteColumn:o,navigateCell:p})})]})})}export{re as default};
