import{r as t,a as g,A as x,u as y,j as e}from"./index-BK59HRyT.js";import{D as v,L as j}from"./DashboardLayout-Di5k8AMF.js";import{f as h}from"./popover-B2tg9WvK.js";import{c as D,D as L,L as S,M as w,A as N,R as C}from"./LoadingOverlay-DfYBKhi2.js";import{B as p}from"./button-CtGU3ee1.js";import{T as M}from"./users-Bt4kmzRf.js";import"./select-8x8xp6aR.js";import"./card-BYJIr3cH.js";import"./AreaChart-DBQwwSos.js";const R=(n,s)=>{const[d,m]=t.useState(null),[u,c]=t.useState(!1),{toast:l}=g(),r=async()=>{c(!0);try{const o=new URLSearchParams({start:h(n.from,"yyyy-MM-dd"),end:h(n.to,"yyyy-MM-dd")});s&&s.length>0&&s.forEach(i=>o.append("locations",i));const a=await fetch(`${x.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(a.ok){const i=await a.json();m(i)}else l({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch{l({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{c(!1)}};return t.useEffect(()=>{r()},[n,s]),{financialData:d,isLoading:u,refetch:r}};function B(){const n=y(),[s,d]=t.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[m,u]=t.useState(!1),[c,l]=t.useState(s),[r,o]=t.useState([]),{financialData:a,isLoading:i}=R(s,r),f=D(a,s);return e.jsx(v,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(L,{dateRange:s,onDateRangeChange:d,calendarOpen:m,onCalendarOpenChange:u,tempDateRange:c,onTempDateRangeChange:l,selectedLocations:r,onLocationsChange:o}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(p,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(M,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(p,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>n("/dashboard/operational"),children:[e.jsx(j,{className:"h-4 w-4"}),"Operational View"]})]})}),i&&e.jsx(S,{}),e.jsx(w,{metrics:f}),e.jsx(N,{salesData:a}),e.jsx(C,{data:(a==null?void 0:a.timeSeries)||[],aggregationLevel:(a==null?void 0:a.aggregationLevel)||"monthly"})]})})]})})}export{B as default};
