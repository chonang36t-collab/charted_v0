import{r as y,a as I,j as e,b as z}from"./index-B9zsSBSc.js";import{D as Y}from"./DashboardLayout-BbhES---.js";import{A as K}from"./api-DS5URhHX.js";import{a as B,f as N,P as V,b as W,C as _,c as q,d as G,s as S,e as k}from"./popover-lfmF_V7N.js";import{B as M}from"./button-DFNT8clF.js";import{S as Q,a as U,b as X,C as J,c as Z,d as g}from"./select-BI_oltMD.js";import{C as j,a as A,b as E,d as v}from"./card-BvjUkWMy.js";import{R,A as D,C as ee,X as se,Y as te,T as re,L as ne,a as H}from"./AreaChart-DJDTelTW.js";import"./users-D30lNfxZ.js";function T(s,r){return B(s,-r)}const oe=s=>{const[r,o]=y.useState(null),[n,t]=y.useState(!1),{toast:d}=I(),l=async()=>{t(!0);try{const c=new URLSearchParams({start:N(s.from,"yyyy-MM-dd"),end:N(s.to,"yyyy-MM-dd")});console.log("Fetching sales data with params:",c.toString());const a=await fetch(`${K.SALES_SUMMARY}?${c}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(a.ok){const u=await a.json();console.log("DASHBOARD DATA RECEIVED:",u),o(u)}else console.error("Dashboard fetch failed:",a.status,a.statusText),d({title:"Error",description:"Could not fetch data from server",variant:"destructive"})}catch(c){console.error("Dashboard fetch error:",c),d({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{t(!1)}};return y.useEffect(()=>{l()},[s]),{salesData:r,isLoading:n,refetch:l}},le=(s,r)=>{var F,O,$;if(!s)return{revenue:{value:0,change:0,trend:"neutral",text:"No data available"},clientPay:{value:0,change:0,trend:"neutral",text:"No data available"},staffPay:{value:0,change:0,trend:"neutral",text:"No data available"}};const o=s.totalRevenue||0,n=s.avgClientPayPerHour||0,t=s.avgStaffPayPerHour||0,d=((F=s.previousPeriod)==null?void 0:F.totalRevenue)||0,l=((O=s.previousPeriod)==null?void 0:O.avgClientPayPerHour)||0,c=(($=s.previousPeriod)==null?void 0:$.avgStaffPayPerHour)||0,a=(m,p)=>p>0?(m-p)/p*100:0,u=a(o,d),f=a(n,l),i=a(t,c),x=m=>m>0?"up":m<0?"down":"neutral",h=(m,p,P)=>{if(!p)return"No previous data";let b="";return P<=7?b="last week":P<=31?b="last month":P<=93?b="last quarter":b="last period",`${m>0?"+":""}${Math.abs(m).toFixed(1)}% from ${b}`},C=Math.ceil((r.to.getTime()-r.from.getTime())/(1e3*60*60*24)),w=!!s.previousPeriod;return{revenue:{value:o,change:u,trend:x(u),text:h(u,w,C)},clientPay:{value:n,change:f,trend:x(f),text:h(f,w,C)},staffPay:{value:t,change:i,trend:x(i),text:h(i,w,C)}}},ae=({dateRange:s,onDateRangeChange:r,calendarOpen:o,onCalendarOpenChange:n,tempDateRange:t,onTempDateRangeChange:d})=>{const l=f=>{const i=new Date;let x,h;switch(f){case"this-month":x=S(i),h=k(i);break;case"last-month":x=S(T(i,1)),h=k(T(i,1));break;case"last-3-months":x=S(T(i,2)),h=k(i);break;case"this-year":x=new Date(i.getFullYear(),0,1),h=new Date(i.getFullYear(),11,31);break;default:return}r({from:x,to:h})},c=f=>{d(f)},a=()=>{t!=null&&t.from&&(t!=null&&t.to)&&r(t),n(!1)},u=()=>{d(s),n(!1)};return e.jsx("div",{className:"sticky top-0 z-40 bg-background border-b border-border",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Overview of your analytics"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(Q,{onValueChange:l,children:[e.jsxs(U,{className:"w-[140px]",children:[e.jsx(X,{placeholder:"Quick Select"}),e.jsx(J,{className:"h-4 w-4 opacity-50"})]}),e.jsxs(Z,{children:[e.jsx(g,{value:"this-month",children:"This Month"}),e.jsx(g,{value:"last-month",children:"Last Month"}),e.jsx(g,{value:"last-3-months",children:"Last 3 Months"}),e.jsx(g,{value:"this-year",children:"This Year"})]})]}),e.jsxs(V,{open:o,onOpenChange:n,children:[e.jsx(W,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:z("w-[240px] justify-start text-left font-normal",!s&&"text-muted-foreground"),children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),s!=null&&s.from?s.to?e.jsxs(e.Fragment,{children:[N(s.from,"LLL dd, y")," -"," ",N(s.to,"LLL dd, y")]}):N(s.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"})]})}),e.jsxs(q,{className:"w-auto p-0",align:"end",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsx(G,{initialFocus:!0,mode:"range",defaultMonth:t==null?void 0:t.from,selected:t,onSelect:c,numberOfMonths:2})}),e.jsxs("div",{className:"flex justify-end gap-2 p-3",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:u,children:"Cancel"}),e.jsx(M,{size:"sm",onClick:a,disabled:!(t!=null&&t.from)||!(t!=null&&t.to),children:"Apply"})]})]})]})]})]})})})};function L({title:s,value:r,change:o,trend:n="neutral"}){return e.jsxs(j,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(A,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:s})}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r}),o&&e.jsx("p",{className:z("text-xs mt-1",n==="up"&&"text-accent",n==="down"&&"text-destructive",n==="neutral"&&"text-muted-foreground"),children:o})]})]})}const ie=({metrics:s})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 w-full",children:[e.jsx(L,{title:"Total Revenue",value:`£${s.revenue.value.toLocaleString()}`,change:s.revenue.text,trend:s.revenue.trend}),e.jsx(L,{title:"Average Client Pay",value:`£${s.clientPay.value.toFixed(2)}`,change:s.clientPay.text,trend:s.clientPay.trend}),e.jsx(L,{title:"Average Staff Pay",value:`£${s.staffPay.value.toFixed(2)}`,change:s.staffPay.text,trend:s.staffPay.trend})]}),ce=({salesData:s})=>{var r;return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(j,{children:e.jsx(v,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalShifts)||0})]})})})}),e.jsx(j,{children:e.jsx(v,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalClients)||0})]})})})}),e.jsx(j,{children:e.jsx(v,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.uniqueEmployees)||0})]})})})}),e.jsx(j,{children:e.jsx(v,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((r=s==null?void 0:s.profitMargin)==null?void 0:r.toFixed(1))||0,"%"]})]})})})})]})},de=({active:s,payload:r,label:o})=>s&&r&&r.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:o}),r.map((n,t)=>e.jsxs("p",{className:"text-sm",style:{color:n.color},children:[n.name,": £",Number(n.value).toLocaleString()]},t))]}):null,xe=({data:s,aggregationLevel:r})=>{const o={dataKey:"display",interval:0};return!s||s.length===0?e.jsxs(j,{children:[e.jsx(A,{children:e.jsx(E,{children:"Revenue vs Cost Trend"})}),e.jsx(v,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(j,{children:[e.jsxs(A,{children:[e.jsx(E,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r==="daily"&&"Daily view",r==="weekly"&&"Weekly view",r==="monthly"&&"Monthly view"]})]}),e.jsx(v,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(D,{data:s,children:[e.jsx(ee,{strokeDasharray:"3 3"}),e.jsx(se,{dataKey:o.dataKey,tick:{fontSize:12},interval:o.interval}),e.jsx(te,{}),e.jsx(re,{content:e.jsx(de,{})}),e.jsx(ne,{}),e.jsx(H,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(H,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]})})})})]})},he=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})});function Ce(){const[s,r]=y.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[o,n]=y.useState(!1),[t,d]=y.useState(s),{salesData:l,isLoading:c}=oe(s),a=le(l,s);return e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(ae,{dateRange:s,onDateRangeChange:r,calendarOpen:o,onCalendarOpenChange:n,tempDateRange:t,onTempDateRangeChange:d}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[c&&e.jsx(he,{}),e.jsx(ie,{metrics:a}),e.jsx(ce,{salesData:l}),e.jsx(xe,{data:(l==null?void 0:l.timeSeries)||[],aggregationLevel:(l==null?void 0:l.aggregationLevel)||"monthly"})]})})]})})}export{Ce as default};
