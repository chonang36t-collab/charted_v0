import{r as S,R as j,ac as be,a as ge,A as V,j as i}from"./index-B8jeXgcD.js";import{f as ae}from"./popover-xLUlo7NN.js";import{C as R,a as L,b as M,d as F}from"./card-Ibbcj3jr.js";import{S as ie,b as Ae,G as je,f as J,c as N,d as Oe,e as Pe,i as k,g as Se,h as ce,E as we,j as I,k as Te,l as Ee,m as _e,n as T,o as Ce,a as Ne,p as oe,u as De,q as Ke,A as B,B as $,X as Q,Y as ee,r as $e,R as ue,C as pe,T as fe,L as de}from"./generateCategoricalChart-DJXx2oC5.js";import{L as ze,B as ke}from"./BarChart-BOIDVCEV.js";function E(t){"@babel/helpers - typeof";return E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(t)}function Ie(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Be(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ye(r.key),r)}}function Re(t,e,n){return e&&Be(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Le(t,e,n){return e=H(e),Me(t,me()?Reflect.construct(e,n||[],H(t).constructor):e.apply(t,n))}function Me(t,e){if(e&&(E(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fe(t)}function Fe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function me(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(me=function(){return!!t})()}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},H(t)}function He(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U(t,e)}function U(t,e){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},U(t,e)}function he(t,e,n){return e=ye(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ye(t){var e=We(t,"string");return E(e)=="symbol"?e:e+""}function We(t,e){if(E(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(E(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var q=function(t){function e(){return Ie(this,e),Le(this,e,arguments)}return He(e,t),Re(e,[{key:"render",value:function(){return null}}])}(S.Component);he(q,"displayName","ZAxis");he(q,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var qe=["option","isActive"];function D(){return D=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},D.apply(this,arguments)}function Ge(t,e){if(t==null)return{};var n=Ye(t,e),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)r=o[a],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function Ye(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function Ze(t){var e=t.option,n=t.isActive,r=Ge(t,qe);return typeof e=="string"?S.createElement(ie,D({option:S.createElement(Ae,D({type:e},r)),isActive:n,shapeType:"symbols"},r)):S.createElement(ie,D({option:e,isActive:n,shapeType:"symbols"},r))}function _(t){"@babel/helpers - typeof";return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(t)}function K(){return K=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},K.apply(this,arguments)}function se(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?se(Object(n),!0).forEach(function(r){P(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Ve(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xe(r.key),r)}}function Je(t,e,n){return e&&le(t.prototype,e),n&&le(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ue(t,e,n){return e=W(e),Xe(t,ve()?Reflect.construct(e,n||[],W(t).constructor):e.apply(t,n))}function Xe(t,e){if(e&&(_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Qe(t)}function Qe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ve(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ve=function(){return!!t})()}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},W(t)}function et(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},X(t,e)}function P(t,e,n){return e=xe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xe(t){var e=tt(t,"string");return _(e)=="symbol"?e:e+""}function tt(t,e){if(_(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(_(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var G=function(t){function e(){var n;Ve(this,e);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return n=Ue(this,e,[].concat(a)),P(n,"state",{isAnimationFinished:!1}),P(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0})}),P(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1})}),P(n,"id",De("recharts-scatter-")),n}return et(e,t),Je(e,[{key:"renderSymbolsStatically",value:function(r){var a=this,o=this.props,d=o.shape,g=o.activeShape,v=o.activeIndex,m=J(this.props,!1);return r.map(function(s,c){var p=v===c,u=p?g:d,x=O(O({},m),s);return j.createElement(N,K({className:"recharts-scatter-symbol",key:"symbol-".concat(s==null?void 0:s.cx,"-").concat(s==null?void 0:s.cy,"-").concat(s==null?void 0:s.size,"-").concat(c)},Oe(a.props,s,c),{role:"img"}),j.createElement(Ze,K({option:u,isActive:p,key:"symbol-".concat(c)},x)))})}},{key:"renderSymbolsWithAnimation",value:function(){var r=this,a=this.props,o=a.points,d=a.isAnimationActive,g=a.animationBegin,v=a.animationDuration,m=a.animationEasing,s=a.animationId,c=this.state.prevPoints;return j.createElement(Pe,{begin:g,duration:v,isActive:d,easing:m,from:{t:0},to:{t:1},key:"pie-".concat(s),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(p){var u=p.t,x=o.map(function(f,h){var y=c&&c[h];if(y){var b=k(y.cx,f.cx),l=k(y.cy,f.cy),A=k(y.size,f.size);return O(O({},f),{},{cx:b(u),cy:l(u),size:A(u)})}var w=k(0,f.size);return O(O({},f),{},{size:w(u)})});return j.createElement(N,null,r.renderSymbolsStatically(x))})}},{key:"renderSymbols",value:function(){var r=this.props,a=r.points,o=r.isAnimationActive,d=this.state.prevPoints;return o&&a&&a.length&&(!d||!Se(d,a))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(a)}},{key:"renderErrorBar",value:function(){var r=this.props.isAnimationActive;if(r&&!this.state.isAnimationFinished)return null;var a=this.props,o=a.points,d=a.xAxis,g=a.yAxis,v=a.children,m=ce(v,we);return m?m.map(function(s,c){var p=s.props,u=p.direction,x=p.dataKey;return j.cloneElement(s,{key:"".concat(u,"-").concat(x,"-").concat(o[c]),data:o,xAxis:d,yAxis:g,layout:u==="x"?"vertical":"horizontal",dataPointFormatter:function(h,y){return{x:h.cx,y:h.cy,value:u==="x"?+h.node.x:+h.node.y,errorVal:I(h,y)}}})}):null}},{key:"renderLine",value:function(){var r=this.props,a=r.points,o=r.line,d=r.lineType,g=r.lineJointType,v=J(this.props,!1),m=J(o,!1),s,c;if(d==="joint")s=a.map(function(l){return{x:l.cx,y:l.cy}});else if(d==="fitting"){var p=Te(a),u=p.xmin,x=p.xmax,f=p.a,h=p.b,y=function(A){return f*A+h};s=[{x:u,y:y(u)},{x,y:y(x)}]}var b=O(O(O({},v),{},{fill:"none",stroke:v&&v.fill},m),{},{points:s});return j.isValidElement(o)?c=j.cloneElement(o,b):Ee(o)?c=o(b):c=j.createElement(_e,K({},b,{type:g})),j.createElement(N,{className:"recharts-scatter-line",key:"recharts-scatter-line"},c)}},{key:"render",value:function(){var r=this.props,a=r.hide,o=r.points,d=r.line,g=r.className,v=r.xAxis,m=r.yAxis,s=r.left,c=r.top,p=r.width,u=r.height,x=r.id,f=r.isAnimationActive;if(a||!o||!o.length)return null;var h=this.state.isAnimationFinished,y=be("recharts-scatter",g),b=v&&v.allowDataOverflow,l=m&&m.allowDataOverflow,A=b||l,w=T(x)?this.id:x;return j.createElement(N,{className:y,clipPath:A?"url(#clipPath-".concat(w,")"):null},b||l?j.createElement("defs",null,j.createElement("clipPath",{id:"clipPath-".concat(w)},j.createElement("rect",{x:b?s:s-p/2,y:l?c:c-u/2,width:b?p:p*2,height:l?u:u*2}))):null,d&&this.renderLine(),this.renderErrorBar(),j.createElement(N,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!f||h)&&Ce.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(r,a){return r.animationId!==a.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:a.curPoints}:r.points!==a.curPoints?{curPoints:r.points}:null}}])}(S.PureComponent);P(G,"displayName","Scatter");P(G,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!je.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});P(G,"getComposedData",function(t){var e=t.xAxis,n=t.yAxis,r=t.zAxis,a=t.item,o=t.displayedData,d=t.xAxisTicks,g=t.yAxisTicks,v=t.offset,m=a.props.tooltipType,s=ce(a.props.children,Ne),c=T(e.dataKey)?a.props.dataKey:e.dataKey,p=T(n.dataKey)?a.props.dataKey:n.dataKey,u=r&&r.dataKey,x=r?r.range:q.defaultProps.range,f=x&&x[0],h=e.scale.bandwidth?e.scale.bandwidth():0,y=n.scale.bandwidth?n.scale.bandwidth():0,b=o.map(function(l,A){var w=I(l,c),te=I(l,p),C=!T(u)&&I(l,u)||"-",re=[{name:T(e.dataKey)?a.props.name:e.name||e.dataKey,unit:e.unit||"",value:w,payload:l,dataKey:c,type:m},{name:T(n.dataKey)?a.props.name:n.name||n.dataKey,unit:n.unit||"",value:te,payload:l,dataKey:p,type:m}];C!=="-"&&re.push({name:r.name||r.dataKey,unit:r.unit||"",value:C,payload:l,dataKey:u,type:m});var Y=oe({axis:e,ticks:d,bandSize:h,entry:l,index:A,dataKey:c}),Z=oe({axis:n,ticks:g,bandSize:y,entry:l,index:A,dataKey:p}),ne=C!=="-"?r.scale(C):f,z=Math.sqrt(Math.max(ne,0)/Math.PI);return O(O({},l),{},{cx:Y,cy:Z,x:Y-z,y:Z-z,xAxis:e,yAxis:n,zAxis:r,width:2*z,height:2*z,size:ne,node:{x:w,y:te,z:C},tooltipPayload:re,tooltipPosition:{x:Y,y:Z},payload:l},s&&s[A]&&s[A].props)});return O({points:b},v)});var rt=Ke({chartName:"ComposedChart",GraphicalChild:[ze,B,$,G],axisComponents:[{axisType:"xAxis",AxisComp:Q},{axisType:"yAxis",AxisComp:ee},{axisType:"zAxis",AxisComp:q}],formatAxisMap:$e});const ut=(t,e,n)=>{const[r,a]=S.useState(null),[o,d]=S.useState(!1),{toast:g}=ge(),v=async()=>{d(!0);try{const m=new URLSearchParams({start:ae(t.from,"yyyy-MM-dd"),end:ae(t.to,"yyyy-MM-dd")});e&&e.length>0&&e.forEach(f=>m.append("locations",f)),n&&n.length>0&&n.forEach(f=>m.append("sites",f));const s=m.toString(),c={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},[p,u,x]=await Promise.all([fetch(`${V.SALES_SUMMARY.replace("sales-summary","operational-summary")}?${s}`,{headers:c}),fetch(`${V.CLIENT_DISTRIBUTION}?${s}`,{headers:c}),fetch(`${V.TARGET_ACHIEVEMENT_TREND}?${s}`,{headers:c})]);if(p.ok){const f=await p.json();if(u.ok){const h=await u.json();h.timeSeries&&(f.timeSeries=f.timeSeries.map(y=>{const b=y.period.substring(0,7),l=h.timeSeries.find(A=>A.period===b);return{...y,clientCount:l?l.clientCount:0}}))}if(x.ok){const h=await x.json();h.data&&(f.timeSeries=f.timeSeries.map(y=>{const b=y.period.substring(0,7),l=h.data.find(A=>A.period===b);return{...y,achievementPercentage:l?l.achievementPercentage:0}}))}a(f)}else g({title:"Error",description:"Could not fetch operational data",variant:"destructive"})}catch(m){console.error(m),g({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{d(!1)}};return S.useEffect(()=>{v()},[t,e,n]),{operationalData:r,isLoading:o,refetch:v}},nt=({active:t,payload:e,label:n})=>t&&e&&e.length?i.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[i.jsx("p",{className:"font-semibold text-foreground",children:n}),e.map((r,a)=>i.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",r.name==="Paid Hours"?r.value.toLocaleString(void 0,{maximumFractionDigits:1}):r.name==="Target Achievement"?`${r.value}%`:r.value]},a))]}):null,pt=({data:t,aggregationLevel:e,selectedMetric:n="shifts"})=>{const r={dataKey:"display",interval:0};if(!t||t.length===0)return i.jsxs(R,{className:"flex-1",children:[i.jsx(L,{children:i.jsx(M,{children:"Metric Trend"})}),i.jsx(F,{children:i.jsx("div",{className:"h-[400px] flex items-center justify-center",children:i.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const a=()=>{switch(n){case"hours":return"Paid Hours Trend";case"shifts":return"Hours & Shifts Trend";case"clients":return"Active Clients Trend";case"targetAchievement":return"Target Achievement Trend";case"missedTarget":return"Missed Target Trend";default:return"Metric Trend"}},o=()=>{switch(n){case"hours":return"Hours";case"shifts":return"Shifts";case"clients":return"Clients";case"targetAchievement":return"Percentage (%)";default:return"Count"}};return console.log("OperationalTrendChart - selectedMetric:",n),console.log("OperationalTrendChart - data sample:",t.slice(0,2)),i.jsxs(R,{className:"flex-1",children:[i.jsxs(L,{children:[i.jsx(M,{children:a()}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[e==="daily"&&"Daily view",e==="weekly"&&"Weekly view",e==="monthly"&&"Monthly view"]})]}),i.jsx(F,{children:i.jsx("div",{className:"h-[400px]",children:i.jsx(ue,{width:"100%",height:"100%",children:i.jsxs(rt,{data:t,children:[i.jsx(pe,{strokeDasharray:"3 3"}),i.jsx(Q,{dataKey:r.dataKey,tick:{fontSize:12},interval:r.interval}),i.jsx(ee,{label:{value:o(),angle:-90,position:"insideLeft"}}),i.jsx(fe,{content:i.jsx(nt,{})}),i.jsx(de,{}),n==="shifts"&&i.jsxs(i.Fragment,{children:[i.jsx(B,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),i.jsx($,{dataKey:"totalShifts",name:"Total Shifts",barSize:20,fill:"hsl(var(--accent))",fillOpacity:.6})]}),n==="hours"&&i.jsx(B,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),n==="clients"&&i.jsx($,{dataKey:"clientCount",name:"Active Clients",barSize:30,fill:"hsl(262, 83%, 58%)",fillOpacity:.8}),n==="targetAchievement"&&i.jsx(B,{type:"monotone",dataKey:"achievementPercentage",name:"Target Achievement",stroke:"hsl(142, 71%, 45%)",fill:"hsl(142, 71%, 45%)",fillOpacity:.2,strokeWidth:2})]})})})})]})},at=({active:t,payload:e,label:n})=>t&&e&&e.length?i.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[i.jsx("p",{className:"font-semibold text-foreground",children:n}),e.map((r,a)=>i.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",r.value.toLocaleString()]},a))]}):null,ft=({data:t})=>{if(!t||t.length===0)return i.jsxs(R,{className:"flex-1",children:[i.jsx(L,{children:i.jsx(M,{children:"Target vs Actual Performance"})}),i.jsx(F,{children:i.jsx("div",{className:"h-[400px] flex items-center justify-center",children:i.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const e=new Map;t.forEach(a=>{const o=a.site?`${a.location} - ${a.site}`:a.location;e.has(o)||e.set(o,{actual:0,target:0});const d=e.get(o);d.actual+=a.actual||0,d.target+=a.target||0});const n=Array.from(e.entries()).map(([a,o])=>({name:a,actual:o.actual,target:o.target})).sort((a,o)=>a.name.localeCompare(o.name));console.log("TargetPerformanceChart - Chart Data:",n.slice(0,3)),console.log("Total sites:",n.length);const r=Math.max(400,n.length*40);return i.jsxs(R,{className:"flex-1",children:[i.jsxs(L,{children:[i.jsx(M,{children:"Target vs Actual Performance by Site"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Total shifts achieved compared to target for each location/site"})]}),i.jsx(F,{children:i.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:i.jsx("div",{style:{height:`${r}px`,minHeight:"400px"},children:i.jsx(ue,{width:"100%",height:"100%",children:i.jsxs(ke,{data:n,layout:"vertical",margin:{top:20,right:30,left:150,bottom:20},children:[i.jsx(pe,{strokeDasharray:"3 3",horizontal:!1}),i.jsx(Q,{type:"number",domain:[0,"dataMax"],tickFormatter:a=>a.toLocaleString()}),i.jsx(ee,{type:"category",dataKey:"name",width:140,tick:{fontSize:11}}),i.jsx(fe,{content:i.jsx(at,{})}),i.jsx(de,{}),i.jsx($,{dataKey:"target",name:"Target",fill:"#94a3b8",opacity:.7}),i.jsx($,{dataKey:"actual",name:"Actual",fill:"#3b82f6"})]})})})})})]})};export{pt as O,ft as T,ut as u};
