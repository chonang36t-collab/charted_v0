import{r as i,a as C,A as b,j as e,u as w}from"./index-BIm8U-WF.js";import{D as S,L}from"./DashboardLayout-BKG9_D-B.js";import{f as j}from"./locationUtils-BqXVJ2N8.js";import{M as f,c as T,D as A,L as M}from"./LoadingOverlay-CcFRW5oK.js";import{C as o,d as l,a as p,b as g}from"./card-CPYEXJ6G.js";import{R,C as k,X as P,Y as E,T as F,L as O,A as v}from"./generateCategoricalChart-wi_2keqS.js";import{A as $}from"./AreaChart-C2p-wx46.js";import{B as y}from"./button-BUooGhA3.js";import{T as K}from"./users-CvOqpEy-.js";import"./select-CiYoD-rJ.js";import"./badge-B4zLmiKw.js";const z=(s,t)=>{const[r,n]=i.useState(null),[d,h]=i.useState(!1),{toast:u}=C(),c=async()=>{h(!0);try{const x=new URLSearchParams({start:j(s.from,"yyyy-MM-dd"),end:j(s.to,"yyyy-MM-dd")});t&&t.length>0&&t.forEach(m=>x.append("locations",m));const a=await fetch(`${b.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${x}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(a.ok){const m=await a.json();n(m)}else u({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch{u({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{h(!1)}};return i.useEffect(()=>{c()},[s,t]),{financialData:r,isLoading:d,refetch:c}},I=({metrics:s})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 w-full",children:[e.jsx(f,{title:"Total Revenue",value:`£${s.revenue.value.toLocaleString()}`,change:s.revenue.text,trend:s.revenue.trend}),e.jsx(f,{title:"Average Client Pay",value:`£${s.clientPay.value.toFixed(2)}`,change:s.clientPay.text,trend:s.clientPay.trend}),e.jsx(f,{title:"Average Staff Pay",value:`£${s.staffPay.value.toFixed(2)}`,change:s.staffPay.text,trend:s.staffPay.trend})]}),B=({salesData:s})=>{var t;return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(o,{children:e.jsx(l,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalShifts)||0})]})})})}),e.jsx(o,{children:e.jsx(l,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalClients)||0})]})})})}),e.jsx(o,{children:e.jsx(l,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.uniqueEmployees)||0})]})})})}),e.jsx(o,{children:e.jsx(l,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((t=s==null?void 0:s.profitMargin)==null?void 0:t.toFixed(1))||0,"%"]})]})})})})]})},U=({active:s,payload:t,label:r})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:r}),t.map((n,d)=>e.jsxs("p",{className:"text-sm",style:{color:n.color},children:[n.name,": £",Number(n.value).toLocaleString()]},d))]}):null,W=({data:s,aggregationLevel:t})=>{const r={dataKey:"display",interval:0};return!s||s.length===0?e.jsxs(o,{children:[e.jsx(p,{children:e.jsx(g,{children:"Revenue vs Cost Trend"})}),e.jsx(l,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(o,{children:[e.jsxs(p,{children:[e.jsx(g,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t==="daily"&&"Daily view",t==="weekly"&&"Weekly view",t==="monthly"&&"Monthly view"]})]}),e.jsx(l,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs($,{data:s,children:[e.jsx(k,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:r.dataKey,tick:{fontSize:12},interval:r.interval}),e.jsx(E,{}),e.jsx(F,{content:e.jsx(U,{})}),e.jsx(O,{}),e.jsx(v,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(v,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]})})})})]})};function ee(){const s=w(),[t,r]=i.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[n,d]=i.useState(!1),[h,u]=i.useState(t),[c,x]=i.useState([]),{financialData:a,isLoading:m}=z(t,c),N=T(a,t);return e.jsx(S,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(A,{dateRange:t,onDateRangeChange:r,calendarOpen:n,onCalendarOpenChange:d,tempDateRange:h,onTempDateRangeChange:u,selectedLocations:c,onLocationsChange:x}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(y,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(K,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(y,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>s("/dashboard/operational"),children:[e.jsx(L,{className:"h-4 w-4"}),"Operational View"]})]})}),m&&e.jsx(M,{}),e.jsx(I,{metrics:N}),e.jsx(B,{salesData:a}),e.jsx(W,{data:(a==null?void 0:a.timeSeries)||[],aggregationLevel:(a==null?void 0:a.aggregationLevel)||"monthly"})]})})]})})}export{ee as default};
