import{c as T,d as Y,r as i,j as e,P as L,b as S,e as Q,a as Z}from"./index-ByTFSIDU.js";import{D as ee,C as se,F as re}from"./DashboardLayout-D98A_w8E.js";import{C as h,a as g,b as v,d as j}from"./card-E7Cytlz6.js";import{B as te}from"./button-C-svuqPT.js";import{L as ae,I as le}from"./label-oZVDzgPC.js";import{A as oe}from"./api-DS5URhHX.js";import"./users-n-PHGirE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=T("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=T("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var R="Progress",E=100,[de,Pe]=Y(R),[ce,ue]=de(R),V=i.forwardRef((s,r)=>{const{__scopeProgress:a,value:l=null,max:o,getValueLabel:f=xe,...N}=s;(o||o===0)&&!$(o)&&console.error(pe(`${o}`,"Progress"));const x=$(o)?o:E;l!==null&&!F(l,x)&&console.error(me(`${l}`,"Progress"));const n=F(l,x)?l:null,m=y(n)?f(n,x):void 0;return e.jsx(ce,{scope:a,value:n,max:x,children:e.jsx(L.div,{"aria-valuemax":x,"aria-valuemin":0,"aria-valuenow":y(n)?n:void 0,"aria-valuetext":m,role:"progressbar","data-state":O(n,x),"data-value":n??void 0,"data-max":x,...N,ref:r})})});V.displayName=R;var B="ProgressIndicator",_=i.forwardRef((s,r)=>{const{__scopeProgress:a,...l}=s,o=ue(B,a);return e.jsx(L.div,{"data-state":O(o.value,o.max),"data-value":o.value??void 0,"data-max":o.max,...l,ref:r})});_.displayName=B;function xe(s,r){return`${Math.round(s/r*100)}%`}function O(s,r){return s==null?"indeterminate":s===r?"complete":"loading"}function y(s){return typeof s=="number"}function $(s){return y(s)&&!isNaN(s)&&s>0}function F(s,r){return y(s)&&!isNaN(s)&&s<=r&&s>=0}function pe(s,r){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${E}\`.`}function me(s,r){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${E} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var z=V,fe=_;const q=i.forwardRef(({className:s,value:r,...a},l)=>e.jsx(z,{ref:l,className:S("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:e.jsx(fe,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));q.displayName=z.displayName;const he=Q("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),k=i.forwardRef(({className:s,variant:r,...a},l)=>e.jsx("div",{ref:l,role:"alert",className:S(he({variant:r}),s),...a}));k.displayName="Alert";const ge=i.forwardRef(({className:s,...r},a)=>e.jsx("h5",{ref:a,className:S("mb-1 font-medium leading-none tracking-tight",s),...r}));ge.displayName="AlertTitle";const I=i.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:S("text-sm [&_p]:leading-relaxed",s),...r}));I.displayName="AlertDescription";function Ce(){const[s,r]=i.useState(null),[a,l]=i.useState(!1),[o,f]=i.useState(0),[N,x]=i.useState({}),[n,m]=i.useState("idle"),[G,w]=i.useState(""),[p,M]=i.useState(null),P=i.useRef(null),{toast:C}=Z(),H=d=>{var c;const t=(c=d.target.files)==null?void 0:c[0];t&&(t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||t.type==="application/vnd.ms-excel"||t.name.endsWith(".csv")?(r(t),m("idle"),w("")):(C({title:"Invalid file type",description:"Please upload an Excel file (.xlsx, .xls) or CSV file",variant:"destructive"}),r(null)))},X=async()=>{if(!s)return;l(!0),f(0),m("idle"),w(""),M(null);const d=new FormData;d.append("file",s);try{const t=await fetch(oe.UPLOAD,{method:"POST",body:d,headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!t.ok)throw new Error(`Upload failed: ${t.statusText}`);if(!t.body)throw new Error("No response body");const c=t.body.getReader(),b=new TextDecoder;let A="";for(;;){const{done:K,value:W}=await c.read();if(K)break;A+=b.decode(W,{stream:!0});const U=A.split(`
`);A=U.pop()||"";for(const D of U)if(D.trim())try{const u=JSON.parse(D);if(u.status==="progress")u.progress&&f(u.progress);else if(u.status==="complete")m("success"),M(u.data),f(100),C({title:"Upload successful",description:"Your file has been uploaded and processed successfully"}),r(null),P.current&&(P.current.value="");else if(u.status==="error")throw new Error(u.message)}catch(u){console.error("Error parsing stream:",u)}}}catch(t){m("error"),w(t.message||"An unexpected error occurred"),C({title:"Upload failed",description:t.message||"An unexpected error occurred",variant:"destructive"})}finally{l(!1)}},J=d=>{if(d===0)return"0 Bytes";const t=1024,c=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(d)/Math.log(t));return parseFloat((d/Math.pow(t,b)).toFixed(2))+" "+c[b]};return e.jsx(ee,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Upload Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Upload your Excel or CSV files to import data into the system"})]}),e.jsxs(h,{children:[e.jsx(g,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"File Upload"]})}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"file-upload",children:"Select File"}),e.jsx(le,{id:"file-upload",type:"file",ref:P,onChange:H,accept:".xlsx,.xls,.csv",disabled:a}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported formats: Excel (.xlsx, .xls) and CSV files"})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg",children:[e.jsx(re,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:J(s.size)})]})]}),a&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[o,"%"]})]}),e.jsx(q,{value:o})]}),n==="success"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(k,{className:"border-green-200 bg-green-50",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600"}),e.jsx(I,{className:"text-green-800",children:"File uploaded successfully!"})]}),p&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(h,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium",children:"Rows Inserted"})}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold",children:p.inserted.toLocaleString()})})]}),e.jsxs(h,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium",children:"Rows Skipped"})}),e.jsx(j,{children:e.jsx("div",{className:`text-2xl font-bold ${p.skipped>0?"text-red-600":"text-green-600"}`,children:p.skipped.toLocaleString()})})]}),e.jsxs(h,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(v,{className:"text-sm font-medium",children:"Revenue Match"})}),e.jsxs(j,{children:[e.jsx("div",{className:`text-2xl font-bold ${p.verification.match?"text-green-600":"text-red-600"}`,children:p.verification.match?"MATCHED":"MISMATCH"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["DB: $",p.verification.db_revenue.toLocaleString()]})]})]})]})]}),n==="error"&&e.jsxs(k,{className:"border-red-200 bg-red-50",children:[e.jsx(ie,{className:"h-4 w-4 text-red-600"}),e.jsx(I,{className:"text-red-800",children:G})]}),e.jsx(te,{onClick:X,disabled:a||n==="success",className:"w-full",children:a?"Uploading...":"Upload File"})]})]})]}),Object.keys(N).length>0&&e.jsxs(h,{children:[e.jsx(g,{children:e.jsx(v,{children:"Required Columns"})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(N).map(([d,t])=>e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:d}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(c=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-md text-sm",children:c},c))})]},d))})})]})]})})}export{Ce as default};
