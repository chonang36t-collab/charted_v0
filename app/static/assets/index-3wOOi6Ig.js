import{c as oe,ab as O,r as b,j as e,T as ie,e as F,B as D,k as Q,l as X,m as Z,I,ac as ne}from"./index-B7lOCxKH.js";import{D as ue,T as ce}from"./DashboardLayout-BhqhNtUZ.js";import{D as $,b as H,c as z,d as B,e as J,a as K}from"./dialog-C117tc1O.js";import{L as de}from"./label-DZ2TcKdd.js";import{T as U}from"./trash-2-C_7rlPoB.js";import{e as fe,C as me,b as he}from"./calendar-e1JToG1E.js";import{f as M,s as pe,P as be,a as xe,b as ye}from"./popover-DVxkve-a.js";import{P as R}from"./plus-CjIHwdCZ.js";import"./users-D0ij6pak.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=oe("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);function Ce(s,a){const l=O(s.start),r=O(s.end);let x=+l>+r;const C=x?+l:+r,u=x?r:l;u.setHours(0,0,0,0),u.setDate(1);let h=1;const g=[];for(;+u<=C;)g.push(O(u)),u.setMonth(u.getMonth()+h);return x?g.reverse():g}function je(s){const a=O(s),l=a.getFullYear();return a.setFullYear(l+1,0,0),a.setHours(23,59,59,999),a}function ee(s,a){return s===null||s===0?"":a.isPercentage?`${s.toFixed(2)}%`:a.isCurrency?`Â£${s.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}`:s.toLocaleString("en-GB",{maximumFractionDigits:2})}function te({source:s,formula:a,value:l}){return e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Source:"})," ",s||"Unknown"]}),a&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Formula:"}),e.jsx("code",{className:"bg-muted px-1 rounded ml-1",children:a})]})]})}function ve({rowId:s,colId:a,value:l,row:r,isActive:x,source:C,onFocus:u,onUpdate:h,onNavigate:g}){const[k,i]=b.useState(!1),[p,j]=b.useState(""),w=b.useRef(null),_=b.useCallback(()=>{i(!0),j(l!==null?String(l):""),setTimeout(()=>{var c;return(c=w.current)==null?void 0:c.focus()},0)},[l]),S=b.useCallback(()=>{i(!1);const c=parseFloat(p);h(p===""?null:isNaN(c)?l:c)},[p,h,l]),A=c=>{k?c.key==="Enter"||c.key==="Tab"?(c.preventDefault(),S(),g(c.shiftKey?"up":"down")):c.key==="Escape"&&i(!1):c.key==="Enter"||c.key==="F2"?(c.preventDefault(),_()):c.key==="ArrowUp"?(c.preventDefault(),g("up")):c.key==="ArrowDown"?(c.preventDefault(),g("down")):c.key==="ArrowLeft"?(c.preventDefault(),g("left")):c.key==="ArrowRight"?(c.preventDefault(),g("right")):c.key==="Delete"||c.key==="Backspace"?(c.preventDefault(),h(null)):/^[0-9.\-]$/.test(c.key)&&(c.preventDefault(),j(c.key),i(!0),setTimeout(()=>{var d;return(d=w.current)==null?void 0:d.focus()},0))};return e.jsx("td",{className:F("border border-border px-2 py-1 text-right text-sm min-w-[110px] h-[34px] cursor-cell transition-colors relative box-border",x&&"ring-2 ring-primary ring-inset bg-primary/5",!x&&"hover:bg-muted/50",C==="backend"&&"bg-blue-50/30 dark:bg-blue-900/10",C==="formula"&&"bg-purple-50/30 dark:bg-purple-900/10"),onClick:u,onDoubleClick:_,onKeyDown:A,tabIndex:0,onFocus:u,style:{willChange:"transform"},children:e.jsxs(Q,{delayDuration:500,children:[e.jsx(X,{asChild:!0,children:e.jsxs("div",{className:"w-full h-full flex items-center justify-end relative",children:[C==="backend"&&e.jsx("div",{className:"absolute top-0 right-0 w-1.5 h-1.5 bg-blue-400 rounded-bl-sm opacity-50 pointer-events-none"}),k?e.jsx("input",{ref:w,type:"text",value:p,onChange:c=>j(c.target.value),onBlur:S,className:"w-full h-full bg-transparent text-right outline-none text-sm font-mono tabular-nums tracking-tighter"}):e.jsx("span",{className:"font-mono text-sm tabular-nums tracking-tighter truncate block w-full",children:ee(l,r)})]})}),e.jsx(Z,{side:"top",sideOffset:4,children:e.jsx(te,{source:C,value:l})})]})})}function _e({value:s,row:a,source:l,formula:r}){return e.jsx("td",{className:F("border border-border px-2 py-1 text-right text-sm min-w-[110px] h-[34px] relative box-border",a.isHeader?"bg-primary/10 font-semibold":"bg-muted/30",l==="calculated"&&"bg-orange-50/30 dark:bg-orange-900/10"),style:{willChange:"transform"},children:e.jsxs(Q,{delayDuration:500,children:[e.jsx(X,{asChild:!0,children:e.jsxs("div",{className:"w-full h-full flex items-center justify-end relative",children:[r&&e.jsx("div",{className:"absolute top-0 right-0 w-1.5 h-1.5 bg-orange-400 rounded-bl-sm opacity-50 pointer-events-none"}),e.jsx("span",{className:"font-mono text-sm tabular-nums tracking-tighter truncate block w-full",children:ee(s,a)})]})}),e.jsx(Z,{side:"top",sideOffset:4,children:e.jsx(te,{source:l,formula:r,value:s})})]})})}function ke({isOpen:s,onClose:a,row:l,onSave:r}){const[x,C]=b.useState((l==null?void 0:l.formulaString)||"");return b.useEffect(()=>{l&&C(l.formulaString||"")},[l]),l?e.jsx($,{open:s,onOpenChange:u=>!u&&a(),children:e.jsxs(H,{children:[e.jsx(z,{children:e.jsxs(B,{children:["Edit Formula: ",l.label]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(de,{htmlFor:"formula",className:"text-right",children:"Formula"}),e.jsx(I,{id:"formula",value:x,onChange:u=>C(u.target.value),className:"col-span-3 font-mono"})]}),e.jsx("div",{className:"text-xs text-muted-foreground ml-[25%]",children:"Supported: +, -, *, /, (, ), row_ids (e.g. total_sales)"})]}),e.jsx(J,{children:e.jsx(D,{type:"submit",onClick:()=>r(x),children:"Save changes"})})]})}):null}function we({rows:s,columns:a,data:l,activeCell:r,setActiveCell:x,updateCell:C,deleteRow:u,deleteColumn:h,navigateCell:g,onRenameColumn:k,updateRowFormula:i}){const[p,j]=b.useState(null),[w,_]=b.useState(""),S=b.useRef(null),[A,c]=b.useState(null),d=t=>{j(t.id),_(t.label),setTimeout(()=>{var f;return(f=S.current)==null?void 0:f.focus()},0)},o=()=>{p&&k&&k(p,w),j(null)},y=t=>{c(t)},m=t=>{A&&i&&i(A.id,t),c(null)};return e.jsxs(ie,{children:[e.jsx("div",{className:"overflow-x-auto border border-border rounded-lg bg-card max-w-full",children:e.jsxs("table",{className:"border-collapse w-full text-xs table-fixed",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 z-20 bg-card border border-border px-2 py-2 text-left font-semibold text-muted-foreground uppercase tracking-wider w-[180px] min-w-[180px]",children:"Description"}),a.map(t=>e.jsx("th",{className:F("sticky top-0 z-10 border border-border px-1 py-1 text-center font-semibold uppercase tracking-wider min-w-[80px]",t.isYearEnd?"bg-primary/10 text-primary":"bg-muted/50 text-muted-foreground"),onDoubleClick:()=>!t.isProtected&&d(t),children:e.jsx("div",{className:"flex items-center justify-center gap-1 h-8 group relative px-2",children:p===t.id?e.jsx("input",{ref:S,value:w,onChange:f=>_(f.target.value),onBlur:o,onKeyDown:f=>f.key==="Enter"&&o(),className:"w-full bg-background border rounded px-1 text-center"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"truncate",children:t.label}),!t.isProtected&&e.jsx(D,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 absolute -right-1 hover:text-destructive hover:bg-destructive/10",onClick:f=>{f.stopPropagation(),h(t.id)},children:e.jsx(U,{className:"h-3 w-3"})})]})})},t.id)),e.jsx("th",{className:"sticky top-0 z-10 bg-card border border-border w-16"})]})}),e.jsx("tbody",{children:s.map(t=>e.jsxs("tr",{className:F("group hover:bg-muted/20",t.isHeader&&"bg-primary/5"),children:[e.jsx("td",{className:F("sticky left-0 z-10 border border-border px-2 py-1 bg-card text-xs max-w-[180px]",t.isHeader&&"font-bold text-primary bg-primary/5",t.isAutoCalculated&&!t.isHeader&&"text-muted-foreground italic"),title:`ID: ${t.id}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2 w-full overflow-hidden",children:[e.jsx("span",{className:"truncate",children:t.label}),(t.formulaString||t.isAutoCalculated)&&e.jsx(D,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:text-primary shrink-0",title:"Edit Formula",onClick:()=>y(t),children:e.jsx(ge,{className:"h-3 w-3"})})]})}),a.map(f=>{var E;const n=(E=l[t.id])==null?void 0:E[f.id];return(n==null?void 0:n.isEditable)&&!t.isAutoCalculated&&!f.isYearEnd?e.jsx(ve,{rowId:t.id,colId:f.id,value:(n==null?void 0:n.value)??null,row:t,isActive:(r==null?void 0:r.row)===t.id&&(r==null?void 0:r.col)===f.id,source:n==null?void 0:n.source,onFocus:()=>x({row:t.id,col:f.id}),onUpdate:L=>C(t.id,f.id,L),onNavigate:g},f.id):e.jsx(_e,{value:(n==null?void 0:n.value)??null,row:t,source:n==null?void 0:n.source,formula:t.formulaString},f.id)}),e.jsx("td",{className:"border border-border bg-card w-16 text-center p-0",children:!t.isAutoCalculated&&e.jsx(D,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:text-destructive",onClick:()=>u(t.id),children:e.jsx(U,{className:"h-3 w-3"})})})]},t.id))})]})}),A&&e.jsx(ke,{isOpen:!0,onClose:()=>c(null),row:A,onSave:m})]})}const T=s=>{if(!(s!=null&&s.from)||!(s!=null&&s.to))return new Date().getFullYear(),[{id:"jan",label:"January",isProtected:!0},{id:"feb",label:"February",isProtected:!0},{id:"mar",label:"March",isProtected:!0},{id:"apr",label:"April",isProtected:!0},{id:"may",label:"May",isProtected:!0},{id:"jun",label:"June",isProtected:!0},{id:"jul",label:"July",isProtected:!0},{id:"aug",label:"August",isProtected:!0},{id:"sep",label:"September",isProtected:!0},{id:"oct",label:"October",isProtected:!0},{id:"nov",label:"November",isProtected:!0},{id:"dec",label:"December",isProtected:!0},{id:"year_end",label:"Year End",isProtected:!0,isYearEnd:!0}];const l=Ce({start:ne(s.from),end:fe(s.to)}).map(r=>({id:M(r,"MMM-yyyy").toLowerCase(),label:M(r,"MMM yyyy"),isProtected:!0}));return l.push({id:"year_end",label:"Period Total",isProtected:!0,isYearEnd:!0}),l},W=(s,a,l)=>{var r,x;try{const C=Object.keys(a).sort((g,k)=>k.length-g.length);let u=s;for(const g of C){const k=new RegExp(`\\b${g}\\b`,"g");if(k.test(u)){const i=((x=(r=a[g])==null?void 0:r[l])==null?void 0:x.value)??0;u=u.replace(k,`(${i})`)}}if(!/^[0-9+\-*/().\s]*$/.test(u))return null;const h=new Function(`return ${u}`)();return typeof h=="number"&&!isNaN(h)&&isFinite(h)?h:null}catch{return null}},Y=[{id:"total_sales",label:"Total Sales",isAutoCalculated:!1,isCurrency:!0},{id:"sales_split_pct",label:"% Sales Split for the Year",isAutoCalculated:!1,isPercentage:!0},{id:"cost_sales_se",label:"Cost of Sales SE",isAutoCalculated:!1,isCurrency:!0},{id:"cost_sales_paye",label:"Cost of Sales PAYE Gross",isAutoCalculated:!1,isCurrency:!0},{id:"employee_ni",label:"Employee NI",isAutoCalculated:!1,isCurrency:!0},{id:"employee_pension",label:"Employee Pension",isAutoCalculated:!1,isCurrency:!0},{id:"total_cost_sales",label:"Total Cost of Sales",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"cost_sales_se + cost_sales_paye + employee_ni + employee_pension"},{id:"apprenticeship_levy",label:"Apprenticeship Levy",isAutoCalculated:!1,isCurrency:!0},{id:"annual_leave",label:"Annual Leave Accrual",isAutoCalculated:!1,isCurrency:!0},{id:"other_expenses",label:"Other Expenses",isAutoCalculated:!1,isCurrency:!0},{id:"recruitment_cost",label:"Recruitment & Pass Cost",isAutoCalculated:!1,isCurrency:!0},{id:"overheads_mgmt",label:"Mgmt & Office Cost",isAutoCalculated:!1,isCurrency:!0},{id:"bank_interest",label:"Bank Interest",isAutoCalculated:!1,isCurrency:!0},{id:"cooperation_tax",label:"Cooperation Tax",isAutoCalculated:!1,isCurrency:!0},{id:"total_overheads",label:"Total Overheads",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"apprenticeship_levy + annual_leave + other_expenses + recruitment_cost + overheads_mgmt + bank_interest + cooperation_tax"},{id:"total_cost",label:"Total Cost",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"total_cost_sales + total_overheads"},{id:"avg_hourly_charge",label:"Avg Hourly Charge",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_pay",label:"Gross Hourly Pay",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_margin",label:"Gross Hourly Margin",isAutoCalculated:!0,isCurrency:!0,formulaString:"avg_hourly_charge - gross_hourly_pay"},{id:"net_cost_per_hour",label:"Net Cost per Hour",isAutoCalculated:!1,isCurrency:!0},{id:"gross_pl_value",label:"Gross P&L",isAutoCalculated:!1,isCurrency:!0},{id:"net_pl",label:"Net P&L",isAutoCalculated:!1,isCurrency:!0},{id:"total_net_margin",label:"Total Net Margin",isAutoCalculated:!1,isPercentage:!0},{id:"worked_hours",label:"Worked Hours",isAutoCalculated:!1},{id:"hours_breakeven",label:"Hours for Breakeven",isAutoCalculated:!0,formula:(s,a,l)=>{var C,u,h,g;const r=((u=(C=s.total_cost)==null?void 0:C[l])==null?void 0:u.value)??0,x=((g=(h=s.gross_hourly_margin)==null?void 0:h[l])==null?void 0:g.value)??0;return x!==0?r/x:0}},{id:"value_breakeven",label:"Total Value for Breakeven",isAutoCalculated:!0,isCurrency:!0,formulaString:"hours_breakeven * avg_hourly_charge"},{id:"sales_budget_2026",label:"Projeted Sales Budget 30% Uplift",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales * 1.3"},{id:"avg_hourly_charge_2026",label:"Average Hourly Charge Rate Future",isAutoCalculated:!1,isCurrency:!0},{id:"sales_target_hours",label:"Sales Target in Hours",isAutoCalculated:!1},{id:"variance_2025",label:"Variance",isAutoCalculated:!1,isCurrency:!0}];function q(s,a){const l={};for(const r of s){l[r.id]={};for(const x of a)l[r.id][x.id]={value:null,isEditable:!r.isAutoCalculated&&!x.isYearEnd,source:"manual"}}return l}function N(s,a,l){var g,k;const r=JSON.parse(JSON.stringify(s));for(const i of l.filter(p=>!p.isYearEnd))for(const p of a)p.formulaString?r[p.id][i.id]={...r[p.id][i.id],value:W(p.formulaString,r,i.id),isEditable:!1,source:"calculated"}:p.formula&&(r[p.id][i.id]={...r[p.id][i.id],value:p.formula(r,p.id,i.id),isEditable:!1,source:"calculated"});const x=a.find(i=>i.id==="total_sales"),C=a.find(i=>i.id==="sales_split_pct"),u=l.find(i=>i.isYearEnd);if(x&&C&&u){let i=0;const p=l.filter(j=>!j.isYearEnd);i=p.reduce((j,w)=>{var _,S;return j+(((S=(_=r.total_sales)==null?void 0:_[w.id])==null?void 0:S.value)??0)},0);for(const j of p){const w=((k=(g=r.total_sales)==null?void 0:g[j.id])==null?void 0:k.value)??0,_=i!==0?w/i*100:0;r.sales_split_pct[j.id]={value:_,isEditable:!1,source:"calculated"}}r.sales_split_pct[u.id]={value:i!==0?100:0,isEditable:!1,source:"calculated"}}const h=l.find(i=>i.isYearEnd);if(h)for(const i of a){if(i.id==="sales_split_pct")continue;const p=l.filter(j=>!j.isYearEnd).reduce((j,w)=>{var _,S;return j+(((S=(_=r[i.id])==null?void 0:_[w.id])==null?void 0:S.value)??0)},0);i.formulaString||i.isAutoCalculated?i.formulaString?r[i.id][h.id]={value:W(i.formulaString,r,h.id),isEditable:!1,source:"calculated"}:i.formula?r[i.id][h.id]={value:i.formula(r,i.id,h.id),isEditable:!1,source:"calculated"}:r[i.id][h.id]={value:p,isEditable:!1,source:"calculated"}:r[i.id][h.id]={value:p,isEditable:!1,source:"calculated"}}return r}function Se(s){const[a,l]=b.useState(Y),[r,x]=b.useState(()=>T(s)),[C,u]=b.useState(()=>N(q(Y,T(s)),Y,T(s))),[h,g]=b.useState(null);b.useEffect(()=>{const d=T(s);x(d);let o=q(a,d);s!=null&&s.from&&(s!=null&&s.to)?(async()=>{try{const m=M(s.from,"yyyy-MM-dd"),t=M(s.to,"yyyy-MM-dd"),f=localStorage.getItem("auth_token"),n=await fetch(`/api/financial-summary/metrics?start=${m}&end=${t}`,{headers:{Authorization:`Bearer ${f}`},credentials:"include"});if(n.status===401){console.error("Unauthorized: Redirecting to login"),window.location.href="/auth";return}if(n.ok){const v=n.headers.get("content-type");if(v&&v.indexOf("application/json")!==-1){const E=await n.json(),L={January:"jan",February:"feb",March:"mar",April:"apr",May:"may",June:"jun",July:"jul",August:"aug",September:"sep",October:"oct",November:"nov",December:"dec"};for(const[se,V]of Object.entries(E)){const[re,ae]=se.split("-"),G=L[ae];if(!G)continue;const P=`${G}-${re}`;d.find(le=>le.id===P)&&(o.total_sales&&o.total_sales[P]&&(o.total_sales[P].value=V.total_sales,o.total_sales[P].source="backend"),o.cost_sales_paye&&o.cost_sales_paye[P]&&(o.cost_sales_paye[P].value=V.cost_sales_paye,o.cost_sales_paye[P].source="backend"))}u(N(o,a,d))}else console.error("Received non-JSON response from API"),u(N(o,a,d))}else console.error("API Error",n.status,n.statusText),u(N(o,a,d))}catch(m){console.error("Failed to fetch metrics",m),u(N(o,a,d))}})():u(N(o,a,d))},[s]);const k=b.useCallback((d,o,y)=>{u(m=>{const t={...m};return t[d]={...t[d]},t[d][o]={...t[d][o],value:y,source:"manual"},N(t,a,r)})},[a,r]),i=b.useCallback((d,o)=>{l(y=>{const m=y.map(t=>t.id===d?{...t,formulaString:o}:t);return u(t=>N(t,m,r)),m})},[r]),p=b.useCallback(d=>{const o=`custom_${Date.now()}`,y={id:o,label:d,isAutoCalculated:!1,isCurrency:!0};l(m=>{const t=[...m,y];return u(f=>{const n={...f};n[o]={};for(const v of r)n[o][v.id]={value:null,isEditable:!v.isYearEnd,source:"manual"};return N(n,t,r)}),t})},[r]),j=b.useCallback(d=>{l(o=>o.filter(y=>y.id!==d)),u(o=>{const y={...o};return delete y[d],y})},[]),w=b.useCallback(d=>{const o=`col_${Date.now()}`,y={id:o,label:d};x(m=>{const t=m.findIndex(n=>n.isYearEnd),f=[...m];return f.splice(t,0,y),u(n=>{const v={...n};for(const E of a)v[E.id]={...v[E.id]},v[E.id][o]={value:null,isEditable:!E.isAutoCalculated,source:"manual"};return N(v,a,f)}),f})},[a]),_=b.useCallback(d=>{x(o=>{const y=o.filter(m=>m.id!==d);return u(m=>{const t={...m};for(const f of Object.keys(t)){const{[d]:n,...v}=t[f];t[f]=v}return N(t,a,y)}),y})},[a]),S=b.useCallback((d,o)=>{x(y=>y.map(m=>m.id===d?{...m,label:o}:m))},[]),A=b.useCallback(d=>{if(!h)return;const o=a.filter(v=>!v.isAutoCalculated),y=r.filter(v=>!v.isYearEnd),m=o.findIndex(v=>v.id===h.row),t=y.findIndex(v=>v.id===h.col);if(m===-1||t===-1)return;let f=m,n=t;switch(d){case"up":f=Math.max(0,m-1);break;case"down":f=Math.min(o.length-1,m+1);break;case"left":n=Math.max(0,t-1);break;case"right":n=Math.min(y.length-1,t+1);break}g({row:o[f].id,col:y[n].id})},[h,a,r]),c=b.useCallback(async d=>{if(d)try{const o={year:new Date().getFullYear(),data:C,rows:a,columns:r},y=localStorage.getItem("auth_token");if(!(await fetch("/api/financial-summary/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},body:JSON.stringify(o)})).ok)throw new Error("Failed to save")}catch(o){throw console.error("Save failed",o),o}},[C,a,r]);return{rows:a,columns:r,data:C,activeCell:h,setActiveCell:g,updateCell:k,addRow:p,deleteRow:j,addColumn:w,deleteColumn:_,renameColumn:S,navigateCell:A,saveData:c,updateRowFormula:i}}function Le(){const[s,a]=b.useState({from:pe(new Date),to:je(new Date)}),{rows:l,columns:r,data:x,activeCell:C,setActiveCell:u,updateCell:h,addRow:g,deleteRow:k,addColumn:i,deleteColumn:p,navigateCell:j,updateRowFormula:w}=Se(s),[_,S]=b.useState(""),[A,c]=b.useState(""),[d,o]=b.useState(!1),[y,m]=b.useState(!1),t=()=>{_.trim()&&(g(_.trim()),S(""),o(!1))},f=()=>{A.trim()&&(i(A.trim()),c(""),m(!1))};return e.jsx(ue,{noPadding:!0,fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-card/50 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(ce,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Financial Summary."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Annual budget and performance spreadsheet"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(be,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(D,{id:"date",variant:"outline",className:F("w-[260px] justify-start text-left font-normal",!s&&"text-muted-foreground"),children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),s!=null&&s.from?s.to?e.jsxs(e.Fragment,{children:[M(s.from,"LLL dd, y")," -"," ",M(s.to,"LLL dd, y")]}):M(s.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(ye,{className:"w-auto p-0",align:"end",children:e.jsx(he,{initialFocus:!0,mode:"range",defaultMonth:s==null?void 0:s.from,selected:s,onSelect:a,numberOfMonths:2,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),e.jsxs($,{open:d,onOpenChange:o,children:[e.jsx(K,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",children:[e.jsx(R,{className:"h-4 w-4 mr-1"})," Add Row"]})}),e.jsxs(H,{children:[e.jsx(z,{children:e.jsx(B,{children:"Add New Row"})}),e.jsx(I,{placeholder:"Row label...",value:_,onChange:n=>S(n.target.value),onKeyDown:n=>n.key==="Enter"&&t()}),e.jsx(J,{children:e.jsx(D,{onClick:t,disabled:!_.trim(),children:"Add"})})]})]}),e.jsxs($,{open:y,onOpenChange:m,children:[e.jsx(K,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",children:[e.jsx(R,{className:"h-4 w-4 mr-1"})," Add Column"]})}),e.jsxs(H,{children:[e.jsx(z,{children:e.jsx(B,{children:"Add New Column"})}),e.jsx(I,{placeholder:"Column label...",value:A,onChange:n=>c(n.target.value),onKeyDown:n=>n.key==="Enter"&&f()}),e.jsx(J,{children:e.jsx(D,{onClick:f,disabled:!A.trim(),children:"Add"})})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx(we,{rows:l,columns:r,data:x,activeCell:C,setActiveCell:u,updateCell:h,deleteRow:k,deleteColumn:p,navigateCell:j,updateRowFormula:w})})]})})}export{Le as default};
