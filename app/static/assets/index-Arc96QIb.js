import{c as me,ab as z,r as p,ac as fe,j as e,e as L,B as P,T as ae,k as le,l as oe,m as ne,I as V}from"./index-BifUCdhM.js";import{D as he,T as pe}from"./DashboardLayout-D6k2tTv5.js";import{D as Z,b as G,c as K,d as U,e as W,a as X}from"./dialog-BtTJBMy0.js";import{L as be}from"./label-D_IJQudO.js";import{c as xe,e as ge,C as ye,b as Ce}from"./calendar-CZ8TysIX.js";import{f as I,s as je,P as ve,a as _e,b as we}from"./popover-B73wkVcj.js";import{T as R}from"./trash-2-BHZJeD06.js";import{P as ee}from"./plus-Co-6I2s2.js";import"./users-DyRJqzpm.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=me("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);function Se(t,s){const i=z(t.start),l=z(t.end);let u=+i>+l;const c=u?+i:+l,o=u?l:i;o.setHours(0,0,0,0),o.setDate(1);let n=1;const d=[];for(;+o<=c;)d.push(z(o)),o.setMonth(o.getMonth()+n);return u?d.reverse():d}function Ae(t){const s=z(t),i=s.getFullYear();return s.setFullYear(i+1,0,0),s.setHours(23,59,59,999),s}function Ne(t,s){return xe(t,-s)}const ie=t=>{let s="";for(;t>=0;)s=String.fromCharCode(t%26+65)+s,t=Math.floor(t/26)-1;return s},te=(t,s)=>`${ie(s)}${t+1}`,de=t=>{const s=t.match(/^([A-Z]+)([0-9]+)$/);if(!s)return null;const i=s[1],l=s[2];let u=0;for(let o=0;o<i.length;o++)u=u*26+(i.charCodeAt(o)-64);return u-=1,{rowIdx:parseInt(l,10)-1,colIdx:u}},H=t=>{if(!(t!=null&&t.from)||!(t!=null&&t.to))return new Date().getFullYear(),[{id:"jan",label:"January",isProtected:!0},{id:"feb",label:"February",isProtected:!0},{id:"mar",label:"March",isProtected:!0},{id:"apr",label:"April",isProtected:!0},{id:"may",label:"May",isProtected:!0},{id:"jun",label:"June",isProtected:!0},{id:"jul",label:"July",isProtected:!0},{id:"aug",label:"August",isProtected:!0},{id:"sep",label:"September",isProtected:!0},{id:"oct",label:"October",isProtected:!0},{id:"nov",label:"November",isProtected:!0},{id:"dec",label:"December",isProtected:!0},{id:"year_end",label:"Year End",isProtected:!0,isYearEnd:!0}];const i=Se({start:fe(t.from),end:ge(t.to)}).map(l=>({id:I(l,"MMM-yyyy").toLowerCase(),label:I(l,"MMM yyyy"),isProtected:!0}));return i.push({id:"year_end",label:"Period Total",isProtected:!0,isYearEnd:!0}),i},re=(t,s,i)=>{var l,u;try{const c=Object.keys(s).sort((d,m)=>m.length-d.length);let o=t;o=o.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(d,m,y)=>{var v,k;return`(${((k=(v=s[m])==null?void 0:v[y])==null?void 0:k.value)??0})`});for(const d of c){const m=new RegExp(`\\b${d}\\b`,"g");if(m.test(o)){const y=((u=(l=s[d])==null?void 0:l[i])==null?void 0:u.value)??0;o=o.replace(m,`(${y})`)}}if(!/^[0-9+\-*/().\s]*$/.test(o))return null;const n=new Function(`return ${o}`)();return typeof n=="number"&&!isNaN(n)&&isFinite(n)?n:null}catch{return null}},B=[{id:"total_sales",label:"Total Sales",isAutoCalculated:!1,isCurrency:!0},{id:"sales_split_pct",label:"% Sales Split for the Year",isAutoCalculated:!0,isPercentage:!0,formulaString:"total_sales / total_sales:year_end"},{id:"cost_sales_se",label:"Cost of Sales SE",isAutoCalculated:!1,isCurrency:!0},{id:"cost_sales_paye",label:"Cost of Sales PAYE Gross",isAutoCalculated:!1,isCurrency:!0},{id:"employee_ni",label:"Employee NI",isAutoCalculated:!1,isCurrency:!0},{id:"employee_pension",label:"Employee Pension",isAutoCalculated:!1,isCurrency:!0},{id:"total_cost_sales",label:"Total Cost of Sales",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"cost_sales_se + cost_sales_paye + employee_ni + employee_pension"},{id:"apprenticeship_levy",label:"Apprenticeship Levy",isAutoCalculated:!1,isCurrency:!0},{id:"annual_leave",label:"Annual Leave Accrual",isAutoCalculated:!1,isCurrency:!0},{id:"other_expenses",label:"Other Expenses",isAutoCalculated:!1,isCurrency:!0},{id:"recruitment_cost",label:"Recruitment & Pass Cost",isAutoCalculated:!1,isCurrency:!0},{id:"overheads_mgmt",label:"Mgmt & Office Cost",isAutoCalculated:!1,isCurrency:!0},{id:"bank_interest",label:"Bank Interest",isAutoCalculated:!1,isCurrency:!0},{id:"cooperation_tax",label:"Cooperation Tax",isAutoCalculated:!1,isCurrency:!0},{id:"total_overheads",label:"Total Overheads",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"apprenticeship_levy + annual_leave + other_expenses + recruitment_cost + overheads_mgmt + bank_interest + cooperation_tax"},{id:"total_cost",label:"Total Cost",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"total_cost_sales + total_overheads"},{id:"avg_hourly_charge",label:"Avg Hourly Charge",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_pay",label:"Gross Hourly Pay",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_margin",label:"Gross Hourly Margin",isAutoCalculated:!0,isCurrency:!0,formulaString:"avg_hourly_charge - gross_hourly_pay"},{id:"net_cost_per_hour",label:"Net Cost per Hour",isAutoCalculated:!1,isCurrency:!0},{id:"gross_pl_value",label:"Gross P&L",isAutoCalculated:!1,isCurrency:!0},{id:"net_pl",label:"Net P&L",isAutoCalculated:!1,isCurrency:!0},{id:"total_net_margin",label:"Total Net Margin",isAutoCalculated:!1,isPercentage:!0},{id:"worked_hours",label:"Worked Hours",isAutoCalculated:!1},{id:"hours_breakeven",label:"Hours for Breakeven",isAutoCalculated:!0,formula:(t,s,i)=>{var c,o,n,d;const l=((o=(c=t.total_cost)==null?void 0:c[i])==null?void 0:o.value)??0,u=((d=(n=t.gross_hourly_margin)==null?void 0:n[i])==null?void 0:d.value)??0;return u!==0?l/u:0}},{id:"value_breakeven",label:"Total Value for Breakeven",isAutoCalculated:!0,isCurrency:!0,formulaString:"hours_breakeven * avg_hourly_charge"},{id:"sales_budget_2026",label:"Projeted Sales Budget 30% Uplift",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales * 1.3"},{id:"avg_hourly_charge_2026",label:"Average Hourly Charge Rate Future",isAutoCalculated:!1,isCurrency:!0},{id:"sales_target_hours",label:"Sales Target in Hours",isAutoCalculated:!1},{id:"variance_2025",label:"Variance",isAutoCalculated:!1,isCurrency:!0}];function se(t,s){const i={};for(const l of t){i[l.id]={};for(const u of s)i[l.id][u.id]={value:null,isEditable:!l.isAutoCalculated&&!u.isYearEnd,source:"manual"}}return i}function F(t,s,i){const l=JSON.parse(JSON.stringify(t)),u=i.filter(n=>!n.isYearEnd),c=i.find(n=>n.isYearEnd);for(const n of u)for(const d of s)d.id!=="sales_split_pct"&&(d.formulaString?l[d.id][n.id]={...l[d.id][n.id],value:re(d.formulaString,l,n.id),isEditable:!1,source:"formula"}:d.formula&&(l[d.id][n.id]={...l[d.id][n.id],value:d.formula(l,d.id,n.id),isEditable:!1,source:"formula"}));if(c)for(const n of s){if(n.id==="sales_split_pct")continue;const d=u.reduce((m,y)=>{var w,v;return m+(((v=(w=l[n.id])==null?void 0:w[y.id])==null?void 0:v.value)??0)},0);l[n.id][c.id]={value:d,isEditable:!1,source:"calculated"}}const o=s.find(n=>n.id==="sales_split_pct");if(o&&o.formulaString&&c){for(const n of u){const d=re(o.formulaString,l,n.id);l[o.id][n.id]={value:d?d*100:0,isEditable:!1,source:"formula"}}l[o.id][c.id]={value:100,isEditable:!1,source:"calculated"}}return l}function De(t){const[s,i]=p.useState(B),[l,u]=p.useState(()=>H(t)),[c,o]=p.useState(()=>F(se(B,H(t)),B,H(t))),[n,d]=p.useState(null);p.useEffect(()=>{const f=H(t);u(f);let r=se(s,f);t!=null&&t.from&&(t!=null&&t.to)?(async()=>{try{const x=I(t.from,"yyyy-MM-dd"),h=I(t.to,"yyyy-MM-dd"),_=localStorage.getItem("auth_token"),C=await fetch(`http://localhost:5000/api/financial-summary/metrics?start=${x}&end=${h}`,{headers:{Authorization:`Bearer ${_}`}});if(C.ok){const a=await C.json(),g={January:"jan",February:"feb",March:"mar",April:"apr",May:"may",June:"jun",July:"jul",August:"aug",September:"sep",October:"oct",November:"nov",December:"dec"};for(const[S,j]of Object.entries(a)){const[O,T]=S.split("-"),$=g[T];if(!$)continue;const A=`${$}-${O}`;f.find(Y=>Y.id===A)&&(r.total_sales&&r.total_sales[A]&&(r.total_sales[A].value=j.total_sales,r.total_sales[A].source="database"),r.cost_sales_paye&&r.cost_sales_paye[A]&&(r.cost_sales_paye[A].value=j.cost_sales_paye,r.cost_sales_paye[A].source="database"))}o(F(r,s,f))}else o(F(r,s,f))}catch(x){console.error("Failed to fetch metrics",x),o(F(r,s,f))}})():o(F(r,s,f))},[t]);const m=p.useCallback((f,r,b)=>{o(x=>{const h={...x};return h[f]={...h[f]},h[f][r]={...h[f][r],value:b,source:"manual"},F(h,s,l)})},[s,l]),y=p.useCallback((f,r)=>{i(b=>{const x=b.map(h=>h.id===f?{...h,formulaString:r}:h);return o(h=>F(h,x,l)),x})},[l]),w=p.useCallback(f=>{const r=`custom_${Date.now()}`,b={id:r,label:f,isAutoCalculated:!1,isCurrency:!0};i(x=>{const h=[...x,b];return o(_=>{const C={..._};C[r]={};for(const a of l)C[r][a.id]={value:null,isEditable:!a.isYearEnd,source:"manual"};return F(C,h,l)}),h})},[l]),v=p.useCallback(f=>{i(r=>r.filter(b=>b.id!==f)),o(r=>{const b={...r};return delete b[f],b})},[]),k=p.useCallback(f=>{const r=`col_${Date.now()}`,b={id:r,label:f};u(x=>{const h=x.findIndex(C=>C.isYearEnd),_=[...x];return _.splice(h,0,b),o(C=>{const a={...C};for(const g of s)a[g.id]={...a[g.id]},a[g.id][r]={value:null,isEditable:!g.isAutoCalculated,source:"manual"};return F(a,s,_)}),_})},[s]),M=p.useCallback(f=>{u(r=>{const b=r.filter(x=>x.id!==f);return o(x=>{const h={...x};for(const _ of Object.keys(h)){const{[f]:C,...a}=h[_];h[_]=a}return F(h,s,b)}),b})},[s]),N=p.useCallback((f,r)=>{u(b=>b.map(x=>x.id===f?{...x,label:r}:x))},[]),D=p.useCallback(f=>{if(!n)return;const r=s.filter(a=>!a.isAutoCalculated),b=l.filter(a=>!a.isYearEnd),x=r.findIndex(a=>a.id===n.row),h=b.findIndex(a=>a.id===n.col);if(x===-1||h===-1)return;let _=x,C=h;switch(f){case"up":_=Math.max(0,x-1);break;case"down":_=Math.min(r.length-1,x+1);break;case"left":C=Math.max(0,h-1);break;case"right":C=Math.min(b.length-1,h+1);break}d({row:r[_].id,col:b[C].id})},[n,s,l]),E=p.useCallback(async f=>{if(f)try{const r={year:new Date().getFullYear(),data:c,rows:s,columns:l},b=localStorage.getItem("auth_token");if(!(await fetch("http://localhost:5000/api/financial-summary/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(r)})).ok)throw new Error("Failed to save")}catch(r){throw console.error("Save failed",r),r}},[c,s,l]);return{rows:s,columns:l,data:c,activeCell:n,setActiveCell:d,updateCell:m,addRow:w,deleteRow:v,addColumn:k,deleteColumn:M,renameColumn:N,navigateCell:D,saveData:E,updateRowFormula:y}}function ue(t,s){return t===null||t===0?"":s.isPercentage?`${t.toFixed(2)}% `:s.isCurrency?`Â£${t.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})} `:t.toLocaleString("en-GB",{maximumFractionDigits:2})}const J=(t,s,i,l)=>{if(!t)return"";const u=i.findIndex(m=>m.id===l),c=new Map(s.map((m,y)=>[m.id,y])),o=new Map(i.map((m,y)=>[m.id,y]));let n=t;n=n.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(m,y,w)=>{const v=c.get(y),k=o.get(w);return v!==void 0&&k!==void 0?te(v,k):m});const d=Array.from(c.keys()).sort((m,y)=>y.length-m.length);for(const m of d){const y=new RegExp(`\\b${m} \\b`,"g");if(y.test(n)){const w=c.get(m);n=n.replace(y,te(w,u))}}return n},Ee=(t,s,i,l)=>{if(!t)return"";let u=t;const c=i.findIndex(o=>o.id===l);return u=u.replace(/\b([A-Z]+)([0-9]+)\b/g,o=>{const n=de(o);if(!n)return o;const d=s[n.rowIdx],m=i[n.colIdx];return!d||!m?o:n.colIdx===c?d.id:`${d.id}:${m.id} `}),u};function ce({source:t,formula:s,displayFormula:i,value:l}){return e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Source:"})," ",t==="backend"?"Database":t||"Unknown"]}),i&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Formula:"}),e.jsx("code",{className:"bg-muted px-1 rounded ml-1",children:i})]})]})}function Me({rowId:t,colId:s,value:i,row:l,isActive:u,source:c,isHighlighted:o,onFocus:n,onUpdate:d,onNavigate:m,onHover:y}){const[w,v]=p.useState(!1),[k,M]=p.useState(""),N=p.useRef(null),D=p.useCallback(()=>{v(!0),M(i!==null?String(i):""),setTimeout(()=>{var r;return(r=N.current)==null?void 0:r.focus()},0)},[i]),E=p.useCallback(()=>{v(!1);const r=parseFloat(k);d(k===""?null:isNaN(r)?i:r)},[k,d,i]),f=r=>{w?r.key==="Enter"||r.key==="Tab"?(r.preventDefault(),E(),m(r.shiftKey?"up":"down")):r.key==="Escape"&&v(!1):r.key==="Enter"||r.key==="F2"?(r.preventDefault(),D()):r.key==="ArrowUp"?(r.preventDefault(),m("up")):r.key==="ArrowDown"?(r.preventDefault(),m("down")):r.key==="ArrowLeft"?(r.preventDefault(),m("left")):r.key==="ArrowRight"?(r.preventDefault(),m("right")):r.key==="Delete"||r.key==="Backspace"?(r.preventDefault(),d(null)):/^[0-9.\-]$/.test(r.key)&&(r.preventDefault(),M(r.key),v(!0),setTimeout(()=>{var b;return(b=N.current)==null?void 0:b.focus()},0))};return e.jsx(ae,{children:e.jsxs(le,{delayDuration:500,children:[e.jsx(oe,{asChild:!0,children:e.jsxs("td",{className:L("border border-border px-2 py-1 text-right text-sm min-w-[110px] cursor-cell transition-colors relative",u&&"ring-2 ring-primary ring-inset bg-primary/5",!u&&"hover:bg-muted/50",c==="database"&&"bg-blue-50/30 dark:bg-blue-900/10",c==="formula"&&"bg-purple-50/30 dark:bg-purple-900/10",o&&"ring-2 ring-orange-400 bg-orange-100/20"),onClick:n,onDoubleClick:D,onKeyDown:f,onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),tabIndex:0,onFocus:n,children:[c==="database"&&e.jsx("div",{className:"absolute top-0 right-0 w-1.5 h-1.5 bg-blue-400 rounded-bl-sm opacity-50"}),w?e.jsx("input",{ref:N,type:"text",value:k,onChange:r=>M(r.target.value),onBlur:E,className:"w-full bg-transparent text-right outline-none text-sm font-mono"}):e.jsx("span",{className:"font-mono text-sm",children:ue(i,l)})]})}),e.jsx(ne,{children:e.jsx(ce,{source:c,value:i})})]})})}function Fe({value:t,row:s,source:i,formula:l,displayFormula:u,isHighlighted:c,onHover:o}){return e.jsx(ae,{children:e.jsxs(le,{delayDuration:500,children:[e.jsx(oe,{asChild:!0,children:e.jsxs("td",{className:L("border border-border px-2 py-1 text-right text-sm min-w-[110px] relative",s.isHeader?"bg-primary/10 font-semibold":"bg-muted/30",i==="calculated"&&"bg-orange-50/30 dark:bg-orange-900/10",c&&"ring-2 ring-orange-400 bg-orange-100/20"),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[l&&e.jsx("div",{className:"absolute top-0 right-0 w-1.5 h-1.5 bg-orange-400 rounded-bl-sm opacity-50"}),e.jsx("span",{className:"font-mono text-sm",children:ue(t,s)})]})}),e.jsx(ne,{children:e.jsx(ce,{source:i,displayFormula:u,value:t})})]})})}function Pe({isOpen:t,onClose:s,row:i,initialFormula:l,onSave:u}){const[c,o]=p.useState(l);return p.useEffect(()=>{o(l)},[l]),i?e.jsx(Z,{open:t,onOpenChange:n=>!n&&s(),children:e.jsxs(G,{children:[e.jsx(K,{children:e.jsxs(U,{children:["Edit Formula: ",i.label]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(be,{htmlFor:"formula",className:"text-right",children:"Formula"}),e.jsx(V,{id:"formula",value:c,onChange:n=>o(n.target.value),className:"col-span-3 font-mono"})]}),e.jsx("div",{className:"text-xs text-muted-foreground ml-[25%]",children:"Supported: A1, B2, +, -, *, /, ( )"})]}),e.jsx(W,{children:e.jsx(P,{type:"submit",onClick:()=>u(c),children:"Save changes"})})]})}):null}function Ie({rows:t,columns:s,data:i,activeCell:l,setActiveCell:u,updateCell:c,deleteRow:o,deleteColumn:n,navigateCell:d,onRenameColumn:m,updateRowFormula:y}){const[w,v]=p.useState(null),[k,M]=p.useState(""),N=p.useRef(null),[D,E]=p.useState(null),[f,r]=p.useState(new Set),b=a=>{v(a.id),M(a.label),setTimeout(()=>{var g;return(g=N.current)==null?void 0:g.focus()},0)},x=()=>{w&&m&&m(w,k),v(null)},h=a=>{E(a)},_=a=>{if(D&&y){const g=Ee(a,t,s,s[0].id);y(D.id,g)}E(null)},C=p.useCallback((a,g,S)=>{if(!S){r(new Set);return}const j=a.formulaString;if(!j)return;const O=J(j,t,s,g),T=new Set,$=/\b[A-Z]+[0-9]+\b/g;let A;for(;(A=$.exec(O))!==null;){const Y=de(A[0]);if(Y){const q=t[Y.rowIdx],Q=s[Y.colIdx];q&&Q&&T.add(`${q.id}:${Q.id} `)}}r(T)},[t,s]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto border border-border rounded-lg bg-card max-w-full",children:e.jsxs("table",{className:"border-collapse w-full text-xs",children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"bg-muted/30 border border-border w-[50px]"}),e.jsx("th",{className:"bg-muted/30 border border-border w-[240px]"}),s.map((a,g)=>e.jsx("th",{className:"bg-muted/30 border border-border text-center font-normal text-muted-foreground",children:ie(g)},`letter - ${a.id} `)),e.jsx("th",{className:"bg-muted/30 border border-border w-16"})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 bg-muted/30 border border-border text-center text-muted-foreground font-mono w-[50px]",children:"#"}),e.jsx("th",{className:"sticky left-[50px] z-20 bg-card border border-border px-2 py-2 text-left font-semibold text-muted-foreground uppercase tracking-wider w-[240px] min-w-[240px]",children:"Description"}),s.map(a=>e.jsx("th",{className:L("sticky top-0 z-10 border border-border px-1 py-1 text-center font-semibold uppercase tracking-wider min-w-[80px]",a.isYearEnd?"bg-primary/10 text-primary":"bg-muted/50 text-muted-foreground"),onDoubleClick:()=>!a.isProtected&&b(a),children:e.jsx("div",{className:"flex items-center justify-center gap-1 h-8 group relative px-2",children:w===a.id?e.jsx("input",{ref:N,value:k,onChange:g=>M(g.target.value),onBlur:x,onKeyDown:g=>g.key==="Enter"&&x(),className:"w-full bg-background border rounded px-1 text-center"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"truncate",children:a.label}),!a.isProtected&&e.jsx(P,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 absolute -right-1 hover:text-destructive hover:bg-destructive/10",onClick:g=>{g.stopPropagation(),n(a.id)},children:e.jsx(R,{className:"h-3 w-3"})})]})})},a.id)),e.jsx("th",{className:"sticky top-0 z-10 bg-card border border-border w-16"})]})]}),e.jsx("tbody",{children:t.map((a,g)=>e.jsxs("tr",{className:L("group hover:bg-muted/20",a.isHeader&&"bg-primary/5"),children:[e.jsx("td",{className:"sticky left-0 bg-muted/30 border border-border text-center text-muted-foreground font-mono w-[50px]",children:g+1}),e.jsxs("td",{className:L("sticky left-[50px] z-10 border border-border px-2 py-1 whitespace-nowrap bg-card text-xs truncate max-w-[240px] flex items-center justify-between gap-2",a.isHeader&&"font-bold text-primary bg-primary/5",a.isAutoCalculated&&!a.isHeader&&"text-muted-foreground italic"),title:`ID: ${a.id} `,children:[e.jsx("span",{className:"truncate",children:a.label}),(a.formulaString||a.isAutoCalculated)&&e.jsx(P,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:text-primary shrink-0",title:"Edit Formula",onClick:()=>h(a),children:e.jsx(ke,{className:"h-3 w-3"})})]}),s.map(S=>{var $;const j=($=i[a.id])==null?void 0:$[S.id],O=(j==null?void 0:j.isEditable)&&!a.isAutoCalculated&&!S.isYearEnd,T=f.has(`${a.id}:${S.id} `);return O?e.jsx(Me,{rowId:a.id,colId:S.id,value:(j==null?void 0:j.value)??null,row:a,isActive:(l==null?void 0:l.row)===a.id&&(l==null?void 0:l.col)===S.id,source:j==null?void 0:j.source,isHighlighted:T,onFocus:()=>u({row:a.id,col:S.id}),onUpdate:A=>c(a.id,S.id,A),onNavigate:d,onHover:A=>C(a,S.id,A)},S.id):e.jsx(Fe,{value:(j==null?void 0:j.value)??null,row:a,source:j==null?void 0:j.source,formula:a.formulaString,displayFormula:J(a.formulaString||"",t,s,S.id),isHighlighted:T,onHover:A=>C(a,S.id,A)},S.id)}),e.jsx("td",{className:"border border-border bg-card w-16 text-center p-0",children:!a.isAutoCalculated&&e.jsx(P,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:text-destructive",onClick:()=>o(a.id),children:e.jsx(R,{className:"h-3 w-3"})})})]},a.id))})]})}),D&&e.jsx(Pe,{isOpen:!0,onClose:()=>E(null),row:D,initialFormula:J(D.formulaString||"",t,s,s[0].id),onSave:_})]})}function Ve(){const[t,s]=p.useState({from:je(Ne(new Date,1)),to:Ae(new Date)}),{rows:i,columns:l,data:u,activeCell:c,setActiveCell:o,updateCell:n,addRow:d,deleteRow:m,addColumn:y,deleteColumn:w,navigateCell:v,renameColumn:k,saveData:M}=De(t),[N,D]=p.useState(""),[E,f]=p.useState(""),[r,b]=p.useState(!1),[x,h]=p.useState(!1);p.useState(!1);const _=()=>{N.trim()&&(d(N.trim()),D(""),b(!1))},C=()=>{E.trim()&&(y(E.trim()),f(""),h(!1))},a=t!=null&&t.from&&(t!=null&&t.to)?`Financial Summary for ${I(t.from,"MMM yyyy")} - ${I(t.to,"MMM yyyy")}`:"Financial Summary";return e.jsx(he,{noPadding:!0,fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-card/50 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(pe,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:a}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Annual budget and performance spreadsheet"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ve,{children:[e.jsx(_e,{asChild:!0,children:e.jsxs(P,{variant:"outline",className:L("w-[240px] justify-start text-left font-normal",!t&&"text-muted-foreground"),children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),t!=null&&t.from?t.to?e.jsxs(e.Fragment,{children:[I(t.from,"LLL dd, y")," -"," ",I(t.to,"LLL dd, y")]}):I(t.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(we,{className:"w-auto p-0",align:"end",children:e.jsx(Ce,{initialFocus:!0,mode:"range",defaultMonth:t==null?void 0:t.from,selected:t,onSelect:s,numberOfMonths:2,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),e.jsxs(Z,{open:r,onOpenChange:b,children:[e.jsx(X,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"})," Add Row"]})}),e.jsxs(G,{children:[e.jsx(K,{children:e.jsx(U,{children:"Add New Row"})}),e.jsx(V,{placeholder:"Row label...",value:N,onChange:g=>D(g.target.value),onKeyDown:g=>g.key==="Enter"&&_()}),e.jsx(W,{children:e.jsx(P,{onClick:_,disabled:!N.trim(),children:"Add"})})]})]}),e.jsxs(Z,{open:x,onOpenChange:h,children:[e.jsx(X,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"})," Add Column"]})}),e.jsxs(G,{children:[e.jsx(K,{children:e.jsx(U,{children:"Add New Column"})}),e.jsx(V,{placeholder:"Column label...",value:E,onChange:g=>f(g.target.value),onKeyDown:g=>g.key==="Enter"&&C()}),e.jsx(W,{children:e.jsx(P,{onClick:C,disabled:!E.trim(),children:"Add"})})]})]}),e.jsx(P,{variant:"default",size:"sm",onClick:()=>M(!0),children:"Save Changes"})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx(Ie,{rows:i,columns:l,data:u,activeCell:c,setActiveCell:o,updateCell:n,deleteRow:m,deleteColumn:w,navigateCell:v,onRenameColumn:k})})]})})}export{Ve as default};
