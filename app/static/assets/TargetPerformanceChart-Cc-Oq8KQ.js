import{r as S,R as j,ac as be,a as ge,A as G,j as i}from"./index-CbhCuN3x.js";import{f as ne}from"./popover-ByODH2su.js";import{C as R,a as L,b as M,d as F}from"./card-DtGcmnaw.js";import{a7 as ie,a8 as Ae,Q as J,O as N,a9 as je,P as Pe,aa as I,ab as Oe,ac as le,ad as Se,S as k,ae as we,J as Te,af as Ee,ag as T,ah as _e,a0 as Ce,a4 as Ne,ai as oe,V as De,a2 as Ke,A as B,B as $,X as Q,Y as ee,a3 as $e,R as ue,C as pe,T as fe,L as de}from"./generateCategoricalChart-BC9b7UUs.js";import{L as ze,B as Ie}from"./BarChart-BZE-3T7r.js";function E(t){"@babel/helpers - typeof";return E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(t)}function ke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Be(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ye(r.key),r)}}function Re(t,e,a){return e&&Be(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Le(t,e,a){return e=H(e),Me(t,me()?Reflect.construct(e,a||[],H(t).constructor):e.apply(t,a))}function Me(t,e){if(e&&(E(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fe(t)}function Fe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function me(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(me=function(){return!!t})()}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},H(t)}function He(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U(t,e)}function U(t,e){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},U(t,e)}function he(t,e,a){return e=ye(e),e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function ye(t){var e=We(t,"string");return E(e)=="symbol"?e:e+""}function We(t,e){if(E(t)!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e||"default");if(E(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Z=function(t){function e(){return ke(this,e),Le(this,e,arguments)}return He(e,t),Re(e,[{key:"render",value:function(){return null}}])}(S.Component);he(Z,"displayName","ZAxis");he(Z,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var Ze=["option","isActive"];function D(){return D=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},D.apply(this,arguments)}function Ve(t,e){if(t==null)return{};var a=Ye(t,e),r,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}function Ye(t,e){if(t==null)return{};var a={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;a[r]=t[r]}return a}function qe(t){var e=t.option,a=t.isActive,r=Ve(t,Ze);return typeof e=="string"?S.createElement(ie,D({option:S.createElement(Ae,D({type:e},r)),isActive:a,shapeType:"symbols"},r)):S.createElement(ie,D({option:e,isActive:a,shapeType:"symbols"},r))}function _(t){"@babel/helpers - typeof";return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(t)}function K(){return K=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},K.apply(this,arguments)}function se(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),a.push.apply(a,r)}return a}function P(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?se(Object(a),!0).forEach(function(r){O(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):se(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Ge(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ce(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xe(r.key),r)}}function Je(t,e,a){return e&&ce(t.prototype,e),a&&ce(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ue(t,e,a){return e=W(e),Xe(t,ve()?Reflect.construct(e,a||[],W(t).constructor):e.apply(t,a))}function Xe(t,e){if(e&&(_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Qe(t)}function Qe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ve(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ve=function(){return!!t})()}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},W(t)}function et(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},X(t,e)}function O(t,e,a){return e=xe(e),e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function xe(t){var e=tt(t,"string");return _(e)=="symbol"?e:e+""}function tt(t,e){if(_(t)!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var r=a.call(t,e||"default");if(_(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var V=function(t){function e(){var a;Ge(this,e);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return a=Ue(this,e,[].concat(n)),O(a,"state",{isAnimationFinished:!1}),O(a,"handleAnimationEnd",function(){a.setState({isAnimationFinished:!0})}),O(a,"handleAnimationStart",function(){a.setState({isAnimationFinished:!1})}),O(a,"id",De("recharts-scatter-")),a}return et(e,t),Je(e,[{key:"renderSymbolsStatically",value:function(r){var n=this,o=this.props,d=o.shape,g=o.activeShape,v=o.activeIndex,m=J(this.props,!1);return r.map(function(s,l){var p=v===l,u=p?g:d,x=P(P({},m),s);return j.createElement(N,K({className:"recharts-scatter-symbol",key:"symbol-".concat(s==null?void 0:s.cx,"-").concat(s==null?void 0:s.cy,"-").concat(s==null?void 0:s.size,"-").concat(l)},je(n.props,s,l),{role:"img"}),j.createElement(qe,K({option:u,isActive:p,key:"symbol-".concat(l)},x)))})}},{key:"renderSymbolsWithAnimation",value:function(){var r=this,n=this.props,o=n.points,d=n.isAnimationActive,g=n.animationBegin,v=n.animationDuration,m=n.animationEasing,s=n.animationId,l=this.state.prevPoints;return j.createElement(Pe,{begin:g,duration:v,isActive:d,easing:m,from:{t:0},to:{t:1},key:"pie-".concat(s),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(p){var u=p.t,x=o.map(function(f,h){var y=l&&l[h];if(y){var b=I(y.cx,f.cx),c=I(y.cy,f.cy),A=I(y.size,f.size);return P(P({},f),{},{cx:b(u),cy:c(u),size:A(u)})}var w=I(0,f.size);return P(P({},f),{},{size:w(u)})});return j.createElement(N,null,r.renderSymbolsStatically(x))})}},{key:"renderSymbols",value:function(){var r=this.props,n=r.points,o=r.isAnimationActive,d=this.state.prevPoints;return o&&n&&n.length&&(!d||!Oe(d,n))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(n)}},{key:"renderErrorBar",value:function(){var r=this.props.isAnimationActive;if(r&&!this.state.isAnimationFinished)return null;var n=this.props,o=n.points,d=n.xAxis,g=n.yAxis,v=n.children,m=le(v,Se);return m?m.map(function(s,l){var p=s.props,u=p.direction,x=p.dataKey;return j.cloneElement(s,{key:"".concat(u,"-").concat(x,"-").concat(o[l]),data:o,xAxis:d,yAxis:g,layout:u==="x"?"vertical":"horizontal",dataPointFormatter:function(h,y){return{x:h.cx,y:h.cy,value:u==="x"?+h.node.x:+h.node.y,errorVal:k(h,y)}}})}):null}},{key:"renderLine",value:function(){var r=this.props,n=r.points,o=r.line,d=r.lineType,g=r.lineJointType,v=J(this.props,!1),m=J(o,!1),s,l;if(d==="joint")s=n.map(function(c){return{x:c.cx,y:c.cy}});else if(d==="fitting"){var p=we(n),u=p.xmin,x=p.xmax,f=p.a,h=p.b,y=function(A){return f*A+h};s=[{x:u,y:y(u)},{x,y:y(x)}]}var b=P(P(P({},v),{},{fill:"none",stroke:v&&v.fill},m),{},{points:s});return j.isValidElement(o)?l=j.cloneElement(o,b):Te(o)?l=o(b):l=j.createElement(Ee,K({},b,{type:g})),j.createElement(N,{className:"recharts-scatter-line",key:"recharts-scatter-line"},l)}},{key:"render",value:function(){var r=this.props,n=r.hide,o=r.points,d=r.line,g=r.className,v=r.xAxis,m=r.yAxis,s=r.left,l=r.top,p=r.width,u=r.height,x=r.id,f=r.isAnimationActive;if(n||!o||!o.length)return null;var h=this.state.isAnimationFinished,y=be("recharts-scatter",g),b=v&&v.allowDataOverflow,c=m&&m.allowDataOverflow,A=b||c,w=T(x)?this.id:x;return j.createElement(N,{className:y,clipPath:A?"url(#clipPath-".concat(w,")"):null},b||c?j.createElement("defs",null,j.createElement("clipPath",{id:"clipPath-".concat(w)},j.createElement("rect",{x:b?s:s-p/2,y:c?l:l-u/2,width:b?p:p*2,height:c?u:u*2}))):null,d&&this.renderLine(),this.renderErrorBar(),j.createElement(N,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!f||h)&&_e.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:n.curPoints}:r.points!==n.curPoints?{curPoints:r.points}:null}}])}(S.PureComponent);O(V,"displayName","Scatter");O(V,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Ce.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});O(V,"getComposedData",function(t){var e=t.xAxis,a=t.yAxis,r=t.zAxis,n=t.item,o=t.displayedData,d=t.xAxisTicks,g=t.yAxisTicks,v=t.offset,m=n.props.tooltipType,s=le(n.props.children,Ne),l=T(e.dataKey)?n.props.dataKey:e.dataKey,p=T(a.dataKey)?n.props.dataKey:a.dataKey,u=r&&r.dataKey,x=r?r.range:Z.defaultProps.range,f=x&&x[0],h=e.scale.bandwidth?e.scale.bandwidth():0,y=a.scale.bandwidth?a.scale.bandwidth():0,b=o.map(function(c,A){var w=k(c,l),te=k(c,p),C=!T(u)&&k(c,u)||"-",re=[{name:T(e.dataKey)?n.props.name:e.name||e.dataKey,unit:e.unit||"",value:w,payload:c,dataKey:l,type:m},{name:T(a.dataKey)?n.props.name:a.name||a.dataKey,unit:a.unit||"",value:te,payload:c,dataKey:p,type:m}];C!=="-"&&re.push({name:r.name||r.dataKey,unit:r.unit||"",value:C,payload:c,dataKey:u,type:m});var Y=oe({axis:e,ticks:d,bandSize:h,entry:c,index:A,dataKey:l}),q=oe({axis:a,ticks:g,bandSize:y,entry:c,index:A,dataKey:p}),ae=C!=="-"?r.scale(C):f,z=Math.sqrt(Math.max(ae,0)/Math.PI);return P(P({},c),{},{cx:Y,cy:q,x:Y-z,y:q-z,xAxis:e,yAxis:a,zAxis:r,width:2*z,height:2*z,size:ae,node:{x:w,y:te,z:C},tooltipPayload:re,tooltipPosition:{x:Y,y:q},payload:c},s&&s[A]&&s[A].props)});return P({points:b},v)});var rt=Ke({chartName:"ComposedChart",GraphicalChild:[ze,B,$,V],axisComponents:[{axisType:"xAxis",AxisComp:Q},{axisType:"yAxis",AxisComp:ee},{axisType:"zAxis",AxisComp:Z}],formatAxisMap:$e});const ut=(t,e,a)=>{const[r,n]=S.useState(null),[o,d]=S.useState(!1),{toast:g}=ge(),v=async()=>{d(!0);try{const m=new URLSearchParams({start:ne(t.from,"yyyy-MM-dd"),end:ne(t.to,"yyyy-MM-dd")});e&&e.length>0&&e.forEach(f=>m.append("locations",f)),a&&a.length>0&&a.forEach(f=>m.append("sites",f));const s=m.toString(),l={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},[p,u,x]=await Promise.all([fetch(`${G.SALES_SUMMARY.replace("sales-summary","operational-summary")}?${s}`,{headers:l}),fetch(`${G.CLIENT_DISTRIBUTION}?${s}`,{headers:l}),fetch(`${G.TARGET_ACHIEVEMENT_TREND}?${s}`,{headers:l})]);if(p.ok){const f=await p.json();if(u.ok){const h=await u.json();h.timeSeries&&(f.timeSeries=f.timeSeries.map(y=>{const b=y.period.substring(0,7),c=h.timeSeries.find(A=>A.period===b);return{...y,clientCount:c?c.clientCount:0}}))}if(x.ok){const h=await x.json();h.data&&(f.timeSeries=f.timeSeries.map(y=>{const b=y.period.substring(0,7),c=h.data.find(A=>A.period===b);return{...y,achievementPercentage:c?c.achievementPercentage:0}}))}n(f)}else g({title:"Error",description:"Could not fetch operational data",variant:"destructive"})}catch(m){console.error(m),g({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{d(!1)}};return S.useEffect(()=>{v()},[t,e,a]),{operationalData:r,isLoading:o,refetch:v}},at=({active:t,payload:e,label:a})=>t&&e&&e.length?i.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[i.jsx("p",{className:"font-semibold text-foreground",children:a}),e.map((r,n)=>i.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",r.name==="Paid Hours"?r.value.toLocaleString(void 0,{maximumFractionDigits:1}):r.name==="Target Achievement"?`${r.value}%`:r.value]},n))]}):null,pt=({data:t,aggregationLevel:e,selectedMetric:a="shifts"})=>{const r={dataKey:"display",interval:0};if(!t||t.length===0)return i.jsxs(R,{className:"flex-1",children:[i.jsx(L,{children:i.jsx(M,{children:"Metric Trend"})}),i.jsx(F,{children:i.jsx("div",{className:"h-[400px] flex items-center justify-center",children:i.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const n=()=>{switch(a){case"hours":return"Paid Hours Trend";case"shifts":return"Hours & Shifts Trend";case"clients":return"Active Clients Trend";case"targetAchievement":return"Target Achievement Trend";case"missedTarget":return"Missed Target Trend";default:return"Metric Trend"}},o=()=>{switch(a){case"hours":return"Hours";case"shifts":return"Shifts";case"clients":return"Clients";case"targetAchievement":return"Percentage (%)";default:return"Count"}};return i.jsxs(R,{className:"flex-1",children:[i.jsxs(L,{children:[i.jsx(M,{children:n()}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[e==="daily"&&"Daily view",e==="weekly"&&"Weekly view",e==="monthly"&&"Monthly view"]})]}),i.jsx(F,{children:i.jsx("div",{className:"h-[400px]",children:i.jsx(ue,{width:"100%",height:"100%",children:i.jsxs(rt,{data:t,children:[i.jsx(pe,{strokeDasharray:"3 3"}),i.jsx(Q,{dataKey:r.dataKey,tick:{fontSize:12},interval:r.interval}),i.jsx(ee,{label:{value:o(),angle:-90,position:"insideLeft"}}),i.jsx(fe,{content:i.jsx(at,{})}),i.jsx(de,{}),a==="shifts"&&i.jsxs(i.Fragment,{children:[i.jsx(B,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),i.jsx($,{dataKey:"totalShifts",name:"Total Shifts",barSize:20,fill:"hsl(var(--accent))",fillOpacity:.6})]}),a==="hours"&&i.jsx(B,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),a==="clients"&&i.jsx($,{dataKey:"clientCount",name:"Active Clients",barSize:30,fill:"hsl(262, 83%, 58%)",fillOpacity:.8}),a==="targetAchievement"&&i.jsx(B,{type:"monotone",dataKey:"achievementPercentage",name:"Target Achievement",stroke:"hsl(142, 71%, 45%)",fill:"hsl(142, 71%, 45%)",fillOpacity:.2,strokeWidth:2})]})})})})]})},nt=({active:t,payload:e,label:a})=>t&&e&&e.length?i.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[i.jsx("p",{className:"font-semibold text-foreground",children:a}),e.map((r,n)=>i.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",r.value.toLocaleString()]},n))]}):null,ft=({data:t})=>{if(!t||t.length===0)return i.jsxs(R,{className:"flex-1",children:[i.jsx(L,{children:i.jsx(M,{children:"Target vs Actual Performance"})}),i.jsx(F,{children:i.jsx("div",{className:"h-[400px] flex items-center justify-center",children:i.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const e=new Map;t.forEach(n=>{const o=n.site?`${n.location} - ${n.site}`:n.location;e.has(o)||e.set(o,{actual:0,target:0});const d=e.get(o);d.actual+=n.actual||0,d.target+=n.target||0});const a=Array.from(e.entries()).map(([n,o])=>({name:n,actual:o.actual,target:o.target})).sort((n,o)=>n.name.localeCompare(o.name)),r=Math.max(400,a.length*40);return i.jsxs(R,{className:"flex-1",children:[i.jsxs(L,{children:[i.jsx(M,{children:"Target vs Actual Performance by Site"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Total shifts achieved compared to target for each location/site"})]}),i.jsx(F,{children:i.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:i.jsx("div",{style:{height:`${r}px`,minHeight:"400px"},children:i.jsx(ue,{width:"100%",height:"100%",children:i.jsxs(Ie,{data:a,layout:"vertical",margin:{top:20,right:30,left:150,bottom:20},children:[i.jsx(pe,{strokeDasharray:"3 3",horizontal:!1}),i.jsx(Q,{type:"number",domain:[0,"dataMax"],tickFormatter:n=>n.toLocaleString()}),i.jsx(ee,{type:"category",dataKey:"name",width:140,tick:{fontSize:11}}),i.jsx(fe,{content:i.jsx(nt,{})}),i.jsx(de,{}),i.jsx($,{dataKey:"target",name:"Target",fill:"#94a3b8",opacity:.7}),i.jsx($,{dataKey:"actual",name:"Actual",fill:"#3b82f6"})]})})})})})]})};export{rt as C,pt as O,V as S,ft as T,Z,ut as u};
