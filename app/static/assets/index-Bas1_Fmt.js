const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-B2A3uXYV.js","assets/index-BGPcJqAi.js","assets/index-DgSwBApk.css","assets/card-DMedEwoy.js","assets/users-m2YRWrHe.js","assets/locationUtils-BjqkTGWX.js","assets/button-B7gA5eLl.js","assets/DashboardLayout-CDJPZCwa.js","assets/ChartCanvas-D2iiutpj.js","assets/badge-Dg2Jrivk.js","assets/AreaChart-CKgPg8rO.js","assets/BarChart-Cys1auF3.js"])))=>i.map(i=>d[i]);
import{c as Me,r as n,q as G,P as _,s as re,j as t,k as $,X as at,T as nt,l as st,m as lt,n as ot,d as it,e as Te,i as ct,f as dt,h as ut,a as mt,S as ht,_ as Pe}from"./index-BGPcJqAi.js";import{R as ft,P as pt,O as xt,a as gt,D as vt}from"./DashboardLayout-CDJPZCwa.js";import{L as je}from"./label-DCr4mAXb.js";import{C as yt,u as bt,S as wt,b as St,c as jt,d as Ct,e as le}from"./select-D9Hbf5dF.js";import{B as ie}from"./button-B7gA5eLl.js";import{P as fe,b as pe,g as Ce,c as xe,j as Nt,C as Ne,f as oe,d as ke}from"./locationUtils-BjqkTGWX.js";import"./dialog-BqtJ7smK.js";import{C as kt,a as Et,b as It,d as Dt}from"./card-DMedEwoy.js";import"./users-m2YRWrHe.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=Me("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=Me("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Mt=()=>{const[e,a]=n.useState(()=>{const s=localStorage.getItem("chartBuilderState"),i={dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0};if(s)try{const x=JSON.parse(s);return{...i,dimensions:x.dimensions||[],metrics:x.metrics||[],chartType:x.chartType||"bar"}}catch(x){console.error("Error parsing saved chart builder state",x)}return i});return n.useEffect(()=>{const{dimensions:s,metrics:i,chartType:x}=e;localStorage.setItem("chartBuilderState",JSON.stringify({dimensions:s,metrics:i,chartType:x}))},[e.dimensions,e.metrics,e.chartType]),{state:e,setDimensions:s=>{a(i=>({...i,dimensions:s}))},setMetrics:s=>{a(i=>({...i,metrics:s}))},setChartType:s=>{a(i=>({...i,chartType:s}))},setDateRange:s=>{a(i=>({...i,dateRange:s}))},addCustomMetric:s=>{a(i=>({...i,customMetrics:[...i.customMetrics,s]}))},setChartData:s=>{a(i=>({...i,chartData:s}))},setDraggedItem:s=>{a(i=>({...i,draggedItem:s}))}}};var Ee=1,Tt=.9,Pt=.8,Bt=.17,ue=.1,me=.999,Lt=.9999,Ot=.99,$t=/[\\\/_+.#"@\[\(\{&]/,_t=/[\\\/_+.#"@\[\(\{&]/g,Ft=/[\s-]/,Be=/[\s-]/g;function ge(e,a,r,h,c,u,m){if(u===a.length)return c===e.length?Ee:Ot;var o=`${c},${u}`;if(m[o]!==void 0)return m[o];for(var v=h.charAt(u),s=r.indexOf(v,c),i=0,x,N,j,R;s>=0;)x=ge(e,a,r,h,s+1,u+1,m),x>i&&(s===c?x*=Ee:$t.test(e.charAt(s-1))?(x*=Pt,j=e.slice(c,s-1).match(_t),j&&c>0&&(x*=Math.pow(me,j.length))):Ft.test(e.charAt(s-1))?(x*=Tt,R=e.slice(c,s-1).match(Be),R&&c>0&&(x*=Math.pow(me,R.length))):(x*=Bt,c>0&&(x*=Math.pow(me,s-c))),e.charAt(s)!==a.charAt(u)&&(x*=Lt)),(x<ue&&r.charAt(s-1)===h.charAt(u+1)||h.charAt(u+1)===h.charAt(u)&&r.charAt(s-1)!==h.charAt(u))&&(N=ge(e,a,r,h,s+1,u+2,m),N*ue>x&&(x=N*ue)),x>i&&(i=x),s=r.indexOf(v,s+1);return m[o]=i,i}function Ie(e){return e.toLowerCase().replace(Be," ")}function zt(e,a,r){return e=r&&r.length>0?`${e+" "+r.join(" ")}`:e,ge(e,a,Ie(e),Ie(a),0,0,{})}var ee='[cmdk-group=""]',he='[cmdk-group-items=""]',qt='[cmdk-group-heading=""]',Le='[cmdk-item=""]',De=`${Le}:not([aria-disabled="true"])`,ve="cmdk-item-select",J="data-value",Vt=(e,a,r)=>zt(e,a,r),Oe=n.createContext(void 0),ae=()=>n.useContext(Oe),$e=n.createContext(void 0),be=()=>n.useContext($e),_e=n.createContext(void 0),Fe=n.forwardRef((e,a)=>{let r=Y(()=>{var l,g;return{search:"",value:(g=(l=e.value)!=null?l:e.defaultValue)!=null?g:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),h=Y(()=>new Set),c=Y(()=>new Map),u=Y(()=>new Map),m=Y(()=>new Set),o=ze(e),{label:v,children:s,value:i,onValueChange:x,filter:N,shouldFilter:j,loop:R,disablePointerSelection:A=!1,vimBindings:P=!0,...E}=e,F=G(),B=G(),q=G(),C=n.useRef(null),w=er();U(()=>{if(i!==void 0){let l=i.trim();r.current.value=l,I.emit()}},[i]),U(()=>{w(6,p)},[]);let I=n.useMemo(()=>({subscribe:l=>(m.current.add(l),()=>m.current.delete(l)),snapshot:()=>r.current,setState:(l,g,y)=>{var f,b,S,L;if(!Object.is(r.current[l],g)){if(r.current[l]=g,l==="search")d(),W(),w(1,X);else if(l==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let M=document.getElementById(q);M?M.focus():(f=document.getElementById(F))==null||f.focus()}if(w(7,()=>{var M;r.current.selectedItemId=(M=k())==null?void 0:M.id,I.emit()}),y||w(5,p),((b=o.current)==null?void 0:b.value)!==void 0){let M=g??"";(L=(S=o.current).onValueChange)==null||L.call(S,M);return}}I.emit()}},emit:()=>{m.current.forEach(l=>l())}}),[]),K=n.useMemo(()=>({value:(l,g,y)=>{var f;g!==((f=u.current.get(l))==null?void 0:f.value)&&(u.current.set(l,{value:g,keywords:y}),r.current.filtered.items.set(l,ne(g,y)),w(2,()=>{W(),I.emit()}))},item:(l,g)=>(h.current.add(l),g&&(c.current.has(g)?c.current.get(g).add(l):c.current.set(g,new Set([l]))),w(3,()=>{d(),W(),r.current.value||X(),I.emit()}),()=>{u.current.delete(l),h.current.delete(l),r.current.filtered.items.delete(l);let y=k();w(4,()=>{d(),(y==null?void 0:y.getAttribute("id"))===l&&X(),I.emit()})}),group:l=>(c.current.has(l)||c.current.set(l,new Set),()=>{u.current.delete(l),c.current.delete(l)}),filter:()=>o.current.shouldFilter,label:v||e["aria-label"],getDisablePointerSelection:()=>o.current.disablePointerSelection,listId:F,inputId:q,labelId:B,listInnerRef:C}),[]);function ne(l,g){var y,f;let b=(f=(y=o.current)==null?void 0:y.filter)!=null?f:Vt;return l?b(l,r.current.search,g):0}function W(){if(!r.current.search||o.current.shouldFilter===!1)return;let l=r.current.filtered.items,g=[];r.current.filtered.groups.forEach(f=>{let b=c.current.get(f),S=0;b.forEach(L=>{let M=l.get(L);S=Math.max(M,S)}),g.push([f,S])});let y=C.current;V().sort((f,b)=>{var S,L;let M=f.getAttribute("id"),se=b.getAttribute("id");return((S=l.get(se))!=null?S:0)-((L=l.get(M))!=null?L:0)}).forEach(f=>{let b=f.closest(he);b?b.appendChild(f.parentElement===b?f:f.closest(`${he} > *`)):y.appendChild(f.parentElement===y?f:f.closest(`${he} > *`))}),g.sort((f,b)=>b[1]-f[1]).forEach(f=>{var b;let S=(b=C.current)==null?void 0:b.querySelector(`${ee}[${J}="${encodeURIComponent(f[0])}"]`);S==null||S.parentElement.appendChild(S)})}function X(){let l=V().find(y=>y.getAttribute("aria-disabled")!=="true"),g=l==null?void 0:l.getAttribute(J);I.setState("value",g||void 0)}function d(){var l,g,y,f;if(!r.current.search||o.current.shouldFilter===!1){r.current.filtered.count=h.current.size;return}r.current.filtered.groups=new Set;let b=0;for(let S of h.current){let L=(g=(l=u.current.get(S))==null?void 0:l.value)!=null?g:"",M=(f=(y=u.current.get(S))==null?void 0:y.keywords)!=null?f:[],se=ne(L,M);r.current.filtered.items.set(S,se),se>0&&b++}for(let[S,L]of c.current)for(let M of L)if(r.current.filtered.items.get(M)>0){r.current.filtered.groups.add(S);break}r.current.filtered.count=b}function p(){var l,g,y;let f=k();f&&(((l=f.parentElement)==null?void 0:l.firstChild)===f&&((y=(g=f.closest(ee))==null?void 0:g.querySelector(qt))==null||y.scrollIntoView({block:"nearest"})),f.scrollIntoView({block:"nearest"}))}function k(){var l;return(l=C.current)==null?void 0:l.querySelector(`${Le}[aria-selected="true"]`)}function V(){var l;return Array.from(((l=C.current)==null?void 0:l.querySelectorAll(De))||[])}function Q(l){let g=V()[l];g&&I.setState("value",g.getAttribute(J))}function D(l){var g;let y=k(),f=V(),b=f.findIndex(L=>L===y),S=f[b+l];(g=o.current)!=null&&g.loop&&(S=b+l<0?f[f.length-1]:b+l===f.length?f[0]:f[b+l]),S&&I.setState("value",S.getAttribute(J))}function Z(l){let g=k(),y=g==null?void 0:g.closest(ee),f;for(;y&&!f;)y=l>0?Qt(y,ee):Zt(y,ee),f=y==null?void 0:y.querySelector(De);f?I.setState("value",f.getAttribute(J)):D(l)}let O=()=>Q(V().length-1),we=l=>{l.preventDefault(),l.metaKey?O():l.altKey?Z(1):D(1)},Se=l=>{l.preventDefault(),l.metaKey?Q(0):l.altKey?Z(-1):D(-1)};return n.createElement(_.div,{ref:a,tabIndex:-1,...E,"cmdk-root":"",onKeyDown:l=>{var g;(g=E.onKeyDown)==null||g.call(E,l);let y=l.nativeEvent.isComposing||l.keyCode===229;if(!(l.defaultPrevented||y))switch(l.key){case"n":case"j":{P&&l.ctrlKey&&we(l);break}case"ArrowDown":{we(l);break}case"p":case"k":{P&&l.ctrlKey&&Se(l);break}case"ArrowUp":{Se(l);break}case"Home":{l.preventDefault(),Q(0);break}case"End":{l.preventDefault(),O();break}case"Enter":{l.preventDefault();let f=k();if(f){let b=new Event(ve);f.dispatchEvent(b)}}}}},n.createElement("label",{"cmdk-label":"",htmlFor:K.inputId,id:K.labelId,style:rr},v),ce(e,l=>n.createElement($e.Provider,{value:I},n.createElement(Oe.Provider,{value:K},l))))}),Ut=n.forwardRef((e,a)=>{var r,h;let c=G(),u=n.useRef(null),m=n.useContext(_e),o=ae(),v=ze(e),s=(h=(r=v.current)==null?void 0:r.forceMount)!=null?h:m==null?void 0:m.forceMount;U(()=>{if(!s)return o.item(c,m==null?void 0:m.id)},[s]);let i=qe(c,u,[e.value,e.children,u],e.keywords),x=be(),N=z(w=>w.value&&w.value===i.current),j=z(w=>s||o.filter()===!1?!0:w.search?w.filtered.items.get(c)>0:!0);n.useEffect(()=>{let w=u.current;if(!(!w||e.disabled))return w.addEventListener(ve,R),()=>w.removeEventListener(ve,R)},[j,e.onSelect,e.disabled]);function R(){var w,I;A(),(I=(w=v.current).onSelect)==null||I.call(w,i.current)}function A(){x.setState("value",i.current,!0)}if(!j)return null;let{disabled:P,value:E,onSelect:F,forceMount:B,keywords:q,...C}=e;return n.createElement(_.div,{ref:re(u,a),...C,id:c,"cmdk-item":"",role:"option","aria-disabled":!!P,"aria-selected":!!N,"data-disabled":!!P,"data-selected":!!N,onPointerMove:P||o.getDisablePointerSelection()?void 0:A,onClick:P?void 0:R},e.children)}),Kt=n.forwardRef((e,a)=>{let{heading:r,children:h,forceMount:c,...u}=e,m=G(),o=n.useRef(null),v=n.useRef(null),s=G(),i=ae(),x=z(j=>c||i.filter()===!1?!0:j.search?j.filtered.groups.has(m):!0);U(()=>i.group(m),[]),qe(m,o,[e.value,e.heading,v]);let N=n.useMemo(()=>({id:m,forceMount:c}),[c]);return n.createElement(_.div,{ref:re(o,a),...u,"cmdk-group":"",role:"presentation",hidden:x?void 0:!0},r&&n.createElement("div",{ref:v,"cmdk-group-heading":"","aria-hidden":!0,id:s},r),ce(e,j=>n.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?s:void 0},n.createElement(_e.Provider,{value:N},j))))}),Ht=n.forwardRef((e,a)=>{let{alwaysRender:r,...h}=e,c=n.useRef(null),u=z(m=>!m.search);return!r&&!u?null:n.createElement(_.div,{ref:re(c,a),...h,"cmdk-separator":"",role:"separator"})}),Jt=n.forwardRef((e,a)=>{let{onValueChange:r,...h}=e,c=e.value!=null,u=be(),m=z(s=>s.search),o=z(s=>s.selectedItemId),v=ae();return n.useEffect(()=>{e.value!=null&&u.setState("search",e.value)},[e.value]),n.createElement(_.input,{ref:a,...h,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":v.listId,"aria-labelledby":v.labelId,"aria-activedescendant":o,id:v.inputId,type:"text",value:c?e.value:m,onChange:s=>{c||u.setState("search",s.target.value),r==null||r(s.target.value)}})}),Yt=n.forwardRef((e,a)=>{let{children:r,label:h="Suggestions",...c}=e,u=n.useRef(null),m=n.useRef(null),o=z(s=>s.selectedItemId),v=ae();return n.useEffect(()=>{if(m.current&&u.current){let s=m.current,i=u.current,x,N=new ResizeObserver(()=>{x=requestAnimationFrame(()=>{let j=s.offsetHeight;i.style.setProperty("--cmdk-list-height",j.toFixed(1)+"px")})});return N.observe(s),()=>{cancelAnimationFrame(x),N.unobserve(s)}}},[]),n.createElement(_.div,{ref:re(u,a),...c,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":o,"aria-label":h,id:v.listId},ce(e,s=>n.createElement("div",{ref:re(m,v.listInnerRef),"cmdk-list-sizer":""},s)))}),Gt=n.forwardRef((e,a)=>{let{open:r,onOpenChange:h,overlayClassName:c,contentClassName:u,container:m,...o}=e;return n.createElement(ft,{open:r,onOpenChange:h},n.createElement(pt,{container:m},n.createElement(xt,{"cmdk-overlay":"",className:c}),n.createElement(gt,{"aria-label":e.label,"cmdk-dialog":"",className:u},n.createElement(Fe,{ref:a,...o}))))}),Wt=n.forwardRef((e,a)=>z(r=>r.filtered.count===0)?n.createElement(_.div,{ref:a,...e,"cmdk-empty":"",role:"presentation"}):null),Xt=n.forwardRef((e,a)=>{let{progress:r,children:h,label:c="Loading...",...u}=e;return n.createElement(_.div,{ref:a,...u,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":c},ce(e,m=>n.createElement("div",{"aria-hidden":!0},m)))}),T=Object.assign(Fe,{List:Yt,Item:Ut,Input:Jt,Group:Kt,Separator:Ht,Dialog:Gt,Empty:Wt,Loading:Xt});function Qt(e,a){let r=e.nextElementSibling;for(;r;){if(r.matches(a))return r;r=r.nextElementSibling}}function Zt(e,a){let r=e.previousElementSibling;for(;r;){if(r.matches(a))return r;r=r.previousElementSibling}}function ze(e){let a=n.useRef(e);return U(()=>{a.current=e}),a}var U=typeof window>"u"?n.useEffect:n.useLayoutEffect;function Y(e){let a=n.useRef();return a.current===void 0&&(a.current=e()),a}function z(e){let a=be(),r=()=>e(a.snapshot());return n.useSyncExternalStore(a.subscribe,r,r)}function qe(e,a,r,h=[]){let c=n.useRef(),u=ae();return U(()=>{var m;let o=(()=>{var s;for(let i of r){if(typeof i=="string")return i.trim();if(typeof i=="object"&&"current"in i)return i.current?(s=i.current.textContent)==null?void 0:s.trim():c.current}})(),v=h.map(s=>s.trim());u.value(e,o,v),(m=a.current)==null||m.setAttribute(J,o),c.current=o}),c}var er=()=>{let[e,a]=n.useState(),r=Y(()=>new Map);return U(()=>{r.current.forEach(h=>h()),r.current=new Map},[e]),(h,c)=>{r.current.set(h,c),a({})}};function tr(e){let a=e.type;return typeof a=="function"?a(e.props):"render"in a?a.render(e.props):e}function ce({asChild:e,children:a},r){return e&&n.isValidElement(a)?n.cloneElement(tr(a),{ref:a.ref},r(a.props.children)):r(a)}var rr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ve=n.forwardRef(({className:e,...a},r)=>t.jsx(T,{ref:r,className:$("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...a}));Ve.displayName=T.displayName;const Ue=n.forwardRef(({className:e,...a},r)=>t.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[t.jsx(At,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),t.jsx(T.Input,{ref:r,className:$("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...a})]}));Ue.displayName=T.Input.displayName;const ar=n.forwardRef(({className:e,...a},r)=>t.jsx(T.List,{ref:r,className:$("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...a}));ar.displayName=T.List.displayName;const Ke=n.forwardRef((e,a)=>t.jsx(T.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));Ke.displayName=T.Empty.displayName;const He=n.forwardRef(({className:e,...a},r)=>t.jsx(T.Group,{ref:r,className:$("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...a}));He.displayName=T.Group.displayName;const nr=n.forwardRef(({className:e,...a},r)=>t.jsx(T.Separator,{ref:r,className:$("-mx-1 h-px bg-border",e),...a}));nr.displayName=T.Separator.displayName;const Je=n.forwardRef(({className:e,...a},r)=>t.jsx(T.Item,{ref:r,className:$("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...a}));Je.displayName=T.Item.displayName;var sr="Separator",Re="horizontal",lr=["horizontal","vertical"],Ye=n.forwardRef((e,a)=>{const{decorative:r,orientation:h=Re,...c}=e,u=or(h)?h:Re,o=r?{role:"none"}:{"aria-orientation":u==="vertical"?u:void 0,role:"separator"};return t.jsx(_.div,{"data-orientation":u,...o,...c,ref:a})});Ye.displayName=sr;function or(e){return lr.includes(e)}var Ge=Ye;const We=n.forwardRef(({className:e,orientation:a="horizontal",decorative:r=!0,...h},c)=>t.jsx(Ge,{ref:c,decorative:r,orientation:a,className:$("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...h}));We.displayName=Ge.displayName;function H({title:e,options:a,selected:r,onChange:h,placeholder:c="Select...",isLocation:u=!1}){const[m,o]=n.useState(!1),v=i=>{r.includes(i)?h(r.filter(x=>x!==i)):h([...r,i])},s=i=>{i.stopPropagation(),h([])};return t.jsxs("div",{className:"flex flex-col gap-1.5 min-w-[180px]",children:[t.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:e}),t.jsxs(fe,{open:m,onOpenChange:o,children:[t.jsx(pe,{asChild:!0,children:t.jsxs(ie,{variant:"outline",role:"combobox","aria-expanded":m,className:"w-full justify-between h-9 px-3 text-sm",children:[t.jsxs("div",{className:"flex flex-wrap gap-1 items-center overflow-hidden",children:[r.length===0&&t.jsx("span",{className:"text-muted-foreground font-normal truncate",children:c}),r.length===1&&t.jsx("span",{className:"truncate",children:u?Ce(r[0]):r[0]}),r.length>1&&t.jsxs("span",{className:"truncate",children:[r.length," selected"]})]}),t.jsxs("div",{className:"flex items-center gap-2 shrink-0 opacity-50 ml-2",children:[r.length>0&&t.jsx(at,{className:"h-3 w-3 cursor-pointer hover:opacity-100",onClick:s}),t.jsx(Rt,{className:"h-3 w-3"})]})]})}),t.jsx(xe,{className:"w-[200px] p-0",align:"start",children:t.jsxs(Ve,{children:[t.jsx(Ue,{placeholder:`Search ${e.toLowerCase()}...`}),t.jsxs(Ke,{children:["No ",e.toLowerCase()," found."]}),t.jsx(He,{className:"max-h-64 overflow-auto",children:a.map(i=>t.jsxs(Je,{value:i,onSelect:()=>v(i),children:[t.jsx(yt,{className:$("mr-2 h-4 w-4",r.includes(i)?"opacity-100":"opacity-0")}),u?t.jsx(nt,{delayDuration:300,children:t.jsxs(st,{children:[t.jsx(lt,{asChild:!0,children:t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"font-medium",children:Ce(i)}),t.jsx("span",{className:"text-[10px] text-muted-foreground truncate opacity-70",children:i})]})}),t.jsx(ot,{side:"right",children:t.jsx("p",{children:i})})]})}):i]},i))})]})})]})]})}function Ae({availableFilters:e,filters:a,onFilterChange:r,orientation:h="vertical",hideSites:c}){const u=n.useMemo(()=>{if(a.locations.length===0){const s=new Set;return e.locations.forEach(i=>{i.sites.forEach(x=>s.add(x))}),Array.from(s).sort()}else{const s=new Set;return e.locations.filter(i=>a.locations.includes(i.name)).forEach(i=>{i.sites.forEach(x=>s.add(x))}),Array.from(s).sort()}},[e.locations,a.locations]),m=s=>{r({...a,clients:s})},o=s=>{r({...a,locations:s})},v=s=>{r({...a,sites:s})};return h==="horizontal"?t.jsxs("div",{className:"flex flex-wrap items-end gap-4 p-1",children:[t.jsx("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mr-2 pb-2",children:t.jsx("span",{children:"ðŸŒªï¸ Filters:"})}),t.jsx(H,{title:"Clients",options:e.clients,selected:a.clients,onChange:m,placeholder:"All Clients"}),t.jsx(H,{title:"Locations",options:e.locations.map(s=>s.name),selected:a.locations,onChange:o,placeholder:"All Locations",isLocation:!0}),!c&&t.jsx(H,{title:"Sites",options:u,selected:a.sites,onChange:v,placeholder:"All Sites"})]}):t.jsxs(kt,{className:"h-full flex flex-col",children:[t.jsx(Et,{className:"pb-3",children:t.jsx(It,{className:"text-lg flex items-center gap-2",children:"ðŸŒªï¸ Filters"})}),t.jsxs(Dt,{className:"space-y-4 flex-1 overflow-y-auto",children:[t.jsx(H,{title:"Clients",options:e.clients,selected:a.clients,onChange:m,placeholder:"All Clients"}),t.jsx(We,{}),t.jsx(H,{title:"Locations",options:e.locations.map(s=>s.name),selected:a.locations,onChange:o,placeholder:"All Locations",isLocation:!0}),t.jsx(H,{title:"Sites",options:u,selected:a.sites,onChange:v,placeholder:"All Sites"})]})]})}var de="Switch",[ir,jr]=it(de),[cr,dr]=ir(de),Xe=n.forwardRef((e,a)=>{const{__scopeSwitch:r,name:h,checked:c,defaultChecked:u,required:m,disabled:o,value:v="on",onCheckedChange:s,form:i,...x}=e,[N,j]=n.useState(null),R=Te(a,B=>j(B)),A=n.useRef(!1),P=N?i||!!N.closest("form"):!0,[E,F]=ct({prop:c,defaultProp:u??!1,onChange:s,caller:de});return t.jsxs(cr,{scope:r,checked:E,disabled:o,children:[t.jsx(_.button,{type:"button",role:"switch","aria-checked":E,"aria-required":m,"data-state":tt(E),"data-disabled":o?"":void 0,disabled:o,value:v,...x,ref:R,onClick:dt(e.onClick,B=>{F(q=>!q),P&&(A.current=B.isPropagationStopped(),A.current||B.stopPropagation())})}),P&&t.jsx(et,{control:N,bubbles:!A.current,name:h,value:v,checked:E,required:m,disabled:o,form:i,style:{transform:"translateX(-100%)"}})]})});Xe.displayName=de;var Qe="SwitchThumb",Ze=n.forwardRef((e,a)=>{const{__scopeSwitch:r,...h}=e,c=dr(Qe,r);return t.jsx(_.span,{"data-state":tt(c.checked),"data-disabled":c.disabled?"":void 0,...h,ref:a})});Ze.displayName=Qe;var ur="SwitchBubbleInput",et=n.forwardRef(({__scopeSwitch:e,control:a,checked:r,bubbles:h=!0,...c},u)=>{const m=n.useRef(null),o=Te(m,u),v=bt(r),s=ut(a);return n.useEffect(()=>{const i=m.current;if(!i)return;const x=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(x,"checked").set;if(v!==r&&j){const R=new Event("click",{bubbles:h});j.call(i,r),i.dispatchEvent(R)}},[v,r,h]),t.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...c,tabIndex:-1,ref:o,style:{...c.style,...s,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});et.displayName=ur;function tt(e){return e?"checked":"unchecked"}var rt=Xe,mr=Ze;const ye=n.forwardRef(({className:e,...a},r)=>t.jsx(rt,{className:$("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...a,ref:r,children:t.jsx(mr,{className:$("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));ye.displayName=rt.displayName;const hr=n.lazy(()=>Pe(()=>import("./MetricPalette-B2A3uXYV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),te=n.lazy(()=>Pe(()=>import("./ChartCanvas-D2iiutpj.js"),__vite__mapDeps([8,1,2,9,10,11])));function Cr(){const{state:e,setDimensions:a,setMetrics:r,setChartType:h,setDateRange:c,setChartData:u}=Mt(),{toast:m}=mt(),[o,v]=n.useState(()=>{const d=localStorage.getItem("chartBuilderDate");if(d)try{const p=JSON.parse(d);return{from:p.from?new Date(p.from):void 0,to:p.to?new Date(p.to):void 0}}catch(p){console.error(p)}return{from:new Date,to:Nt(new Date,30)}}),[s,i]=n.useState(()=>{const d=localStorage.getItem("chartBuilderAppliedDate");if(d)try{const p=JSON.parse(d);return{from:p.from?new Date(p.from):void 0,to:p.to?new Date(p.to):void 0}}catch(p){console.error(p)}return o});n.useEffect(()=>{o&&localStorage.setItem("chartBuilderDate",JSON.stringify(o))},[o]),n.useEffect(()=>{s&&localStorage.setItem("chartBuilderAppliedDate",JSON.stringify(s))},[s]);const[x,N]=n.useState(!1),[j,R]=n.useState(!1),[A,P]=n.useState(()=>localStorage.getItem("chartBuilderSplitByLocation")==="true"),[E,F]=n.useState(()=>localStorage.getItem("chartBuilderSplitBySite")==="true");n.useEffect(()=>{localStorage.setItem("chartBuilderSplitByLocation",String(A))},[A]),n.useEffect(()=>{localStorage.setItem("chartBuilderSplitBySite",String(E))},[E]);const[B,q]=n.useState({clients:[],locations:[]}),[C,w]=n.useState({clients:[],locations:[],sites:[]});n.useEffect(()=>{(async()=>{try{const p=await fetch("/api/filters",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(p.ok){const k=await p.json();q(k)}}catch(p){console.error("Error fetching filters:",p)}})()},[]);const I=()=>{i(o)};n.useEffect(()=>{(async()=>{if(e.dimensions.length===0||e.metrics.length===0||!(s!=null&&s.from)||!(s!=null&&s.to)){u([]);return}const p=e.dimensions[0],k=e.metrics,V=oe(s.from,"yyyy-MM-dd"),Q=oe(s.to,"yyyy-MM-dd");try{const D=new URLSearchParams;D.append("start",V),D.append("end",Q),D.append("dimension",p),k.forEach(O=>D.append("metrics",O)),C.clients.forEach(O=>D.append("clients",O)),C.locations.forEach(O=>D.append("locations",O)),C.sites.forEach(O=>D.append("sites",O)),A&&D.append("split_by_location","true"),E&&D.append("split_by_site","true");const Z=await fetch(`/api/chart-data?${D.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(Z.ok){const O=await Z.json();u(O)}else console.error("Failed to fetch chart data"),u([])}catch(D){console.error("Error fetching chart data:",D),u([])}})()},[e.dimensions,e.metrics,s,C,A,E]);const{showSiteFilter:K,showSiteSplit:ne}=n.useMemo(()=>{const d=C.locations.length===0?B.locations.flatMap(k=>k.sites):B.locations.filter(k=>C.locations.includes(k.name)).flatMap(k=>k.sites),p=Array.from(new Set(d));return{showSiteFilter:p.length>1,showSiteSplit:p.length>1}},[B.locations,C.locations]),W=d=>{d.type==="dimension"?e.dimensions.includes(d.name)||(a([d.name]),m({description:`Added ${d.name} to chart`,duration:2e3})):d.type==="metric"&&(e.metrics.includes(d.name)||(r([...e.metrics,d.name]),m({description:`Added ${d.name} to chart`,duration:2e3})))},X=d=>{d.type==="dimension"?e.dimensions.includes(d.name)&&(a(e.dimensions.filter(p=>p!==d.name)),m({description:`Removed ${d.name} from chart`,duration:2e3})):d.type==="metric"&&e.metrics.includes(d.name)&&(r(e.metrics.filter(p=>p!==d.name)),m({description:`Removed ${d.name} from chart`,duration:2e3}))};return t.jsx(vt,{noPadding:!0,fullWidth:!0,children:t.jsx("div",{className:"p-2 md:p-3 h-full flex flex-col",children:t.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[t.jsx("div",{className:"sticky lg:top-0 z-30 pb-2 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-1 shadow-sm bg-background",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[t.jsx("div",{children:t.jsx("h1",{className:"text-xl font-bold",children:"Chart Builder"})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("div",{className:"w-32",children:t.jsxs(wt,{value:e.chartType,onValueChange:h,children:[t.jsx(St,{className:"h-8 text-xs",children:t.jsx(jt,{placeholder:"Chart Type"})}),t.jsxs(Ct,{children:[t.jsx(le,{value:"bar",children:"Bar Chart"}),t.jsx(le,{value:"line",children:"Line Chart"}),t.jsx(le,{value:"area",children:"Area Chart"}),t.jsx(le,{value:"pie",children:"Pie Chart"})]})]})}),t.jsxs("div",{className:"flex items-center gap-6 px-2 border-l ml-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ye,{id:"split-location",checked:A,onCheckedChange:d=>{P(d),d&&F(!1)}}),t.jsx(je,{htmlFor:"split-location",className:"text-xs font-medium cursor-pointer flex items-center gap-1.5",children:"Split by Location"})]}),ne&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ye,{id:"split-site",checked:E,onCheckedChange:d=>{F(d),d&&P(!1)}}),t.jsx(je,{htmlFor:"split-site",className:"text-xs font-medium cursor-pointer flex items-center gap-1.5",children:"Split by Site"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(fe,{open:x,onOpenChange:N,children:[t.jsx(pe,{asChild:!0,children:t.jsxs(ie,{variant:"outline",className:$("w-32 justify-start text-left font-normal h-8 text-xs",!(o!=null&&o.from)&&"text-muted-foreground"),children:[t.jsx(Ne,{className:"mr-2 h-3 w-3"}),o!=null&&o.from?oe(o.from,"MMM dd, y"):t.jsx("span",{children:"From"})]})}),t.jsx(xe,{className:"w-auto p-0",align:"start",children:t.jsx(ke,{mode:"single",selected:o==null?void 0:o.from,onSelect:d=>{v(p=>({...p,from:d})),N(!1)},defaultMonth:o==null?void 0:o.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),t.jsx("span",{className:"text-muted-foreground text-xs",children:"-"}),t.jsxs(fe,{open:j,onOpenChange:R,children:[t.jsx(pe,{asChild:!0,children:t.jsxs(ie,{variant:"outline",className:$("w-32 justify-start text-left font-normal h-8 text-xs",!(o!=null&&o.to)&&"text-muted-foreground"),children:[t.jsx(Ne,{className:"mr-2 h-3 w-3"}),o!=null&&o.to?oe(o.to,"MMM dd, y"):t.jsx("span",{children:"To"})]})}),t.jsx(xe,{className:"w-auto p-0",align:"start",children:t.jsx(ke,{mode:"single",selected:o==null?void 0:o.to,onSelect:d=>{v(p=>({...p,to:d})),R(!1)},defaultMonth:o==null?void 0:o.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030,disabled:d=>d<((o==null?void 0:o.from)||new Date(0))})})]}),t.jsx(ie,{onClick:I,size:"sm",className:"h-8 text-xs",disabled:!(o!=null&&o.from)||!(o!=null&&o.to),children:"Apply"})]})]})]})}),t.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:t.jsx(n.Suspense,{fallback:t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx(ht,{className:"h-8 w-8 rounded-full"})}),children:t.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-2 min-h-0 h-full",children:[t.jsxs("div",{className:"lg:w-72 shrink-0 h-full flex flex-col overflow-hidden",children:[t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2",children:t.jsx(Ae,{availableFilters:B,filters:C,onFilterChange:w,hideSites:!K})}),t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2",children:t.jsx(hr,{selectedDimensions:e.dimensions,selectedMetrics:e.metrics,onItemClick:W,onItemDoubleClick:X})})]}),t.jsxs("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:[t.jsx("div",{className:"shrink-0 pb-2 border-b mb-2",children:t.jsx(Ae,{availableFilters:B,filters:C,onFilterChange:w,orientation:"horizontal",hideSites:!K})}),t.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2 custom-scrollbar",children:[!A&&!E&&t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 h-full min-h-[500px]",children:t.jsx(te,{chartData:e.chartData,chartType:e.chartType,metrics:e.metrics,title:"Aggregated View"})}),A&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[C.locations.length>0?C.locations.map(d=>{const p=e.chartData.filter(k=>k.location===d);return p.length===0?null:t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(te,{chartData:p,chartType:e.chartType,metrics:e.metrics,title:d,isCompact:!0})},d)}):Array.from(new Set(e.chartData.map(d=>d.location))).map(d=>t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(te,{chartData:e.chartData.filter(p=>p.location===d),chartType:e.chartType,metrics:e.metrics,title:d,isCompact:!0})},d)),e.chartData.length===0&&t.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground bg-muted/20 rounded-xl border border-dashed",children:"No data available for selected locations"})]}),E&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[C.sites.length>0?C.sites.map(d=>{const p=e.chartData.filter(k=>k.site===d);return p.length===0?null:t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(te,{chartData:p,chartType:e.chartType,metrics:e.metrics,title:d,isCompact:!0})},d)}):Array.from(new Set(e.chartData.map(d=>d.site))).map(d=>t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(te,{chartData:e.chartData.filter(p=>p.site===d),chartType:e.chartType,metrics:e.metrics,title:d,isCompact:!0})},d)),e.chartData.length===0&&t.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground bg-muted/20 rounded-xl border border-dashed",children:"No data available for selected sites"})]})]})]})]})})})]})})})}export{Cr as default};
