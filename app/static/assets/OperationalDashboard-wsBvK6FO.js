import{r as O,R as v,d as he,a as ve,A as xe,j as a,u as be,b as ge}from"./index-C9Xvk_Mh.js";import{D as Ae,L as je}from"./DashboardLayout-Dy9fBXuT.js";import{f as J}from"./locationUtils-CzTH1835.js";import{M as L,c as Oe,D as Se,L as Pe,A as we}from"./LoadingOverlay-BNMyDbNJ.js";import{C as X,a as Q,b as ee,d as te}from"./card-DKWA8Mal.js";import{S as ne,a as Ee,G as _e,f as se,b as De,i as E,g as $,c as ie,d as q,e as C,h as Te,j as Ce,k as I,l as Ne,E as Ke,m as ze,n as Le,o as Ie,p as $e,u as Re,q as Be,A as le,B as ce,X as ue,Y as W,r as ke,R as Me,C as Fe,T as He,L as qe}from"./generateCategoricalChart-CAMbkyR6.js";import{L as We}from"./Line-CI8BG9zq.js";import{B as re}from"./button-xOT2x8Rw.js";import{T as Ge}from"./users-CiSG5V5y.js";import"./select-DiQeDqP8.js";import"./badge-yvcuWxJT.js";function _(t){"@babel/helpers - typeof";return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(t)}function Ue(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ve(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,de(n.key),n)}}function Ze(t,e,i){return e&&Ve(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ye(t,e,i){return e=R(e),Je(t,pe()?Reflect.construct(e,i||[],R(t).constructor):e.apply(t,i))}function Je(t,e){if(e&&(_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xe(t)}function Xe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pe(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pe=function(){return!!t})()}function R(t){return R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},R(t)}function Qe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&G(t,e)}function G(t,e){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},G(t,e)}function fe(t,e,i){return e=de(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function de(t){var e=et(t,"string");return _(e)=="symbol"?e:e+""}function et(t,e){if(_(t)!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var k=function(t){function e(){return Ue(this,e),Ye(this,e,arguments)}return Qe(e,t),Ze(e,[{key:"render",value:function(){return null}}])}(O.Component);fe(k,"displayName","ZAxis");fe(k,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var tt=["option","isActive"];function N(){return N=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},N.apply(this,arguments)}function nt(t,e){if(t==null)return{};var i=it(t,e),n,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function it(t,e){if(t==null)return{};var i={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;i[n]=t[n]}return i}function rt(t){var e=t.option,i=t.isActive,n=nt(t,tt);return typeof e=="string"?O.createElement(ne,N({option:O.createElement(Ee,N({type:e},n)),isActive:i,shapeType:"symbols"},n)):O.createElement(ne,N({option:e,isActive:i,shapeType:"symbols"},n))}function D(t){"@babel/helpers - typeof";return D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(t)}function K(){return K=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},K.apply(this,arguments)}function ae(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function j(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?ae(Object(i),!0).forEach(function(n){P(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ae(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function at(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oe(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ye(n.key),n)}}function ot(t,e,i){return e&&oe(t.prototype,e),i&&oe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function st(t,e,i){return e=B(e),lt(t,me()?Reflect.construct(e,i||[],B(t).constructor):e.apply(t,i))}function lt(t,e){if(e&&(D(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ct(t)}function ct(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function me(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(me=function(){return!!t})()}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},B(t)}function ut(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U(t,e)}function U(t,e){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},U(t,e)}function P(t,e,i){return e=ye(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ye(t){var e=pt(t,"string");return D(e)=="symbol"?e:e+""}function pt(t,e){if(D(t)!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(D(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var M=function(t){function e(){var i;at(this,e);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return i=st(this,e,[].concat(r)),P(i,"state",{isAnimationFinished:!1}),P(i,"handleAnimationEnd",function(){i.setState({isAnimationFinished:!0})}),P(i,"handleAnimationStart",function(){i.setState({isAnimationFinished:!1})}),P(i,"id",Re("recharts-scatter-")),i}return ut(e,t),ot(e,[{key:"renderSymbolsStatically",value:function(n){var r=this,s=this.props,d=s.shape,y=s.activeShape,u=s.activeIndex,m=q(this.props,!1);return n.map(function(o,l){var c=u===l,p=c?y:d,h=j(j({},m),o);return v.createElement(C,K({className:"recharts-scatter-symbol",key:"symbol-".concat(o==null?void 0:o.cx,"-").concat(o==null?void 0:o.cy,"-").concat(o==null?void 0:o.size,"-").concat(l)},Te(r.props,o,l),{role:"img"}),v.createElement(rt,K({option:p,isActive:c,key:"symbol-".concat(l)},h)))})}},{key:"renderSymbolsWithAnimation",value:function(){var n=this,r=this.props,s=r.points,d=r.isAnimationActive,y=r.animationBegin,u=r.animationDuration,m=r.animationEasing,o=r.animationId,l=this.state.prevPoints;return v.createElement(Ce,{begin:y,duration:u,isActive:d,easing:m,from:{t:0},to:{t:1},key:"pie-".concat(o),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(c){var p=c.t,h=s.map(function(x,b){var g=l&&l[b];if(g){var A=I(g.cx,x.cx),f=I(g.cy,x.cy),S=I(g.size,x.size);return j(j({},x),{},{cx:A(p),cy:f(p),size:S(p)})}var w=I(0,x.size);return j(j({},x),{},{size:w(p)})});return v.createElement(C,null,n.renderSymbolsStatically(h))})}},{key:"renderSymbols",value:function(){var n=this.props,r=n.points,s=n.isAnimationActive,d=this.state.prevPoints;return s&&r&&r.length&&(!d||!Ne(d,r))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(r)}},{key:"renderErrorBar",value:function(){var n=this.props.isAnimationActive;if(n&&!this.state.isAnimationFinished)return null;var r=this.props,s=r.points,d=r.xAxis,y=r.yAxis,u=r.children,m=se(u,Ke);return m?m.map(function(o,l){var c=o.props,p=c.direction,h=c.dataKey;return v.cloneElement(o,{key:"".concat(p,"-").concat(h,"-").concat(s[l]),data:s,xAxis:d,yAxis:y,layout:p==="x"?"vertical":"horizontal",dataPointFormatter:function(b,g){return{x:b.cx,y:b.cy,value:p==="x"?+b.node.x:+b.node.y,errorVal:$(b,g)}}})}):null}},{key:"renderLine",value:function(){var n=this.props,r=n.points,s=n.line,d=n.lineType,y=n.lineJointType,u=q(this.props,!1),m=q(s,!1),o,l;if(d==="joint")o=r.map(function(f){return{x:f.cx,y:f.cy}});else if(d==="fitting"){var c=ze(r),p=c.xmin,h=c.xmax,x=c.a,b=c.b,g=function(S){return x*S+b};o=[{x:p,y:g(p)},{x:h,y:g(h)}]}var A=j(j(j({},u),{},{fill:"none",stroke:u&&u.fill},m),{},{points:o});return v.isValidElement(s)?l=v.cloneElement(s,A):Le(s)?l=s(A):l=v.createElement(Ie,K({},A,{type:y})),v.createElement(C,{className:"recharts-scatter-line",key:"recharts-scatter-line"},l)}},{key:"render",value:function(){var n=this.props,r=n.hide,s=n.points,d=n.line,y=n.className,u=n.xAxis,m=n.yAxis,o=n.left,l=n.top,c=n.width,p=n.height,h=n.id,x=n.isAnimationActive;if(r||!s||!s.length)return null;var b=this.state.isAnimationFinished,g=he("recharts-scatter",y),A=u&&u.allowDataOverflow,f=m&&m.allowDataOverflow,S=A||f,w=E(h)?this.id:h;return v.createElement(C,{className:g,clipPath:S?"url(#clipPath-".concat(w,")"):null},A||f?v.createElement("defs",null,v.createElement("clipPath",{id:"clipPath-".concat(w)},v.createElement("rect",{x:A?o:o-c/2,y:f?l:l-p/2,width:A?c:c*2,height:f?p:p*2}))):null,d&&this.renderLine(),this.renderErrorBar(),v.createElement(C,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!x||b)&&$e.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,r){return n.animationId!==r.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:r.curPoints}:n.points!==r.curPoints?{curPoints:n.points}:null}}])}(O.PureComponent);P(M,"displayName","Scatter");P(M,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!_e.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});P(M,"getComposedData",function(t){var e=t.xAxis,i=t.yAxis,n=t.zAxis,r=t.item,s=t.displayedData,d=t.xAxisTicks,y=t.yAxisTicks,u=t.offset,m=r.props.tooltipType,o=se(r.props.children,De),l=E(e.dataKey)?r.props.dataKey:e.dataKey,c=E(i.dataKey)?r.props.dataKey:i.dataKey,p=n&&n.dataKey,h=n?n.range:k.defaultProps.range,x=h&&h[0],b=e.scale.bandwidth?e.scale.bandwidth():0,g=i.scale.bandwidth?i.scale.bandwidth():0,A=s.map(function(f,S){var w=$(f,l),V=$(f,c),T=!E(p)&&$(f,p)||"-",Z=[{name:E(e.dataKey)?r.props.name:e.name||e.dataKey,unit:e.unit||"",value:w,payload:f,dataKey:l,type:m},{name:E(i.dataKey)?r.props.name:i.name||i.dataKey,unit:i.unit||"",value:V,payload:f,dataKey:c,type:m}];T!=="-"&&Z.push({name:n.name||n.dataKey,unit:n.unit||"",value:T,payload:f,dataKey:p,type:m});var F=ie({axis:e,ticks:d,bandSize:b,entry:f,index:S,dataKey:l}),H=ie({axis:i,ticks:y,bandSize:g,entry:f,index:S,dataKey:c}),Y=T!=="-"?n.scale(T):x,z=Math.sqrt(Math.max(Y,0)/Math.PI);return j(j({},f),{},{cx:F,cy:H,x:F-z,y:H-z,xAxis:e,yAxis:i,zAxis:n,width:2*z,height:2*z,size:Y,node:{x:w,y:V,z:T},tooltipPayload:Z,tooltipPosition:{x:F,y:H},payload:f},o&&o[S]&&o[S].props)});return j({points:A},u)});var ft=Be({chartName:"ComposedChart",GraphicalChild:[We,le,ce,M],axisComponents:[{axisType:"xAxis",AxisComp:ue},{axisType:"yAxis",AxisComp:W},{axisType:"zAxis",AxisComp:k}],formatAxisMap:ke});const dt=(t,e)=>{const[i,n]=O.useState(null),[r,s]=O.useState(!1),{toast:d}=ve(),y=async()=>{s(!0);try{const u=new URLSearchParams({start:J(t.from,"yyyy-MM-dd"),end:J(t.to,"yyyy-MM-dd")});e&&e.length>0&&e.forEach(o=>u.append("locations",o));const m=await fetch(`${xe.SALES_SUMMARY.replace("sales-summary","operational-summary")}?${u}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(m.ok){const o=await m.json();n(o)}else d({title:"Error",description:"Could not fetch operational data",variant:"destructive"})}catch{d({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{s(!1)}};return O.useEffect(()=>{y()},[t,e]),{operationalData:i,isLoading:r,refetch:y}},mt=({metrics:t})=>a.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[a.jsx(L,{title:"Total Shifts",value:t.totalShifts.value.toLocaleString(),change:t.totalShifts.text,trend:t.totalShifts.trend}),a.jsx(L,{title:"Total Paid Hours",value:t.paidHours.value.toLocaleString(void 0,{maximumFractionDigits:1}),change:t.paidHours.text,trend:t.paidHours.trend}),a.jsx(L,{title:"Unique Employees",value:t.uniqueEmployees.value.toLocaleString(),change:t.uniqueEmployees.text,trend:t.uniqueEmployees.trend}),a.jsx(L,{title:"Avg Shift Duration",value:`${t.avgShiftDuration.value.toFixed(1)} hrs`,change:t.avgShiftDuration.text,trend:t.avgShiftDuration.trend})]}),yt=({active:t,payload:e,label:i})=>t&&e&&e.length?a.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[a.jsx("p",{className:"font-semibold text-foreground",children:i}),e.map((n,r)=>a.jsxs("p",{className:"text-sm",style:{color:n.color},children:[n.name,": ",n.name==="Paid Hours"?n.value.toLocaleString(void 0,{maximumFractionDigits:1}):n.value]},r))]}):null,ht=({data:t,aggregationLevel:e})=>{const i={dataKey:"display",interval:0};return!t||t.length===0?a.jsxs(X,{children:[a.jsx(Q,{children:a.jsx(ee,{children:"Hours & Shifts Trend"})}),a.jsx(te,{children:a.jsx("div",{className:"h-[400px] flex items-center justify-center",children:a.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):a.jsxs(X,{children:[a.jsxs(Q,{children:[a.jsx(ee,{children:"Hours & Shifts Trend"}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[e==="daily"&&"Daily view",e==="weekly"&&"Weekly view",e==="monthly"&&"Monthly view"]})]}),a.jsx(te,{children:a.jsx("div",{className:"h-[400px]",children:a.jsx(Me,{width:"100%",height:"100%",children:a.jsxs(ft,{data:t,children:[a.jsx(Fe,{strokeDasharray:"3 3"}),a.jsx(ue,{dataKey:i.dataKey,tick:{fontSize:12},interval:i.interval}),a.jsx(W,{yAxisId:"left",orientation:"left",label:{value:"Hours",angle:-90,position:"insideLeft"}}),a.jsx(W,{yAxisId:"right",orientation:"right",label:{value:"Shifts",angle:90,position:"insideRight"}}),a.jsx(He,{content:a.jsx(yt,{})}),a.jsx(qe,{}),a.jsx(le,{yAxisId:"left",type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),a.jsx(ce,{yAxisId:"right",dataKey:"totalShifts",name:"Total Shifts",barSize:20,fill:"hsl(var(--accent))",fillOpacity:.6})]})})})})]})};function _t(){const t=be(),{role:e}=ge(),[i,n]=O.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[r,s]=O.useState(!1),[d,y]=O.useState(i),[u,m]=O.useState([]),{operationalData:o,isLoading:l}=dt(i,u),c=Oe(o,i);return a.jsx(Ae,{children:a.jsxs("div",{className:"flex flex-col h-screen",children:[a.jsx(Se,{dateRange:i,onDateRangeChange:n,calendarOpen:r,onCalendarOpenChange:s,tempDateRange:d,onTempDateRangeChange:y,selectedLocations:u,onLocationsChange:m}),a.jsx("div",{className:"flex-1 overflow-auto",children:a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:e==="admin"?a.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[a.jsxs(re,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>t("/dashboard/financial"),children:[a.jsx(Ge,{className:"h-4 w-4"}),"Financial View"]}),a.jsxs(re,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[a.jsx(je,{className:"h-4 w-4"}),"Operational View"]})]}):a.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Operational Dashboard"})}),l&&a.jsx(Pe,{}),a.jsx(mt,{metrics:c}),a.jsx(we,{salesData:o}),a.jsx(ht,{data:(o==null?void 0:o.timeSeries)||[],aggregationLevel:(o==null?void 0:o.aggregationLevel)||"monthly"})]})})]})})}export{_t as default};
