const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-DA1tZVCl.js","assets/index-CtiPAVVF.js","assets/index-DNNbaSSC.css","assets/card-BZjizS8n.js","assets/trending-up-3lyi-qJd.js","assets/popover-DttDBYex.js","assets/button-BQPUCfgD.js","assets/DashboardLayout-BUY-wYOm.js","assets/users-q_i31mc8.js","assets/ChartCanvas-2IsqpAyj.js","assets/badge-CbeJdFaB.js","assets/AreaChart-BxgmIvHv.js","assets/BarChart-BnmGVAJ2.js"])))=>i.map(i=>d[i]);
import{r as i,j as e,b as y,S as R,_ as L}from"./index-CtiPAVVF.js";import{D as k}from"./DashboardLayout-BUY-wYOm.js";import{L as p}from"./label-C1VW0dm9.js";import{S as E,a as I,b as B,c as A,d as m}from"./select-D3c53IT1.js";import{B as w}from"./button-BQPUCfgD.js";import{g as z,P as D,b as C,C as N,f as h,c as b,d as S}from"./popover-DttDBYex.js";import"./users-q_i31mc8.js";const V=()=>{const[t,n]=i.useState({dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0});return{state:t,setDimensions:o=>{n(r=>({...r,dimensions:o}))},setMetrics:o=>{n(r=>({...r,metrics:o}))},setChartType:o=>{n(r=>({...r,chartType:o}))},setDateRange:o=>{n(r=>({...r,dateRange:o}))},addCustomMetric:o=>{n(r=>({...r,customMetrics:[...r.customMetrics,o]}))},setChartData:o=>{n(r=>({...r,chartData:o}))},setDraggedItem:o=>{n(r=>({...r,draggedItem:o}))}}},Y=i.lazy(()=>L(()=>import("./MetricPalette-DA1tZVCl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),$=i.lazy(()=>L(()=>import("./ChartCanvas-2IsqpAyj.js"),__vite__mapDeps([9,1,2,10,11,12])));function K(){const{state:t,setDimensions:n,setMetrics:x,setChartType:j,setDateRange:M,setChartData:d}=V(),[s,f]=i.useState({from:new Date(2022,0,20),to:z(new Date(2022,0,20),20)});i.useEffect(()=>{(async()=>{if(t.dimensions.length===0||t.metrics.length===0||!(s!=null&&s.from)||!(s!=null&&s.to)){d([]);return}const l=t.dimensions[0],_=t.metrics,T=h(s.from,"yyyy-MM-dd"),P=h(s.to,"yyyy-MM-dd");try{const c=new URLSearchParams;c.append("start",T),c.append("end",P),c.append("dimension",l),_.forEach(u=>c.append("metrics",u));const v=await fetch(`/api/chart-data?${c.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(v.ok){const u=await v.json();d(u)}else console.error("Failed to fetch chart data"),d([])}catch(c){console.error("Error fetching chart data:",c),d([])}})()},[t.dimensions,t.metrics,s]);const g=a=>{a.type==="dimension"?t.dimensions.includes(a.name)||n([a.name]):a.type==="metric"&&(t.metrics.includes(a.name)||x([...t.metrics,a.name]))},o=a=>{n(t.dimensions.filter(l=>l!==a))},r=a=>{x(t.metrics.filter(l=>l!==a))};return e.jsx(k,{children:e.jsx("div",{className:"p-4 md:p-6 h-full flex flex-col",children:e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsx("div",{className:"sticky lg:top-0 z-30 pb-4 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-2 shadow-sm bg-background",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Chart Builder"}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-base",children:"Click on metrics and dimensions to build your chart"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1",children:[e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"Chart Type"}),e.jsxs(E,{value:t.chartType,onValueChange:j,children:[e.jsx(I,{className:"w-full",children:e.jsx(B,{placeholder:"Select chart type"})}),e.jsxs(A,{children:[e.jsx(m,{value:"bar",children:"Bar Chart"}),e.jsx(m,{value:"line",children:"Line Chart"}),e.jsx(m,{value:"area",children:"Area Chart"}),e.jsx(m,{value:"pie",children:"Pie Chart"})]})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"From Date"}),e.jsxs(D,{children:[e.jsx(C,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:y("w-full justify-start text-left font-normal",!(s!=null&&s.from)&&"text-muted-foreground"),children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),s!=null&&s.from?h(s.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(b,{className:"w-auto p-0",align:"start",children:e.jsx(S,{mode:"single",selected:s==null?void 0:s.from,onSelect:a=>f(l=>({...l,from:a})),captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"To Date"}),e.jsxs(D,{children:[e.jsx(C,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:y("w-full justify-start text-left font-normal",!(s!=null&&s.to)&&"text-muted-foreground"),children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),s!=null&&s.to?h(s.to,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(b,{className:"w-auto p-0",align:"start",children:e.jsx(S,{mode:"single",selected:s==null?void 0:s.to,onSelect:a=>f(l=>({...l,to:a})),captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030,disabled:a=>a<((s==null?void 0:s.from)||new Date(0))})})]})]})]})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(R,{className:"h-8 w-8 rounded-full"})}),children:e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 min-h-0 h-full",children:[e.jsx("div",{className:"lg:w-72 shrink-0 overflow-y-auto h-full pr-2",children:e.jsx(Y,{onItemClick:g})}),e.jsx("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:e.jsx("div",{className:"bg-card rounded-lg border p-4 flex-1 flex flex-col min-h-0 overflow-y-auto",children:e.jsx($,{dimensions:t.dimensions,metrics:t.metrics,chartType:t.chartType,chartData:t.chartData,onRemoveDimension:o,onRemoveMetric:r})})})]})})})]})})})}export{K as default};
