import{c as os,h as ls,r as l,U as cs,p as ds,j as e,v as hs,P as re,q as he,w as us,e as ge,B as H,I as Te,L as ms,y as D,ab as xs,u as gs,d as fs,a3 as js,a4 as vs,a5 as ps,a6 as ys,a7 as bs,a8 as Ns,a9 as Ss,aa as Cs,A as ee}from"./index-Dxrdp36H.js";import{D as Ts}from"./DashboardLayout-_FiSklTt.js";import{C as k,d as M,a as ae,b as te}from"./card-CIO6Fz1F.js";import{c as De,R as As,I as Ls,P as Ds}from"./index-s74CjKT6.js";import{D as Rs}from"./DashboardHeader-DnDOX0Dy.js";import{u as ks,O as Ms}from"./OperationalTrendChart-2XAdJ8il.js";import{u as Fs,L as ws,R as Ps}from"./LoadingOverlay-GRxVLqfc.js";import{R as fe,C as Re,X as ke,Y as Me,T as je,B as xe,a as Fe,L as we}from"./generateCategoricalChart-ri3Yejuu.js";import{B as Pe}from"./BarChart-D3sVHyYn.js";import{P as Es,a as Is}from"./PieChart-BWKKYEfQ.js";import{T as Ee,a as Ie,b as W,c as R,d as Oe,e as T,f as Os}from"./table-B8i67xVb.js";import{P as $s}from"./pen-BIhmWmpe.js";import{T as Bs}from"./trash-2-CoESyank.js";import{D as _s,b as Vs,c as Hs,d as zs,f as Gs,e as Ks}from"./dialog-BLocrg__.js";import{L as P}from"./label-C99-vNtM.js";import{S as U,a as Y,b as q,c as J,d as $}from"./select-VqwwJu2P.js";import{u as Us}from"./useRecords-hdBFeF41.js";import{f as B}from"./popover-Ch3h_oYL.js";import"./users-CeDUzZB0.js";import"./locationUtils-C8iLvkD8.js";import"./index-Bjf7wqwk.js";import"./Line-ZLp3vvkE.js";import"./AreaChart-BYUGonvc.js";import"./useQuery-CRgH_8dU.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=os("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var ne="Tabs",[qs,Da]=ls(ne,[De]),$e=De(),[Js,ve]=qs(ne),Be=l.forwardRef((s,r)=>{const{__scopeTabs:a,value:t,onValueChange:i,defaultValue:d,orientation:h="horizontal",dir:v,activationMode:f="automatic",...b}=s,u=cs(v),[x,j]=ds({prop:t,onChange:i,defaultProp:d??"",caller:ne});return e.jsx(Js,{scope:a,baseId:hs(),value:x,onValueChange:j,orientation:h,dir:u,activationMode:f,children:e.jsx(re.div,{dir:u,"data-orientation":h,...b,ref:r})})});Be.displayName=ne;var _e="TabsList",Ve=l.forwardRef((s,r)=>{const{__scopeTabs:a,loop:t=!0,...i}=s,d=ve(_e,a),h=$e(a);return e.jsx(As,{asChild:!0,...h,orientation:d.orientation,dir:d.dir,loop:t,children:e.jsx(re.div,{role:"tablist","aria-orientation":d.orientation,...i,ref:r})})});Ve.displayName=_e;var He="TabsTrigger",ze=l.forwardRef((s,r)=>{const{__scopeTabs:a,value:t,disabled:i=!1,...d}=s,h=ve(He,a),v=$e(a),f=Ue(h.baseId,t),b=Ye(h.baseId,t),u=t===h.value;return e.jsx(Ls,{asChild:!0,...v,focusable:!i,active:u,children:e.jsx(re.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":b,"data-state":u?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:f,...d,ref:r,onMouseDown:he(s.onMouseDown,x=>{!i&&x.button===0&&x.ctrlKey===!1?h.onValueChange(t):x.preventDefault()}),onKeyDown:he(s.onKeyDown,x=>{[" ","Enter"].includes(x.key)&&h.onValueChange(t)}),onFocus:he(s.onFocus,()=>{const x=h.activationMode!=="manual";!u&&!i&&x&&h.onValueChange(t)})})})});ze.displayName=He;var Ge="TabsContent",Ke=l.forwardRef((s,r)=>{const{__scopeTabs:a,value:t,forceMount:i,children:d,...h}=s,v=ve(Ge,a),f=Ue(v.baseId,t),b=Ye(v.baseId,t),u=t===v.value,x=l.useRef(u);return l.useEffect(()=>{const j=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(j)},[]),e.jsx(us,{present:i||u,children:({present:j})=>e.jsx(re.div,{"data-state":u?"active":"inactive","data-orientation":v.orientation,role:"tabpanel","aria-labelledby":f,hidden:!j,id:b,tabIndex:0,...h,ref:r,style:{...s.style,animationDuration:x.current?"0s":void 0},children:j&&d})})});Ke.displayName=Ge;function Ue(s,r){return`${s}-trigger-${r}`}function Ye(s,r){return`${s}-content-${r}`}var Ws=Be,qe=Ve,Je=ze,We=Ke;const Xs=Ws,Xe=l.forwardRef(({className:s,...r},a)=>e.jsx(qe,{ref:a,className:ge("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r}));Xe.displayName=qe.displayName;const _=l.forwardRef(({className:s,...r},a)=>e.jsx(Je,{ref:a,className:ge("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...r}));_.displayName=Je.displayName;const V=l.forwardRef(({className:s,...r},a)=>e.jsx(We,{ref:a,className:ge("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r}));V.displayName=We.displayName;const Qs=({active:s,payload:r,label:a,metric:t})=>{if(s&&r&&r.length){const i=["clients","employees","shifts"].includes(t),d=r[0].value;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:a}),e.jsx("p",{className:"text-sm",children:i?d.toLocaleString():d.toLocaleString(void 0,{style:"currency",currency:"GBP"})})]})}return null},ue=({data:s,metric:r,onBarClick:a})=>!s||s.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No breakdown data available"})}):e.jsx(k,{children:e.jsx(M,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Pe,{data:s,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(Re,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(ke,{type:"number",hide:!0}),e.jsx(Me,{dataKey:"name",type:"category",width:120,tick:{fontSize:12}}),e.jsx(je,{content:e.jsx(Qs,{metric:r})}),e.jsx(xe,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0],onClick:a,children:s.map((t,i)=>e.jsx(Fe,{fill:"hsl(var(--primary))",fillOpacity:.8+i*.05},`cell-${i}`))})]})})})})}),Ae=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#8dd1e1","#a4de6c","#d0ed57"],Zs=({active:s,payload:r})=>s&&r&&r.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:r[0].name}),e.jsx("p",{className:"text-sm",children:Number(r[0].value).toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:`${(r[0].payload.percentage||0).toFixed(1)}%`})]}):null,se=({data:s,metric:r})=>{if(!s||s.length===0)return e.jsx(k,{children:e.jsx(M,{className:"pt-6",children:e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No distribution data available"})})})});const a=[...s].sort((d,h)=>h.value-d.value),t=a.reduce((d,h)=>d+h.value,0),i=a.map(d=>({...d,percentage:t>0?d.value/t*100:0}));return e.jsx(k,{children:e.jsx(M,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Es,{children:[e.jsx(Is,{data:i,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",children:i.map((d,h)=>e.jsx(Fe,{fill:Ae[h%Ae.length]},`cell-${h}`))}),e.jsx(je,{content:e.jsx(Zs,{})}),e.jsx(we,{})]})})})})})},ea=({data:s,onEdit:r,onDelete:a})=>!s||s.length===0?e.jsx("div",{className:"h-[200px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No overhead details available"})}):e.jsxs(k,{children:[e.jsx(ae,{children:e.jsx(te,{children:"Overheads Details"})}),e.jsx(M,{children:e.jsxs(Ee,{children:[e.jsx(Ie,{children:e.jsxs(W,{children:[e.jsx(R,{children:"Title"}),e.jsx(R,{children:"Month"}),e.jsx(R,{children:"Location"}),e.jsx(R,{children:"Site"}),e.jsx(R,{className:"text-right",children:"Amount"}),e.jsx(R,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Oe,{children:s.map(t=>e.jsxs(W,{children:[e.jsx(T,{className:"font-medium",children:t.name}),e.jsxs(T,{children:[t.month," ",t.year]}),e.jsx(T,{children:t.location||"-"}),e.jsx(T,{children:t.site||"-"}),e.jsx(T,{className:"text-right",children:t.value.toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-500 hover:text-blue-600",onClick:()=>r(t),children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx(H,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600",onClick:()=>a(t.id),children:e.jsx(Bs,{className:"h-4 w-4"})})]})})]},t.id))})]})})]}),sa=({active:s,payload:r,label:a})=>s&&r&&r.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:a}),r.map((t,i)=>e.jsxs("p",{className:"text-sm",style:{color:t.color},children:[t.name,": ",t.value.toLocaleString()]},i))]}):null,aa=({data:s})=>{if(!s||s.length===0)return e.jsxs(k,{className:"flex-1",children:[e.jsx(ae,{children:e.jsx(te,{children:"Target vs Actual Performance"})}),e.jsx(M,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const r=new Map;s.forEach(t=>{const i=t.site?`${t.location} - ${t.site}`:t.location;r.has(i)||r.set(i,{actual:0,target:0});const d=r.get(i);d.actual+=t.actual||0,d.target+=t.target||0});const a=Array.from(r.entries()).map(([t,i])=>({name:t,actual:i.actual,target:i.target})).sort((t,i)=>t.name.localeCompare(i.name));return e.jsxs(k,{className:"flex-1",children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Target vs Actual Performance by Site"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total shifts achieved compared to target for each location/site"})]}),e.jsx(M,{children:e.jsx("div",{className:"h-[500px]",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Pe,{data:a,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(Re,{strokeDasharray:"3 3"}),e.jsx(ke,{dataKey:"name",angle:-45,textAnchor:"end",height:100,tick:{fontSize:11},interval:0}),e.jsx(Me,{label:{value:"Shifts",angle:-90,position:"insideLeft"}}),e.jsx(je,{content:e.jsx(sa,{})}),e.jsx(we,{}),e.jsx(xe,{dataKey:"target",name:"Target",fill:"hsl(var(--muted))",opacity:.7}),e.jsx(xe,{dataKey:"actual",name:"Actual",fill:"hsl(var(--primary))"})]})})})})]})},me=["January","February","March","April","May","June","July","August","September","October","November","December"],Le=["Rent","Salaries","Utilities","Software","Equipment","Marketing","Travel","Insurance","Taxes","Maintenance","Custom..."],ta=({open:s,onOpenChange:r,initialData:a,onSave:t})=>{var w,Q;const{data:i}=Us(),[d,h]=l.useState(!1),[v,f]=l.useState(new Date().getFullYear()),[b,u]=l.useState(me[new Date().getMonth()]),[x,j]=l.useState(""),[X,p]=l.useState(""),[F,N]=l.useState(""),[E,I]=l.useState(""),[O,z]=l.useState("");l.useEffect(()=>{s&&(a?(f(a.year),u(a.month),j(a.location||""),p(a.site||""),z(a.value.toString()),Le.includes(a.name)?(N(a.name),I("")):(N("Custom..."),I(a.name))):(f(new Date().getFullYear()),u(me[new Date().getMonth()]),j(""),p(""),N(""),I(""),z("")))},[s,a]);const ie=async()=>{if(!x||!F||!O){D.error("Please fill in all required fields");return}const n=F==="Custom..."?E:F;if(!n){D.error("Please specify the overhead name");return}h(!0);try{await t({id:a==null?void 0:a.id,year:v,month:b,location:x,site:X||null,name:n,value:parseFloat(O)}),r(!1)}catch(A){console.error("Failed to save overhead:",A)}finally{h(!1)}},G=((w=i==null?void 0:i.jobs)==null?void 0:w.filter(n=>n.location===x&&n.site).map(n=>n.site).filter((n,A,K)=>K.indexOf(n)===A))||[];return e.jsx(_s,{open:s,onOpenChange:r,children:e.jsxs(Vs,{className:"sm:max-w-[500px]",children:[e.jsxs(Hs,{children:[e.jsx(zs,{children:a?"Edit Overhead":"Add Overhead"}),e.jsx(Gs,{children:a?"Update existing overhead record.":"Create a new overhead record."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Year"}),e.jsxs(U,{value:v.toString(),onValueChange:n=>f(Number(n)),children:[e.jsx(Y,{children:e.jsx(q,{})}),e.jsx(J,{children:[2024,2025,2026,2027,2028].map(n=>e.jsx($,{value:n.toString(),children:n},n))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Month"}),e.jsxs(U,{value:b,onValueChange:u,children:[e.jsx(Y,{children:e.jsx(q,{})}),e.jsx(J,{children:me.map(n=>e.jsx($,{value:n,children:n},n))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Location"}),e.jsxs(U,{value:x,onValueChange:n=>{j(n),p("")},children:[e.jsx(Y,{children:e.jsx(q,{placeholder:"Select location..."})}),e.jsx(J,{children:Array.from(new Set((Q=i==null?void 0:i.jobs)==null?void 0:Q.map(n=>n.location).filter(Boolean))).map(n=>e.jsx($,{value:n,children:n},n))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Site (Optional)"}),e.jsxs(U,{value:X,onValueChange:p,disabled:!x||G.length===0,children:[e.jsx(Y,{children:e.jsx(q,{placeholder:G.length===0?"No sites available":"Select site..."})}),e.jsxs(J,{children:[e.jsx($,{value:"all_sites",children:"All Sites (if applicable)"}),G.map(n=>e.jsx($,{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Category"}),e.jsxs(U,{value:F,onValueChange:N,children:[e.jsx(Y,{children:e.jsx(q,{placeholder:"Select category..."})}),e.jsx(J,{children:Le.map(n=>e.jsx($,{value:n,children:n},n))})]})]}),F==="Custom..."&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Custom Name"}),e.jsx(Te,{placeholder:"Enter overhead name",value:E,onChange:n=>I(n.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Value (£)"}),e.jsx(Te,{type:"number",placeholder:"0.00",value:O,onChange:n=>z(n.target.value)})]})]}),e.jsxs(Ks,{children:[e.jsx(H,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(H,{onClick:ie,disabled:d,children:[d&&e.jsx(ms,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})})},Ra=()=>{const{metricId:s}=xs(),r=gs(),{dateRange:a,setDateRange:t}=fs(),[i,d]=l.useState(!1),[h,v]=l.useState(a),[f,b]=l.useState([]),[u,x]=l.useState([]),[j,X]=l.useState("trend"),[p,F]=l.useState([]),[N,E]=l.useState([]),[I,O]=l.useState(!1),[z,ie]=l.useState([]),[G,w]=l.useState(!1),[Q,n]=l.useState(null),[A,K]=l.useState(null),Z=["revenue","cost","profit","employees","clientRate","staffRate","overheads"].includes(s||""),oe=["shifts","hours","clients","targetAchievement","missedTargets"].includes(s||""),le=s==="overheads",{operationalData:S,isLoading:Qe}=ks(a,f,u),{financialData:C,isLoading:Ze}=Fs(a,f,u),es=Z?Ze:oe?Qe:!1;l.useEffect(()=>{if(s!=="missedTargets")return;(async()=>{try{const c=new URLSearchParams({start:B(a.from,"yyyy-MM-dd"),end:B(a.to,"yyyy-MM-dd")}),g={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},m=await fetch(`${ee.TARGETS_PERFORMANCE}?${c.toString()}`,{headers:g});if(m.ok){const y=await m.json();ie(y)}}catch(c){console.error("Error fetching targets performance:",c)}})()},[a,s]),l.useEffect(()=>{if(j==="trend"||!s)return;(async()=>{O(!0);try{const c=new URLSearchParams({start:B(a.from,"yyyy-MM-dd"),end:B(a.to,"yyyy-MM-dd"),metric:s,limit:"20"});f&&f.length>0&&f.forEach(m=>c.append("locations",m)),u&&u.length>0&&u.forEach(m=>c.append("sites",m));const g={Authorization:`Bearer ${localStorage.getItem("auth_token")}`};if(j==="details"&&le){const m=await fetch(`${ee.FINANCIAL_METRICS_LIST}?${c.toString()}`,{headers:g});if(m.ok){const y=await m.json();E(y)}}else if(["location","site","client"].includes(j)){c.append("dimension",j);const m=await fetch(`${ee.BREAKDOWN}?${c.toString()}`,{headers:g});if(m.ok){const y=await m.json();F(y)}}}catch(c){console.error("Error fetching breakdown:",c)}finally{O(!1)}})()},[j,s,a,f,u]);const ss=()=>{n(null),w(!0)},as=o=>{n(o),w(!0)},ts=async()=>{if(A)try{const o=await fetch(`/api/admin/financial-metrics/${A}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(o.ok)D.success("Overhead deleted"),j==="details"&&E(c=>c.filter(g=>g.id!==A));else{const c=await o.json();D.error(c.error||"Failed to delete")}}catch(o){console.error(o),D.error("Failed to delete")}finally{K(null)}},rs=async o=>{try{const c=await fetch("/api/admin/financial-metrics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(o)});if(c.ok){D.success("Overhead saved"),w(!1);const g=new URLSearchParams({start:B(a.from,"yyyy-MM-dd"),end:B(a.to,"yyyy-MM-dd"),metric:s||"overheads",limit:"20"});f&&f.forEach(L=>g.append("locations",L)),u&&u.forEach(L=>g.append("sites",L));const m={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},y=await fetch(`${ee.FINANCIAL_METRICS_LIST}?${g.toString()}`,{headers:m});if(y.ok){const L=await y.json();E(L)}}else{const g=await c.json();D.error(g.error||"Failed to save")}}catch(c){console.error(c),D.error("Failed to save")}},pe=o=>{switch(o){case"revenue":return"Revenue Analysis";case"cost":return"Cost Analysis";case"profit":return"Profit Analysis";case"shifts":return"Shifts Analysis";case"hours":return"Hours Analysis";case"clients":return"Client Analysis";case"employees":return"Employee Analysis";case"targetAchievement":return"Target Achievement Analysis";case"missedTargets":return"Missed Targets Analysis";case"clientRate":return"Client Rate Analysis";case"staffRate":return"Staff Rate Analysis";case"overheads":return"Overheads Analysis";default:return"Metric Analysis"}},ns=(o,c)=>{var g,m,y,L,ye,be,Ne,Se,Ce;if(!o)return"-";switch(c){case"revenue":return`£${((g=o.revenue)==null?void 0:g.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"cost":return`£${((m=o.cost)==null?void 0:m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"profit":const de=o.profit??o.revenue-o.cost-(o.overheads||0);return`£${(de==null?void 0:de.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"shifts":return((y=o.totalShifts)==null?void 0:y.toLocaleString())??0;case"hours":return((L=o.paidHours)==null?void 0:L.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"clients":return((ye=o.clientCount)==null?void 0:ye.toLocaleString())??0;case"employees":return((be=o.paidHours)==null?void 0:be.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"targetAchievement":return`${((Ne=o.achievementPercentage)==null?void 0:Ne.toFixed(1))??0}%`;case"missedTargets":return`${((Se=o.achievementPercentage)==null?void 0:Se.toFixed(1))??0}%`;case"clientRate":return`£${(o.revenue/o.paidHours||0).toFixed(2)}`;case"staffRate":return`£${(o.cost/o.paidHours||0).toFixed(2)}`;case"overheads":return`£${((Ce=o.overheads)==null?void 0:Ce.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;default:return"-"}},is=l.useMemo(()=>{if(!N||N.length===0)return[];const o=N.reduce((c,g)=>{const m=g.name||"Unknown";return c[m]||(c[m]=0),c[m]+=g.value,c},{});return Object.entries(o).map(([c,g])=>({name:c,value:g}))},[N]),ce=Z?C==null?void 0:C.timeSeries:S==null?void 0:S.timeSeries;return e.jsx(Ts,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(Rs,{dateRange:a,onDateRangeChange:t,calendarOpen:i,onCalendarOpenChange:d,tempDateRange:h,onTempDateRangeChange:v,selectedLocations:f,onLocationsChange:b,selectedSites:u,onSitesChange:x}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6 relative",children:[(es||I)&&e.jsx(ws,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>r(-1),className:"gap-2",children:[e.jsx(Ys,{className:"h-4 w-4"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold",children:pe(s)})]}),e.jsxs(Xs,{value:j,onValueChange:X,className:"space-y-4",children:[e.jsxs(Xe,{children:[e.jsx(_,{value:"trend",children:"Trend"}),e.jsx(_,{value:"location",children:"By Location"}),e.jsx(_,{value:"site",children:"By Site"}),!le&&e.jsx(_,{value:"client",children:"By Client"}),le&&e.jsx(_,{value:"details",children:"All Details"})]}),e.jsx(V,{value:"trend",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[Z&&e.jsx(Ps,{data:(C==null?void 0:C.timeSeries)||[],aggregationLevel:(C==null?void 0:C.aggregationLevel)||"monthly",selectedMetric:s}),oe&&s!=="missedTargets"&&e.jsx(Ms,{data:(S==null?void 0:S.timeSeries)||[],aggregationLevel:(S==null?void 0:S.aggregationLevel)||"monthly",selectedMetric:s}),s==="missedTargets"&&e.jsx(aa,{data:z}),!Z&&!oe&&e.jsx(k,{children:e.jsx(M,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Metric type not recognized or data unavailable."})})}),e.jsxs(k,{children:[e.jsx(ae,{children:e.jsx(te,{children:"Historical Data"})}),e.jsx(M,{children:e.jsxs(Ee,{children:[e.jsxs(Os,{children:["Detailed historical data for ",pe(s)]}),e.jsx(Ie,{children:e.jsxs(W,{children:[e.jsx(R,{children:"Period"}),e.jsx(R,{className:"text-right",children:"Value"})]})}),e.jsx(Oe,{children:ce&&ce.length>0?[...ce].reverse().map((o,c)=>e.jsxs(W,{children:[e.jsx(T,{className:"font-medium",children:o.display}),e.jsx(T,{className:"text-right font-medium",children:ns(o,s)})]},c)):e.jsx(W,{children:e.jsx(T,{colSpan:2,className:"text-center",children:"No data available"})})})]})})]})]})}),e.jsx(V,{value:"location",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(ue,{data:p,metric:s||"revenue"}),e.jsx(se,{data:p,metric:s||"revenue"})]})}),e.jsx(V,{value:"site",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(ue,{data:p,metric:s||"revenue"}),e.jsx(se,{data:p,metric:s||"revenue"})]})}),e.jsx(V,{value:"client",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(ue,{data:p,metric:s||"revenue"}),e.jsx(se,{data:p,metric:s||"revenue"})]})}),e.jsx(V,{value:"details",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(se,{data:is,metric:"overheads"})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(H,{onClick:ss,className:"gap-2",children:[e.jsx(Ds,{className:"h-4 w-4"}),"Add Overhead"]})}),e.jsx(ea,{data:N,onEdit:as,onDelete:K}),e.jsx(ta,{open:G,onOpenChange:w,initialData:Q,onSave:rs}),e.jsx(js,{open:!!A,onOpenChange:o=>!o&&K(null),children:e.jsxs(vs,{children:[e.jsxs(ps,{children:[e.jsx(ys,{children:"Are you sure?"}),e.jsx(bs,{children:"This will permanently delete this overhead record."})]}),e.jsxs(Ns,{children:[e.jsx(Ss,{children:"Cancel"}),e.jsx(Cs,{onClick:ts,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})})]})]})]})})};export{Ra as default};
