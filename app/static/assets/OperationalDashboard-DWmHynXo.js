import{c as T,j as e,L as F,B as I,u as P,b as q,d as B,r as p}from"./index-vv7Xxvxx.js";import{D as V,L as E}from"./DashboardLayout-BvNnIU1Q.js";import{u as z,T as U,O as K}from"./TargetPerformanceChart-BPrdlm1p.js";import{M as j,u as _,c as Q,R as C}from"./RankingList-OMTYjips.js";import{D as W}from"./DashboardHeader-BeGbzAUK.js";import{C as k,a as D,b as w,d as L}from"./card-t2CvivAU.js";import{D as Z,a as G,b as J,c as X,d as Y}from"./dialog-C4jVc5rp.js";import{u as $}from"./useQuery-C6Zx2IC-.js";import{C as R}from"./clock-D7yKipxO.js";import{U as N}from"./users-BuPRz4_V.js";import"./popover-CJoFCFCM.js";import"./generateCategoricalChart-Ba-AHQe3.js";import"./BarChart-Da0PlctV.js";import"./progress-BpN_5DqQ.js";import"./ellipsis-D3uA7-P5.js";import"./locationUtils-BXqwuQR5.js";import"./checkbox-DoPojQwp.js";import"./index-C1qR41hW.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=T("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=T("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=T("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ae=({dateRange:a,onMetricClick:s,onViewDetails:v})=>{const c=a!=null&&a.from?a.from.toISOString().split("T")[0]:"",d=a!=null&&a.to?a.to.toISOString().split("T")[0]:"",{data:h,isLoading:b}=$({queryKey:["target-performance",c,d],queryFn:async()=>{if(!c||!d)return[];const t=await fetch(`/api/dashboard/targets-performance?start=${c}&end=${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!t.ok)throw new Error("Failed to fetch target Data");return t.json()},enabled:!!c&&!!d});if(b)return e.jsxs(k,{children:[e.jsx(D,{children:e.jsx(w,{children:"Target Performance"})}),e.jsx(L,{children:e.jsx(F,{className:"animate-spin"})})]});if(!h||h.length===0)return null;const l=new Map;h.forEach(t=>{const u=`${t.location}|${t.site||"null"}`,f=l.get(u);f?(f.actual+=t.actual,f.target+=t.target):l.set(u,{location:t.location,site:t.site,actual:t.actual,target:t.target})});const m=Array.from(l.values()),o=m.length,g=m.filter(t=>t.actual>=t.target).length,r=o-g,n=o>0?g/o*100:0;return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-2",children:[e.jsx(j,{title:"Target Achievement",value:`${n.toFixed(0)}%`,subtitle:`${g} of ${o} sites met target`,icon:te,onClick:s?()=>s("targetAchievement"):void 0,onViewDetails:v?()=>v("targetAchievement"):void 0,children:e.jsx("div",{className:"mt-4 h-2 w-full bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${n}%`}})})}),e.jsx(j,{title:"Missed Targets",value:r,subtitle:"Sites below target",icon:se,onClick:s?()=>s("missedTargets"):void 0,children:e.jsxs(Z,{children:[e.jsx(G,{asChild:!0,children:e.jsx(I,{variant:"outline",size:"sm",className:"mt-4 w-full",children:"View Details"})}),e.jsxs(J,{className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(X,{children:e.jsx(Y,{children:"Missed Targets Report"})}),e.jsxs("div",{className:"space-y-2",children:[m.filter(t=>t.actual<t.target).map((t,u)=>e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 last:border-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.site||t.location}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.location})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-red-500 font-bold",children:[t.actual," / ",t.target]}),e.jsxs("span",{className:"text-xs text-muted-foreground block",children:["Deficit: ",t.actual-t.target]})]})]},u)),r===0&&e.jsx("p",{className:"text-center text-muted-foreground",children:"No missed targets!"})]})]})]})})]})},be=()=>{const a=P();q();const{dateRange:s,setDateRange:v}=B(),[c,d]=p.useState(!1),[h,b]=p.useState(s),[l,m]=p.useState([]),[o,g]=p.useState([]),[r,n]=p.useState("shifts"),{operationalData:t,isLoading:u}=z(s,l,o),{topStaff:f,isLoadingStaff:M,topClientsShifts:O,isLoadingClientsShifts:A}=_(s,l,o),x=Q(t,s),y=s!=null&&s.from?s.from.toISOString().split("T")[0]:"",S=s!=null&&s.to?s.to.toISOString().split("T")[0]:"",{data:H}=$({queryKey:["target-performance",y,S],queryFn:async()=>{if(!y||!S)return[];const i=await fetch(`/api/dashboard/targets-performance?start=${y}&end=${S}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!i.ok)throw new Error("Failed to fetch target data");return i.json()},enabled:!!y&&!!S});return e.jsx(V,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(W,{dateRange:s,onDateRangeChange:v,calendarOpen:c,onCalendarOpenChange:d,tempDateRange:h,onTempDateRangeChange:b,selectedLocations:l,onLocationsChange:m,selectedSites:o,onSitesChange:g}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"px-4 pt-6 pb-6 space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs("div",{className:"col-span-5 flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(j,{title:"Total Shifts",value:x.totalShifts.value,subtitle:x.totalShifts.text,icon:E,isSelected:r==="shifts",onClick:()=>n("shifts"),onViewDetails:()=>a("/dashboard/metrics/shifts")}),e.jsx(j,{title:"Total Hours",value:x.paidHours.value.toLocaleString(),subtitle:x.paidHours.text,icon:R,isSelected:r==="hours",onClick:()=>n("hours"),onViewDetails:()=>a("/dashboard/metrics/hours")}),e.jsx(j,{title:"Active Clients",value:x.totalClients.value,subtitle:"Distinct clients this period",icon:N,isSelected:r==="clients",onClick:()=>n("clients"),onViewDetails:()=>a("/dashboard/metrics/clients")})]}),e.jsx(ae,{dateRange:s,onMetricClick:i=>n(i),onViewDetails:i=>a(`/dashboard/metrics/${i}`)}),r==="missedTargets"?e.jsx(U,{data:H||[]}):e.jsxs(k,{className:"flex-1",children:[e.jsx(D,{children:e.jsxs(w,{children:[r==="shifts"&&"Hours & Shifts Trend",r==="hours"&&"Paid Hours Trend",r==="clients"&&"Active Clients Trend",r==="targetAchievement"&&"Target Achievement Trend"]})}),e.jsx(L,{className:"pl-2",children:e.jsx(K,{data:(t==null?void 0:t.timeSeries)||[],aggregationLevel:(t==null?void 0:t.aggregationLevel)||"monthly",selectedMetric:r})})]})]}),e.jsxs("div",{className:"col-span-2 flex flex-col gap-4",children:[e.jsx(C,{title:"Top Staff (Paid Hours)",data:f,isLoading:M,valueFormatter:i=>`${i.toLocaleString()} hrs`,icon:e.jsx(N,{className:"h-4 w-4"}),className:"flex-1"}),e.jsx(C,{title:"Top Clients (Shifts)",data:O,isLoading:A,valueFormatter:i=>`${i.toLocaleString()} shifts`,icon:e.jsx(ee,{className:"h-4 w-4"}),className:"flex-1",barColor:"bg-blue-500"})]})]})})})]})})};export{be as OperationalDashboard,be as default};
