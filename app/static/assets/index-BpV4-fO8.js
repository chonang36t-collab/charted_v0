import{g as me,r as h,Y as xe,m as je,j as e,z as ge,P as R,i as k,k as fe,d as B,a8 as pe,I as N,B as q,L as T,D as S}from"./index-B2wxE_Dd.js";import{D as ve}from"./DashboardLayout-BkHDIkQ9.js";import{C,a as w,b as F,d as A}from"./card-C3bGNNHL.js";import{L as g}from"./label-DS_sKOtC.js";import{S as M,a as I,b as L,c as E,d as y}from"./select-DSIXMPLM.js";import{T as K,a as z,b as v,c as p,d as G,e as j}from"./table-DrLqigzo.js";import{c as Q,R as be,I as ye,u as Ne,f as H}from"./index-Dh76PAe9.js";import{u as J}from"./useQuery-DD9OD5YM.js";import"./users-C1K4zxjf.js";import"./index-ZIh-836K.js";var _="Tabs",[Te,ke]=me(_,[Q]),Y=Q(),[Se,O]=Te(_),W=h.forwardRef((s,r)=>{const{__scopeTabs:i,value:n,onValueChange:o,defaultValue:m,orientation:l="horizontal",dir:u,activationMode:f="automatic",...x}=s,t=xe(u),[c,d]=je({prop:n,onChange:o,defaultProp:m??"",caller:_});return e.jsx(Se,{scope:i,baseId:ge(),value:c,onValueChange:d,orientation:l,dir:t,activationMode:f,children:e.jsx(R.div,{dir:t,"data-orientation":l,...x,ref:r})})});W.displayName=_;var U="TabsList",X=h.forwardRef((s,r)=>{const{__scopeTabs:i,loop:n=!0,...o}=s,m=O(U,i),l=Y(i);return e.jsx(be,{asChild:!0,...l,orientation:m.orientation,dir:m.dir,loop:n,children:e.jsx(R.div,{role:"tablist","aria-orientation":m.orientation,...o,ref:r})})});X.displayName=U;var Z="TabsTrigger",ee=h.forwardRef((s,r)=>{const{__scopeTabs:i,value:n,disabled:o=!1,...m}=s,l=O(Z,i),u=Y(i),f=te(l.baseId,n),x=ne(l.baseId,n),t=n===l.value;return e.jsx(ye,{asChild:!0,...u,focusable:!o,active:t,children:e.jsx(R.button,{type:"button",role:"tab","aria-selected":t,"aria-controls":x,"data-state":t?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:f,...m,ref:r,onMouseDown:k(s.onMouseDown,c=>{!o&&c.button===0&&c.ctrlKey===!1?l.onValueChange(n):c.preventDefault()}),onKeyDown:k(s.onKeyDown,c=>{[" ","Enter"].includes(c.key)&&l.onValueChange(n)}),onFocus:k(s.onFocus,()=>{const c=l.activationMode!=="manual";!t&&!o&&c&&l.onValueChange(n)})})})});ee.displayName=Z;var ae="TabsContent",se=h.forwardRef((s,r)=>{const{__scopeTabs:i,value:n,forceMount:o,children:m,...l}=s,u=O(ae,i),f=te(u.baseId,n),x=ne(u.baseId,n),t=n===u.value,c=h.useRef(t);return h.useEffect(()=>{const d=requestAnimationFrame(()=>c.current=!1);return()=>cancelAnimationFrame(d)},[]),e.jsx(fe,{present:o||t,children:({present:d})=>e.jsx(R.div,{"data-state":t?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":f,hidden:!d,id:x,tabIndex:0,...l,ref:r,style:{...s.style,animationDuration:c.current?"0s":void 0},children:d&&m})})});se.displayName=ae;function te(s,r){return`${s}-trigger-${r}`}function ne(s,r){return`${s}-content-${r}`}var Ce=W,re=X,ie=ee,oe=se;const we=Ce,le=h.forwardRef(({className:s,...r},i)=>e.jsx(re,{ref:i,className:B("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r}));le.displayName=re.displayName;const V=h.forwardRef(({className:s,...r},i)=>e.jsx(ie,{ref:i,className:B("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...r}));V.displayName=ie.displayName;const $=h.forwardRef(({className:s,...r},i)=>e.jsx(oe,{ref:i,className:B("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r}));$.displayName=oe.displayName;const P=["January","February","March","April","May","June","July","August","September","October","November","December"],Ve=()=>{const[s,r]=h.useState(new Date().getFullYear()),i=pe(),{data:n}=Ne(),{data:o,isLoading:m}=J({queryKey:["admin-targets",s],queryFn:async()=>{const a=await fetch(`/api/admin/targets?year=${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!a.ok)throw new Error("Failed to fetch targets");return a.json()}}),l=H({mutationFn:async a=>{const b=await fetch("/api/admin/targets",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(a)});if(!b.ok)throw new Error("Failed to save target");return b.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["admin-targets"]}),S.success("Target saved")},onError:a=>S.error(a.message)}),{data:u,isLoading:f}=J({queryKey:["admin-financials",s],queryFn:async()=>{const a=await fetch(`/api/admin/financial-metrics?year=${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!a.ok)throw new Error("Failed to fetch metrics");return a.json()}}),x=H({mutationFn:async a=>{const b=await fetch("/api/admin/financial-metrics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(a)});if(!b.ok)throw new Error("Failed to save metric");return b.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["admin-financials"]}),S.success("Metric saved")},onError:a=>S.error(a.message)}),[t,c]=h.useState({month:P[new Date().getMonth()],location:"",site:"",target:0}),[d,D]=h.useState({month:P[new Date().getMonth()],name:"",value:0}),ce=Array.from(new Set((n==null?void 0:n.jobs.map(a=>a.location).filter(Boolean))||[])),de=(n==null?void 0:n.jobs.filter(a=>a.location===t.location).map(a=>a.site).filter(Boolean))||[],ue=a=>{a.preventDefault(),l.mutate({year:s,month:t.month,location:t.location,site:t.site||null,target:Number(t.target)})},he=a=>{a.preventDefault(),x.mutate({year:s,month:d.month,name:d.name,value:Number(d.value)})};return e.jsxs(ve,{fullWidth:!0,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Admin Metrics & Targets"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{htmlFor:"year-select",children:"Year:"}),e.jsx(N,{id:"year-select",type:"number",className:"w-24",value:s,onChange:a=>r(Number(a.target.value))})]})]}),e.jsxs(we,{defaultValue:"targets",className:"space-y-4",children:[e.jsxs(le,{children:[e.jsx(V,{value:"targets",children:"Shift Targets"}),e.jsx(V,{value:"financials",children:"Financial Parameters"})]}),e.jsx($,{value:"targets",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(C,{className:"md:col-span-1 h-fit",children:[e.jsx(w,{children:e.jsx(F,{children:"Set Target"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:ue,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Month"}),e.jsxs(M,{value:t.month,onValueChange:a=>c({...t,month:a}),children:[e.jsx(I,{children:e.jsx(L,{})}),e.jsx(E,{children:P.map(a=>e.jsx(y,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Location"}),e.jsxs(M,{value:t.location,onValueChange:a=>c({...t,location:a,site:""}),children:[e.jsx(I,{children:e.jsx(L,{placeholder:"Select Location"})}),e.jsx(E,{children:ce.map(a=>e.jsx(y,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Site (Optional)"}),e.jsxs(M,{value:t.site,onValueChange:a=>c({...t,site:a}),disabled:!t.location,children:[e.jsx(I,{children:e.jsx(L,{placeholder:"All Sites"})}),e.jsxs(E,{children:[e.jsx(y,{value:"ALL_SITES_PLACEHOLDER",children:"All Sites"}),de.map(a=>e.jsx(y,{value:a,children:a},a))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave empty to target whole location."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Target Shift Count"}),e.jsx(N,{type:"number",value:t.target,onChange:a=>c({...t,target:Number(a.target.value)})})]}),e.jsxs(q,{type:"submit",disabled:l.isPending,className:"w-full",children:[l.isPending&&e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Target"]})]})})]}),e.jsxs(C,{className:"md:col-span-2",children:[e.jsx(w,{children:e.jsxs(F,{children:["Existing Targets (",s,")"]})}),e.jsx(A,{children:m?e.jsx(T,{className:"animate-spin"}):e.jsxs(K,{children:[e.jsx(z,{children:e.jsxs(v,{children:[e.jsx(p,{children:"Month"}),e.jsx(p,{children:"Location"}),e.jsx(p,{children:"Site"}),e.jsx(p,{children:"Target"})]})}),e.jsxs(G,{children:[o==null?void 0:o.map(a=>e.jsxs(v,{children:[e.jsx(j,{children:a.month}),e.jsx(j,{children:a.location}),e.jsx(j,{children:a.site||e.jsx("span",{className:"text-muted-foreground italic",children:"All"})}),e.jsx(j,{children:a.target})]},a.id)),(o==null?void 0:o.length)===0&&e.jsx(v,{children:e.jsx(j,{colSpan:4,className:"text-center",children:"No targets set"})})]})]})})]})]})}),e.jsx($,{value:"financials",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(C,{className:"md:col-span-1 h-fit",children:[e.jsx(w,{children:e.jsx(F,{children:"Add Metric"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:he,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Month"}),e.jsxs(M,{value:d.month,onValueChange:a=>D({...d,month:a}),children:[e.jsx(I,{children:e.jsx(L,{})}),e.jsx(E,{children:P.map(a=>e.jsx(y,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Metric Name"}),e.jsx(N,{placeholder:"e.g. Overheads",value:d.name,onChange:a=>D({...d,name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Value (£)"}),e.jsx(N,{type:"number",step:"0.01",value:d.value,onChange:a=>D({...d,value:Number(a.target.value)})})]}),e.jsxs(q,{type:"submit",disabled:x.isPending,className:"w-full",children:[x.isPending&&e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Metric"]})]})})]}),e.jsxs(C,{className:"md:col-span-2",children:[e.jsx(w,{children:e.jsxs(F,{children:["Financial Parameters (",s,")"]})}),e.jsx(A,{children:f?e.jsx(T,{className:"animate-spin"}):e.jsxs(K,{children:[e.jsx(z,{children:e.jsxs(v,{children:[e.jsx(p,{children:"Month"}),e.jsx(p,{children:"Metric"}),e.jsx(p,{children:"Value"})]})}),e.jsxs(G,{children:[u==null?void 0:u.map(a=>e.jsxs(v,{children:[e.jsx(j,{children:a.month}),e.jsx(j,{children:a.name}),e.jsxs(j,{children:["£",a.value.toLocaleString()]})]},a.id)),(u==null?void 0:u.length)===0&&e.jsx(v,{children:e.jsx(j,{colSpan:3,className:"text-center",children:"No metrics set"})})]})]})})]})]})})]})]})};export{Ve as default};
