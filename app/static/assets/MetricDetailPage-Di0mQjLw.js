import{c as hs,h as ms,r as i,U as us,p as xs,j as e,v as fs,P as ge,q as Se,w as gs,e as Te,B as q,I as ue,A as re,L as js,y as U,ab as ps,u as vs,d as ys,b as Ns,a3 as bs,a4 as Ss,a5 as Cs,a6 as ws,a7 as Ts,a8 as ks,a9 as As,aa as Ms}from"./index-C5kd7gQ1.js";import{D as Ls}from"./DashboardLayout-CtHASLbh.js";import{C as E,d as $,a as G,b as Y}from"./card-D6kaRjpZ.js";import{c as Pe,R as Ds,I as Rs}from"./index-CJ0oSto1.js";import{D as Es}from"./DashboardHeader-BerTHwKf.js";import{S as Be,Z as $s,C as Is,u as Ps,O as Bs,T as _s}from"./TargetPerformanceChart-BcKm8aJp.js";import{u as Os,L as Fs,R as zs}from"./LoadingOverlay-hOvUoN5d.js";import{g as Hs,X as ne,Y as ie,f as Ws,R as le,C as je,T as oe,B as xe,a as ke,L as Vs,b as Re,c as Ee}from"./generateCategoricalChart-BkAhgv2c.js";import{B as _e}from"./BarChart-BSzIgxnV.js";import{P as Us,a as Ks}from"./PieChart-CQ2qnNwZ.js";import{T as Oe,a as Fe,b as fe,c as _,d as ze,e as O}from"./table-CbZnQtel.js";import{P as qs}from"./pen-BmaZvEqI.js";import{T as Gs}from"./trash-2-BuhIbW-0.js";import{L as R}from"./label-Dve1q3YF.js";import{f as T}from"./popover-CBzz2F_Z.js";import{D as Ys,b as Qs,c as Js,d as Xs,f as Zs,e as et}from"./dialog-CfjnqRgh.js";import{S as ee,a as se,b as te,c as ae,d as J}from"./select-Bcp-GFDT.js";import{u as st}from"./useRecords-CIfrDWLb.js";import{P as tt}from"./plus-prM0ttkf.js";import"./users-BC_Vp8aU.js";import"./locationUtils-DMecBRNU.js";import"./checkbox-DZug_ofI.js";import"./index-CYNVBB12.js";import"./AreaChart-C5WZfmRo.js";import"./useQuery-DXGsHctx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=hs("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var rt=Hs({chartName:"ScatterChart",GraphicalChild:Be,defaultTooltipEventType:"item",validateTooltipEventTypes:["item"],axisComponents:[{axisType:"xAxis",AxisComp:ne},{axisType:"yAxis",AxisComp:ie},{axisType:"zAxis",AxisComp:$s}],formatAxisMap:Ws}),pe="Tabs",[nt,Kt]=ms(pe,[Pe]),He=Pe(),[it,Ae]=nt(pe),We=i.forwardRef((t,a)=>{const{__scopeTabs:s,value:r,onValueChange:c,defaultValue:o,orientation:u="horizontal",dir:x,activationMode:g="automatic",...d}=t,v=us(x),[l,b]=xs({prop:r,onChange:c,defaultProp:o??"",caller:pe});return e.jsx(it,{scope:s,baseId:fs(),value:l,onValueChange:b,orientation:u,dir:v,activationMode:g,children:e.jsx(ge.div,{dir:v,"data-orientation":u,...d,ref:a})})});We.displayName=pe;var Ve="TabsList",Ue=i.forwardRef((t,a)=>{const{__scopeTabs:s,loop:r=!0,...c}=t,o=Ae(Ve,s),u=He(s);return e.jsx(Ds,{asChild:!0,...u,orientation:o.orientation,dir:o.dir,loop:r,children:e.jsx(ge.div,{role:"tablist","aria-orientation":o.orientation,...c,ref:a})})});Ue.displayName=Ve;var Ke="TabsTrigger",qe=i.forwardRef((t,a)=>{const{__scopeTabs:s,value:r,disabled:c=!1,...o}=t,u=Ae(Ke,s),x=He(s),g=Qe(u.baseId,r),d=Je(u.baseId,r),v=r===u.value;return e.jsx(Rs,{asChild:!0,...x,focusable:!c,active:v,children:e.jsx(ge.button,{type:"button",role:"tab","aria-selected":v,"aria-controls":d,"data-state":v?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:g,...o,ref:a,onMouseDown:Se(t.onMouseDown,l=>{!c&&l.button===0&&l.ctrlKey===!1?u.onValueChange(r):l.preventDefault()}),onKeyDown:Se(t.onKeyDown,l=>{[" ","Enter"].includes(l.key)&&u.onValueChange(r)}),onFocus:Se(t.onFocus,()=>{const l=u.activationMode!=="manual";!v&&!c&&l&&u.onValueChange(r)})})})});qe.displayName=Ke;var Ge="TabsContent",Ye=i.forwardRef((t,a)=>{const{__scopeTabs:s,value:r,forceMount:c,children:o,...u}=t,x=Ae(Ge,s),g=Qe(x.baseId,r),d=Je(x.baseId,r),v=r===x.value,l=i.useRef(v);return i.useEffect(()=>{const b=requestAnimationFrame(()=>l.current=!1);return()=>cancelAnimationFrame(b)},[]),e.jsx(gs,{present:c||v,children:({present:b})=>e.jsx(ge.div,{"data-state":v?"active":"inactive","data-orientation":x.orientation,role:"tabpanel","aria-labelledby":g,hidden:!b,id:d,tabIndex:0,...u,ref:a,style:{...t.style,animationDuration:l.current?"0s":void 0},children:b&&o})})});Ye.displayName=Ge;function Qe(t,a){return`${t}-trigger-${a}`}function Je(t,a){return`${t}-content-${a}`}var lt=We,Xe=Ue,Ze=qe,es=Ye;const Me=lt,ve=i.forwardRef(({className:t,...a},s)=>e.jsx(Xe,{ref:s,className:Te("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...a}));ve.displayName=Xe.displayName;const D=i.forwardRef(({className:t,...a},s)=>e.jsx(Ze,{ref:s,className:Te("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...a}));D.displayName=Ze.displayName;const H=i.forwardRef(({className:t,...a},s)=>e.jsx(es,{ref:s,className:Te("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...a}));H.displayName=es.displayName;const ot=({active:t,payload:a,label:s,metric:r})=>{if(t&&a&&a.length){const c=["clients","employees","shifts","hours"].includes(r),o=a[0].value;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:s}),e.jsx("p",{className:"text-sm",children:c?o.toLocaleString():o.toLocaleString(void 0,{style:"currency",currency:"GBP"})})]})}return null},Ce=({data:t,metric:a,onBarClick:s})=>!t||t.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No breakdown data available"})}):e.jsx(E,{children:e.jsx($,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(le,{width:"100%",height:"100%",children:e.jsxs(_e,{data:t,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(ne,{type:"number",hide:!0}),e.jsx(ie,{dataKey:"name",type:"category",width:120,tick:{fontSize:12}}),e.jsx(oe,{content:e.jsx(ot,{metric:a})}),e.jsx(xe,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0],onClick:s,children:t.map((r,c)=>e.jsx(ke,{fill:"hsl(var(--primary))",fillOpacity:.8+c*.05},`cell-${c}`))})]})})})})}),$e=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#8dd1e1","#a4de6c","#d0ed57"],ct=({active:t,payload:a,metric:s})=>{if(t&&a&&a.length){const r=["revenue","costs","profit","overheads"].includes(s);return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:a[0].name}),e.jsx("p",{className:"text-sm",children:r?Number(a[0].value).toLocaleString(void 0,{style:"currency",currency:"GBP"}):Number(a[0].value).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:`${(a[0].payload.percentage||0).toFixed(1)}%`})]})}return null},me=({data:t,metric:a})=>{if(!t||t.length===0)return e.jsx(E,{children:e.jsx($,{className:"pt-6",children:e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No distribution data available"})})})});const s=[...t].sort((o,u)=>u.value-o.value),r=s.reduce((o,u)=>o+u.value,0),c=s.map(o=>({...o,percentage:r>0?o.value/r*100:0}));return e.jsx(E,{children:e.jsx($,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(le,{width:"100%",height:"100%",children:e.jsxs(Us,{children:[e.jsx(Ks,{data:c,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",children:c.map((o,u)=>e.jsx(ke,{fill:$e[u%$e.length]},`cell-${u}`))}),e.jsx(oe,{content:e.jsx(ct,{metric:a})}),e.jsx(Vs,{})]})})})})})},dt=({data:t,onEdit:a,onDelete:s})=>!t||t.length===0?e.jsx("div",{className:"h-[200px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No overhead details available"})}):e.jsxs(E,{children:[e.jsx(G,{children:e.jsx(Y,{children:"Overheads Details"})}),e.jsx($,{children:e.jsxs(Oe,{children:[e.jsx(Fe,{children:e.jsxs(fe,{children:[e.jsx(_,{children:"Title"}),e.jsx(_,{children:"Month"}),e.jsx(_,{children:"Location"}),e.jsx(_,{children:"Site"}),e.jsx(_,{className:"text-right",children:"Amount"}),e.jsx(_,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ze,{children:t.map(r=>e.jsxs(fe,{children:[e.jsx(O,{className:"font-medium",children:r.name}),e.jsxs(O,{children:[r.month," ",r.year]}),e.jsx(O,{children:r.location||"-"}),e.jsx(O,{children:r.site||"-"}),e.jsx(O,{className:"text-right",children:r.value.toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx(O,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-500 hover:text-blue-600",onClick:()=>a(r),children:e.jsx(qs,{className:"h-4 w-4"})}),e.jsx(q,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600",onClick:()=>s(r.id),children:e.jsx(Gs,{className:"h-4 w-4"})})]})})]},r.id))})]})})]}),ht=t=>{const a=[];for(let s=0;s<t;s++)a.push(s*360/t%360);return a.map(s=>`hsl(${s}, 70%, 60%)`)},mt=({active:t,payload:a})=>{if(t&&a&&a.length){const s=a[0].payload;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg max-w-xs",children:[e.jsx("p",{className:"font-semibold text-foreground mb-2",children:s.tierName}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Clients:"})," ",s.clientCount]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total Revenue:"})," £",s.totalRevenue.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Avg/Client:"})," £",s.avgRevenue.toLocaleString()]})]}),s.hoveredClient&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border",children:[e.jsx("p",{className:"font-medium text-primary",children:s.hoveredClient.name}),e.jsxs("p",{className:"text-sm",children:["£",s.hoveredClient.revenue.toLocaleString()]})]})]})}return null},ut=({data:t})=>{if(!t||t.length===0)return e.jsx("div",{className:"h-[400px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No tier data available"})});const a=t.map(s=>{const r=ht(s.clients.length);return{tierName:s.name,totalRevenue:s.value,clientCount:s.clientCount,avgRevenue:s.avgRevenue,clients:s.clients,colors:r}});return e.jsxs(E,{children:[e.jsxs(G,{children:[e.jsx(Y,{children:"Revenue Distribution by Tier & Client"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Each bar is segmented by individual clients within the tier"})]}),e.jsxs($,{children:[e.jsx("div",{className:"h-[500px]",children:e.jsx(le,{width:"100%",height:"100%",children:e.jsxs(_e,{data:a,layout:"vertical",margin:{top:20,right:30,left:100,bottom:20},children:[e.jsx(je,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(ne,{type:"number",hide:!0}),e.jsx(ie,{dataKey:"tierName",type:"category",width:90,tick:{fontSize:13,fontWeight:500}}),e.jsx(oe,{content:e.jsx(mt,{})}),a.map((s,r)=>s.clients.map((c,o)=>e.jsx(xe,{dataKey:()=>c.revenue,stackId:r,fill:s.colors[o],radius:o===s.clients.length-1?[0,4,4,0]:[0,0,0,0],children:a.map((u,x)=>{const g=x===r;return e.jsx(ke,{fill:g?s.colors[o]:"transparent",stroke:g?"rgba(0,0,0,0.1)":"none",strokeWidth:.5,style:{cursor:"pointer"},onMouseEnter:d=>{g&&(d.target.style.opacity="0.8")},onMouseLeave:d=>{g&&(d.target.style.opacity="1")}},`cell-${r}-${o}-${x}`)})},`${r}-${o}`)))]})})}),e.jsx("div",{className:"mt-4 space-y-3",children:a.map((s,r)=>e.jsxs("div",{className:"border-t pt-3 first:border-t-0 first:pt-0",children:[e.jsx("p",{className:"font-semibold mb-2",children:s.tierName}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:s.clients.map((c,o)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm flex-shrink-0",style:{backgroundColor:s.colors[o]}}),e.jsx("span",{className:"truncate",title:`${c.name}: £${c.revenue.toLocaleString()}`,children:c.name})]},o))})]},r))})]})]})},xt=({active:t,payload:a})=>{if(t&&a&&a.length){const s=a[0].payload;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground mb-2",children:s.clientName}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total Hours:"})," ",s.totalHours.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Staff Assigned:"})," ",s.staffCount]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Shifts:"})," ",s.shiftCount]})]})]})}return null},ft=({data:t,medianHours:a,medianStaff:s})=>!t||t.length===0?e.jsxs(E,{children:[e.jsx(G,{children:e.jsx(Y,{children:"Client Workload vs Staff Coverage"})}),e.jsx($,{children:e.jsx("div",{className:"h-[500px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(E,{children:[e.jsxs(G,{children:[e.jsx(Y,{children:"Client Workload vs Staff Coverage"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Each dot represents a client. Dashed lines show median values."})]}),e.jsxs($,{children:[e.jsx("div",{className:"h-[550px]",children:e.jsx(le,{width:"100%",height:"100%",children:e.jsxs(rt,{margin:{top:20,right:30,bottom:70,left:70},children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ne,{type:"number",dataKey:"totalHours",name:"Total Paid Hours",tickFormatter:r=>r.toLocaleString(),children:e.jsx(Re,{value:"Total Paid Hours",position:"bottom",offset:50,style:{fontSize:14,fontWeight:500}})}),e.jsx(ie,{type:"number",dataKey:"staffCount",name:"Staff Count",allowDecimals:!1,children:e.jsx(Re,{value:"Staff Assigned",angle:-90,position:"left",offset:50,style:{fontSize:14,fontWeight:500}})}),e.jsx(oe,{content:e.jsx(xt,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ee,{x:a,stroke:"hsl(var(--primary))",strokeDasharray:"5 5",strokeWidth:2,label:{value:`Median: ${a.toLocaleString()}h`,position:"top",fill:"hsl(var(--primary))",fontSize:12}}),e.jsx(Ee,{y:s,stroke:"hsl(var(--chart-2))",strokeDasharray:"5 5",strokeWidth:2,label:{value:`Median: ${s} staff`,position:"right",fill:"hsl(var(--chart-2))",fontSize:12}}),e.jsx(Be,{data:t,fill:"hsl(var(--primary))",fillOpacity:.7,strokeWidth:1,stroke:"hsl(var(--primary))"})]})})}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 md:grid-cols-4 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:t.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Median Hours"}),e.jsx("p",{className:"text-2xl font-bold",children:a.toLocaleString()})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Median Staff"}),e.jsx("p",{className:"text-2xl font-bold",children:Math.round(s)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:t.reduce((r,c)=>r+c.shiftCount,0).toLocaleString()})]})]})]})]}),gt=({dateRange:t,locations:a=[],sites:s=[]})=>{const[r,c]=i.useState("calendar"),[o,u]=i.useState([]),[x,g]=i.useState([]),[d,v]=i.useState([]),[l,b]=i.useState([]),[y,C]=i.useState(!1),[j,I]=i.useState(33),[k,W]=i.useState(67),[P,K]=i.useState(!1);i.useEffect(()=>{(async()=>{C(!0);try{const n=new URLSearchParams({start:T(t.from,"yyyy-MM-dd"),end:T(t.to,"yyyy-MM-dd"),view_type:r});a&&a.length>0&&a.forEach(X=>n.append("locations",X)),s&&s.length>0&&s.forEach(X=>n.append("sites",X));const S={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},M=await fetch(`/api/dashboard/shifts-heatmap?${n.toString()}`,{headers:S,credentials:"include"});if(!M.ok){console.error(`Heatmap API returned ${M.status}`);return}const L=await M.json();L.view_type==="calendar"?u(L.data||[]):(g(L.data||[]),v(L.locations||[]),b(L.dates||[]))}catch(n){console.error("Error fetching heatmap data:",n)}finally{C(!1)}})()},[t,a,s,r]);const Q=()=>Math.max(...r==="calendar"?o.map(m=>m.shift_count):x.map(m=>m.shift_count),1),V=m=>{const n=Q(),S=m/n*100;return S===0?"#f8f9fa":S<j?"#d4edda":S<k?"#fff3cd":"#f8d7da"},B=(m,n)=>{const S=x.find(M=>M.location===m&&M.date===n);return S?S.shift_count:0};return e.jsxs(E,{children:[e.jsxs(G,{children:[e.jsx(Y,{children:"Shift Density Heatmap"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Visualize shift distribution to identify peak workload periods"}),e.jsxs("div",{className:"mt-4 p-4 border rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(R,{className:"font-semibold",children:"Intensity Thresholds (%)"}),e.jsx(q,{variant:"outline",size:"sm",onClick:()=>K(!P),children:P?"Done":"Edit"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs(R,{className:"text-xs",children:["Low (","<"," ",j,"%)"]}),P?e.jsx(ue,{type:"number",min:"0",max:"100",value:j,onChange:m=>I(Number(m.target.value)),className:"mt-1"}):e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#d4edda"}}),e.jsxs("span",{className:"text-sm",children:["0-",j,"%"]})]})]}),e.jsxs("div",{children:[e.jsxs(R,{className:"text-xs",children:["Medium (",j,"-",k,"%)"]}),P?e.jsx(ue,{type:"number",min:"0",max:"100",value:k,onChange:m=>W(Number(m.target.value)),className:"mt-1"}):e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#fff3cd"}}),e.jsxs("span",{className:"text-sm",children:[j,"-",k,"%"]})]})]}),e.jsxs("div",{children:[e.jsxs(R,{className:"text-xs",children:["High (",">="," ",k,"%)"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#f8d7da"}}),e.jsxs("span",{className:"text-sm",children:[k,"-100%"]})]})]})]})]})]}),e.jsx($,{children:e.jsxs(Me,{value:r,onValueChange:m=>c(m),children:[e.jsxs(ve,{className:"mb-4",children:[e.jsx(D,{value:"calendar",children:"Calendar View"}),e.jsx(D,{value:"location_day",children:"By Location"})]}),e.jsx(H,{value:"calendar",children:y?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):o.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No shift data available"}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2",children:o.map((m,n)=>e.jsxs("div",{className:"relative p-3 rounded-md border text-center cursor-pointer transition-all hover:shadow-md",style:{backgroundColor:V(m.shift_count)},title:`${m.date} (${m.day_of_week}): ${m.shift_count} shifts`,children:[e.jsx("div",{className:"text-xs font-medium",children:T(new Date(m.date),"MMM d")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:m.day_of_week.slice(0,3)}),e.jsx("div",{className:"text-lg font-bold mt-1",children:m.shift_count})]},n))}),e.jsxs("div",{className:"flex items-center justify-center gap-4 pt-4 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Intensity:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#d4edda"}}),e.jsx("span",{className:"text-xs",children:"Low"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#fff3cd"}}),e.jsx("span",{className:"text-xs",children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#f8d7da"}}),e.jsx("span",{className:"text-xs",children:"High"})]})]})]})}),e.jsx(H,{value:"location_day",children:y?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):d.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No location data available"}):e.jsxs("div",{className:"overflow-x-scroll max-w-full",children:[e.jsx("div",{className:"inline-block min-w-full",children:e.jsxs("table",{className:"border-collapse",style:{minWidth:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky left-0 bg-background border p-2 text-left font-medium text-sm",children:"Location"}),l.slice(0,31).map((m,n)=>e.jsx("th",{className:"border p-2 text-center text-xs whitespace-nowrap",children:T(new Date(m),"MMM d")},n))]})}),e.jsx("tbody",{children:d.map((m,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"sticky left-0 bg-background border p-2 font-medium text-sm",children:m}),l.slice(0,31).map((S,M)=>{const L=B(m,S);return e.jsx("td",{className:"border p-2 text-center text-sm cursor-pointer hover:opacity-80",style:{backgroundColor:V(L)},title:`${m} - ${S}: ${L} shifts`,children:L>0?L:""},M)})]},n))})]})}),l.length>31&&e.jsx("div",{className:"text-center text-sm text-muted-foreground mt-2",children:"Showing first 31 days. Adjust date range for focused view."}),e.jsxs("div",{className:"flex items-center justify-center gap-4 pt-4 border-t mt-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Intensity:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#d4edda"}}),e.jsx("span",{className:"text-xs",children:"Low"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#fff3cd"}}),e.jsx("span",{className:"text-xs",children:"Medium"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-4 rounded",style:{backgroundColor:"#f8d7da"}}),e.jsx("span",{className:"text-xs",children:"High"})]})]})]})})]})})]})},jt=t=>{const{x:a,y:s,width:r,height:c,stroke:o,fill:u,payload:x,yAxis:g}=t;if(!x||!g||!g.scale)return null;const d=t.yAxis.scale(x.min),v=t.yAxis.scale(x.q1),l=t.yAxis.scale(x.median),b=t.yAxis.scale(x.q3),y=t.yAxis.scale(x.max),C=a+r/2,j=r/2;return e.jsxs("g",{children:[e.jsx("line",{x1:C,y1:y,x2:C,y2:d,stroke:o,strokeWidth:1}),e.jsx("line",{x1:C-j/2,y1:y,x2:C+j/2,y2:y,stroke:o,strokeWidth:1}),e.jsx("line",{x1:C-j/2,y1:d,x2:C+j/2,y2:d,stroke:o,strokeWidth:1}),e.jsx("rect",{x:a,y:b,width:r,height:Math.abs(v-b),stroke:o,fill:u,fillOpacity:.6}),e.jsx("line",{x1:a,y1:l,x2:a+r,y2:l,stroke:o,strokeWidth:2}),x.outliers&&x.outliers.map((I,k)=>e.jsx("circle",{cx:C,cy:t.yAxis.scale(I),r:2,fill:"#ef4444",opacity:.6},k))]})},pt=({active:t,payload:a,label:s})=>{if(t&&a&&a.length){const r=a[0].payload;return e.jsxs("div",{className:"bg-popover border text-popover-foreground p-3 rounded-lg shadow-md text-sm",children:[e.jsx("p",{className:"font-semibold mb-2",children:r.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Max:"}),e.jsxs("span",{className:"font-medium",children:[r.max.toFixed(1),"h"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Q3 (75%):"}),e.jsxs("span",{className:"font-medium",children:[r.q3.toFixed(1),"h"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Median:"}),e.jsxs("span",{className:"font-medium text-primary",children:[r.median.toFixed(1),"h"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Q1 (25%):"}),e.jsxs("span",{className:"font-medium",children:[r.q1.toFixed(1),"h"]})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"Min:"}),e.jsxs("span",{className:"font-medium",children:[r.min.toFixed(1),"h"]})]}),r.outliers.length>0&&e.jsxs("div",{className:"flex justify-between gap-4 pt-1 border-t mt-1",children:[e.jsx("span",{className:"text-destructive",children:"Outliers:"}),e.jsx("span",{className:"font-medium",children:r.outliers.length})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 pt-1 border-t",children:["Sample size: ",r.count," shifts"]})]})]})}return null},vt=({dateRange:t,limit:a=15})=>{const[s,r]=i.useState("client"),[c,o]=i.useState([]),[u,x]=i.useState(!1);return i.useEffect(()=>{(async()=>{x(!0);try{const d=new URLSearchParams({start:T(t.from,"yyyy-MM-dd"),end:T(t.to,"yyyy-MM-dd"),dimension:s,limit:a.toString()}),v={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},l=await fetch(`${re.HOURS_DISTRIBUTION}?${d.toString()}`,{headers:v});if(l.ok){const b=await l.json();o(b)}}catch(d){console.error("Error fetching distribution data:",d)}finally{x(!1)}})()},[t,s,a]),e.jsxs(E,{children:[e.jsxs(G,{children:[e.jsx(Y,{children:"Hours Distribution"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Showing spread of shift durations. Box represents middle 50% of data."})]}),e.jsx($,{children:e.jsxs(Me,{value:s,onValueChange:g=>r(g),children:[e.jsxs(ve,{className:"mb-6",children:[e.jsx(D,{value:"client",children:"By Client"}),e.jsx(D,{value:"site",children:"By Site"}),e.jsx(D,{value:"staff",children:"By Staff"})]}),e.jsxs("div",{className:"h-[400px] w-full",children:[u?e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"Loading distribution data..."}):c.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:"No data available for selected period"}):e.jsx(le,{width:"100%",height:"100%",children:e.jsxs(Is,{data:c,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(je,{strokeDasharray:"3 3",vertical:!1,opacity:.3}),e.jsx(ne,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:{fontSize:12}}),e.jsx(ie,{label:{value:"Hours Worked",angle:-90,position:"insideLeft",style:{textAnchor:"middle"}}}),e.jsx(oe,{content:e.jsx(pt,{}),cursor:{fill:"transparent"}}),e.jsx(xe,{dataKey:"max",fill:"transparent",barSize:1}),e.jsx(xe,{dataKey:"median",shape:jt,fill:"#3b82f6",stroke:"#1e40af",barSize:40})]})}),!u&&c.length>0&&e.jsx("div",{className:"text-center text-xs text-muted-foreground mt-2",children:"* Whiskers extend to 1.5x IQR. Dots represent outliers."})]})]})})]})},we=["January","February","March","April","May","June","July","August","September","October","November","December"],Ie=["Rent","Salaries","Utilities","Software","Equipment","Marketing","Travel","Insurance","Taxes","Maintenance","Custom..."],yt=({open:t,onOpenChange:a,initialData:s,onSave:r})=>{var B,m;const{data:c}=st(),[o,u]=i.useState(!1),[x,g]=i.useState(new Date().getFullYear()),[d,v]=i.useState(we[new Date().getMonth()]),[l,b]=i.useState(""),[y,C]=i.useState(""),[j,I]=i.useState(""),[k,W]=i.useState(""),[P,K]=i.useState("");i.useEffect(()=>{t&&(s?(g(s.year),v(s.month),b(s.location||""),C(s.site||""),K(s.value.toString()),Ie.includes(s.name)?(I(s.name),W("")):(I("Custom..."),W(s.name))):(g(new Date().getFullYear()),v(we[new Date().getMonth()]),b(""),C(""),I(""),W(""),K("")))},[t,s]);const Q=async()=>{if(!l||!j||!P){U.error("Please fill in all required fields");return}const n=j==="Custom..."?k:j;if(!n){U.error("Please specify the overhead name");return}u(!0);try{await r({id:s==null?void 0:s.id,year:x,month:d,location:l,site:y||null,name:n,value:parseFloat(P)}),a(!1)}catch(S){console.error("Failed to save overhead:",S)}finally{u(!1)}},V=((B=c==null?void 0:c.jobs)==null?void 0:B.filter(n=>n.location===l&&n.site).map(n=>n.site).filter((n,S,M)=>M.indexOf(n)===S))||[];return e.jsx(Ys,{open:t,onOpenChange:a,children:e.jsxs(Qs,{className:"sm:max-w-[500px]",children:[e.jsxs(Js,{children:[e.jsx(Xs,{children:s?"Edit Overhead":"Add Overhead"}),e.jsx(Zs,{children:s?"Update existing overhead record.":"Create a new overhead record."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:"Year"}),e.jsxs(ee,{value:x.toString(),onValueChange:n=>g(Number(n)),children:[e.jsx(se,{children:e.jsx(te,{})}),e.jsx(ae,{children:[2024,2025,2026,2027,2028].map(n=>e.jsx(J,{value:n.toString(),children:n},n))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:"Month"}),e.jsxs(ee,{value:d,onValueChange:v,children:[e.jsx(se,{children:e.jsx(te,{})}),e.jsx(ae,{children:we.map(n=>e.jsx(J,{value:n,children:n},n))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:"Location"}),e.jsxs(ee,{value:l,onValueChange:n=>{b(n),C("")},children:[e.jsx(se,{children:e.jsx(te,{placeholder:"Select location..."})}),e.jsx(ae,{children:Array.from(new Set((m=c==null?void 0:c.jobs)==null?void 0:m.map(n=>n.location).filter(Boolean))).map(n=>e.jsx(J,{value:n,children:n},n))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:"Site (Optional)"}),e.jsxs(ee,{value:y,onValueChange:C,disabled:!l||V.length===0,children:[e.jsx(se,{children:e.jsx(te,{placeholder:V.length===0?"No sites available":"Select site..."})}),e.jsxs(ae,{children:[e.jsx(J,{value:"all_sites",children:"All Sites (if applicable)"}),V.map(n=>e.jsx(J,{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:"Category"}),e.jsxs(ee,{value:j,onValueChange:I,children:[e.jsx(se,{children:e.jsx(te,{placeholder:"Select category..."})}),e.jsx(ae,{children:Ie.map(n=>e.jsx(J,{value:n,children:n},n))})]})]}),j==="Custom..."&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:"Custom Name"}),e.jsx(ue,{placeholder:"Enter overhead name",value:k,onChange:n=>W(n.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(R,{children:"Value (£)"}),e.jsx(ue,{type:"number",placeholder:"0.00",value:P,onChange:n=>K(n.target.value)})]})]}),e.jsxs(et,{children:[e.jsx(q,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsxs(q,{onClick:Q,disabled:o,children:[o&&e.jsx(js,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})})},qt=()=>{const{metricId:t}=ps(),a=vs(),{dateRange:s,setDateRange:r}=ys(),{role:c}=Ns(),[o,u]=i.useState(!1),[x,g]=i.useState(s),[d,v]=i.useState([]),[l,b]=i.useState([]),[y,C]=i.useState("trend"),[j,I]=i.useState([]),[k,W]=i.useState([]),[P,K]=i.useState([]),[Q,V]=i.useState({hours:0,staffCount:0}),[B,m]=i.useState([]),[n,S]=i.useState(!1),[M,L]=i.useState([]),[X,ce]=i.useState(!1),[ss,Le]=i.useState(null),[de,ye]=i.useState(null),he=["revenue","cost","profit","employees","clientRate","staffRate","overheads"].includes(t||""),Ne=["shifts","hours","clients","targetAchievement","missedTargets"].includes(t||""),De=t==="overheads",be=c==="admin",{operationalData:F,isLoading:ts}=Ps(s,d,l),{financialData:z,isLoading:as}=Os(s,d,l),rs=he?as:Ne?ts:!1;i.useEffect(()=>{if(t!=="missedTargets")return;(async()=>{try{const h=new URLSearchParams({start:T(s.from,"yyyy-MM-dd"),end:T(s.to,"yyyy-MM-dd")}),N={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},f=await fetch(`${re.TARGETS_PERFORMANCE}?${h.toString()}`,{headers:N});if(f.ok){const w=await f.json();L(w)}}catch(h){console.error("Error fetching targets performance:",h)}})()},[s,t]),i.useEffect(()=>{if(y==="trend"||!t)return;(async()=>{S(!0);try{const h=new URLSearchParams({start:T(s.from,"yyyy-MM-dd"),end:T(s.to,"yyyy-MM-dd"),metric:t,limit:"20"});d&&d.length>0&&d.forEach(f=>h.append("locations",f)),l&&l.length>0&&l.forEach(f=>h.append("sites",f));const N={Authorization:`Bearer ${localStorage.getItem("auth_token")}`};if(y==="details"&&De){const f=await fetch(`${re.FINANCIAL_METRICS_LIST}?${h.toString()}`,{headers:N});if(f.ok){const w=await f.json();m(w)}}else if(["location","site","client"].includes(y)){h.append("dimension",y);const f=await fetch(`${re.BREAKDOWN}?${h.toString()}`,{headers:N});if(f.ok){const w=await f.json();I(w)}}}catch(h){console.error("Error fetching breakdown:",h)}finally{S(!1)}})()},[y,t,s,d,l]),i.useEffect(()=>{t==="clients"&&y==="revenueTier"&&be&&(async()=>{try{const h=new URLSearchParams({start:T(s.from,"yyyy-MM-dd"),end:T(s.to,"yyyy-MM-dd")});d&&d.length>0&&d.forEach(w=>h.append("locations",w)),l&&l.length>0&&l.forEach(w=>h.append("sites",w));const N={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},f=await fetch(`/api/dashboard/client-revenue-tiers?${h.toString()}`,{headers:N});if(f.ok){const A=(await f.json()).tiers.map(Z=>({name:Z.tier,value:Z.totalRevenue,clientCount:Z.clientCount,avgRevenue:Z.avgRevenue,clients:Z.clients||[]}));W(A)}}catch(h){console.error("Error fetching revenue tiers:",h)}})()},[t,y,be,s,d,l]),i.useEffect(()=>{y==="trend"&&(async()=>{try{const h=new URLSearchParams({start:T(s.from,"yyyy-MM-dd"),end:T(s.to,"yyyy-MM-dd")});d&&d.length>0&&d.forEach(A=>h.append("locations",A)),l&&l.length>0&&l.forEach(A=>h.append("sites",A));const N={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},f=await fetch(`/api/dashboard/client-workload-scatter?${h.toString()}`,{headers:N});if(!f.ok){console.error(`❌ Workload scatter API failed (${f.status}): /api/dashboard/client-workload-scatter`);const A=await f.text();console.error("Response preview:",A.substring(0,200));return}const w=await f.json();K(w.data||[]),V(w.medians||{hours:0,staffCount:0})}catch(h){console.error("Error fetching workload data:",h)}})()},[y,s,d,l]);const ns=()=>{Le(null),ce(!0)},is=p=>{Le(p),ce(!0)},ls=async()=>{if(de)try{const p=await fetch(`/api/admin/financial-metrics/${de}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(p.ok)U.success("Overhead deleted"),y==="details"&&m(h=>h.filter(N=>N.id!==de));else{const h=await p.json();U.error(h.error||"Failed to delete")}}catch(p){console.error(p),U.error("Failed to delete")}finally{ye(null)}},os=async p=>{try{const h=await fetch("/api/admin/financial-metrics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(p)});if(h.ok){U.success("Overhead saved"),ce(!1);const N=new URLSearchParams({start:T(s.from,"yyyy-MM-dd"),end:T(s.to,"yyyy-MM-dd"),metric:t||"overheads",limit:"20"});d&&d.forEach(A=>N.append("locations",A)),l&&l.forEach(A=>N.append("sites",A));const f={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},w=await fetch(`${re.FINANCIAL_METRICS_LIST}?${N.toString()}`,{headers:f});if(w.ok){const A=await w.json();m(A)}}else{const N=await h.json();U.error(N.error||"Failed to save")}}catch(h){console.error(h),U.error("Failed to save")}},cs=p=>{switch(p){case"revenue":return"Revenue Analysis";case"cost":return"Cost Analysis";case"profit":return"Profit Analysis";case"shifts":return"Shifts Analysis";case"hours":return"Hours Analysis";case"clients":return"Client Analysis";case"employees":return"Employee Analysis";case"targetAchievement":return"Target Achievement Analysis";case"missedTargets":return"Missed Targets Analysis";case"clientRate":return"Client Rate Analysis";case"staffRate":return"Staff Rate Analysis";case"overheads":return"Overheads Analysis";default:return"Metric Analysis"}},ds=i.useMemo(()=>{if(!B||B.length===0)return[];const p=B.reduce((h,N)=>{const f=N.name||"Unknown";return h[f]||(h[f]=0),h[f]+=N.value,h},{});return Object.entries(p).map(([h,N])=>({name:h,value:N}))},[B]);return he?z==null||z.timeSeries:F==null||F.timeSeries,e.jsx(Ls,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(Es,{dateRange:s,onDateRangeChange:r,calendarOpen:o,onCalendarOpenChange:u,tempDateRange:x,onTempDateRangeChange:g,selectedLocations:d,onLocationsChange:v,selectedSites:l,onSitesChange:b}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6 relative",children:[(rs||n)&&e.jsx(Fs,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(q,{variant:"ghost",size:"sm",onClick:()=>a(-1),className:"gap-2",children:[e.jsx(at,{className:"h-4 w-4"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold",children:cs(t)})]}),e.jsxs(Me,{value:y,onValueChange:C,className:"space-y-4",children:[e.jsxs(ve,{children:[e.jsx(D,{value:"trend",children:"Trend"}),e.jsx(D,{value:"location",children:"By Location"}),e.jsx(D,{value:"site",children:"By Site"}),t!=="clients"&&e.jsx(D,{value:"client",children:"By Clients"}),t==="clients"&&be&&e.jsx(D,{value:"revenueTier",children:"By Revenue Tier"}),De&&e.jsx(D,{value:"details",children:"All Details"})]}),e.jsx(H,{value:"trend",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[t==="clients"&&e.jsx(ft,{data:P,medianHours:Q.hours,medianStaff:Q.staffCount}),t==="shifts"&&e.jsx(gt,{dateRange:s,locations:d,sites:l}),he&&e.jsx(zs,{data:(z==null?void 0:z.timeSeries)||[],aggregationLevel:(z==null?void 0:z.aggregationLevel)||"monthly",selectedMetric:t}),Ne&&t!=="missedTargets"&&t!=="shifts"&&t!=="hours"&&e.jsx(Bs,{data:(F==null?void 0:F.timeSeries)||[],aggregationLevel:(F==null?void 0:F.aggregationLevel)||"monthly",selectedMetric:t}),t==="hours"&&e.jsx(vt,{dateRange:s}),t==="missedTargets"&&e.jsx(_s,{data:M}),!he&&!Ne&&e.jsx(E,{children:e.jsx($,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Metric type not recognized or data unavailable."})})})]})}),e.jsx(H,{value:"location",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Ce,{data:j,metric:t||"revenue"}),e.jsx(me,{data:j,metric:t||"revenue"})]})}),e.jsx(H,{value:"site",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Ce,{data:j,metric:t||"revenue"}),e.jsx(me,{data:j,metric:t||"revenue"})]})}),e.jsx(H,{value:"client",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(Ce,{data:j,metric:t||"revenue"}),e.jsx(me,{data:j,metric:t||"revenue"})]})}),e.jsx(H,{value:"revenueTier",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(ut,{data:k}),e.jsxs(E,{children:[e.jsx(G,{children:e.jsx(Y,{children:"Tier Breakdown"})}),e.jsx($,{children:e.jsxs(Oe,{children:[e.jsx(Fe,{children:e.jsxs(fe,{children:[e.jsx(_,{children:"Tier"}),e.jsx(_,{className:"text-right",children:"Clients"}),e.jsx(_,{className:"text-right",children:"Total Revenue"}),e.jsx(_,{className:"text-right",children:"Avg Revenue/Client"})]})}),e.jsx(ze,{children:k.map(p=>e.jsxs(fe,{children:[e.jsx(O,{className:"font-medium",children:p.name}),e.jsx(O,{className:"text-right",children:p.clientCount}),e.jsxs(O,{className:"text-right",children:["£",p.value.toLocaleString()]}),e.jsxs(O,{className:"text-right",children:["£",p.avgRevenue.toLocaleString()]})]},p.name))})]})})]})]})}),e.jsx(H,{value:"details",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(me,{data:ds,metric:"overheads"})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(q,{onClick:ns,className:"gap-2",children:[e.jsx(tt,{className:"h-4 w-4"}),"Add Overhead"]})}),e.jsx(dt,{data:B,onEdit:is,onDelete:ye}),e.jsx(yt,{open:X,onOpenChange:ce,initialData:ss,onSave:os}),e.jsx(bs,{open:!!de,onOpenChange:p=>!p&&ye(null),children:e.jsxs(Ss,{children:[e.jsxs(Cs,{children:[e.jsx(ws,{children:"Are you sure?"}),e.jsx(Ts,{children:"This will permanently delete this overhead record."})]}),e.jsxs(ks,{children:[e.jsx(As,{children:"Cancel"}),e.jsx(Ms,{onClick:ls,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})})]})]})]})})};export{qt as default};
