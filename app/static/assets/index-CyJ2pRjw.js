const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-D6GaCze-.js","assets/index-DkaKKDeW.js","assets/index-DNNbaSSC.css","assets/card-CgnxsyMo.js","assets/trending-up-BMTW-IdI.js","assets/popover-CA8YgGPY.js","assets/button-CSIp_jet.js","assets/DashboardLayout-DkyaHgay.js","assets/users-Cux6RX16.js","assets/ChartCanvas-umXigVPk.js","assets/badge-ex2AWmGN.js","assets/AreaChart-BinH2asD.js","assets/BarChart-BUGM8aDw.js"])))=>i.map(i=>d[i]);
import{r as i,j as e,b as P,S as I,_ as N}from"./index-DkaKKDeW.js";import{D as E}from"./DashboardLayout-DkyaHgay.js";import{L as w}from"./label-fmofhqwp.js";import{S as R,a as A,b as B,c as z,d as f}from"./select-DE5PmNW9.js";import{B as j}from"./button-CSIp_jet.js";import{g as D,P as O,b as V,C as F,f as h,c as $,d as Y}from"./popover-CA8YgGPY.js";import"./users-Cux6RX16.js";const U=()=>{const[s,l]=i.useState({dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0});return{state:s,setDimensions:n=>{l(r=>({...r,dimensions:n}))},setMetrics:n=>{l(r=>({...r,metrics:n}))},setChartType:n=>{l(r=>({...r,chartType:n}))},setDateRange:n=>{l(r=>({...r,dateRange:n}))},addCustomMetric:n=>{l(r=>({...r,customMetrics:[...r.customMetrics,n]}))},setChartData:n=>{l(r=>({...r,chartData:n}))},setDraggedItem:n=>{l(r=>({...r,draggedItem:n}))}}},q=i.lazy(()=>N(()=>import("./MetricPalette-D6GaCze-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),G=i.lazy(()=>N(()=>import("./ChartCanvas-umXigVPk.js"),__vite__mapDeps([9,1,2,10,11,12])));function ee(){const{state:s,setDimensions:l,setMetrics:x,setChartType:v,setDateRange:y,setChartData:d}=U(),[t,g]=i.useState({from:new Date(2022,0,20),to:D(new Date(2022,0,20),20)}),[a,n]=i.useState({from:new Date(2022,0,20),to:D(new Date(2022,0,20),20)}),[r,u]=i.useState(!1),b=()=>{t!=null&&t.from&&t.to&&(n(t),y({from:t.from,to:t.to}),u(!1))};i.useEffect(()=>{(async()=>{if(s.dimensions.length===0||s.metrics.length===0||!(a!=null&&a.from)||!(a!=null&&a.to)){d([]);return}const m=s.dimensions[0],_=s.metrics,T=h(a.from,"yyyy-MM-dd"),k=h(a.to,"yyyy-MM-dd");try{const c=new URLSearchParams;c.append("start",T),c.append("end",k),c.append("dimension",m),_.forEach(p=>c.append("metrics",p));const C=await fetch(`/api/chart-data?${c.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(C.ok){const p=await C.json();d(p)}else console.error("Failed to fetch chart data"),d([])}catch(c){console.error("Error fetching chart data:",c),d([])}})()},[s.dimensions,s.metrics,a]);const S=o=>{o.type==="dimension"?s.dimensions.includes(o.name)||l([o.name]):o.type==="metric"&&(s.metrics.includes(o.name)||x([...s.metrics,o.name]))},L=o=>{l(s.dimensions.filter(m=>m!==o))},M=o=>{x(s.metrics.filter(m=>m!==o))};return e.jsx(E,{children:e.jsx("div",{className:"p-4 md:p-6 h-full flex flex-col",children:e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsx("div",{className:"sticky lg:top-0 z-30 pb-4 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-2 shadow-sm bg-background",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Chart Builder"}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-base",children:"Click on metrics and dimensions to build your chart"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1",children:[e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(w,{className:"text-xs text-muted-foreground",children:"Chart Type"}),e.jsxs(R,{value:s.chartType,onValueChange:v,children:[e.jsx(A,{className:"w-full",children:e.jsx(B,{placeholder:"Select chart type"})}),e.jsxs(z,{children:[e.jsx(f,{value:"bar",children:"Bar Chart"}),e.jsx(f,{value:"line",children:"Line Chart"}),e.jsx(f,{value:"area",children:"Area Chart"}),e.jsx(f,{value:"pie",children:"Pie Chart"})]})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(w,{className:"text-xs text-muted-foreground",children:"Date Range"}),e.jsxs(O,{open:r,onOpenChange:u,children:[e.jsx(V,{asChild:!0,children:e.jsxs(j,{id:"date",variant:"outline",className:P("w-[240px] justify-start text-left font-normal",!a&&"text-muted-foreground"),children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),a!=null&&a.from?a.to?e.jsxs(e.Fragment,{children:[h(a.from,"LLL dd, y")," -"," ",h(a.to,"LLL dd, y")]}):h(a.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsxs($,{className:"w-auto p-0",align:"start",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsx(Y,{initialFocus:!0,mode:"range",defaultMonth:t==null?void 0:t.from,selected:t,onSelect:g,numberOfMonths:2,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})}),e.jsxs("div",{className:"flex justify-end gap-2 p-3",children:[e.jsx(j,{size:"sm",variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(j,{size:"sm",onClick:b,disabled:!(t!=null&&t.from)||!(t!=null&&t.to),children:"Apply"})]})]})]})]})]})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(I,{className:"h-8 w-8 rounded-full"})}),children:e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 min-h-0 h-full",children:[e.jsx("div",{className:"lg:w-72 shrink-0 overflow-y-auto h-full pr-2",children:e.jsx(q,{onItemClick:S})}),e.jsx("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:e.jsx("div",{className:"bg-card rounded-lg border p-4 flex-1 flex flex-col min-h-0 overflow-y-auto",children:e.jsx(G,{dimensions:s.dimensions,metrics:s.metrics,chartType:s.chartType,chartData:s.chartData,onRemoveDimension:L,onRemoveMetric:M})})})]})})})]})})})}export{ee as default};
