import{r as d,a as L,A as T,j as e,c as k,u as A,b as P,d as M,B as v}from"./index-Cmp3SBtg.js";import{D as E,L as F}from"./DashboardLayout-CCxWjJqY.js";import{f as y}from"./popover-hS7Hrdx4.js";import{u as O,c as $,D as z,R as K}from"./RankingList-BhSxefpm.js";import{C as l,a as f,b as j,d as o}from"./card-DY8SD6M5.js";import{R as I,C as U,X as W,Y as B,T as Y,L as _,A as N}from"./generateCategoricalChart-DuoElswF.js";import{A as G}from"./AreaChart-B-YekndO.js";import{T as H}from"./users-CCzvHyiO.js";import{P as V}from"./pound-sterling-DUIBuXyW.js";import"./locationUtils-gIoLlFtp.js";import"./index-DxluRzuh.js";import"./progress-BEzPzrKb.js";import"./ellipsis-CTtsMHF5.js";const X=(s,t,a)=>{const[r,x]=d.useState(null),[p,m]=d.useState(!1),{toast:c}=L(),h=async()=>{m(!0);try{const i=new URLSearchParams({start:y(s.from,"yyyy-MM-dd"),end:y(s.to,"yyyy-MM-dd")});t&&t.length>0&&t.forEach(n=>i.append("locations",n)),a&&a.length>0&&a.forEach(n=>i.append("sites",n));const u=await fetch(`${T.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(u.ok){const n=await u.json();x(n)}else c({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch{c({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{m(!1)}};return d.useEffect(()=>{h()},[s,t,a]),{financialData:r,isLoading:p,refetch:h}};function g({title:s,value:t,change:a,trend:r="neutral"}){return e.jsxs(l,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(f,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(j,{className:"text-sm font-medium text-muted-foreground",children:s})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t}),a&&e.jsx("p",{className:k("text-xs mt-1",r==="up"&&"text-accent",r==="down"&&"text-destructive",r==="neutral"&&"text-muted-foreground"),children:a})]})]})}const q=({metrics:s})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 w-full",children:[e.jsx(g,{title:"Total Revenue",value:`£${s.revenue.value.toLocaleString()}`,change:s.revenue.text,trend:s.revenue.trend}),e.jsx(g,{title:"Average Client Pay",value:`£${s.clientPay.value.toFixed(2)}`,change:s.clientPay.text,trend:s.clientPay.trend}),e.jsx(g,{title:"Average Staff Pay",value:`£${s.staffPay.value.toFixed(2)}`,change:s.staffPay.text,trend:s.staffPay.trend})]}),J=({salesData:s})=>{var t;return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(l,{children:e.jsx(o,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalShifts)||0})]})})})}),e.jsx(l,{children:e.jsx(o,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalClients)||0})]})})})}),e.jsx(l,{children:e.jsx(o,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.uniqueEmployees)||0})]})})})}),e.jsx(l,{children:e.jsx(o,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((t=s==null?void 0:s.profitMargin)==null?void 0:t.toFixed(1))||0,"%"]})]})})})})]})},Q=({active:s,payload:t,label:a})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:a}),t.map((r,x)=>e.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": £",Number(r.value).toLocaleString()]},x))]}):null,Z=({data:s,aggregationLevel:t})=>{const a={dataKey:"display",interval:0};return!s||s.length===0?e.jsxs(l,{children:[e.jsx(f,{children:e.jsx(j,{children:"Revenue vs Cost Trend"})}),e.jsx(o,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(l,{children:[e.jsxs(f,{children:[e.jsx(j,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t==="daily"&&"Daily view",t==="weekly"&&"Weekly view",t==="monthly"&&"Monthly view"]})]}),e.jsx(o,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(G,{data:s,children:[e.jsx(U,{strokeDasharray:"3 3"}),e.jsx(W,{dataKey:a.dataKey,tick:{fontSize:12},interval:a.interval}),e.jsx(B,{}),e.jsx(Y,{content:e.jsx(Q,{})}),e.jsx(_,{}),e.jsx(N,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(N,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]})})})})]})},D=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})}),he=()=>{const s=A();P();const{dateRange:t,setDateRange:a}=M(),[r,x]=d.useState(!1),[p,m]=d.useState(t),[c,h]=d.useState([]),[i,u]=d.useState([]),{financialData:n,isLoading:b}=X(t,c,i),{topClientsRevenue:C,isLoadingClientsRev:w}=O(t,c,i),S=$(n,t);return e.jsx(E,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(z,{dateRange:t,onDateRangeChange:a,calendarOpen:r,onCalendarOpenChange:x,tempDateRange:p,onTempDateRangeChange:m,selectedLocations:c,onLocationsChange:h,selectedSites:i,onSitesChange:u}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"px-4 pt-6 pb-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(v,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(H,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(v,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>s("/dashboard/operational"),children:[e.jsx(F,{className:"h-4 w-4"}),"Operational View"]})]})}),b&&e.jsx(D,{}),e.jsx(q,{metrics:S}),e.jsx(J,{salesData:n}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(l,{className:"col-span-5",children:[e.jsx(f,{children:e.jsx(j,{children:"Revenue Overview"})}),e.jsx(o,{className:"pl-2",children:e.jsx(Z,{data:(n==null?void 0:n.timeSeries)||[],aggregationLevel:(n==null?void 0:n.aggregationLevel)||"monthly"})})]}),e.jsx("div",{className:"col-span-2 flex flex-col gap-4 h-full",children:e.jsx(K,{title:"Top Clients (Revenue)",data:C,isLoading:w,valueFormatter:R=>`£${R.toLocaleString()}`,icon:e.jsx(V,{className:"h-4 w-4"}),className:"h-full",barColor:"bg-green-500"})})]})]})})]})})};export{he as FinancialDashboard,he as default};
