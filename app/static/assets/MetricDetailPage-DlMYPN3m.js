import{c as ts,h as rs,r as o,U as ns,p as is,j as e,v as os,P as oe,q as me,w as ls,e as ye,B as H,I as Re,L as cs,y as L,ab as ds,u as hs,d as us,a3 as ms,a4 as xs,a5 as gs,a6 as vs,a7 as fs,a8 as js,a9 as ps,aa as ys,A as re}from"./index-Bnq4W1TT.js";import{D as bs}from"./DashboardLayout-DadV97mf.js";import{C as $,d as B,a as ge,b as ve}from"./card-bROFo5-s.js";import{c as Me,R as Ns,I as Ss,P as Cs}from"./index-BgfvIStJ.js";import{D as Ts}from"./DashboardHeader-rIxB-IvY.js";import{u as As,O as Rs,T as Ds}from"./TargetPerformanceChart-E1E80gyi.js";import{u as Ls,L as Ms,R as ks}from"./LoadingOverlay-DrTsUe8v.js";import{R as ke,C as ws,X as Es,Y as Fs,T as we,B as Is,a as Ee,L as Ps}from"./generateCategoricalChart-DF7p8fQ4.js";import{B as Os}from"./BarChart-C-1f8ZK1.js";import{P as $s,a as Bs}from"./PieChart-C0MC7x0Q.js";import{T as fe,a as je,b as O,c as b,d as pe,e as y,f as _s}from"./table-C7E8Gghq.js";import{P as Vs}from"./pen-CN9zEM7x.js";import{T as Hs}from"./trash-2-BMAogA96.js";import{D as zs,b as Gs,c as Us,d as Ks,f as Ys,e as qs}from"./dialog-BqZMfDpZ.js";import{L as F}from"./label-BXrmhNX5.js";import{S as K,a as Y,b as q,c as J,d as V}from"./select-BilDw56G.js";import{u as Js}from"./useRecords-gYaMFoeI.js";import{f as D}from"./popover-pg7jFuoZ.js";import"./users-BGrnonBw.js";import"./locationUtils-zKOuSrvB.js";import"./index-Dd04voAI.js";import"./AreaChart-D-51eEMD.js";import"./useQuery-DZC002d6.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=ts("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var le="Tabs",[Xs,Da]=rs(le,[Me]),Fe=Me(),[Qs,be]=Xs(le),Ie=o.forwardRef((s,n)=>{const{__scopeTabs:a,value:l,onValueChange:d,defaultValue:u,orientation:h="horizontal",dir:p,activationMode:x="automatic",...S}=s,c=ns(p),[v,f]=is({prop:l,onChange:d,defaultProp:u??"",caller:le});return e.jsx(Qs,{scope:a,baseId:os(),value:v,onValueChange:f,orientation:h,dir:c,activationMode:x,children:e.jsx(oe.div,{dir:c,"data-orientation":h,...S,ref:n})})});Ie.displayName=le;var Pe="TabsList",Oe=o.forwardRef((s,n)=>{const{__scopeTabs:a,loop:l=!0,...d}=s,u=be(Pe,a),h=Fe(a);return e.jsx(Ns,{asChild:!0,...h,orientation:u.orientation,dir:u.dir,loop:l,children:e.jsx(oe.div,{role:"tablist","aria-orientation":u.orientation,...d,ref:n})})});Oe.displayName=Pe;var $e="TabsTrigger",Be=o.forwardRef((s,n)=>{const{__scopeTabs:a,value:l,disabled:d=!1,...u}=s,h=be($e,a),p=Fe(a),x=He(h.baseId,l),S=ze(h.baseId,l),c=l===h.value;return e.jsx(Ss,{asChild:!0,...p,focusable:!d,active:c,children:e.jsx(oe.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":S,"data-state":c?"active":"inactive","data-disabled":d?"":void 0,disabled:d,id:x,...u,ref:n,onMouseDown:me(s.onMouseDown,v=>{!d&&v.button===0&&v.ctrlKey===!1?h.onValueChange(l):v.preventDefault()}),onKeyDown:me(s.onKeyDown,v=>{[" ","Enter"].includes(v.key)&&h.onValueChange(l)}),onFocus:me(s.onFocus,()=>{const v=h.activationMode!=="manual";!c&&!d&&v&&h.onValueChange(l)})})})});Be.displayName=$e;var _e="TabsContent",Ve=o.forwardRef((s,n)=>{const{__scopeTabs:a,value:l,forceMount:d,children:u,...h}=s,p=be(_e,a),x=He(p.baseId,l),S=ze(p.baseId,l),c=l===p.value,v=o.useRef(c);return o.useEffect(()=>{const f=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(f)},[]),e.jsx(ls,{present:d||c,children:({present:f})=>e.jsx(oe.div,{"data-state":c?"active":"inactive","data-orientation":p.orientation,role:"tabpanel","aria-labelledby":x,hidden:!f,id:S,tabIndex:0,...h,ref:n,style:{...s.style,animationDuration:v.current?"0s":void 0},children:f&&u})})});Ve.displayName=_e;function He(s,n){return`${s}-trigger-${n}`}function ze(s,n){return`${s}-content-${n}`}var Zs=Ie,Ge=Oe,Ue=Be,Ke=Ve;const ea=Zs,Ye=o.forwardRef(({className:s,...n},a)=>e.jsx(Ge,{ref:a,className:ye("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...n}));Ye.displayName=Ge.displayName;const I=o.forwardRef(({className:s,...n},a)=>e.jsx(Ue,{ref:a,className:ye("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...n}));I.displayName=Ue.displayName;const P=o.forwardRef(({className:s,...n},a)=>e.jsx(Ke,{ref:a,className:ye("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...n}));P.displayName=Ke.displayName;const sa=({active:s,payload:n,label:a,metric:l})=>{if(s&&n&&n.length){const d=["clients","employees","shifts","hours"].includes(l),u=n[0].value;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:a}),e.jsx("p",{className:"text-sm",children:d?u.toLocaleString():u.toLocaleString(void 0,{style:"currency",currency:"GBP"})})]})}return null},ne=({data:s,metric:n,onBarClick:a})=>!s||s.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No breakdown data available"})}):e.jsx($,{children:e.jsx(B,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(ke,{width:"100%",height:"100%",children:e.jsxs(Os,{data:s,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(ws,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(Es,{type:"number",hide:!0}),e.jsx(Fs,{dataKey:"name",type:"category",width:120,tick:{fontSize:12}}),e.jsx(we,{content:e.jsx(sa,{metric:n})}),e.jsx(Is,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0],onClick:a,children:s.map((l,d)=>e.jsx(Ee,{fill:"hsl(var(--primary))",fillOpacity:.8+d*.05},`cell-${d}`))})]})})})})}),De=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#8dd1e1","#a4de6c","#d0ed57"],aa=({active:s,payload:n})=>s&&n&&n.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:n[0].name}),e.jsx("p",{className:"text-sm",children:Number(n[0].value).toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:`${(n[0].payload.percentage||0).toFixed(1)}%`})]}):null,ie=({data:s,metric:n})=>{if(!s||s.length===0)return e.jsx($,{children:e.jsx(B,{className:"pt-6",children:e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No distribution data available"})})})});const a=[...s].sort((u,h)=>h.value-u.value),l=a.reduce((u,h)=>u+h.value,0),d=a.map(u=>({...u,percentage:l>0?u.value/l*100:0}));return e.jsx($,{children:e.jsx(B,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(ke,{width:"100%",height:"100%",children:e.jsxs($s,{children:[e.jsx(Bs,{data:d,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",children:d.map((u,h)=>e.jsx(Ee,{fill:De[h%De.length]},`cell-${h}`))}),e.jsx(we,{content:e.jsx(aa,{})}),e.jsx(Ps,{})]})})})})})},ta=({data:s,onEdit:n,onDelete:a})=>!s||s.length===0?e.jsx("div",{className:"h-[200px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No overhead details available"})}):e.jsxs($,{children:[e.jsx(ge,{children:e.jsx(ve,{children:"Overheads Details"})}),e.jsx(B,{children:e.jsxs(fe,{children:[e.jsx(je,{children:e.jsxs(O,{children:[e.jsx(b,{children:"Title"}),e.jsx(b,{children:"Month"}),e.jsx(b,{children:"Location"}),e.jsx(b,{children:"Site"}),e.jsx(b,{className:"text-right",children:"Amount"}),e.jsx(b,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(pe,{children:s.map(l=>e.jsxs(O,{children:[e.jsx(y,{className:"font-medium",children:l.name}),e.jsxs(y,{children:[l.month," ",l.year]}),e.jsx(y,{children:l.location||"-"}),e.jsx(y,{children:l.site||"-"}),e.jsx(y,{className:"text-right",children:l.value.toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-500 hover:text-blue-600",onClick:()=>n(l),children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx(H,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600",onClick:()=>a(l.id),children:e.jsx(Hs,{className:"h-4 w-4"})})]})})]},l.id))})]})})]}),xe=["January","February","March","April","May","June","July","August","September","October","November","December"],Le=["Rent","Salaries","Utilities","Software","Equipment","Marketing","Travel","Insurance","Taxes","Maintenance","Custom..."],ra=({open:s,onOpenChange:n,initialData:a,onSave:l})=>{var Z,ee;const{data:d}=Js(),[u,h]=o.useState(!1),[p,x]=o.useState(new Date().getFullYear()),[S,c]=o.useState(xe[new Date().getMonth()]),[v,f]=o.useState(""),[W,N]=o.useState(""),[M,k]=o.useState(""),[X,C]=o.useState(""),[w,z]=o.useState("");o.useEffect(()=>{s&&(a?(x(a.year),c(a.month),f(a.location||""),N(a.site||""),z(a.value.toString()),Le.includes(a.name)?(k(a.name),C("")):(k("Custom..."),C(a.name))):(x(new Date().getFullYear()),c(xe[new Date().getMonth()]),f(""),N(""),k(""),C(""),z("")))},[s,a]);const Q=async()=>{if(!v||!M||!w){L.error("Please fill in all required fields");return}const r=M==="Custom..."?X:M;if(!r){L.error("Please specify the overhead name");return}h(!0);try{await l({id:a==null?void 0:a.id,year:p,month:S,location:v,site:W||null,name:r,value:parseFloat(w)}),n(!1)}catch(G){console.error("Failed to save overhead:",G)}finally{h(!1)}},_=((Z=d==null?void 0:d.jobs)==null?void 0:Z.filter(r=>r.location===v&&r.site).map(r=>r.site).filter((r,G,se)=>se.indexOf(r)===G))||[];return e.jsx(zs,{open:s,onOpenChange:n,children:e.jsxs(Gs,{className:"sm:max-w-[500px]",children:[e.jsxs(Us,{children:[e.jsx(Ks,{children:a?"Edit Overhead":"Add Overhead"}),e.jsx(Ys,{children:a?"Update existing overhead record.":"Create a new overhead record."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Year"}),e.jsxs(K,{value:p.toString(),onValueChange:r=>x(Number(r)),children:[e.jsx(Y,{children:e.jsx(q,{})}),e.jsx(J,{children:[2024,2025,2026,2027,2028].map(r=>e.jsx(V,{value:r.toString(),children:r},r))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Month"}),e.jsxs(K,{value:S,onValueChange:c,children:[e.jsx(Y,{children:e.jsx(q,{})}),e.jsx(J,{children:xe.map(r=>e.jsx(V,{value:r,children:r},r))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Location"}),e.jsxs(K,{value:v,onValueChange:r=>{f(r),N("")},children:[e.jsx(Y,{children:e.jsx(q,{placeholder:"Select location..."})}),e.jsx(J,{children:Array.from(new Set((ee=d==null?void 0:d.jobs)==null?void 0:ee.map(r=>r.location).filter(Boolean))).map(r=>e.jsx(V,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Site (Optional)"}),e.jsxs(K,{value:W,onValueChange:N,disabled:!v||_.length===0,children:[e.jsx(Y,{children:e.jsx(q,{placeholder:_.length===0?"No sites available":"Select site..."})}),e.jsxs(J,{children:[e.jsx(V,{value:"all_sites",children:"All Sites (if applicable)"}),_.map(r=>e.jsx(V,{value:r,children:r},r))]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Category"}),e.jsxs(K,{value:M,onValueChange:k,children:[e.jsx(Y,{children:e.jsx(q,{placeholder:"Select category..."})}),e.jsx(J,{children:Le.map(r=>e.jsx(V,{value:r,children:r},r))})]})]}),M==="Custom..."&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Custom Name"}),e.jsx(Re,{placeholder:"Enter overhead name",value:X,onChange:r=>C(r.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{children:"Value (£)"}),e.jsx(Re,{type:"number",placeholder:"0.00",value:w,onChange:r=>z(r.target.value)})]})]}),e.jsxs(qs,{children:[e.jsx(H,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsxs(H,{onClick:Q,disabled:u,children:[u&&e.jsx(cs,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})})},La=()=>{const{metricId:s}=ds(),n=hs(),{dateRange:a,setDateRange:l}=us(),[d,u]=o.useState(!1),[h,p]=o.useState(a),[x,S]=o.useState([]),[c,v]=o.useState([]),[f,W]=o.useState("trend"),[N,M]=o.useState([]),[k,X]=o.useState([]),[C,w]=o.useState([]),[z,Q]=o.useState(!1),[_,Z]=o.useState([]),[ee,r]=o.useState(!1),[G,se]=o.useState(null),[ae,ce]=o.useState(null),U=["revenue","cost","profit","employees","clientRate","staffRate","overheads"].includes(s||""),te=["shifts","hours","clients","targetAchievement","missedTargets"].includes(s||""),de=s==="overheads",{operationalData:A,isLoading:qe}=As(a,x,c),{financialData:R,isLoading:Je}=Ls(a,x,c),We=U?Je:te?qe:!1;console.log("MetricDetail Debug:",{metricId:s,isOperational:te,isFinancial:U,targetsPerformanceData:_}),o.useEffect(()=>{if(s!=="missedTargets")return;(async()=>{try{const i=new URLSearchParams({start:D(a.from,"yyyy-MM-dd"),end:D(a.to,"yyyy-MM-dd")}),g={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},m=await fetch(`${re.TARGETS_PERFORMANCE}?${i.toString()}`,{headers:g});if(m.ok){const j=await m.json();Z(j)}}catch(i){console.error("Error fetching targets performance:",i)}})()},[a,s]),o.useEffect(()=>{if(f==="trend"||!s)return;(async()=>{Q(!0);try{const i=new URLSearchParams({start:D(a.from,"yyyy-MM-dd"),end:D(a.to,"yyyy-MM-dd"),metric:s,limit:"20"});x&&x.length>0&&x.forEach(m=>i.append("locations",m)),c&&c.length>0&&c.forEach(m=>i.append("sites",m));const g={Authorization:`Bearer ${localStorage.getItem("auth_token")}`};if(f==="details"&&de){const m=await fetch(`${re.FINANCIAL_METRICS_LIST}?${i.toString()}`,{headers:g});if(m.ok){const j=await m.json();w(j)}}else if(["location","site","client"].includes(f)){i.append("dimension",f);const m=await fetch(`${re.BREAKDOWN}?${i.toString()}`,{headers:g});if(m.ok){const j=await m.json();M(j)}}}catch(i){console.error("Error fetching breakdown:",i)}finally{Q(!1)}})()},[f,s,a,x,c]),o.useEffect(()=>{s==="clients"&&f==="revenueTier"&&(async()=>{try{const i=new URLSearchParams({start:D(a.from,"yyyy-MM-dd"),end:D(a.to,"yyyy-MM-dd")});x&&x.length>0&&x.forEach(j=>i.append("locations",j)),c&&c.length>0&&c.forEach(j=>i.append("sites",j));const g={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},m=await fetch(`/api/dashboard/client-revenue-tiers?${i.toString()}`,{headers:g});if(m.ok){const T=(await m.json()).tiers.map(E=>({name:E.tier,value:E.totalRevenue,clientCount:E.clientCount,avgRevenue:E.avgRevenue}));X(T)}}catch(i){console.error("Error fetching revenue tiers:",i)}})()},[s,f,a,x,c]);const Xe=()=>{se(null),r(!0)},Qe=t=>{se(t),r(!0)},Ze=async()=>{if(ae)try{const t=await fetch(`/api/admin/financial-metrics/${ae}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(t.ok)L.success("Overhead deleted"),f==="details"&&w(i=>i.filter(g=>g.id!==ae));else{const i=await t.json();L.error(i.error||"Failed to delete")}}catch(t){console.error(t),L.error("Failed to delete")}finally{ce(null)}},es=async t=>{try{const i=await fetch("/api/admin/financial-metrics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(t)});if(i.ok){L.success("Overhead saved"),r(!1);const g=new URLSearchParams({start:D(a.from,"yyyy-MM-dd"),end:D(a.to,"yyyy-MM-dd"),metric:s||"overheads",limit:"20"});x&&x.forEach(T=>g.append("locations",T)),c&&c.forEach(T=>g.append("sites",T));const m={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},j=await fetch(`${re.FINANCIAL_METRICS_LIST}?${g.toString()}`,{headers:m});if(j.ok){const T=await j.json();w(T)}}else{const g=await i.json();L.error(g.error||"Failed to save")}}catch(i){console.error(i),L.error("Failed to save")}},Ne=t=>{switch(t){case"revenue":return"Revenue Analysis";case"cost":return"Cost Analysis";case"profit":return"Profit Analysis";case"shifts":return"Shifts Analysis";case"hours":return"Hours Analysis";case"clients":return"Client Analysis";case"employees":return"Employee Analysis";case"targetAchievement":return"Target Achievement Analysis";case"missedTargets":return"Missed Targets Analysis";case"clientRate":return"Client Rate Analysis";case"staffRate":return"Staff Rate Analysis";case"overheads":return"Overheads Analysis";default:return"Metric Analysis"}},ss=(t,i)=>{var g,m,j,T,E,Se,Ce,Te,Ae;if(!t)return"-";switch(i){case"revenue":return`£${((g=t.revenue)==null?void 0:g.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"cost":return`£${((m=t.cost)==null?void 0:m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"profit":const ue=t.profit??t.revenue-t.cost-(t.overheads||0);return`£${(ue==null?void 0:ue.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"shifts":return((j=t.totalShifts)==null?void 0:j.toLocaleString())??0;case"hours":return((T=t.paidHours)==null?void 0:T.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"clients":return((E=t.clientCount)==null?void 0:E.toLocaleString())??0;case"employees":return((Se=t.paidHours)==null?void 0:Se.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"targetAchievement":return`${((Ce=t.achievementPercentage)==null?void 0:Ce.toFixed(1))??0}%`;case"missedTargets":return`${((Te=t.achievementPercentage)==null?void 0:Te.toFixed(1))??0}%`;case"clientRate":return`£${(t.revenue/t.paidHours||0).toFixed(2)}`;case"staffRate":return`£${(t.cost/t.paidHours||0).toFixed(2)}`;case"overheads":return`£${((Ae=t.overheads)==null?void 0:Ae.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;default:return"-"}},as=o.useMemo(()=>{if(!C||C.length===0)return[];const t=C.reduce((i,g)=>{const m=g.name||"Unknown";return i[m]||(i[m]=0),i[m]+=g.value,i},{});return Object.entries(t).map(([i,g])=>({name:i,value:g}))},[C]),he=U?R==null?void 0:R.timeSeries:A==null?void 0:A.timeSeries;return e.jsx(bs,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(Ts,{dateRange:a,onDateRangeChange:l,calendarOpen:d,onCalendarOpenChange:u,tempDateRange:h,onTempDateRangeChange:p,selectedLocations:x,onLocationsChange:S,selectedSites:c,onSitesChange:v}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6 relative",children:[(We||z)&&e.jsx(Ms,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(H,{variant:"ghost",size:"sm",onClick:()=>n(-1),className:"gap-2",children:[e.jsx(Ws,{className:"h-4 w-4"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold",children:Ne(s)})]}),e.jsxs(ea,{value:f,onValueChange:W,className:"space-y-4",children:[e.jsxs(Ye,{children:[e.jsx(I,{value:"trend",children:"Trend"}),e.jsx(I,{value:"location",children:"By Location"}),e.jsx(I,{value:"site",children:"By Site"}),s==="clients"?e.jsx(I,{value:"revenueTier",children:"By Revenue Tier"}):!de&&e.jsx(I,{value:"client",children:"By Client"}),de&&e.jsx(I,{value:"details",children:"All Details"})]}),e.jsx(P,{value:"trend",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[U&&e.jsx(ks,{data:(R==null?void 0:R.timeSeries)||[],aggregationLevel:(R==null?void 0:R.aggregationLevel)||"monthly",selectedMetric:s}),te&&s!=="missedTargets"&&e.jsx(Rs,{data:(A==null?void 0:A.timeSeries)||[],aggregationLevel:(A==null?void 0:A.aggregationLevel)||"monthly",selectedMetric:s}),s==="missedTargets"&&e.jsx(Ds,{data:_}),!U&&!te&&e.jsx($,{children:e.jsx(B,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Metric type not recognized or data unavailable."})})}),e.jsxs($,{children:[e.jsx(ge,{children:e.jsx(ve,{children:"Historical Data"})}),e.jsx(B,{children:e.jsxs(fe,{children:[e.jsxs(_s,{children:["Detailed historical data for ",Ne(s)]}),e.jsx(je,{children:e.jsxs(O,{children:[e.jsx(b,{children:"Period"}),e.jsx(b,{className:"text-right",children:"Value"})]})}),e.jsx(pe,{children:he&&he.length>0?[...he].reverse().map((t,i)=>e.jsxs(O,{children:[e.jsx(y,{className:"font-medium",children:t.display}),e.jsx(y,{className:"text-right font-medium",children:ss(t,s)})]},i)):e.jsx(O,{children:e.jsx(y,{colSpan:2,className:"text-center",children:"No data available"})})})]})})]})]})}),e.jsx(P,{value:"location",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(ne,{data:N,metric:s||"revenue"}),e.jsx(ie,{data:N,metric:s||"revenue"})]})}),e.jsx(P,{value:"site",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(ne,{data:N,metric:s||"revenue"}),e.jsx(ie,{data:N,metric:s||"revenue"})]})}),e.jsx(P,{value:"revenueTier",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{data:k,metric:"revenue"}),e.jsxs($,{children:[e.jsx(ge,{children:e.jsx(ve,{children:"Tier Breakdown"})}),e.jsx(B,{children:e.jsxs(fe,{children:[e.jsx(je,{children:e.jsxs(O,{children:[e.jsx(b,{children:"Tier"}),e.jsx(b,{className:"text-right",children:"Clients"}),e.jsx(b,{className:"text-right",children:"Total Revenue"}),e.jsx(b,{className:"text-right",children:"Avg Revenue/Client"})]})}),e.jsx(pe,{children:k.map(t=>e.jsxs(O,{children:[e.jsx(y,{className:"font-medium",children:t.name}),e.jsx(y,{className:"text-right",children:t.clientCount}),e.jsxs(y,{className:"text-right",children:["£",t.value.toLocaleString()]}),e.jsxs(y,{className:"text-right",children:["£",t.avgRevenue.toLocaleString()]})]},t.name))})]})})]})]})}),e.jsx(P,{value:"client",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(ne,{data:N,metric:s||"revenue"}),e.jsx(ie,{data:N,metric:s||"revenue"})]})}),e.jsx(P,{value:"details",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(ie,{data:as,metric:"overheads"})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(H,{onClick:Xe,className:"gap-2",children:[e.jsx(Cs,{className:"h-4 w-4"}),"Add Overhead"]})}),e.jsx(ta,{data:C,onEdit:Qe,onDelete:ce}),e.jsx(ra,{open:ee,onOpenChange:r,initialData:G,onSave:es}),e.jsx(ms,{open:!!ae,onOpenChange:t=>!t&&ce(null),children:e.jsxs(xs,{children:[e.jsxs(gs,{children:[e.jsx(vs,{children:"Are you sure?"}),e.jsx(fs,{children:"This will permanently delete this overhead record."})]}),e.jsxs(js,{children:[e.jsx(ps,{children:"Cancel"}),e.jsx(ys,{onClick:Ze,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})})]})]})]})})};export{La as default};
