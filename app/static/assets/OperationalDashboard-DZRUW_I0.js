import{c as he,r as A,R as j,e as ye,a as ve,A as xe,j as r,u as be,b as ge}from"./index-BCxjYy-L.js";import{D as je}from"./DashboardLayout-DW3aFuu-.js";import{f as ee,s as Ae}from"./locationUtils-C7G14Asw.js";import{u as Se,c as Oe,D as Pe,R as te}from"./RankingList-wH8hXofk.js";import{C as E,a as N,b as T,d as C}from"./card-DwD9tNN9.js";import{S as ie,a as we,G as _e,f as U,b as K,c as Ee,d as Ne,i as R,e as Te,g as oe,E as Ce,h as B,j as De,k as Le,l as ke,m as _,n as Ke,o as Ie,p as ne,u as ze,q as $e,A as se,B as le,X as ce,Y as V,r as Re,R as Be,C as Me,T as Fe,L as He}from"./generateCategoricalChart-DRixoTgO.js";import{L as We}from"./Line-C3SBPrKe.js";import{B as qe}from"./button-CooRjy1X.js";import{U as Ze}from"./users-tZXB2N9_.js";import"./select-DVBTyhAc.js";import"./progress-Bnha8m7n.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=he("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);function D(t){"@babel/helpers - typeof";return D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(t)}function Ve(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ge(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,de(i.key),i)}}function Ye(t,e,n){return e&&Ge(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Je(t,e,n){return e=M(e),Xe(t,ue()?Reflect.construct(e,n||[],M(t).constructor):e.apply(t,n))}function Xe(t,e){if(e&&(D(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Qe(t)}function Qe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ue(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ue=function(){return!!t})()}function M(t){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},M(t)}function et(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&G(t,e)}function G(t,e){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},G(t,e)}function pe(t,e,n){return e=de(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function de(t){var e=tt(t,"string");return D(e)=="symbol"?e:e+""}function tt(t,e){if(D(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(D(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var H=function(t){function e(){return Ve(this,e),Je(this,e,arguments)}return et(e,t),Ye(e,[{key:"render",value:function(){return null}}])}(A.Component);pe(H,"displayName","ZAxis");pe(H,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var it=["option","isActive"];function I(){return I=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},I.apply(this,arguments)}function nt(t,e){if(t==null)return{};var n=rt(t,e),i,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)i=o[a],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i])}return n}function rt(t,e){if(t==null)return{};var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){if(e.indexOf(i)>=0)continue;n[i]=t[i]}return n}function at(t){var e=t.option,n=t.isActive,i=nt(t,it);return typeof e=="string"?A.createElement(ie,I({option:A.createElement(we,I({type:e},i)),isActive:n,shapeType:"symbols"},i)):A.createElement(ie,I({option:e,isActive:n,shapeType:"symbols"},i))}function L(t){"@babel/helpers - typeof";return L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(t)}function z(){return z=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},z.apply(this,arguments)}function re(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,i)}return n}function S(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?re(Object(n),!0).forEach(function(i){P(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ae(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,me(i.key),i)}}function st(t,e,n){return e&&ae(t.prototype,e),n&&ae(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function lt(t,e,n){return e=F(e),ct(t,fe()?Reflect.construct(e,n||[],F(t).constructor):e.apply(t,n))}function ct(t,e){if(e&&(L(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ut(t)}function ut(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function fe(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fe=function(){return!!t})()}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},F(t)}function pt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Y(t,e)}function Y(t,e){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},Y(t,e)}function P(t,e,n){return e=me(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function me(t){var e=dt(t,"string");return L(e)=="symbol"?e:e+""}function dt(t,e){if(L(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(L(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var W=function(t){function e(){var n;ot(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=lt(this,e,[].concat(a)),P(n,"state",{isAnimationFinished:!1}),P(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0})}),P(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1})}),P(n,"id",ze("recharts-scatter-")),n}return pt(e,t),st(e,[{key:"renderSymbolsStatically",value:function(i){var a=this,o=this.props,m=o.shape,y=o.activeShape,f=o.activeIndex,p=U(this.props,!1);return i.map(function(s,l){var c=f===l,d=c?y:m,v=S(S({},p),s);return j.createElement(K,z({className:"recharts-scatter-symbol",key:"symbol-".concat(s==null?void 0:s.cx,"-").concat(s==null?void 0:s.cy,"-").concat(s==null?void 0:s.size,"-").concat(l)},Ee(a.props,s,l),{role:"img"}),j.createElement(at,z({option:d,isActive:c,key:"symbol-".concat(l)},v)))})}},{key:"renderSymbolsWithAnimation",value:function(){var i=this,a=this.props,o=a.points,m=a.isAnimationActive,y=a.animationBegin,f=a.animationDuration,p=a.animationEasing,s=a.animationId,l=this.state.prevPoints;return j.createElement(Ne,{begin:y,duration:f,isActive:m,easing:p,from:{t:0},to:{t:1},key:"pie-".concat(s),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(c){var d=c.t,v=o.map(function(x,b){var g=l&&l[b];if(g){var h=R(g.cx,x.cx),u=R(g.cy,x.cy),O=R(g.size,x.size);return S(S({},x),{},{cx:h(d),cy:u(d),size:O(d)})}var w=R(0,x.size);return S(S({},x),{},{size:w(d)})});return j.createElement(K,null,i.renderSymbolsStatically(v))})}},{key:"renderSymbols",value:function(){var i=this.props,a=i.points,o=i.isAnimationActive,m=this.state.prevPoints;return o&&a&&a.length&&(!m||!Te(m,a))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(a)}},{key:"renderErrorBar",value:function(){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var a=this.props,o=a.points,m=a.xAxis,y=a.yAxis,f=a.children,p=oe(f,Ce);return p?p.map(function(s,l){var c=s.props,d=c.direction,v=c.dataKey;return j.cloneElement(s,{key:"".concat(d,"-").concat(v,"-").concat(o[l]),data:o,xAxis:m,yAxis:y,layout:d==="x"?"vertical":"horizontal",dataPointFormatter:function(b,g){return{x:b.cx,y:b.cy,value:d==="x"?+b.node.x:+b.node.y,errorVal:B(b,g)}}})}):null}},{key:"renderLine",value:function(){var i=this.props,a=i.points,o=i.line,m=i.lineType,y=i.lineJointType,f=U(this.props,!1),p=U(o,!1),s,l;if(m==="joint")s=a.map(function(u){return{x:u.cx,y:u.cy}});else if(m==="fitting"){var c=De(a),d=c.xmin,v=c.xmax,x=c.a,b=c.b,g=function(O){return x*O+b};s=[{x:d,y:g(d)},{x:v,y:g(v)}]}var h=S(S(S({},f),{},{fill:"none",stroke:f&&f.fill},p),{},{points:s});return j.isValidElement(o)?l=j.cloneElement(o,h):Le(o)?l=o(h):l=j.createElement(ke,z({},h,{type:y})),j.createElement(K,{className:"recharts-scatter-line",key:"recharts-scatter-line"},l)}},{key:"render",value:function(){var i=this.props,a=i.hide,o=i.points,m=i.line,y=i.className,f=i.xAxis,p=i.yAxis,s=i.left,l=i.top,c=i.width,d=i.height,v=i.id,x=i.isAnimationActive;if(a||!o||!o.length)return null;var b=this.state.isAnimationFinished,g=ye("recharts-scatter",y),h=f&&f.allowDataOverflow,u=p&&p.allowDataOverflow,O=h||u,w=_(v)?this.id:v;return j.createElement(K,{className:g,clipPath:O?"url(#clipPath-".concat(w,")"):null},h||u?j.createElement("defs",null,j.createElement("clipPath",{id:"clipPath-".concat(w)},j.createElement("rect",{x:h?s:s-c/2,y:u?l:l-d/2,width:h?c:c*2,height:u?d:d*2}))):null,m&&this.renderLine(),this.renderErrorBar(),j.createElement(K,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!x||b)&&Ke.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(i,a){return i.animationId!==a.prevAnimationId?{prevAnimationId:i.animationId,curPoints:i.points,prevPoints:a.curPoints}:i.points!==a.curPoints?{curPoints:i.points}:null}}])}(A.PureComponent);P(W,"displayName","Scatter");P(W,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!_e.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});P(W,"getComposedData",function(t){var e=t.xAxis,n=t.yAxis,i=t.zAxis,a=t.item,o=t.displayedData,m=t.xAxisTicks,y=t.yAxisTicks,f=t.offset,p=a.props.tooltipType,s=oe(a.props.children,Ie),l=_(e.dataKey)?a.props.dataKey:e.dataKey,c=_(n.dataKey)?a.props.dataKey:n.dataKey,d=i&&i.dataKey,v=i?i.range:H.defaultProps.range,x=v&&v[0],b=e.scale.bandwidth?e.scale.bandwidth():0,g=n.scale.bandwidth?n.scale.bandwidth():0,h=o.map(function(u,O){var w=B(u,l),J=B(u,c),k=!_(d)&&B(u,d)||"-",X=[{name:_(e.dataKey)?a.props.name:e.name||e.dataKey,unit:e.unit||"",value:w,payload:u,dataKey:l,type:p},{name:_(n.dataKey)?a.props.name:n.name||n.dataKey,unit:n.unit||"",value:J,payload:u,dataKey:c,type:p}];k!=="-"&&X.push({name:i.name||i.dataKey,unit:i.unit||"",value:k,payload:u,dataKey:d,type:p});var q=ne({axis:e,ticks:m,bandSize:b,entry:u,index:O,dataKey:l}),Z=ne({axis:n,ticks:y,bandSize:g,entry:u,index:O,dataKey:c}),Q=k!=="-"?i.scale(k):x,$=Math.sqrt(Math.max(Q,0)/Math.PI);return S(S({},u),{},{cx:q,cy:Z,x:q-$,y:Z-$,xAxis:e,yAxis:n,zAxis:i,width:2*$,height:2*$,size:Q,node:{x:w,y:J,z:k},tooltipPayload:X,tooltipPosition:{x:q,y:Z},payload:u},s&&s[O]&&s[O].props)});return S({points:h},f)});var ft=$e({chartName:"ComposedChart",GraphicalChild:[We,se,le,W],axisComponents:[{axisType:"xAxis",AxisComp:ce},{axisType:"yAxis",AxisComp:V},{axisType:"zAxis",AxisComp:H}],formatAxisMap:Re});const mt=(t,e,n)=>{const[i,a]=A.useState(null),[o,m]=A.useState(!1),{toast:y}=ve(),f=async()=>{m(!0);try{const p=new URLSearchParams({start:ee(t.from,"yyyy-MM-dd"),end:ee(t.to,"yyyy-MM-dd")});e&&e.length>0&&e.forEach(l=>p.append("locations",l)),n&&n.length>0&&n.forEach(l=>p.append("sites",l));const s=await fetch(`${xe.SALES_SUMMARY.replace("sales-summary","operational-summary")}?${p}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(s.ok){const l=await s.json();a(l)}else y({title:"Error",description:"Could not fetch operational data",variant:"destructive"})}catch{y({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{m(!1)}};return A.useEffect(()=>{f()},[t,e,n]),{operationalData:i,isLoading:o,refetch:f}},ht=({active:t,payload:e,label:n})=>t&&e&&e.length?r.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[r.jsx("p",{className:"font-semibold text-foreground",children:n}),e.map((i,a)=>r.jsxs("p",{className:"text-sm",style:{color:i.color},children:[i.name,": ",i.name==="Paid Hours"?i.value.toLocaleString(void 0,{maximumFractionDigits:1}):i.value]},a))]}):null,yt=({data:t,aggregationLevel:e})=>{const n={dataKey:"display",interval:0};return!t||t.length===0?r.jsxs(E,{children:[r.jsx(N,{children:r.jsx(T,{children:"Hours & Shifts Trend"})}),r.jsx(C,{children:r.jsx("div",{className:"h-[400px] flex items-center justify-center",children:r.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):r.jsxs(E,{children:[r.jsxs(N,{children:[r.jsx(T,{children:"Hours & Shifts Trend"}),r.jsxs("p",{className:"text-sm text-muted-foreground",children:[e==="daily"&&"Daily view",e==="weekly"&&"Weekly view",e==="monthly"&&"Monthly view"]})]}),r.jsx(C,{children:r.jsx("div",{className:"h-[400px]",children:r.jsx(Be,{width:"100%",height:"100%",children:r.jsxs(ft,{data:t,children:[r.jsx(Me,{strokeDasharray:"3 3"}),r.jsx(ce,{dataKey:n.dataKey,tick:{fontSize:12},interval:n.interval}),r.jsx(V,{yAxisId:"left",orientation:"left",label:{value:"Hours",angle:-90,position:"insideLeft"}}),r.jsx(V,{yAxisId:"right",orientation:"right",label:{value:"Shifts",angle:90,position:"insideRight"}}),r.jsx(Fe,{content:r.jsx(ht,{})}),r.jsx(He,{}),r.jsx(se,{yAxisId:"left",type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),r.jsx(le,{yAxisId:"right",dataKey:"totalShifts",name:"Total Shifts",barSize:20,fill:"hsl(var(--accent))",fillOpacity:.6})]})})})})]})},Et=()=>{be();const{role:t,locations:e}=ge(),[n,i]=A.useState({from:Ae(new Date),to:new Date}),[a,o]=A.useState(!1),[m,y]=A.useState(n),[f,p]=A.useState([]),[s,l]=A.useState([]),{operationalData:c,isLoading:d}=mt(n,f,s),{topStaff:v,isLoadingStaff:x,topClientsShifts:b,isLoadingClientsShifts:g}=Se(n,f,s),h=Oe(c,n);return r.jsx(je,{children:r.jsxs("div",{className:"flex flex-col h-screen",children:[r.jsx(Pe,{dateRange:n,onDateRangeChange:i,calendarOpen:a,onCalendarOpenChange:o,tempDateRange:m,onTempDateRangeChange:y,selectedLocations:f,onLocationsChange:p,selectedSites:s,onSitesChange:l}),r.jsx("div",{className:"flex-1 overflow-auto",children:r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[r.jsxs(E,{children:[r.jsx(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:r.jsx(T,{className:"text-sm font-medium",children:"Total Shifts"})}),r.jsxs(C,{children:[r.jsx("div",{className:"text-2xl font-bold",children:h.totalShifts.value}),r.jsx("p",{className:"text-xs text-muted-foreground",children:h.totalShifts.text})]})]}),r.jsxs(E,{children:[r.jsx(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:r.jsx(T,{className:"text-sm font-medium",children:"Total Hours"})}),r.jsxs(C,{children:[r.jsx("div",{className:"text-2xl font-bold",children:h.paidHours.value.toLocaleString()}),r.jsx("p",{className:"text-xs text-muted-foreground",children:h.paidHours.text})]})]}),r.jsxs(E,{children:[r.jsx(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:r.jsx(T,{className:"text-sm font-medium",children:"Active Clients"})}),r.jsxs(C,{children:[r.jsx("div",{className:"text-2xl font-bold",children:h.totalClients.value}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Distinct clients this period"})]})]}),t==="admin"&&r.jsx("div",{className:"flex items-center justify-center p-4",children:r.jsx(qe,{variant:"outline",asChild:!0,children:r.jsx("a",{href:"/dashboard/financial",children:"View Financial Dashboard"})})})]}),r.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[r.jsxs(E,{className:"col-span-4",children:[r.jsx(N,{children:r.jsx(T,{children:"Overview"})}),r.jsx(C,{className:"pl-2",children:r.jsx(yt,{data:(c==null?void 0:c.timeSeries)||[],aggregationLevel:(c==null?void 0:c.aggregationLevel)||"monthly"})})]}),r.jsxs("div",{className:"col-span-3 flex flex-col gap-4 h-full",children:[r.jsx(te,{title:"Top Staff (Paid Hours)",data:v,isLoading:x,valueFormatter:u=>`${u.toLocaleString()} hrs`,icon:r.jsx(Ze,{className:"h-4 w-4"}),className:"flex-1"}),r.jsx(te,{title:"Top Clients (Shifts)",data:b,isLoading:g,valueFormatter:u=>`${u.toLocaleString()} shifts`,icon:r.jsx(Ue,{className:"h-4 w-4"}),className:"flex-1",barColor:"bg-blue-500"})]})]})]})})]})})};export{Et as OperationalDashboard,Et as default};
