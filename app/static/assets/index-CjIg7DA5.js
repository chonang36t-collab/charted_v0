import{r as v,a as W,R as S,j as e,b as E}from"./index-BbM0XA5P.js";import{D as _}from"./DashboardLayout-DqdSXmhv.js";import{A as q}from"./api-DS5URhHX.js";import{a as G,f as L,P as H,b as I,C as B,c as K,d as z,i as R,e as Q,s as M,g as A}from"./popover-D7piFYJC.js";import{B as F}from"./button-Q3PEGJ3B.js";import{S as U,a as X,b as J,C as Z,c as ee,d as k}from"./select-hA6o-q4M.js";import{C as j,a as D,b as $,d as p}from"./card-BiP12D7k.js";import{R as te,A as se,C as re,X as ae,Y as ne,T as oe,L as le,a as V}from"./AreaChart-TAR1NA3X.js";import"./users-7U1-MO4X.js";function O(t,s){return G(t,-s)}const ie=t=>{const[s,o]=v.useState(null),[l,x]=v.useState(!1),{toast:m}=W(),i=async()=>{x(!0);try{const r=new URLSearchParams({start:L(t.from,"yyyy-MM-dd"),end:L(t.to,"yyyy-MM-dd")});console.log("Fetching sales data with params:",r.toString());const d=await fetch(`${q.SALES_SUMMARY}?${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(d.ok){const a=await d.json();console.log("DASHBOARD DATA RECEIVED:",a),o(a)}else console.error("Dashboard fetch failed:",d.status,d.statusText),m({title:"Error",description:"Could not fetch data from server",variant:"destructive"})}catch(r){console.error("Dashboard fetch error:",r),m({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{x(!1)}};return v.useEffect(()=>{i()},[t]),{salesData:s,isLoading:l,refetch:i}},ce=(t,s)=>{var P,T,c;if(!t)return{revenue:{value:0,change:0,trend:"neutral",text:"No data available"},clientPay:{value:0,change:0,trend:"neutral",text:"No data available"},staffPay:{value:0,change:0,trend:"neutral",text:"No data available"}};const o=t.totalRevenue||0,l=t.avgClientPayPerHour||0,x=t.avgStaffPayPerHour||0,m=((P=t.previousPeriod)==null?void 0:P.totalRevenue)||0,i=((T=t.previousPeriod)==null?void 0:T.avgClientPayPerHour)||0,r=((c=t.previousPeriod)==null?void 0:c.avgStaffPayPerHour)||0,d=(n,u)=>u>0?(n-u)/u*100:0,a=d(o,m),f=d(l,i),g=d(x,r),y=n=>n>0?"up":n<0?"down":"neutral",N=(n,u,h)=>{if(!u)return"No previous data";let w="";return h<=7?w="last week":h<=31?w="last month":h<=93?w="last quarter":w="last period",`${n>0?"+":""}${Math.abs(n).toFixed(1)}% from ${w}`},b=Math.ceil((s.to.getTime()-s.from.getTime())/(1e3*60*60*24)),C=!!t.previousPeriod;return{revenue:{value:o,change:a,trend:y(a),text:N(a,C,b)},clientPay:{value:l,change:f,trend:y(f),text:N(f,C,b)},staffPay:{value:x,change:g,trend:y(g),text:N(g,C,b)}}},de=({dateRange:t,onDateRangeChange:s,calendarOpen:o,onCalendarOpenChange:l,tempDateRange:x,onTempDateRangeChange:m})=>{const i=c=>{const n=new Date;let u,h;switch(c){case"this-month":u=M(n),h=A(n);break;case"last-month":u=M(O(n,1)),h=A(O(n,1));break;case"last-3-months":u=M(O(n,2)),h=A(n);break;case"this-year":u=new Date(n.getFullYear(),0,1),h=new Date(n.getFullYear(),11,31);break;default:return}s({from:u,to:h})},[r,d]=S.useState(t==null?void 0:t.from),[a,f]=S.useState(t==null?void 0:t.to),[g,y]=S.useState(!1),[N,b]=S.useState(!1);S.useEffect(()=>{d(t==null?void 0:t.from),f(t==null?void 0:t.to)},[t]);const C=c=>{c&&(d(c),a&&R(c,a)&&f(void 0))},P=c=>{c&&f(c)},T=()=>{r&&a&&s({from:r,to:a})};return e.jsx("div",{className:"sticky top-0 z-40 bg-background border-b border-border",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Overview of your analytics"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(U,{onValueChange:i,children:[e.jsxs(X,{className:"w-[140px]",children:[e.jsx(J,{placeholder:"Quick Select"}),e.jsx(Z,{className:"h-4 w-4 opacity-50"})]}),e.jsxs(ee,{children:[e.jsx(k,{value:"this-month",children:"This Month"}),e.jsx(k,{value:"last-month",children:"Last Month"}),e.jsx(k,{value:"last-3-months",children:"Last 3 Months"}),e.jsx(k,{value:"this-year",children:"This Year"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(H,{open:g,onOpenChange:y,children:[e.jsx(I,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:E("w-[140px] justify-start text-left font-normal",!r&&"text-muted-foreground"),children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),r?L(r,"LLL dd, y"):"From"]})}),e.jsx(K,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(z,{mode:"single",selected:r,onSelect:C,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:c=>a?R(c,a):!1,className:"rounded-md border"})})})]}),e.jsx("div",{className:"text-muted-foreground",children:"to"}),e.jsxs(H,{open:N,onOpenChange:b,children:[e.jsx(I,{asChild:!0,children:e.jsxs(F,{variant:"outline",className:E("w-[140px] justify-start text-left font-normal",!a&&"text-muted-foreground"),disabled:!r,children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),a?L(a,"LLL dd, y"):"To"]})}),e.jsx(K,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(z,{mode:"single",selected:a,onSelect:P,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:r?r.getFullYear():new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:c=>r?Q(c,r):!1,className:"rounded-md border"})})})]}),e.jsx(F,{onClick:T,disabled:!r||!a,className:"ml-2",children:"Apply"})]})]})]})})})};function Y({title:t,value:s,change:o,trend:l="neutral"}){return e.jsxs(j,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(D,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx($,{className:"text-sm font-medium text-muted-foreground",children:t})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s}),o&&e.jsx("p",{className:E("text-xs mt-1",l==="up"&&"text-accent",l==="down"&&"text-destructive",l==="neutral"&&"text-muted-foreground"),children:o})]})]})}const ue=({metrics:t})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 w-full",children:[e.jsx(Y,{title:"Total Revenue",value:`£${t.revenue.value.toLocaleString()}`,change:t.revenue.text,trend:t.revenue.trend}),e.jsx(Y,{title:"Average Client Pay",value:`£${t.clientPay.value.toFixed(2)}`,change:t.clientPay.text,trend:t.clientPay.trend}),e.jsx(Y,{title:"Average Staff Pay",value:`£${t.staffPay.value.toFixed(2)}`,change:t.staffPay.text,trend:t.staffPay.trend})]}),xe=({salesData:t})=>{var s;return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(j,{children:e.jsx(p,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.totalShifts)||0})]})})})}),e.jsx(j,{children:e.jsx(p,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.totalClients)||0})]})})})}),e.jsx(j,{children:e.jsx(p,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.uniqueEmployees)||0})]})})})}),e.jsx(j,{children:e.jsx(p,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((s=t==null?void 0:t.profitMargin)==null?void 0:s.toFixed(1))||0,"%"]})]})})})})]})},he=({active:t,payload:s,label:o})=>t&&s&&s.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:o}),s.map((l,x)=>e.jsxs("p",{className:"text-sm",style:{color:l.color},children:[l.name,": £",Number(l.value).toLocaleString()]},x))]}):null,me=({data:t,aggregationLevel:s})=>{const o={dataKey:"display",interval:0};return!t||t.length===0?e.jsxs(j,{children:[e.jsx(D,{children:e.jsx($,{children:"Revenue vs Cost Trend"})}),e.jsx(p,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(j,{children:[e.jsxs(D,{children:[e.jsx($,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s==="daily"&&"Daily view",s==="weekly"&&"Weekly view",s==="monthly"&&"Monthly view"]})]}),e.jsx(p,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(se,{data:t,children:[e.jsx(re,{strokeDasharray:"3 3"}),e.jsx(ae,{dataKey:o.dataKey,tick:{fontSize:12},interval:o.interval}),e.jsx(ne,{}),e.jsx(oe,{content:e.jsx(he,{})}),e.jsx(le,{}),e.jsx(V,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(V,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]})})})})]})},fe=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})});function Pe(){const[t,s]=v.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[o,l]=v.useState(!1),[x,m]=v.useState(t),{salesData:i,isLoading:r}=ie(t),d=ce(i,t);return e.jsx(_,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(de,{dateRange:t,onDateRangeChange:s,calendarOpen:o,onCalendarOpenChange:l,tempDateRange:x,onTempDateRangeChange:m}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[r&&e.jsx(fe,{}),e.jsx(ue,{metrics:d}),e.jsx(xe,{salesData:i}),e.jsx(me,{data:(i==null?void 0:i.timeSeries)||[],aggregationLevel:(i==null?void 0:i.aggregationLevel)||"monthly"})]})})]})})}export{Pe as default};
