const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-DPoB7HEb.js","assets/index-44ICaway.js","assets/index-DNNbaSSC.css","assets/card-uooV3kVC.js","assets/trending-up-B6YbR8Wz.js","assets/popover-viJ9WD1z.js","assets/button-DUhBaSqM.js","assets/DashboardLayout-CuBxDZGF.js","assets/users-DAP2fuPj.js","assets/ChartCanvas-VGWD48vk.js","assets/badge-BxuBGdxO.js","assets/AreaChart-nvrAxIwT.js","assets/BarChart-C7KiwJ4h.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,b as C,S as O,_ as L}from"./index-44ICaway.js";import{D as B}from"./DashboardLayout-CuBxDZGF.js";import{L as p}from"./label-BzmJhpRX.js";import{S as A,a as z,b as V,c as Y,d as m}from"./select-DUlR2isg.js";import{B as w}from"./button-DUhBaSqM.js";import{g as F,P as D,b as N,C as b,f as h,c as S,d as M}from"./popover-viJ9WD1z.js";import"./users-DAP2fuPj.js";const $=()=>{const[t,o]=c.useState({dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0});return{state:t,setDimensions:r=>{o(n=>({...n,dimensions:r}))},setMetrics:r=>{o(n=>({...n,metrics:r}))},setChartType:r=>{o(n=>({...n,chartType:r}))},setDateRange:r=>{o(n=>({...n,dateRange:r}))},addCustomMetric:r=>{o(n=>({...n,customMetrics:[...n.customMetrics,r]}))},setChartData:r=>{o(n=>({...n,chartData:r}))},setDraggedItem:r=>{o(n=>({...n,draggedItem:r}))}}},U=c.lazy(()=>L(()=>import("./MetricPalette-DPoB7HEb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),q=c.lazy(()=>L(()=>import("./ChartCanvas-VGWD48vk.js"),__vite__mapDeps([9,1,2,10,11,12])));function Z(){const{state:t,setDimensions:o,setMetrics:f,setChartType:j,setDateRange:T,setChartData:d}=$(),[s,x]=c.useState({from:new Date,to:F(new Date,30)}),[g,r]=c.useState(!1),[n,v]=c.useState(!1);c.useEffect(()=>{(async()=>{if(t.dimensions.length===0||t.metrics.length===0||!(s!=null&&s.from)||!(s!=null&&s.to)){d([]);return}const l=t.dimensions[0],k=t.metrics,E=h(s.from,"yyyy-MM-dd"),I=h(s.to,"yyyy-MM-dd");try{const i=new URLSearchParams;i.append("start",E),i.append("end",I),i.append("dimension",l),k.forEach(u=>i.append("metrics",u));const y=await fetch(`/api/chart-data?${i.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(y.ok){const u=await y.json();d(u)}else console.error("Failed to fetch chart data"),d([])}catch(i){console.error("Error fetching chart data:",i),d([])}})()},[t.dimensions,t.metrics,s]);const _=a=>{a.type==="dimension"?t.dimensions.includes(a.name)||o([a.name]):a.type==="metric"&&(t.metrics.includes(a.name)||f([...t.metrics,a.name]))},P=a=>{o(t.dimensions.filter(l=>l!==a))},R=a=>{f(t.metrics.filter(l=>l!==a))};return e.jsx(B,{children:e.jsx("div",{className:"p-4 md:p-6 h-full flex flex-col",children:e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsx("div",{className:"sticky lg:top-0 z-30 pb-4 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-2 shadow-sm bg-background",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Chart Builder"}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-base",children:"Click on metrics and dimensions to build your chart"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1",children:[e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"Chart Type"}),e.jsxs(A,{value:t.chartType,onValueChange:j,children:[e.jsx(z,{className:"w-full",children:e.jsx(V,{placeholder:"Select chart type"})}),e.jsxs(Y,{children:[e.jsx(m,{value:"bar",children:"Bar Chart"}),e.jsx(m,{value:"line",children:"Line Chart"}),e.jsx(m,{value:"area",children:"Area Chart"}),e.jsx(m,{value:"pie",children:"Pie Chart"})]})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"From Date"}),e.jsxs(D,{open:g,onOpenChange:r,children:[e.jsx(N,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:C("w-full justify-start text-left font-normal",!(s!=null&&s.from)&&"text-muted-foreground"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),s!=null&&s.from?h(s.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(S,{className:"w-auto p-0",align:"start",children:e.jsx(M,{mode:"single",selected:s==null?void 0:s.from,onSelect:a=>{x(l=>({...l,from:a})),r(!1)},defaultMonth:s==null?void 0:s.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(p,{className:"text-xs text-muted-foreground",children:"To Date"}),e.jsxs(D,{open:n,onOpenChange:v,children:[e.jsx(N,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:C("w-full justify-start text-left font-normal",!(s!=null&&s.to)&&"text-muted-foreground"),children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),s!=null&&s.to?h(s.to,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(S,{className:"w-auto p-0",align:"start",children:e.jsx(M,{mode:"single",selected:s==null?void 0:s.to,onSelect:a=>{x(l=>({...l,to:a})),v(!1)},defaultMonth:s==null?void 0:s.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030,disabled:a=>a<((s==null?void 0:s.from)||new Date(0))})})]})]})]})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(O,{className:"h-8 w-8 rounded-full"})}),children:e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 min-h-0 h-full",children:[e.jsx("div",{className:"lg:w-72 shrink-0 overflow-y-auto h-full pr-2",children:e.jsx(U,{onItemClick:_})}),e.jsx("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:e.jsx("div",{className:"bg-card rounded-lg border p-4 flex-1 flex flex-col min-h-0",children:e.jsx(q,{dimensions:t.dimensions,metrics:t.metrics,chartType:t.chartType,chartData:t.chartData,onRemoveDimension:P,onRemoveMetric:R})})})]})})})]})})})}export{Z as default};
