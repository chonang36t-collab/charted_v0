import{c as ne,r as b,j as e,e as M,B as I,T as Z,k as J,l as G,m as U,I as z}from"./index-FziJFGlq.js";import{D as ie,T as de}from"./DashboardLayout-DlxjwA3z.js";import{D as B,b as Y,c as V,d as K,e as W,a as q}from"./dialog-zw-M34SQ.js";import{L as ue}from"./label-GPmg4vKj.js";import{T as Q}from"./trash-2-I_xo3BGh.js";import{P as X}from"./plus-DFH3uQV1.js";import"./users-BGJTyr2A.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=ne("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),me=o=>{let t="";for(;o>=0;)t=String.fromCharCode(o%26+65)+t,o=Math.floor(o/26)-1;return t},ee=(o,t)=>`${me(t)}${o+1}`,se=o=>{const t=o.match(/^([A-Z]+)([0-9]+)$/);if(!t)return null;const i=t[1],s=t[2];let f=0;for(let n=0;n<i.length;n++)f=f*26+(i.charCodeAt(n)-64);return f-=1,{rowIdx:parseInt(s,10)-1,colIdx:f}},te=(o,t,i,s)=>{if(!o)return"";const f=i.findIndex(c=>c.id===s),x=new Map(t.map((c,g)=>[c.id,g])),n=new Map(i.map((c,g)=>[c.id,g]));let l=o;l=l.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(c,g,v)=>{const C=x.get(g),j=n.get(v);return C!==void 0&&j!==void 0?ee(C,j):c});const u=Array.from(x.keys()).sort((c,g)=>g.length-c.length);for(const c of u){const g=new RegExp(`\\b${c}\\b`,"g");if(g.test(l)){const v=x.get(c);l=l.replace(g,ee(v,f))}}return l},fe=(o,t,i,s)=>{if(!o)return"";let f=o;const x=i.findIndex(n=>n.id===s);return f=f.replace(/\b([A-Z]+)([0-9]+)\b/g,n=>{const l=se(n);if(!l)return n;const u=t[l.rowIdx],c=i[l.colIdx];return!u||!c?n:l.colIdx===x?u.id:`${u.id}:${c.id}`}),f},L=o=>[{id:"jan",label:"January",isProtected:!0},{id:"feb",label:"February",isProtected:!0},{id:"mar",label:"March",isProtected:!0},{id:"apr",label:"April",isProtected:!0},{id:"may",label:"May",isProtected:!0},{id:"jun",label:"June",isProtected:!0},{id:"jul",label:"July",isProtected:!0},{id:"aug",label:"August",isProtected:!0},{id:"sep",label:"September",isProtected:!0},{id:"oct",label:"October",isProtected:!0},{id:"nov",label:"November",isProtected:!0},{id:"dec",label:"December",isProtected:!0},{id:"year_end",label:"Year End",isProtected:!0,isYearEnd:!0}],re=(o,t,i)=>{var s,f;try{const x=Object.keys(t).sort((u,c)=>c.length-u.length);let n=o;n=n.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(u,c,g)=>{var C,j;return`(${((j=(C=t[c])==null?void 0:C[g])==null?void 0:j.value)??0})`});for(const u of x){const c=new RegExp(`\\b${u}\\b`,"g");if(c.test(n)){const g=((f=(s=t[u])==null?void 0:s[i])==null?void 0:f.value)??0;n=n.replace(c,`(${g})`)}}if(!/^[0-9+\-*/().\s]*$/.test(n))return null;const l=new Function(`return ${n}`)();return typeof l=="number"&&!isNaN(l)&&isFinite(l)?l:null}catch{return null}},be=["cost_sales_se","cost_sales_paye","employee_ni","employee_pension"],pe=["apprenticeship_levy","annual_leave","other_expenses","recruitment_cost","overheads_mgmt","bank_interest","cooperation_tax"],H=[{id:"total_sales",label:"Total Sales",isAutoCalculated:!1,isCurrency:!0},{id:"sales_split_pct",label:"% Sales Split",isAutoCalculated:!0,isPercentage:!0,formulaString:"total_sales / total_sales:year_end"},{id:"cost_sales_se",label:"Cost of Sales SE",isAutoCalculated:!1,isCurrency:!0},{id:"cost_sales_paye",label:"Cost of Sales PAYE Gross",isAutoCalculated:!1,isCurrency:!0},{id:"employee_ni",label:"Employee NI",isAutoCalculated:!1,isCurrency:!0},{id:"employee_pension",label:"Employee Pension",isAutoCalculated:!1,isCurrency:!0},{id:"total_cost_sales",label:"Total Cost of Sales",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:be.join(" + ")},{id:"apprenticeship_levy",label:"Apprenticeship Levy",isAutoCalculated:!1,isCurrency:!0},{id:"annual_leave",label:"Annual Leave Accrual",isAutoCalculated:!1,isCurrency:!0},{id:"other_expenses",label:"Other Expenses",isAutoCalculated:!1,isCurrency:!0},{id:"recruitment_cost",label:"Recruitment & Pass Cost",isAutoCalculated:!1,isCurrency:!0},{id:"overheads_mgmt",label:"Total Mgmt & Office Cost",isAutoCalculated:!1,isCurrency:!0},{id:"bank_interest",label:"Bank Interest",isAutoCalculated:!1,isCurrency:!0},{id:"cooperation_tax",label:"Cooperation Tax",isAutoCalculated:!1,isCurrency:!0},{id:"total_overheads",label:"Total Overheads",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:pe.join(" + ")},{id:"total_cost",label:"Total Cost",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"total_cost_sales + total_overheads"},{id:"avg_hourly_charge",label:"Avg Hourly Charge Rate",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_pay",label:"Avg Hourly Pay",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_margin",label:"Gross Hourly Margin",isAutoCalculated:!0,isCurrency:!0,formulaString:"avg_hourly_charge - gross_hourly_pay"},{id:"net_cost_per_hour",label:"Net Cost per Hour",isAutoCalculated:!1,isCurrency:!0},{id:"gross_pl_value",label:"Gross P&L Value",isAutoCalculated:!1,isCurrency:!0},{id:"net_pl",label:"Net P&L",isAutoCalculated:!1,isCurrency:!0},{id:"total_net_margin",label:"Total Net Margin",isAutoCalculated:!1,isPercentage:!0},{id:"worked_hours",label:"Worked Hours",isAutoCalculated:!1},{id:"hours_breakeven",label:"Hours for Breakeven",isAutoCalculated:!0,formulaString:"total_cost / gross_hourly_margin"},{id:"value_breakeven",label:"Total Value for Breakeven",isAutoCalculated:!0,isCurrency:!0,formulaString:"hours_breakeven * avg_hourly_charge"},{id:"sales_budget",label:"Sales Budget 30% Uplift",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales * 1.3"},{id:"avg_hourly_charge_2026",label:"Avg Hourly Charge Rate 2026",isAutoCalculated:!1,isCurrency:!0},{id:"sales_target_hours",label:"Sales Target in Hours",isAutoCalculated:!1},{id:"variance_2025",label:"Variance Against 2025",isAutoCalculated:!1,isCurrency:!0}];function ae(o,t){const i={};for(const s of o){i[s.id]={};for(const f of t)i[s.id][f.id]={value:null,isEditable:!s.isAutoCalculated&&!f.isYearEnd,source:"manual"}}return i}function T(o,t,i){const s=JSON.parse(JSON.stringify(o)),f=i.filter(l=>!l.isYearEnd),x=i.find(l=>l.isYearEnd);for(const l of f)for(const u of t)u.id!=="sales_split_pct"&&(u.formulaString?s[u.id][l.id]={...s[u.id][l.id],value:re(u.formulaString,s,l.id),isEditable:!1,source:"formula"}:u.formula&&(s[u.id][l.id]={...s[u.id][l.id],value:u.formula(s,u.id,l.id),isEditable:!1,source:"formula"}));if(x)for(const l of t){if(l.id==="sales_split_pct")continue;const u=f.reduce((c,g)=>{var v,C;return c+(((C=(v=s[l.id])==null?void 0:v[g.id])==null?void 0:C.value)??0)},0);s[l.id][x.id]={value:u,isEditable:!1,source:"calculated"}}const n=t.find(l=>l.id==="sales_split_pct");if(n&&n.formulaString&&x){for(const l of f){const u=re(n.formulaString,s,l.id);s[n.id][l.id]={value:u?u*100:0,isEditable:!1,source:"formula"}}s[n.id][x.id]={value:100,isEditable:!1,source:"calculated"}}return s}function xe(o){const[t,i]=b.useState(H),[s,f]=b.useState(()=>L()),[x,n]=b.useState(()=>T(ae(H,L()),H,L())),[l,u]=b.useState(null);b.useEffect(()=>{const r=L();f(r);let d=ae(t,r);n(T(d,t,r))},[o]);const c=b.useCallback((r,d,h)=>{n(p=>{const m={...p};return m[r]={...m[r]},m[r][d]={...m[r][d],value:h,source:"manual"},T(m,t,s)})},[t,s]),g=b.useCallback((r,d)=>{i(h=>{const p=h.map(m=>m.id===r?{...m,formulaString:d}:m);return n(m=>T(m,p,s)),p})},[s]),v=b.useCallback(r=>{const d=`custom_${Date.now()}`,h={id:d,label:r,isAutoCalculated:!1,isCurrency:!0};i(p=>{const m=[...p,h];return n(k=>{const S={...k};S[d]={};for(const a of s)S[d][a.id]={value:null,isEditable:!a.isYearEnd,source:"manual"};return T(S,m,s)}),m})},[s]),C=b.useCallback(r=>{i(d=>d.filter(h=>h.id!==r)),n(d=>{const h={...d};return delete h[r],h})},[]),j=b.useCallback(r=>{const d=`col_${Date.now()}`,h={id:d,label:r};f(p=>{const m=p.findIndex(S=>S.isYearEnd),k=[...p];return k.splice(m,0,h),n(S=>{const a={...S};for(const y of t)a[y.id]={...a[y.id]},a[y.id][d]={value:null,isEditable:!y.isAutoCalculated,source:"manual"};return T(a,t,k)}),k})},[t]),A=b.useCallback(r=>{f(d=>{const h=d.filter(p=>p.id!==r);return n(p=>{const m={...p};for(const k of Object.keys(m)){const{[r]:S,...a}=m[k];m[k]=a}return T(m,t,h)}),h})},[t]),N=b.useCallback((r,d)=>{f(h=>h.map(p=>p.id===r?{...p,label:d}:p))},[]),E=b.useCallback(r=>{if(!l)return;const d=t.filter(a=>!a.isAutoCalculated),h=s.filter(a=>!a.isYearEnd),p=d.findIndex(a=>a.id===l.row),m=h.findIndex(a=>a.id===l.col);if(p===-1||m===-1)return;let k=p,S=m;switch(r){case"up":k=Math.max(0,p-1);break;case"down":k=Math.min(d.length-1,p+1);break;case"left":S=Math.max(0,m-1);break;case"right":S=Math.min(h.length-1,m+1);break}u({row:d[k].id,col:h[S].id})},[l,t,s]),D=b.useCallback(async r=>{if(r)try{const d={year:new Date().getFullYear(),data:x,rows:t,columns:s},h=localStorage.getItem("auth_token");if(!(await fetch("undefined/api/financial-summary/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(d)})).ok)throw new Error("Failed to save")}catch(d){throw console.error("Save failed",d),d}},[x,t,s]);return{rows:t,columns:s,data:x,activeCell:l,setActiveCell:u,updateCell:c,addRow:v,deleteRow:C,addColumn:j,deleteColumn:A,renameColumn:N,navigateCell:E,saveData:D,updateRowFormula:g}}function he(o){let t="",i=o;for(;i>=0;)t=String.fromCharCode(65+i%26)+t,i=Math.floor(i/26)-1;return t}const le={database:{bg:"border-l-blue-500",border:"border-l-2",label:"Database"},manual:{bg:"border-l-transparent",border:"",label:"Manual"},formula:{bg:"border-l-orange-500",border:"border-l-2",label:"Formula"},calculated:{bg:"border-l-emerald-500",border:"border-l-2",label:"Calculated"}};function oe(o,t){return o===null?"":o===0?t.isCurrency?"£0.00":"0":t.isPercentage?`${o.toFixed(2)}%`:t.isCurrency?`£${o.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}`:o.toLocaleString("en-GB",{maximumFractionDigits:2})}function ge({rowId:o,colId:t,value:i,source:s,row:f,isActive:x,isHighlighted:n,onFocus:l,onUpdate:u,onNavigate:c}){const[g,v]=b.useState(!1),[C,j]=b.useState(""),A=b.useRef(null),N=b.useCallback(()=>{v(!0),j(i!==null?String(i):""),setTimeout(()=>{var r;return(r=A.current)==null?void 0:r.focus()},0)},[i]),E=b.useCallback(()=>{v(!1);const r=parseFloat(C);u(C===""?null:isNaN(r)?i:r)},[C,u,i]),D=r=>{g?r.key==="Enter"||r.key==="Tab"?(r.preventDefault(),E(),c(r.shiftKey?"up":"down")):r.key==="Escape"&&v(!1):r.key==="Enter"||r.key==="F2"?(r.preventDefault(),N()):r.key==="ArrowUp"?(r.preventDefault(),c("up")):r.key==="ArrowDown"?(r.preventDefault(),c("down")):r.key==="ArrowLeft"?(r.preventDefault(),c("left")):r.key==="ArrowRight"?(r.preventDefault(),c("right")):r.key==="Delete"||r.key==="Backspace"?(r.preventDefault(),u(null)):/^[0-9.\-]$/.test(r.key)&&(r.preventDefault(),j(r.key),v(!0),setTimeout(()=>{var d;return(d=A.current)==null?void 0:d.focus()},0))};return e.jsx(Z,{delayDuration:300,children:e.jsxs(J,{children:[e.jsx(G,{asChild:!0,children:e.jsx("td",{className:M("relative border-r border-b border-border/40 px-2 py-[5px] text-right text-[13px] min-w-[120px] cursor-cell select-none transition-all duration-75",x&&"outline outline-2 outline-primary z-10 bg-primary/5",n&&"ring-2 ring-orange-400/70 bg-orange-50/30 dark:bg-orange-950/20",!x&&!n&&"hover:bg-muted/30"),onClick:l,onDoubleClick:N,onKeyDown:D,tabIndex:0,onFocus:l,children:g?e.jsx("input",{ref:A,type:"text",value:C,onChange:r=>j(r.target.value),onBlur:E,className:"w-full bg-background text-right outline-none text-[13px] font-mono border border-primary/30 rounded px-1 -mx-1"}):e.jsx("span",{className:"font-mono text-[13px] text-foreground/90",children:oe(i,f)})})}),e.jsxs(U,{side:"top",className:"text-xs",children:[e.jsx("div",{className:"font-semibold",children:le[s||"manual"].label}),f.formulaString&&e.jsxs("div",{className:"mt-1 text-muted-foreground font-mono bg-muted px-1 rounded",children:["= ",f.formulaString]})]})]})})}function ye({value:o,row:t,source:i,isHighlighted:s}){return e.jsx(Z,{delayDuration:300,children:e.jsxs(J,{children:[e.jsx(G,{asChild:!0,children:e.jsx("td",{className:M("relative border-r border-b border-border/40 px-2 py-[5px] text-right text-[13px] min-w-[120px] select-none",t.isHeader?"bg-primary/[0.06] font-semibold":"bg-muted/20",s&&"ring-2 ring-orange-400/70 bg-orange-50/30 dark:bg-orange-950/20"),children:e.jsx("span",{className:M("font-mono text-[13px]",t.isHeader?"text-foreground font-semibold":"text-muted-foreground"),children:oe(o,t)})})}),e.jsxs(U,{side:"top",className:"text-xs",children:[e.jsx("div",{className:"font-semibold",children:le[i||"manual"].label}),t.formulaString&&e.jsxs("div",{className:"mt-1 text-muted-foreground font-mono bg-muted px-1 rounded",children:["= ",t.formulaString]}),!t.formulaString&&t.isAutoCalculated&&e.jsx("div",{className:"mt-1 text-muted-foreground italic",children:"Complex calculation"})]})]})})}function Ce({isOpen:o,onClose:t,row:i,initialFormula:s,onSave:f}){const[x,n]=b.useState(s);return b.useEffect(()=>{n(s)},[s]),i?e.jsx(B,{open:o,onOpenChange:l=>!l&&t(),children:e.jsxs(Y,{children:[e.jsx(V,{children:e.jsxs(K,{children:["Edit Formula: ",i.label]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ue,{htmlFor:"formula",className:"text-right",children:"Formula"}),e.jsx(z,{id:"formula",value:x,onChange:l=>n(l.target.value),className:"col-span-3 font-mono"})]}),e.jsx("div",{className:"text-xs text-muted-foreground ml-[25%]",children:"Supported: A1, B2, +, -, *, /, ( )"})]}),e.jsx(W,{children:e.jsx(I,{type:"submit",onClick:()=>f(x),children:"Save changes"})})]})}):null}function _e({rows:o,columns:t,data:i,activeCell:s,setActiveCell:f,updateCell:x,deleteRow:n,deleteColumn:l,navigateCell:u,onRenameColumn:c,updateRowFormula:g}){const[v,C]=b.useState(null),[j,A]=b.useState(""),[N,E]=b.useState(null),D=b.useRef(null),[r,d]=b.useState(null),h=a=>{C(a.id),A(a.label),setTimeout(()=>{var y;return(y=D.current)==null?void 0:y.focus()},0)},p=()=>{v&&c&&c(v,j),C(null)},m=a=>{d(a)},k=a=>{if(r&&g){const y=fe(a,o,t,t[0].id);g(r.id,y)}d(null)},S=b.useMemo(()=>{if(!N)return new Set;const a=o.find(w=>w.id===N),y=a==null?void 0:a.formulaString;if(!y){const w=["cost_sales_se","cost_sales_paye","employee_ni","employee_pension"],_=["apprenticeship_levy","annual_leave","other_expenses","recruitment_cost","overheads_mgmt","bank_interest","cooperation_tax"],O={total_cost_sales:w,total_overheads:_,total_cost:[...w,..._],gross_hourly_margin:["avg_hourly_charge","gross_hourly_pay"],hours_breakeven:["total_cost","gross_hourly_margin"],value_breakeven:["hours_breakeven","avg_hourly_charge"],sales_budget_2026:["total_sales"],gross_pl_value:["total_sales","total_cost"],net_pl:["gross_pl_value","total_overheads"]}[N]||[],R=new Set;for(const F of O)for(const P of t)R.add(`${F}:${P.id}`);return R}if(y){const w=te(y,o,t,t[0].id),_=new Set,$=/\b[A-Z]+[0-9]+\b/g;let O;for(;(O=$.exec(w))!==null;){const R=se(O[0]);if(R){const F=o[R.rowIdx],P=t[R.colIdx];F&&P&&_.add(`${F.id}:${P.id}`)}}return _}return new Set},[N,o,t]);return e.jsxs("div",{className:"border border-border rounded-md bg-card overflow-hidden shadow-sm",children:[e.jsx("div",{className:"overflow-auto max-h-[calc(100vh-200px)]",children:e.jsxs("table",{className:"border-collapse w-full",children:[e.jsxs("thead",{className:"sticky top-0 z-30",children:[e.jsxs("tr",{className:"bg-muted/60",children:[e.jsx("th",{className:"sticky left-0 z-40 bg-muted/80 border-r border-b border-border/50 w-10 min-w-[40px]"}),e.jsx("th",{className:"sticky left-10 z-40 bg-muted/80 border-r border-b border-border/50 w-[200px] min-w-[200px]"}),t.map((a,y)=>e.jsx("th",{className:"border-r border-b border-border/50 px-1 py-1 text-center text-[11px] font-medium text-muted-foreground bg-muted/60 min-w-[120px]",children:he(y)},y)),e.jsx("th",{className:"bg-muted/60 border-b border-border/50 w-8"})]}),e.jsxs("tr",{className:"bg-muted/40",children:[e.jsx("th",{className:"sticky left-0 z-40 bg-muted/60 border-r border-b border-border/50 w-10 min-w-[40px] text-[10px] text-muted-foreground font-medium",children:"#"}),e.jsx("th",{className:"sticky left-10 z-40 bg-muted/60 border-r border-b border-border/50 px-3 py-2 text-left text-[11px] font-semibold text-muted-foreground uppercase tracking-wider w-[200px] min-w-[200px]",children:"Description"}),t.map(a=>e.jsx("th",{className:M("border-r border-b border-border/50 px-1 py-2 text-center text-[11px] font-semibold uppercase tracking-wide min-w-[120px]",a.isYearEnd?"bg-primary/10 text-primary":"bg-muted/40 text-muted-foreground"),onDoubleClick:()=>!a.isProtected&&h(a),children:e.jsx("div",{className:"flex items-center justify-center gap-1 group relative",children:v===a.id?e.jsx("input",{ref:D,value:j,onChange:y=>A(y.target.value),onBlur:p,onKeyDown:y=>y.key==="Enter"&&p(),className:"w-full bg-background border border-border rounded px-1 text-center text-[11px]"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"truncate",children:a.label}),!a.isProtected&&e.jsx(I,{variant:"ghost",size:"icon",className:"h-4 w-4 opacity-0 group-hover:opacity-100 absolute -right-1 hover:text-destructive",onClick:y=>{y.stopPropagation(),l(a.id)},children:e.jsx(Q,{className:"h-3 w-3"})})]})})},a.id)),e.jsx("th",{className:"bg-muted/40 border-b border-border/50 w-8"})]})]}),e.jsx("tbody",{children:o.map((a,y)=>e.jsxs("tr",{className:M("group",a.isHeader&&"bg-primary/[0.04]"),onMouseEnter:()=>(a.isAutoCalculated||a.formulaString)&&E(a.id),onMouseLeave:()=>E(null),children:[e.jsx("td",{className:"sticky left-0 z-10 bg-muted/60 border-r border-b border-border/50 text-center text-[11px] text-muted-foreground font-medium w-10 min-w-[40px] select-none",children:y+1}),e.jsx("td",{className:M("sticky left-10 z-10 border-r border-b border-border/50 px-3 py-[5px] whitespace-nowrap text-[13px] truncate max-w-[200px] w-[200px] min-w-[200px] bg-card",a.isHeader&&"font-bold text-primary bg-primary/[0.04]",a.isAutoCalculated&&!a.isHeader&&"text-muted-foreground italic"),title:a.label,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"truncate",children:a.label}),(a.isAutoCalculated||a.formulaString)&&e.jsx(Z,{delayDuration:200,children:e.jsxs(J,{children:[e.jsx(G,{asChild:!0,children:e.jsx("button",{className:"opacity-0 group-hover:opacity-70 hover:!opacity-100 transition-opacity",onClick:()=>m(a),children:e.jsx(ce,{className:"h-3.5 w-3.5 text-orange-500"})})}),e.jsx(U,{side:"right",className:"text-xs",children:"Edit formula"})]})})]})}),t.map(w=>{var F;const _=(F=i[a.id])==null?void 0:F[w.id],$=(_==null?void 0:_.isEditable)&&!a.isAutoCalculated&&!w.isYearEnd,O=`${a.id}:${w.id}`,R=S.has(O);return $?e.jsx(ge,{rowId:a.id,colId:w.id,value:(_==null?void 0:_.value)??null,source:_==null?void 0:_.source,row:a,isActive:(s==null?void 0:s.row)===a.id&&(s==null?void 0:s.col)===w.id,isHighlighted:R,onFocus:()=>f({row:a.id,col:w.id}),onUpdate:P=>x(a.id,w.id,P),onNavigate:u},w.id):e.jsx(ye,{value:(_==null?void 0:_.value)??null,row:a,source:_==null?void 0:_.source,isHighlighted:R},w.id)}),e.jsx("td",{className:"border-b border-border/40 bg-card w-8 text-center p-0",children:!a.isAutoCalculated&&e.jsx(I,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:text-destructive hover:bg-destructive/10",onClick:()=>n(a.id),children:e.jsx(Q,{className:"h-3 w-3"})})})]},a.id))})]})}),r&&e.jsx(Ce,{isOpen:!0,onClose:()=>d(null),row:r,initialFormula:te(r.formulaString||"",o,t,t[0].id),onSave:k})]})}function Ee(){const{rows:o,columns:t,data:i,activeCell:s,setActiveCell:f,updateCell:x,addRow:n,deleteRow:l,addColumn:u,deleteColumn:c,navigateCell:g,updateRowFormula:v}=xe(),[C,j]=b.useState(""),[A,N]=b.useState(""),[E,D]=b.useState(!1),[r,d]=b.useState(!1),h=()=>{C.trim()&&(n(C.trim()),j(""),D(!1))},p=()=>{A.trim()&&(u(A.trim()),N(""),d(!1))};return e.jsx(ie,{noPadding:!0,fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-card/50 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(de,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Financial Summary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Annual budget and performance spreadsheet"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(B,{open:E,onOpenChange:D,children:[e.jsx(q,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"sm",children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," Add Row"]})}),e.jsxs(Y,{children:[e.jsx(V,{children:e.jsx(K,{children:"Add New Row"})}),e.jsx(z,{placeholder:"Row label...",value:C,onChange:m=>j(m.target.value),onKeyDown:m=>m.key==="Enter"&&h()}),e.jsx(W,{children:e.jsx(I,{onClick:h,disabled:!C.trim(),children:"Add"})})]})]}),e.jsxs(B,{open:r,onOpenChange:d,children:[e.jsx(q,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"sm",children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," Add Column"]})}),e.jsxs(Y,{children:[e.jsx(V,{children:e.jsx(K,{children:"Add New Column"})}),e.jsx(z,{placeholder:"Column label...",value:A,onChange:m=>N(m.target.value),onKeyDown:m=>m.key==="Enter"&&p()}),e.jsx(W,{children:e.jsx(I,{onClick:p,disabled:!A.trim(),children:"Add"})})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx(_e,{rows:o,columns:t,data:i,activeCell:s,setActiveCell:f,updateCell:x,deleteRow:l,deleteColumn:c,navigateCell:g,updateRowFormula:v})})]})})}export{Ee as default};
