import{c as os,h as ls,r as c,U as cs,p as ds,j as e,v as hs,P as ne,q as he,w as us,e as xe,B as z,I as Te,L as ms,y as L,ab as gs,u as xs,d as fs,a3 as js,a4 as vs,a5 as ps,a6 as ys,a7 as bs,a8 as Ns,a9 as Ss,aa as Cs,A as se}from"./index-aquobynx.js";import{D as Ts}from"./DashboardLayout-BQdW6cYD.js";import{C as M,d as k,a as te,b as re}from"./card-CGtHYGn6.js";import{c as Le,R as As,I as Ds,P as Ls}from"./index-CXnya9pW.js";import{D as Rs}from"./DashboardHeader-DudOYGl2.js";import{u as Ms,O as ks}from"./OperationalTrendChart-CZDV7TO8.js";import{u as ws,L as Fs,R as Ps}from"./LoadingOverlay-Civyytq9.js";import{R as fe,C as Re,X as Me,Y as ke,T as je,B as ge,a as we,L as Fe}from"./generateCategoricalChart-ZbuZl4Jk.js";import{B as Pe}from"./BarChart-D9lGIULC.js";import{P as Es,a as Is}from"./PieChart-ClPKHiif.js";import{T as Ee,a as Ie,b as X,c as R,d as Oe,e as T,f as Os}from"./table-Bn7oq0jc.js";import{P as $s}from"./pen-CgDbORDk.js";import{T as Bs}from"./trash-2-D-vQA5xv.js";import{D as _s,b as Vs,c as Hs,d as zs,f as Gs,e as Ks}from"./dialog-DIn0j7k6.js";import{L as P}from"./label-Cni09IrY.js";import{S as Y,a as q,b as J,c as W,d as B}from"./select-uneU3hhJ.js";import{u as Us}from"./useRecords-DouZEEB8.js";import{f as _}from"./popover-Bhh3IOUa.js";import"./users-BXtOXMM4.js";import"./locationUtils-BbMavvEK.js";import"./index-B1tyjBHR.js";import"./Line-CV1HrZ1j.js";import"./AreaChart-OfIWAeOA.js";import"./useQuery-BD_ggkPF.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=os("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var ie="Tabs",[qs,La]=ls(ie,[Le]),$e=Le(),[Js,ve]=qs(ie),Be=c.forwardRef((s,t)=>{const{__scopeTabs:a,value:i,onValueChange:n,defaultValue:l,orientation:h="horizontal",dir:v,activationMode:f="automatic",...b}=s,u=cs(v),[g,j]=ds({prop:i,onChange:n,defaultProp:l??"",caller:ie});return e.jsx(Js,{scope:a,baseId:hs(),value:g,onValueChange:j,orientation:h,dir:u,activationMode:f,children:e.jsx(ne.div,{dir:u,"data-orientation":h,...b,ref:t})})});Be.displayName=ie;var _e="TabsList",Ve=c.forwardRef((s,t)=>{const{__scopeTabs:a,loop:i=!0,...n}=s,l=ve(_e,a),h=$e(a);return e.jsx(As,{asChild:!0,...h,orientation:l.orientation,dir:l.dir,loop:i,children:e.jsx(ne.div,{role:"tablist","aria-orientation":l.orientation,...n,ref:t})})});Ve.displayName=_e;var He="TabsTrigger",ze=c.forwardRef((s,t)=>{const{__scopeTabs:a,value:i,disabled:n=!1,...l}=s,h=ve(He,a),v=$e(a),f=Ue(h.baseId,i),b=Ye(h.baseId,i),u=i===h.value;return e.jsx(Ds,{asChild:!0,...v,focusable:!n,active:u,children:e.jsx(ne.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":b,"data-state":u?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:f,...l,ref:t,onMouseDown:he(s.onMouseDown,g=>{!n&&g.button===0&&g.ctrlKey===!1?h.onValueChange(i):g.preventDefault()}),onKeyDown:he(s.onKeyDown,g=>{[" ","Enter"].includes(g.key)&&h.onValueChange(i)}),onFocus:he(s.onFocus,()=>{const g=h.activationMode!=="manual";!u&&!n&&g&&h.onValueChange(i)})})})});ze.displayName=He;var Ge="TabsContent",Ke=c.forwardRef((s,t)=>{const{__scopeTabs:a,value:i,forceMount:n,children:l,...h}=s,v=ve(Ge,a),f=Ue(v.baseId,i),b=Ye(v.baseId,i),u=i===v.value,g=c.useRef(u);return c.useEffect(()=>{const j=requestAnimationFrame(()=>g.current=!1);return()=>cancelAnimationFrame(j)},[]),e.jsx(us,{present:n||u,children:({present:j})=>e.jsx(ne.div,{"data-state":u?"active":"inactive","data-orientation":v.orientation,role:"tabpanel","aria-labelledby":f,hidden:!j,id:b,tabIndex:0,...h,ref:t,style:{...s.style,animationDuration:g.current?"0s":void 0},children:j&&l})})});Ke.displayName=Ge;function Ue(s,t){return`${s}-trigger-${t}`}function Ye(s,t){return`${s}-content-${t}`}var Ws=Be,qe=Ve,Je=ze,We=Ke;const Xs=Ws,Xe=c.forwardRef(({className:s,...t},a)=>e.jsx(qe,{ref:a,className:xe("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));Xe.displayName=qe.displayName;const V=c.forwardRef(({className:s,...t},a)=>e.jsx(Je,{ref:a,className:xe("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...t}));V.displayName=Je.displayName;const H=c.forwardRef(({className:s,...t},a)=>e.jsx(We,{ref:a,className:xe("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));H.displayName=We.displayName;const Qs=({active:s,payload:t,label:a,metric:i})=>{if(s&&t&&t.length){const n=["clients","employees","shifts"].includes(i),l=t[0].value;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:a}),e.jsx("p",{className:"text-sm",children:n?l.toLocaleString():l.toLocaleString(void 0,{style:"currency",currency:"GBP"})})]})}return null},ue=({data:s,metric:t,onBarClick:a})=>!s||s.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No breakdown data available"})}):e.jsx(M,{children:e.jsx(k,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Pe,{data:s,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(Re,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(Me,{type:"number",hide:!0}),e.jsx(ke,{dataKey:"name",type:"category",width:120,tick:{fontSize:12}}),e.jsx(je,{content:e.jsx(Qs,{metric:t})}),e.jsx(ge,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0],onClick:a,children:s.map((i,n)=>e.jsx(we,{fill:"hsl(var(--primary))",fillOpacity:.8+n*.05},`cell-${n}`))})]})})})})}),Ae=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#8dd1e1","#a4de6c","#d0ed57"],Zs=({active:s,payload:t})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:t[0].name}),e.jsx("p",{className:"text-sm",children:Number(t[0].value).toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:`${(t[0].payload.percentage||0).toFixed(1)}%`})]}):null,ae=({data:s,metric:t})=>{if(!s||s.length===0)return e.jsx(M,{children:e.jsx(k,{className:"pt-6",children:e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No distribution data available"})})})});const a=[...s].sort((l,h)=>h.value-l.value),i=a.reduce((l,h)=>l+h.value,0),n=a.map(l=>({...l,percentage:i>0?l.value/i*100:0}));return e.jsx(M,{children:e.jsx(k,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Es,{children:[e.jsx(Is,{data:n,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",children:n.map((l,h)=>e.jsx(we,{fill:Ae[h%Ae.length]},`cell-${h}`))}),e.jsx(je,{content:e.jsx(Zs,{})}),e.jsx(Fe,{})]})})})})})},ea=({data:s,onEdit:t,onDelete:a})=>!s||s.length===0?e.jsx("div",{className:"h-[200px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No overhead details available"})}):e.jsxs(M,{children:[e.jsx(te,{children:e.jsx(re,{children:"Overheads Details"})}),e.jsx(k,{children:e.jsxs(Ee,{children:[e.jsx(Ie,{children:e.jsxs(X,{children:[e.jsx(R,{children:"Title"}),e.jsx(R,{children:"Month"}),e.jsx(R,{children:"Location"}),e.jsx(R,{children:"Site"}),e.jsx(R,{className:"text-right",children:"Amount"}),e.jsx(R,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Oe,{children:s.map(i=>e.jsxs(X,{children:[e.jsx(T,{className:"font-medium",children:i.name}),e.jsxs(T,{children:[i.month," ",i.year]}),e.jsx(T,{children:i.location||"-"}),e.jsx(T,{children:i.site||"-"}),e.jsx(T,{className:"text-right",children:i.value.toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-500 hover:text-blue-600",onClick:()=>t(i),children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600",onClick:()=>a(i.id),children:e.jsx(Bs,{className:"h-4 w-4"})})]})})]},i.id))})]})})]}),sa=({active:s,payload:t,label:a})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:a}),t.map((i,n)=>e.jsxs("p",{className:"text-sm",style:{color:i.color},children:[i.name,": ",i.value.toLocaleString()]},n))]}):null,aa=({data:s})=>{if(!s||s.length===0)return e.jsxs(M,{className:"flex-1",children:[e.jsx(te,{children:e.jsx(re,{children:"Target vs Actual Performance"})}),e.jsx(k,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const t=new Map;s.forEach(n=>{const l=n.site?`${n.location} - ${n.site}`:n.location;t.has(l)||t.set(l,{actual:0,target:0});const h=t.get(l);h.actual+=n.actual||0,h.target+=n.target||0});const a=Array.from(t.entries()).map(([n,l])=>({name:n,actual:l.actual,target:l.target})).sort((n,l)=>n.name.localeCompare(l.name));console.log("TargetPerformanceChart - Chart Data:",a.slice(0,3)),console.log("Total sites:",a.length);const i=Math.max(400,a.length*50);return e.jsxs(M,{className:"flex-1",children:[e.jsxs(te,{children:[e.jsx(re,{children:"Target vs Actual Performance by Site"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total shifts achieved compared to target for each location/site"})]}),e.jsx(k,{children:e.jsx("div",{style:{height:`${i}px`},children:e.jsx(fe,{width:"100%",height:"100%",children:e.jsxs(Pe,{data:a,layout:"horizontal",margin:{top:20,right:30,left:150,bottom:20},children:[e.jsx(Re,{strokeDasharray:"3 3"}),e.jsx(Me,{type:"number",label:{value:"Number of Shifts",position:"bottom"}}),e.jsx(ke,{type:"category",dataKey:"name",width:140,tick:{fontSize:11}}),e.jsx(je,{content:e.jsx(sa,{})}),e.jsx(Fe,{}),e.jsx(ge,{dataKey:"target",name:"Target",fill:"hsl(var(--muted))",opacity:.7}),e.jsx(ge,{dataKey:"actual",name:"Actual",fill:"hsl(var(--primary))"})]})})})})]})},me=["January","February","March","April","May","June","July","August","September","October","November","December"],De=["Rent","Salaries","Utilities","Software","Equipment","Marketing","Travel","Insurance","Taxes","Maintenance","Custom..."],ta=({open:s,onOpenChange:t,initialData:a,onSave:i})=>{var F,Z;const{data:n}=Us(),[l,h]=c.useState(!1),[v,f]=c.useState(new Date().getFullYear()),[b,u]=c.useState(me[new Date().getMonth()]),[g,j]=c.useState(""),[Q,p]=c.useState(""),[w,N]=c.useState(""),[E,I]=c.useState(""),[O,$]=c.useState("");c.useEffect(()=>{s&&(a?(f(a.year),u(a.month),j(a.location||""),p(a.site||""),$(a.value.toString()),De.includes(a.name)?(N(a.name),I("")):(N("Custom..."),I(a.name))):(f(new Date().getFullYear()),u(me[new Date().getMonth()]),j(""),p(""),N(""),I(""),$("")))},[s,a]);const oe=async()=>{if(!g||!w||!O){L.error("Please fill in all required fields");return}const r=w==="Custom..."?E:w;if(!r){L.error("Please specify the overhead name");return}h(!0);try{await i({id:a==null?void 0:a.id,year:v,month:b,location:g,site:Q||null,name:r,value:parseFloat(O)}),t(!1)}catch(A){console.error("Failed to save overhead:",A)}finally{h(!1)}},G=((F=n==null?void 0:n.jobs)==null?void 0:F.filter(r=>r.location===g&&r.site).map(r=>r.site).filter((r,A,K)=>K.indexOf(r)===A))||[];return e.jsx(_s,{open:s,onOpenChange:t,children:e.jsxs(Vs,{className:"sm:max-w-[500px]",children:[e.jsxs(Hs,{children:[e.jsx(zs,{children:a?"Edit Overhead":"Add Overhead"}),e.jsx(Gs,{children:a?"Update existing overhead record.":"Create a new overhead record."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Year"}),e.jsxs(Y,{value:v.toString(),onValueChange:r=>f(Number(r)),children:[e.jsx(q,{children:e.jsx(J,{})}),e.jsx(W,{children:[2024,2025,2026,2027,2028].map(r=>e.jsx(B,{value:r.toString(),children:r},r))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Month"}),e.jsxs(Y,{value:b,onValueChange:u,children:[e.jsx(q,{children:e.jsx(J,{})}),e.jsx(W,{children:me.map(r=>e.jsx(B,{value:r,children:r},r))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Location"}),e.jsxs(Y,{value:g,onValueChange:r=>{j(r),p("")},children:[e.jsx(q,{children:e.jsx(J,{placeholder:"Select location..."})}),e.jsx(W,{children:Array.from(new Set((Z=n==null?void 0:n.jobs)==null?void 0:Z.map(r=>r.location).filter(Boolean))).map(r=>e.jsx(B,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Site (Optional)"}),e.jsxs(Y,{value:Q,onValueChange:p,disabled:!g||G.length===0,children:[e.jsx(q,{children:e.jsx(J,{placeholder:G.length===0?"No sites available":"Select site..."})}),e.jsxs(W,{children:[e.jsx(B,{value:"all_sites",children:"All Sites (if applicable)"}),G.map(r=>e.jsx(B,{value:r,children:r},r))]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Category"}),e.jsxs(Y,{value:w,onValueChange:N,children:[e.jsx(q,{children:e.jsx(J,{placeholder:"Select category..."})}),e.jsx(W,{children:De.map(r=>e.jsx(B,{value:r,children:r},r))})]})]}),w==="Custom..."&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Custom Name"}),e.jsx(Te,{placeholder:"Enter overhead name",value:E,onChange:r=>I(r.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(P,{children:"Value (£)"}),e.jsx(Te,{type:"number",placeholder:"0.00",value:O,onChange:r=>$(r.target.value)})]})]}),e.jsxs(Ks,{children:[e.jsx(z,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsxs(z,{onClick:oe,disabled:l,children:[l&&e.jsx(ms,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})})},Ra=()=>{const{metricId:s}=gs(),t=xs(),{dateRange:a,setDateRange:i}=fs(),[n,l]=c.useState(!1),[h,v]=c.useState(a),[f,b]=c.useState([]),[u,g]=c.useState([]),[j,Q]=c.useState("trend"),[p,w]=c.useState([]),[N,E]=c.useState([]),[I,O]=c.useState(!1),[$,oe]=c.useState([]),[G,F]=c.useState(!1),[Z,r]=c.useState(null),[A,K]=c.useState(null),U=["revenue","cost","profit","employees","clientRate","staffRate","overheads"].includes(s||""),ee=["shifts","hours","clients","targetAchievement","missedTargets"].includes(s||""),le=s==="overheads",{operationalData:S,isLoading:Qe}=Ms(a,f,u),{financialData:C,isLoading:Ze}=ws(a,f,u),es=U?Ze:ee?Qe:!1;console.log("MetricDetail Debug:",{metricId:s,isOperational:ee,isFinancial:U,targetsPerformanceData:$}),c.useEffect(()=>{if(s!=="missedTargets")return;(async()=>{try{const d=new URLSearchParams({start:_(a.from,"yyyy-MM-dd"),end:_(a.to,"yyyy-MM-dd")}),x={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},m=await fetch(`${se.TARGETS_PERFORMANCE}?${d.toString()}`,{headers:x});if(m.ok){const y=await m.json();oe(y)}}catch(d){console.error("Error fetching targets performance:",d)}})()},[a,s]),c.useEffect(()=>{if(j==="trend"||!s)return;(async()=>{O(!0);try{const d=new URLSearchParams({start:_(a.from,"yyyy-MM-dd"),end:_(a.to,"yyyy-MM-dd"),metric:s,limit:"20"});f&&f.length>0&&f.forEach(m=>d.append("locations",m)),u&&u.length>0&&u.forEach(m=>d.append("sites",m));const x={Authorization:`Bearer ${localStorage.getItem("auth_token")}`};if(j==="details"&&le){const m=await fetch(`${se.FINANCIAL_METRICS_LIST}?${d.toString()}`,{headers:x});if(m.ok){const y=await m.json();E(y)}}else if(["location","site","client"].includes(j)){d.append("dimension",j);const m=await fetch(`${se.BREAKDOWN}?${d.toString()}`,{headers:x});if(m.ok){const y=await m.json();w(y)}}}catch(d){console.error("Error fetching breakdown:",d)}finally{O(!1)}})()},[j,s,a,f,u]);const ss=()=>{r(null),F(!0)},as=o=>{r(o),F(!0)},ts=async()=>{if(A)try{const o=await fetch(`/api/admin/financial-metrics/${A}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(o.ok)L.success("Overhead deleted"),j==="details"&&E(d=>d.filter(x=>x.id!==A));else{const d=await o.json();L.error(d.error||"Failed to delete")}}catch(o){console.error(o),L.error("Failed to delete")}finally{K(null)}},rs=async o=>{try{const d=await fetch("/api/admin/financial-metrics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(o)});if(d.ok){L.success("Overhead saved"),F(!1);const x=new URLSearchParams({start:_(a.from,"yyyy-MM-dd"),end:_(a.to,"yyyy-MM-dd"),metric:s||"overheads",limit:"20"});f&&f.forEach(D=>x.append("locations",D)),u&&u.forEach(D=>x.append("sites",D));const m={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},y=await fetch(`${se.FINANCIAL_METRICS_LIST}?${x.toString()}`,{headers:m});if(y.ok){const D=await y.json();E(D)}}else{const x=await d.json();L.error(x.error||"Failed to save")}}catch(d){console.error(d),L.error("Failed to save")}},pe=o=>{switch(o){case"revenue":return"Revenue Analysis";case"cost":return"Cost Analysis";case"profit":return"Profit Analysis";case"shifts":return"Shifts Analysis";case"hours":return"Hours Analysis";case"clients":return"Client Analysis";case"employees":return"Employee Analysis";case"targetAchievement":return"Target Achievement Analysis";case"missedTargets":return"Missed Targets Analysis";case"clientRate":return"Client Rate Analysis";case"staffRate":return"Staff Rate Analysis";case"overheads":return"Overheads Analysis";default:return"Metric Analysis"}},ns=(o,d)=>{var x,m,y,D,ye,be,Ne,Se,Ce;if(!o)return"-";switch(d){case"revenue":return`£${((x=o.revenue)==null?void 0:x.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"cost":return`£${((m=o.cost)==null?void 0:m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"profit":const de=o.profit??o.revenue-o.cost-(o.overheads||0);return`£${(de==null?void 0:de.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"shifts":return((y=o.totalShifts)==null?void 0:y.toLocaleString())??0;case"hours":return((D=o.paidHours)==null?void 0:D.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"clients":return((ye=o.clientCount)==null?void 0:ye.toLocaleString())??0;case"employees":return((be=o.paidHours)==null?void 0:be.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"targetAchievement":return`${((Ne=o.achievementPercentage)==null?void 0:Ne.toFixed(1))??0}%`;case"missedTargets":return`${((Se=o.achievementPercentage)==null?void 0:Se.toFixed(1))??0}%`;case"clientRate":return`£${(o.revenue/o.paidHours||0).toFixed(2)}`;case"staffRate":return`£${(o.cost/o.paidHours||0).toFixed(2)}`;case"overheads":return`£${((Ce=o.overheads)==null?void 0:Ce.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;default:return"-"}},is=c.useMemo(()=>{if(!N||N.length===0)return[];const o=N.reduce((d,x)=>{const m=x.name||"Unknown";return d[m]||(d[m]=0),d[m]+=x.value,d},{});return Object.entries(o).map(([d,x])=>({name:d,value:x}))},[N]),ce=U?C==null?void 0:C.timeSeries:S==null?void 0:S.timeSeries;return e.jsx(Ts,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(Rs,{dateRange:a,onDateRangeChange:i,calendarOpen:n,onCalendarOpenChange:l,tempDateRange:h,onTempDateRangeChange:v,selectedLocations:f,onLocationsChange:b,selectedSites:u,onSitesChange:g}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6 relative",children:[(es||I)&&e.jsx(Fs,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>t(-1),className:"gap-2",children:[e.jsx(Ys,{className:"h-4 w-4"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold",children:pe(s)})]}),e.jsxs(Xs,{value:j,onValueChange:Q,className:"space-y-4",children:[e.jsxs(Xe,{children:[e.jsx(V,{value:"trend",children:"Trend"}),e.jsx(V,{value:"location",children:"By Location"}),e.jsx(V,{value:"site",children:"By Site"}),!le&&e.jsx(V,{value:"client",children:"By Client"}),le&&e.jsx(V,{value:"details",children:"All Details"})]}),e.jsx(H,{value:"trend",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[U&&e.jsx(Ps,{data:(C==null?void 0:C.timeSeries)||[],aggregationLevel:(C==null?void 0:C.aggregationLevel)||"monthly",selectedMetric:s}),ee&&s!=="missedTargets"&&e.jsx(ks,{data:(S==null?void 0:S.timeSeries)||[],aggregationLevel:(S==null?void 0:S.aggregationLevel)||"monthly",selectedMetric:s}),s==="missedTargets"&&e.jsx(aa,{data:$}),!U&&!ee&&e.jsx(M,{children:e.jsx(k,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Metric type not recognized or data unavailable."})})}),e.jsxs(M,{children:[e.jsx(te,{children:e.jsx(re,{children:"Historical Data"})}),e.jsx(k,{children:e.jsxs(Ee,{children:[e.jsxs(Os,{children:["Detailed historical data for ",pe(s)]}),e.jsx(Ie,{children:e.jsxs(X,{children:[e.jsx(R,{children:"Period"}),e.jsx(R,{className:"text-right",children:"Value"})]})}),e.jsx(Oe,{children:ce&&ce.length>0?[...ce].reverse().map((o,d)=>e.jsxs(X,{children:[e.jsx(T,{className:"font-medium",children:o.display}),e.jsx(T,{className:"text-right font-medium",children:ns(o,s)})]},d)):e.jsx(X,{children:e.jsx(T,{colSpan:2,className:"text-center",children:"No data available"})})})]})})]})]})}),e.jsx(H,{value:"location",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(ue,{data:p,metric:s||"revenue"}),e.jsx(ae,{data:p,metric:s||"revenue"})]})}),e.jsx(H,{value:"site",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(ue,{data:p,metric:s||"revenue"}),e.jsx(ae,{data:p,metric:s||"revenue"})]})}),e.jsx(H,{value:"client",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(ue,{data:p,metric:s||"revenue"}),e.jsx(ae,{data:p,metric:s||"revenue"})]})}),e.jsx(H,{value:"details",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(ae,{data:is,metric:"overheads"})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(z,{onClick:ss,className:"gap-2",children:[e.jsx(Ls,{className:"h-4 w-4"}),"Add Overhead"]})}),e.jsx(ea,{data:N,onEdit:as,onDelete:K}),e.jsx(ta,{open:G,onOpenChange:F,initialData:Z,onSave:rs}),e.jsx(js,{open:!!A,onOpenChange:o=>!o&&K(null),children:e.jsxs(vs,{children:[e.jsxs(ps,{children:[e.jsx(ys,{children:"Are you sure?"}),e.jsx(bs,{children:"This will permanently delete this overhead record."})]}),e.jsxs(Ns,{children:[e.jsx(Ss,{children:"Cancel"}),e.jsx(Cs,{onClick:ts,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})})]})]})]})})};export{Ra as default};
