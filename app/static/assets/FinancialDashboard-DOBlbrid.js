import{r,a as w,A as S,j as e,u as L}from"./index-X6n8QLQ6.js";import{D as T,L as A}from"./DashboardLayout-DamfEDU6.js";import{f as p}from"./locationUtils-3wBueozB.js";import{M as j,c as M,D as R,L as k}from"./LoadingOverlay-Dfsn-3_H.js";import{C as l,d,a as g,b as v}from"./card-DwLgY9GA.js";import{R as P,C as E,X as F,Y as O,T as $,L as K,A as y}from"./generateCategoricalChart-Duo-jgrn.js";import{A as z}from"./AreaChart-BAU_kpb4.js";import{B as N}from"./button-CvIZVJXF.js";import{T as I}from"./users-B_CdESUm.js";import"./select-D8IUDuCg.js";import"./badge-UXmziVSu.js";const B=(s,t,n)=>{const[i,c]=r.useState(null),[f,m]=r.useState(!1),{toast:x}=w(),h=async()=>{m(!0);try{const o=new URLSearchParams({start:p(s.from,"yyyy-MM-dd"),end:p(s.to,"yyyy-MM-dd")});t&&t.length>0&&t.forEach(a=>o.append("locations",a)),n&&n.length>0&&n.forEach(a=>o.append("sites",a));const u=await fetch(`${S.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(u.ok){const a=await u.json();c(a)}else x({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch{x({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{m(!1)}};return r.useEffect(()=>{h()},[s,t,n]),{financialData:i,isLoading:f,refetch:h}},U=({metrics:s})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 w-full",children:[e.jsx(j,{title:"Total Revenue",value:`£${s.revenue.value.toLocaleString()}`,change:s.revenue.text,trend:s.revenue.trend}),e.jsx(j,{title:"Average Client Pay",value:`£${s.clientPay.value.toFixed(2)}`,change:s.clientPay.text,trend:s.clientPay.trend}),e.jsx(j,{title:"Average Staff Pay",value:`£${s.staffPay.value.toFixed(2)}`,change:s.staffPay.text,trend:s.staffPay.trend})]}),W=({salesData:s})=>{var t;return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalShifts)||0})]})})})}),e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalClients)||0})]})})})}),e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.uniqueEmployees)||0})]})})})}),e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((t=s==null?void 0:s.profitMargin)==null?void 0:t.toFixed(1))||0,"%"]})]})})})})]})},Y=({active:s,payload:t,label:n})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:n}),t.map((i,c)=>e.jsxs("p",{className:"text-sm",style:{color:i.color},children:[i.name,": £",Number(i.value).toLocaleString()]},c))]}):null,_=({data:s,aggregationLevel:t})=>{const n={dataKey:"display",interval:0};return!s||s.length===0?e.jsxs(l,{children:[e.jsx(g,{children:e.jsx(v,{children:"Revenue vs Cost Trend"})}),e.jsx(d,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(l,{children:[e.jsxs(g,{children:[e.jsx(v,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t==="daily"&&"Daily view",t==="weekly"&&"Weekly view",t==="monthly"&&"Monthly view"]})]}),e.jsx(d,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(P,{width:"100%",height:"100%",children:e.jsxs(z,{data:s,children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:n.dataKey,tick:{fontSize:12},interval:n.interval}),e.jsx(O,{}),e.jsx($,{content:e.jsx(Y,{})}),e.jsx(K,{}),e.jsx(y,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(y,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]})})})})]})};function te(){const s=L(),[t,n]=r.useState({from:new Date(2025,0,1),to:new Date}),[i,c]=r.useState(!1),[f,m]=r.useState(t),[x,h]=r.useState([]),[o,u]=r.useState([]),{financialData:a,isLoading:C}=B(t,x,o),b=M(a,t);return e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(R,{dateRange:t,onDateRangeChange:n,calendarOpen:i,onCalendarOpenChange:c,tempDateRange:f,onTempDateRangeChange:m,selectedLocations:x,onLocationsChange:h,selectedSites:o,onSitesChange:u}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(N,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(I,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(N,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>s("/dashboard/operational"),children:[e.jsx(A,{className:"h-4 w-4"}),"Operational View"]})]})}),C&&e.jsx(k,{}),e.jsx(U,{metrics:b}),e.jsx(W,{salesData:a}),e.jsx(_,{data:(a==null?void 0:a.timeSeries)||[],aggregationLevel:(a==null?void 0:a.aggregationLevel)||"monthly"})]})})]})})}export{te as default};
