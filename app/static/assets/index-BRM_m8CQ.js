const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-B-eULRIK.js","assets/index-DGdRZeVl.js","assets/index-DaO3iYkk.css","assets/card-BpvvmwCp.js","assets/users-Bm0Hlhia.js","assets/locationUtils-ycv-iby-.js","assets/button-XclJQX5t.js","assets/DashboardLayout-CJziurwz.js","assets/ChartCanvas-C-3XzwnQ.js","assets/badge-C7Pl0zEo.js","assets/AreaChart-BHtc2fVd.js","assets/BarChart-DBg86xM5.js"])))=>i.map(i=>d[i]);
import{c as Ie,r as a,q as W,P as _,s as Z,j as r,k as L,X as tt,d as rt,e as De,i as nt,f as at,h as st,a as lt,S as ot,T as it,l as ct,m as dt,n as ut,_ as Me}from"./index-DGdRZeVl.js";import{R as mt,P as ft,O as ht,a as pt,D as xt}from"./DashboardLayout-CJziurwz.js";import{L as vt}from"./label-C5Na_GnW.js";import{C as gt,u as bt,S as yt,b as wt,c as jt,d as Ct,e as ne}from"./select-BjJg5foD.js";import{B as se}from"./button-XclJQX5t.js";import{P as ue,b as me,c as fe,j as we,C as je,f as ae,d as Ce,g as St}from"./locationUtils-ycv-iby-.js";import"./dialog-ByRegUAR.js";import{C as Nt,a as kt,b as Et,d as Rt}from"./card-BpvvmwCp.js";import"./users-Bm0Hlhia.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=Ie("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=Ie("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Mt=()=>{const[e,n]=a.useState({dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0});return{state:e,setDimensions:s=>{n(d=>({...d,dimensions:s}))},setMetrics:s=>{n(d=>({...d,metrics:s}))},setChartType:s=>{n(d=>({...d,chartType:s}))},setDateRange:s=>{n(d=>({...d,dateRange:s}))},addCustomMetric:s=>{n(d=>({...d,customMetrics:[...d.customMetrics,s]}))},setChartData:s=>{n(d=>({...d,chartData:s}))},setDraggedItem:s=>{n(d=>({...d,draggedItem:s}))}}};var Se=1,At=.9,Tt=.8,Pt=.17,ie=.1,ce=.999,Lt=.9999,$t=.99,_t=/[\\\/_+.#"@\[\(\{&]/,Ot=/[\\\/_+.#"@\[\(\{&]/g,Bt=/[\s-]/,Ae=/[\s-]/g;function he(e,n,t,u,i,c,m){if(c===n.length)return i===e.length?Se:$t;var o=`${i},${c}`;if(m[o]!==void 0)return m[o];for(var h=u.charAt(c),s=t.indexOf(h,i),d=0,g,S,C,E;s>=0;)g=he(e,n,t,u,s+1,c+1,m),g>d&&(s===i?g*=Se:_t.test(e.charAt(s-1))?(g*=Tt,C=e.slice(i,s-1).match(Ot),C&&i>0&&(g*=Math.pow(ce,C.length))):Bt.test(e.charAt(s-1))?(g*=At,E=e.slice(i,s-1).match(Ae),E&&i>0&&(g*=Math.pow(ce,E.length))):(g*=Pt,i>0&&(g*=Math.pow(ce,s-i))),e.charAt(s)!==n.charAt(c)&&(g*=Lt)),(g<ie&&t.charAt(s-1)===u.charAt(c+1)||u.charAt(c+1)===u.charAt(c)&&t.charAt(s-1)!==u.charAt(c))&&(S=he(e,n,t,u,s+1,c+2,m),S*ie>g&&(g=S*ie)),g>d&&(d=g),s=t.indexOf(h,s+1);return m[o]=d,d}function Ne(e){return e.toLowerCase().replace(Ae," ")}function zt(e,n,t){return e=t&&t.length>0?`${e+" "+t.join(" ")}`:e,he(e,n,Ne(e),Ne(n),0,0,{})}var Q='[cmdk-group=""]',de='[cmdk-group-items=""]',Ft='[cmdk-group-heading=""]',Te='[cmdk-item=""]',ke=`${Te}:not([aria-disabled="true"])`,pe="cmdk-item-select",G="data-value",qt=(e,n,t)=>zt(e,n,t),Pe=a.createContext(void 0),ee=()=>a.useContext(Pe),Le=a.createContext(void 0),xe=()=>a.useContext(Le),$e=a.createContext(void 0),_e=a.forwardRef((e,n)=>{let t=X(()=>{var l,x;return{search:"",value:(x=(l=e.value)!=null?l:e.defaultValue)!=null?x:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),u=X(()=>new Set),i=X(()=>new Map),c=X(()=>new Map),m=X(()=>new Set),o=Oe(e),{label:h,children:s,value:d,onValueChange:g,filter:S,shouldFilter:C,loop:E,disablePointerSelection:M=!1,vimBindings:P=!0,...$}=e,F=W(),R=W(),q=W(),O=a.useRef(null),j=Zt();U(()=>{if(d!==void 0){let l=d.trim();t.current.value=l,k.emit()}},[d]),U(()=>{j(6,te)},[]);let k=a.useMemo(()=>({subscribe:l=>(m.current.add(l),()=>m.current.delete(l)),snapshot:()=>t.current,setState:(l,x,v)=>{var f,b,w,T;if(!Object.is(t.current[l],x)){if(t.current[l]=x,l==="search")V(),p(),j(1,y);else if(l==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let I=document.getElementById(q);I?I.focus():(f=document.getElementById(F))==null||f.focus()}if(j(7,()=>{var I;t.current.selectedItemId=(I=B())==null?void 0:I.id,k.emit()}),v||j(5,te),((b=o.current)==null?void 0:b.value)!==void 0){let I=x??"";(T=(w=o.current).onValueChange)==null||T.call(w,I);return}}k.emit()}},emit:()=>{m.current.forEach(l=>l())}}),[]),K=a.useMemo(()=>({value:(l,x,v)=>{var f;x!==((f=c.current.get(l))==null?void 0:f.value)&&(c.current.set(l,{value:x,keywords:v}),t.current.filtered.items.set(l,J(x,v)),j(2,()=>{p(),k.emit()}))},item:(l,x)=>(u.current.add(l),x&&(i.current.has(x)?i.current.get(x).add(l):i.current.set(x,new Set([l]))),j(3,()=>{V(),p(),t.current.value||y(),k.emit()}),()=>{c.current.delete(l),u.current.delete(l),t.current.filtered.items.delete(l);let v=B();j(4,()=>{V(),(v==null?void 0:v.getAttribute("id"))===l&&y(),k.emit()})}),group:l=>(i.current.has(l)||i.current.set(l,new Set),()=>{c.current.delete(l),i.current.delete(l)}),filter:()=>o.current.shouldFilter,label:h||e["aria-label"],getDisablePointerSelection:()=>o.current.disablePointerSelection,listId:F,inputId:q,labelId:R,listInnerRef:O}),[]);function J(l,x){var v,f;let b=(f=(v=o.current)==null?void 0:v.filter)!=null?f:qt;return l?b(l,t.current.search,x):0}function p(){if(!t.current.search||o.current.shouldFilter===!1)return;let l=t.current.filtered.items,x=[];t.current.filtered.groups.forEach(f=>{let b=i.current.get(f),w=0;b.forEach(T=>{let I=l.get(T);w=Math.max(I,w)}),x.push([f,w])});let v=O.current;N().sort((f,b)=>{var w,T;let I=f.getAttribute("id"),re=b.getAttribute("id");return((w=l.get(re))!=null?w:0)-((T=l.get(I))!=null?T:0)}).forEach(f=>{let b=f.closest(de);b?b.appendChild(f.parentElement===b?f:f.closest(`${de} > *`)):v.appendChild(f.parentElement===v?f:f.closest(`${de} > *`))}),x.sort((f,b)=>b[1]-f[1]).forEach(f=>{var b;let w=(b=O.current)==null?void 0:b.querySelector(`${Q}[${G}="${encodeURIComponent(f[0])}"]`);w==null||w.parentElement.appendChild(w)})}function y(){let l=N().find(v=>v.getAttribute("aria-disabled")!=="true"),x=l==null?void 0:l.getAttribute(G);k.setState("value",x||void 0)}function V(){var l,x,v,f;if(!t.current.search||o.current.shouldFilter===!1){t.current.filtered.count=u.current.size;return}t.current.filtered.groups=new Set;let b=0;for(let w of u.current){let T=(x=(l=c.current.get(w))==null?void 0:l.value)!=null?x:"",I=(f=(v=c.current.get(w))==null?void 0:v.keywords)!=null?f:[],re=J(T,I);t.current.filtered.items.set(w,re),re>0&&b++}for(let[w,T]of i.current)for(let I of T)if(t.current.filtered.items.get(I)>0){t.current.filtered.groups.add(w);break}t.current.filtered.count=b}function te(){var l,x,v;let f=B();f&&(((l=f.parentElement)==null?void 0:l.firstChild)===f&&((v=(x=f.closest(Q))==null?void 0:x.querySelector(Ft))==null||v.scrollIntoView({block:"nearest"})),f.scrollIntoView({block:"nearest"}))}function B(){var l;return(l=O.current)==null?void 0:l.querySelector(`${Te}[aria-selected="true"]`)}function N(){var l;return Array.from(((l=O.current)==null?void 0:l.querySelectorAll(ke))||[])}function H(l){let x=N()[l];x&&k.setState("value",x.getAttribute(G))}function A(l){var x;let v=B(),f=N(),b=f.findIndex(T=>T===v),w=f[b+l];(x=o.current)!=null&&x.loop&&(w=b+l<0?f[f.length-1]:b+l===f.length?f[0]:f[b+l]),w&&k.setState("value",w.getAttribute(G))}function ve(l){let x=B(),v=x==null?void 0:x.closest(Q),f;for(;v&&!f;)v=l>0?Jt(v,Q):Qt(v,Q),f=v==null?void 0:v.querySelector(ke);f?k.setState("value",f.getAttribute(G)):A(l)}let ge=()=>H(N().length-1),be=l=>{l.preventDefault(),l.metaKey?ge():l.altKey?ve(1):A(1)},ye=l=>{l.preventDefault(),l.metaKey?H(0):l.altKey?ve(-1):A(-1)};return a.createElement(_.div,{ref:n,tabIndex:-1,...$,"cmdk-root":"",onKeyDown:l=>{var x;(x=$.onKeyDown)==null||x.call($,l);let v=l.nativeEvent.isComposing||l.keyCode===229;if(!(l.defaultPrevented||v))switch(l.key){case"n":case"j":{P&&l.ctrlKey&&be(l);break}case"ArrowDown":{be(l);break}case"p":case"k":{P&&l.ctrlKey&&ye(l);break}case"ArrowUp":{ye(l);break}case"Home":{l.preventDefault(),H(0);break}case"End":{l.preventDefault(),ge();break}case"Enter":{l.preventDefault();let f=B();if(f){let b=new Event(pe);f.dispatchEvent(b)}}}}},a.createElement("label",{"cmdk-label":"",htmlFor:K.inputId,id:K.labelId,style:tr},h),le(e,l=>a.createElement(Le.Provider,{value:k},a.createElement(Pe.Provider,{value:K},l))))}),Vt=a.forwardRef((e,n)=>{var t,u;let i=W(),c=a.useRef(null),m=a.useContext($e),o=ee(),h=Oe(e),s=(u=(t=h.current)==null?void 0:t.forceMount)!=null?u:m==null?void 0:m.forceMount;U(()=>{if(!s)return o.item(i,m==null?void 0:m.id)},[s]);let d=Be(i,c,[e.value,e.children,c],e.keywords),g=xe(),S=z(j=>j.value&&j.value===d.current),C=z(j=>s||o.filter()===!1?!0:j.search?j.filtered.items.get(i)>0:!0);a.useEffect(()=>{let j=c.current;if(!(!j||e.disabled))return j.addEventListener(pe,E),()=>j.removeEventListener(pe,E)},[C,e.onSelect,e.disabled]);function E(){var j,k;M(),(k=(j=h.current).onSelect)==null||k.call(j,d.current)}function M(){g.setState("value",d.current,!0)}if(!C)return null;let{disabled:P,value:$,onSelect:F,forceMount:R,keywords:q,...O}=e;return a.createElement(_.div,{ref:Z(c,n),...O,id:i,"cmdk-item":"",role:"option","aria-disabled":!!P,"aria-selected":!!S,"data-disabled":!!P,"data-selected":!!S,onPointerMove:P||o.getDisablePointerSelection()?void 0:M,onClick:P?void 0:E},e.children)}),Ut=a.forwardRef((e,n)=>{let{heading:t,children:u,forceMount:i,...c}=e,m=W(),o=a.useRef(null),h=a.useRef(null),s=W(),d=ee(),g=z(C=>i||d.filter()===!1?!0:C.search?C.filtered.groups.has(m):!0);U(()=>d.group(m),[]),Be(m,o,[e.value,e.heading,h]);let S=a.useMemo(()=>({id:m,forceMount:i}),[i]);return a.createElement(_.div,{ref:Z(o,n),...c,"cmdk-group":"",role:"presentation",hidden:g?void 0:!0},t&&a.createElement("div",{ref:h,"cmdk-group-heading":"","aria-hidden":!0,id:s},t),le(e,C=>a.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":t?s:void 0},a.createElement($e.Provider,{value:S},C))))}),Kt=a.forwardRef((e,n)=>{let{alwaysRender:t,...u}=e,i=a.useRef(null),c=z(m=>!m.search);return!t&&!c?null:a.createElement(_.div,{ref:Z(i,n),...u,"cmdk-separator":"",role:"separator"})}),Ht=a.forwardRef((e,n)=>{let{onValueChange:t,...u}=e,i=e.value!=null,c=xe(),m=z(s=>s.search),o=z(s=>s.selectedItemId),h=ee();return a.useEffect(()=>{e.value!=null&&c.setState("search",e.value)},[e.value]),a.createElement(_.input,{ref:n,...u,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":h.listId,"aria-labelledby":h.labelId,"aria-activedescendant":o,id:h.inputId,type:"text",value:i?e.value:m,onChange:s=>{i||c.setState("search",s.target.value),t==null||t(s.target.value)}})}),Yt=a.forwardRef((e,n)=>{let{children:t,label:u="Suggestions",...i}=e,c=a.useRef(null),m=a.useRef(null),o=z(s=>s.selectedItemId),h=ee();return a.useEffect(()=>{if(m.current&&c.current){let s=m.current,d=c.current,g,S=new ResizeObserver(()=>{g=requestAnimationFrame(()=>{let C=s.offsetHeight;d.style.setProperty("--cmdk-list-height",C.toFixed(1)+"px")})});return S.observe(s),()=>{cancelAnimationFrame(g),S.unobserve(s)}}},[]),a.createElement(_.div,{ref:Z(c,n),...i,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":o,"aria-label":u,id:h.listId},le(e,s=>a.createElement("div",{ref:Z(m,h.listInnerRef),"cmdk-list-sizer":""},s)))}),Gt=a.forwardRef((e,n)=>{let{open:t,onOpenChange:u,overlayClassName:i,contentClassName:c,container:m,...o}=e;return a.createElement(mt,{open:t,onOpenChange:u},a.createElement(ft,{container:m},a.createElement(ht,{"cmdk-overlay":"",className:i}),a.createElement(pt,{"aria-label":e.label,"cmdk-dialog":"",className:c},a.createElement(_e,{ref:n,...o}))))}),Xt=a.forwardRef((e,n)=>z(t=>t.filtered.count===0)?a.createElement(_.div,{ref:n,...e,"cmdk-empty":"",role:"presentation"}):null),Wt=a.forwardRef((e,n)=>{let{progress:t,children:u,label:i="Loading...",...c}=e;return a.createElement(_.div,{ref:n,...c,"cmdk-loading":"",role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":100,"aria-label":i},le(e,m=>a.createElement("div",{"aria-hidden":!0},m)))}),D=Object.assign(_e,{List:Yt,Item:Vt,Input:Ht,Group:Ut,Separator:Kt,Dialog:Gt,Empty:Xt,Loading:Wt});function Jt(e,n){let t=e.nextElementSibling;for(;t;){if(t.matches(n))return t;t=t.nextElementSibling}}function Qt(e,n){let t=e.previousElementSibling;for(;t;){if(t.matches(n))return t;t=t.previousElementSibling}}function Oe(e){let n=a.useRef(e);return U(()=>{n.current=e}),n}var U=typeof window>"u"?a.useEffect:a.useLayoutEffect;function X(e){let n=a.useRef();return n.current===void 0&&(n.current=e()),n}function z(e){let n=xe(),t=()=>e(n.snapshot());return a.useSyncExternalStore(n.subscribe,t,t)}function Be(e,n,t,u=[]){let i=a.useRef(),c=ee();return U(()=>{var m;let o=(()=>{var s;for(let d of t){if(typeof d=="string")return d.trim();if(typeof d=="object"&&"current"in d)return d.current?(s=d.current.textContent)==null?void 0:s.trim():i.current}})(),h=u.map(s=>s.trim());c.value(e,o,h),(m=n.current)==null||m.setAttribute(G,o),i.current=o}),i}var Zt=()=>{let[e,n]=a.useState(),t=X(()=>new Map);return U(()=>{t.current.forEach(u=>u()),t.current=new Map},[e]),(u,i)=>{t.current.set(u,i),n({})}};function er(e){let n=e.type;return typeof n=="function"?n(e.props):"render"in n?n.render(e.props):e}function le({asChild:e,children:n},t){return e&&a.isValidElement(n)?a.cloneElement(er(n),{ref:n.ref},t(n.props.children)):t(n)}var tr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const ze=a.forwardRef(({className:e,...n},t)=>r.jsx(D,{ref:t,className:L("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...n}));ze.displayName=D.displayName;const Fe=a.forwardRef(({className:e,...n},t)=>r.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[r.jsx(Dt,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),r.jsx(D.Input,{ref:t,className:L("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...n})]}));Fe.displayName=D.Input.displayName;const rr=a.forwardRef(({className:e,...n},t)=>r.jsx(D.List,{ref:t,className:L("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...n}));rr.displayName=D.List.displayName;const qe=a.forwardRef((e,n)=>r.jsx(D.Empty,{ref:n,className:"py-6 text-center text-sm",...e}));qe.displayName=D.Empty.displayName;const Ve=a.forwardRef(({className:e,...n},t)=>r.jsx(D.Group,{ref:t,className:L("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...n}));Ve.displayName=D.Group.displayName;const nr=a.forwardRef(({className:e,...n},t)=>r.jsx(D.Separator,{ref:t,className:L("-mx-1 h-px bg-border",e),...n}));nr.displayName=D.Separator.displayName;const Ue=a.forwardRef(({className:e,...n},t)=>r.jsx(D.Item,{ref:t,className:L("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...n}));Ue.displayName=D.Item.displayName;var ar="Separator",Ee="horizontal",sr=["horizontal","vertical"],Ke=a.forwardRef((e,n)=>{const{decorative:t,orientation:u=Ee,...i}=e,c=lr(u)?u:Ee,o=t?{role:"none"}:{"aria-orientation":c==="vertical"?c:void 0,role:"separator"};return r.jsx(_.div,{"data-orientation":c,...o,...i,ref:n})});Ke.displayName=ar;function lr(e){return sr.includes(e)}var He=Ke;const Ye=a.forwardRef(({className:e,orientation:n="horizontal",decorative:t=!0,...u},i)=>r.jsx(He,{ref:i,decorative:t,orientation:n,className:L("shrink-0 bg-border",n==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...u}));Ye.displayName=He.displayName;function Y({title:e,options:n,selected:t,onChange:u,placeholder:i="Select..."}){const[c,m]=a.useState(!1),o=s=>{t.includes(s)?u(t.filter(d=>d!==s)):u([...t,s])},h=s=>{s.stopPropagation(),u([])};return r.jsxs("div",{className:"flex flex-col gap-1.5 min-w-[180px]",children:[r.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:e}),r.jsxs(ue,{open:c,onOpenChange:m,children:[r.jsx(me,{asChild:!0,children:r.jsxs(se,{variant:"outline",role:"combobox","aria-expanded":c,className:"w-full justify-between h-9 px-3 text-sm",children:[r.jsxs("div",{className:"flex flex-wrap gap-1 items-center overflow-hidden",children:[t.length===0&&r.jsx("span",{className:"text-muted-foreground font-normal truncate",children:i}),t.length>0&&r.jsx("span",{className:"truncate",children:t.length===1?t[0]:`${t.length} selected`})]}),r.jsxs("div",{className:"flex items-center gap-2 shrink-0 opacity-50 ml-2",children:[t.length>0&&r.jsx(tt,{className:"h-3 w-3 cursor-pointer hover:opacity-100",onClick:h}),r.jsx(It,{className:"h-3 w-3"})]})]})}),r.jsx(fe,{className:"w-[200px] p-0",align:"start",children:r.jsxs(ze,{children:[r.jsx(Fe,{placeholder:`Search ${e.toLowerCase()}...`}),r.jsxs(qe,{children:["No ",e.toLowerCase()," found."]}),r.jsx(Ve,{className:"max-h-64 overflow-auto",children:n.map(s=>r.jsxs(Ue,{value:s,onSelect:()=>o(s),children:[r.jsx(gt,{className:L("mr-2 h-4 w-4",t.includes(s)?"opacity-100":"opacity-0")}),s]},s))})]})})]})]})}function or({availableFilters:e,filters:n,onFilterChange:t,orientation:u="vertical"}){const i=a.useMemo(()=>{if(n.locations.length===0){const h=new Set;return e.locations.forEach(s=>{s.sites.forEach(d=>h.add(d))}),Array.from(h).sort()}else{const h=new Set;return e.locations.filter(s=>n.locations.includes(s.name)).forEach(s=>{s.sites.forEach(d=>h.add(d))}),Array.from(h).sort()}},[e.locations,n.locations]),c=h=>{t({...n,clients:h})},m=h=>{t({...n,locations:h})},o=h=>{t({...n,sites:h})};return u==="horizontal"?r.jsxs("div",{className:"flex flex-wrap items-end gap-4 p-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mr-2 pb-2",children:r.jsx("span",{children:"ðŸŒªï¸ Filters:"})}),r.jsx(Y,{title:"Clients",options:e.clients,selected:n.clients,onChange:c,placeholder:"All Clients"}),r.jsx(Y,{title:"Locations",options:e.locations.map(h=>h.name),selected:n.locations,onChange:m,placeholder:"All Locations"}),r.jsx(Y,{title:"Sites",options:i,selected:n.sites,onChange:o,placeholder:"All Sites"})]}):r.jsxs(Nt,{className:"h-full flex flex-col",children:[r.jsx(kt,{className:"pb-3",children:r.jsx(Et,{className:"text-lg flex items-center gap-2",children:"ðŸŒªï¸ Filters"})}),r.jsxs(Rt,{className:"space-y-4 flex-1 overflow-y-auto",children:[r.jsx(Y,{title:"Clients",options:e.clients,selected:n.clients,onChange:c,placeholder:"All Clients"}),r.jsx(Ye,{}),r.jsx(Y,{title:"Locations",options:e.locations.map(h=>h.name),selected:n.locations,onChange:m,placeholder:"All Locations"}),r.jsx(Y,{title:"Sites",options:i,selected:n.sites,onChange:o,placeholder:"All Sites"})]})]})}var oe="Switch",[ir,Cr]=rt(oe),[cr,dr]=ir(oe),Ge=a.forwardRef((e,n)=>{const{__scopeSwitch:t,name:u,checked:i,defaultChecked:c,required:m,disabled:o,value:h="on",onCheckedChange:s,form:d,...g}=e,[S,C]=a.useState(null),E=De(n,R=>C(R)),M=a.useRef(!1),P=S?d||!!S.closest("form"):!0,[$,F]=nt({prop:i,defaultProp:c??!1,onChange:s,caller:oe});return r.jsxs(cr,{scope:t,checked:$,disabled:o,children:[r.jsx(_.button,{type:"button",role:"switch","aria-checked":$,"aria-required":m,"data-state":Qe($),"data-disabled":o?"":void 0,disabled:o,value:h,...g,ref:E,onClick:at(e.onClick,R=>{F(q=>!q),P&&(M.current=R.isPropagationStopped(),M.current||R.stopPropagation())})}),P&&r.jsx(Je,{control:S,bubbles:!M.current,name:u,value:h,checked:$,required:m,disabled:o,form:d,style:{transform:"translateX(-100%)"}})]})});Ge.displayName=oe;var Xe="SwitchThumb",We=a.forwardRef((e,n)=>{const{__scopeSwitch:t,...u}=e,i=dr(Xe,t);return r.jsx(_.span,{"data-state":Qe(i.checked),"data-disabled":i.disabled?"":void 0,...u,ref:n})});We.displayName=Xe;var ur="SwitchBubbleInput",Je=a.forwardRef(({__scopeSwitch:e,control:n,checked:t,bubbles:u=!0,...i},c)=>{const m=a.useRef(null),o=De(m,c),h=bt(t),s=st(n);return a.useEffect(()=>{const d=m.current;if(!d)return;const g=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(g,"checked").set;if(h!==t&&C){const E=new Event("click",{bubbles:u});C.call(d,t),d.dispatchEvent(E)}},[h,t,u]),r.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:o,style:{...i.style,...s,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Je.displayName=ur;function Qe(e){return e?"checked":"unchecked"}var Ze=Ge,mr=We;const et=a.forwardRef(({className:e,...n},t)=>r.jsx(Ze,{className:L("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...n,ref:t,children:r.jsx(mr,{className:L("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));et.displayName=Ze.displayName;const fr=a.lazy(()=>Me(()=>import("./MetricPalette-B-eULRIK.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Re=a.lazy(()=>Me(()=>import("./ChartCanvas-C-3XzwnQ.js"),__vite__mapDeps([8,1,2,9,10,11])));function Sr(){const{state:e,setDimensions:n,setMetrics:t,setChartType:u,setDateRange:i,setChartData:c}=Mt(),{toast:m}=lt(),[o,h]=a.useState({from:new Date,to:we(new Date,30)}),[s,d]=a.useState({from:new Date,to:we(new Date,30)}),[g,S]=a.useState(!1),[C,E]=a.useState(!1),[M,P]=a.useState(!1),[$,F]=a.useState({clients:[],locations:[]}),[R,q]=a.useState({clients:[],locations:[],sites:[]});a.useEffect(()=>{(async()=>{try{const y=await fetch("/api/filters",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(y.ok){const V=await y.json();F(V)}}catch(y){console.error("Error fetching filters:",y)}})()},[]);const O=()=>{d(o)};a.useEffect(()=>{(async()=>{if(e.dimensions.length===0||e.metrics.length===0||!(s!=null&&s.from)||!(s!=null&&s.to)){c([]);return}const y=e.dimensions[0],V=e.metrics,te=ae(s.from,"yyyy-MM-dd"),B=ae(s.to,"yyyy-MM-dd");try{const N=new URLSearchParams;N.append("start",te),N.append("end",B),N.append("dimension",y),V.forEach(A=>N.append("metrics",A)),R.clients.forEach(A=>N.append("clients",A)),R.locations.forEach(A=>N.append("locations",A)),R.sites.forEach(A=>N.append("sites",A)),M&&N.append("split_by_location","true");const H=await fetch(`/api/chart-data?${N.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(H.ok){const A=await H.json();c(A)}else console.error("Failed to fetch chart data"),c([])}catch(N){console.error("Error fetching chart data:",N),c([])}})()},[e.dimensions,e.metrics,s,R,M]);const j=p=>{p.type==="dimension"?e.dimensions.includes(p.name)||(n([p.name]),m({description:`Added ${p.name} to chart`,duration:2e3})):p.type==="metric"&&(e.metrics.includes(p.name)||(t([...e.metrics,p.name]),m({description:`Added ${p.name} to chart`,duration:2e3})))},k=p=>{p.type==="dimension"?e.dimensions.includes(p.name)&&(n(e.dimensions.filter(y=>y!==p.name)),m({description:`Removed ${p.name} from chart`,duration:2e3})):p.type==="metric"&&e.metrics.includes(p.name)&&(t(e.metrics.filter(y=>y!==p.name)),m({description:`Removed ${p.name} from chart`,duration:2e3}))},K=p=>{n(e.dimensions.filter(y=>y!==p))},J=p=>{t(e.metrics.filter(y=>y!==p))};return r.jsx(xt,{children:r.jsx("div",{className:"p-4 md:p-6 h-full flex flex-col",children:r.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[r.jsx("div",{className:"sticky lg:top-0 z-30 pb-2 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-1 shadow-sm bg-background",children:r.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[r.jsx("div",{children:r.jsx("h1",{className:"text-xl font-bold",children:"Chart Builder"})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("div",{className:"w-32",children:r.jsxs(yt,{value:e.chartType,onValueChange:u,children:[r.jsx(wt,{className:"h-8 text-xs",children:r.jsx(jt,{placeholder:"Chart Type"})}),r.jsxs(Ct,{children:[r.jsx(ne,{value:"bar",children:"Bar Chart"}),r.jsx(ne,{value:"line",children:"Line Chart"}),r.jsx(ne,{value:"area",children:"Area Chart"}),r.jsx(ne,{value:"pie",children:"Pie Chart"})]})]})}),r.jsxs("div",{className:"flex items-center gap-2 px-2 border-l h-8",children:[r.jsx(vt,{htmlFor:"split-mode",className:"text-[10px] font-medium uppercase tracking-wider text-muted-foreground mr-1",children:"Split by Location"}),r.jsx(et,{id:"split-mode",checked:M,onCheckedChange:P,disabled:R.locations.length<=1&&!M&&R.locations.length!==0})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(ue,{open:g,onOpenChange:S,children:[r.jsx(me,{asChild:!0,children:r.jsxs(se,{variant:"outline",className:L("w-32 justify-start text-left font-normal h-8 text-xs",!(o!=null&&o.from)&&"text-muted-foreground"),children:[r.jsx(je,{className:"mr-2 h-3 w-3"}),o!=null&&o.from?ae(o.from,"MMM dd, y"):r.jsx("span",{children:"From"})]})}),r.jsx(fe,{className:"w-auto p-0",align:"start",children:r.jsx(Ce,{mode:"single",selected:o==null?void 0:o.from,onSelect:p=>{h(y=>({...y,from:p})),S(!1)},defaultMonth:o==null?void 0:o.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),r.jsx("span",{className:"text-muted-foreground text-xs",children:"-"}),r.jsxs(ue,{open:C,onOpenChange:E,children:[r.jsx(me,{asChild:!0,children:r.jsxs(se,{variant:"outline",className:L("w-32 justify-start text-left font-normal h-8 text-xs",!(o!=null&&o.to)&&"text-muted-foreground"),children:[r.jsx(je,{className:"mr-2 h-3 w-3"}),o!=null&&o.to?ae(o.to,"MMM dd, y"):r.jsx("span",{children:"To"})]})}),r.jsx(fe,{className:"w-auto p-0",align:"start",children:r.jsx(Ce,{mode:"single",selected:o==null?void 0:o.to,onSelect:p=>{h(y=>({...y,to:p})),E(!1)},defaultMonth:o==null?void 0:o.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030,disabled:p=>p<((o==null?void 0:o.from)||new Date(0))})})]}),r.jsx(se,{onClick:O,size:"sm",className:"h-8 text-xs",disabled:!(o!=null&&o.from)||!(o!=null&&o.to),children:"Apply"})]})]})]})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsx(ot,{className:"h-8 w-8 rounded-full"})}),children:r.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 min-h-0 h-full",children:[r.jsx("div",{className:"lg:w-72 shrink-0 h-full flex flex-col overflow-hidden",children:r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2",children:r.jsx(fr,{selectedDimensions:e.dimensions,selectedMetrics:e.metrics,onItemClick:j,onItemDoubleClick:k})})}),r.jsxs("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:[r.jsx("div",{className:"shrink-0 pb-2 border-b mb-2",children:r.jsx(or,{availableFilters:$,filters:R,onFilterChange:q,orientation:"horizontal"})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:M?r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 p-1",children:[Array.from(new Set(e.chartData.map(p=>p.location))).map(p=>r.jsxs("div",{className:"border rounded-lg p-4 bg-card shadow-sm",children:[r.jsx("div",{className:"flex items-center justify-between mb-4 border-b pb-2",children:r.jsx(it,{children:r.jsxs(ct,{children:[r.jsx(dt,{asChild:!0,children:r.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",children:[r.jsx("span",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded text-[10px]",children:St(p)}),p.length>25?p.substring(0,25)+"...":p]})}),r.jsx(ut,{children:r.jsx("p",{children:p})})]})})}),r.jsx("div",{className:"h-[300px]",children:r.jsx(Re,{dimensions:e.dimensions,metrics:e.metrics,chartType:e.chartType,chartData:e.chartData.filter(y=>y.location===p),onRemoveDimension:K,onRemoveMetric:J})})]},p)),e.chartData.length===0&&r.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground italic",children:"No data available for the selected filters"})]}):r.jsx(Re,{dimensions:e.dimensions,metrics:e.metrics,chartType:e.chartType,chartData:e.chartData,onRemoveDimension:K,onRemoveMetric:J})})]})]})})})]})})})}export{Sr as default};
