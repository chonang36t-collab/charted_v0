const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-DldkV41i.js","assets/index-Bm8yovVs.js","assets/index-DUHGf_ks.css","assets/card-D5H5cFdR.js","assets/pound-sterling-CzAxkh1N.js","assets/users-C39JCKee.js","assets/locationUtils-DbahMiKv.js","assets/format-COpJTk8T.js","assets/button-BPQIVpAh.js","assets/DashboardLayout-_HLisFMv.js","assets/ChartCanvas-ZNj2eQsU.js","assets/badge-D2HQ5MBI.js","assets/generateCategoricalChart-BSjWB9ZJ.js","assets/BarChart-BmdYj5Oe.js","assets/Line-DUX0Sbqb.js","assets/AreaChart-DJmcn8hl.js"])))=>i.map(i=>d[i]);
import{c as Ye,r as s,w as G,P as O,x as te,j as t,d as L,X as Ge,T as He,n as We,o as Xe,p as Qe,a as Ze,S as et,_ as Re}from"./index-Bm8yovVs.js";import{R as tt,P as rt,O as at,a as nt,D as st}from"./DashboardLayout-_HLisFMv.js";import{L as we}from"./label-BN4XVdz3.js";import{S as lt,a as ot,b as it,c as ct,d as ie}from"./select-CQHDJG78.js";import{B as de}from"./button-BPQIVpAh.js";import{P as pe,a as xe,g as Se,b as ge,e as dt,C as je,c as Ce}from"./locationUtils-DbahMiKv.js";import{S as Ne}from"./switch-CmDEhjFp.js";import{S as ut}from"./search-CsiJswoQ.js";import{C as mt,a as ft,b as ht,d as pt}from"./card-D5H5cFdR.js";import{C as xt}from"./index-BUI66t7i.js";import{f as ce}from"./format-COpJTk8T.js";import"./users-C39JCKee.js";import"./chevron-down-BIPYRwRF.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=Ye("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]),vt=()=>{const[e,a]=s.useState(()=>{const l=localStorage.getItem("chartBuilderState"),i={dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0};if(l)try{const f=JSON.parse(l);return{...i,dimensions:f.dimensions||[],metrics:f.metrics||[],chartType:f.chartType||"bar"}}catch(f){console.error("Error parsing saved chart builder state",f)}return i});return s.useEffect(()=>{const{dimensions:l,metrics:i,chartType:f}=e;localStorage.setItem("chartBuilderState",JSON.stringify({dimensions:l,metrics:i,chartType:f}))},[e.dimensions,e.metrics,e.chartType]),{state:e,setDimensions:l=>{a(i=>({...i,dimensions:l}))},setMetrics:l=>{a(i=>({...i,metrics:l}))},setChartType:l=>{a(i=>({...i,chartType:l}))},setDateRange:l=>{a(i=>({...i,dateRange:l}))},addCustomMetric:l=>{a(i=>({...i,customMetrics:[...i.customMetrics,l]}))},setChartData:l=>{a(i=>({...i,chartData:l}))},setDraggedItem:l=>{a(i=>({...i,draggedItem:l}))}}};var Ee=1,yt=.9,bt=.8,wt=.17,me=.1,fe=.999,St=.9999,jt=.99,Ct=/[\\\/_+.#"@\[\(\{&]/,Nt=/[\\\/_+.#"@\[\(\{&]/g,Et=/[\s-]/,De=/[\s-]/g;function ve(e,a,r,h,d,u,o){if(u===a.length)return d===e.length?Ee:jt;var g=`${d},${u}`;if(o[g]!==void 0)return o[g];for(var v=h.charAt(u),l=r.indexOf(v,d),i=0,f,N,b,E;l>=0;)f=ve(e,a,r,h,l+1,u+1,o),f>i&&(l===d?f*=Ee:Ct.test(e.charAt(l-1))?(f*=bt,b=e.slice(d,l-1).match(Nt),b&&d>0&&(f*=Math.pow(fe,b.length))):Et.test(e.charAt(l-1))?(f*=yt,E=e.slice(d,l-1).match(De),E&&d>0&&(f*=Math.pow(fe,E.length))):(f*=wt,d>0&&(f*=Math.pow(fe,l-d))),e.charAt(l)!==a.charAt(u)&&(f*=St)),(f<me&&r.charAt(l-1)===h.charAt(u+1)||h.charAt(u+1)===h.charAt(u)&&r.charAt(l-1)!==h.charAt(u))&&(N=ve(e,a,r,h,l+1,u+2,o),N*me>f&&(f=N*me)),f>i&&(i=f),l=r.indexOf(v,l+1);return o[g]=i,i}function ke(e){return e.toLowerCase().replace(De," ")}function kt(e,a,r){return e=r&&r.length>0?`${e+" "+r.join(" ")}`:e,ve(e,a,ke(e),ke(a),0,0,{})}var Z='[cmdk-group=""]',he='[cmdk-group-items=""]',It='[cmdk-group-heading=""]',Me='[cmdk-item=""]',Ie=`${Me}:not([aria-disabled="true"])`,ye="cmdk-item-select",U="data-value",At=(e,a,r)=>kt(e,a,r),Te=s.createContext(void 0),re=()=>s.useContext(Te),Le=s.createContext(void 0),be=()=>s.useContext(Le),Be=s.createContext(void 0),Oe=s.forwardRef((e,a)=>{let r=Y(()=>{var n,x;return{search:"",value:(x=(n=e.value)!=null?n:e.defaultValue)!=null?x:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),h=Y(()=>new Set),d=Y(()=>new Map),u=Y(()=>new Map),o=Y(()=>new Set),g=$e(e),{label:v,children:l,value:i,onValueChange:f,filter:N,shouldFilter:b,loop:E,disablePointerSelection:q=!1,vimBindings:k=!0,...$}=e,P=G(),ae=G(),A=G(),B=s.useRef(null),C=zt();K(()=>{if(i!==void 0){let n=i.trim();r.current.value=n,S.emit()}},[i]),K(()=>{C(6,se)},[]);let S=s.useMemo(()=>({subscribe:n=>(o.current.add(n),()=>o.current.delete(n)),snapshot:()=>r.current,setState:(n,x,y)=>{var m,w,j,T;if(!Object.is(r.current[n],x)){if(r.current[n]=x,n==="search")F(),z(),C(1,H);else if(n==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let D=document.getElementById(A);D?D.focus():(m=document.getElementById(P))==null||m.focus()}if(C(7,()=>{var D;r.current.selectedItemId=(D=c())==null?void 0:D.id,S.emit()}),y||C(5,se),((w=g.current)==null?void 0:w.value)!==void 0){let D=x??"";(T=(j=g.current).onValueChange)==null||T.call(j,D);return}}S.emit()}},emit:()=>{o.current.forEach(n=>n())}}),[]),_=s.useMemo(()=>({value:(n,x,y)=>{var m;x!==((m=u.current.get(n))==null?void 0:m.value)&&(u.current.set(n,{value:x,keywords:y}),r.current.filtered.items.set(n,ne(x,y)),C(2,()=>{z(),S.emit()}))},item:(n,x)=>(h.current.add(n),x&&(d.current.has(x)?d.current.get(x).add(n):d.current.set(x,new Set([n]))),C(3,()=>{F(),z(),r.current.value||H(),S.emit()}),()=>{u.current.delete(n),h.current.delete(n),r.current.filtered.items.delete(n);let y=c();C(4,()=>{F(),(y==null?void 0:y.getAttribute("id"))===n&&H(),S.emit()})}),group:n=>(d.current.has(n)||d.current.set(n,new Set),()=>{u.current.delete(n),d.current.delete(n)}),filter:()=>g.current.shouldFilter,label:v||e["aria-label"],getDisablePointerSelection:()=>g.current.disablePointerSelection,listId:P,inputId:A,labelId:ae,listInnerRef:B}),[]);function ne(n,x){var y,m;let w=(m=(y=g.current)==null?void 0:y.filter)!=null?m:At;return n?w(n,r.current.search,x):0}function z(){if(!r.current.search||g.current.shouldFilter===!1)return;let n=r.current.filtered.items,x=[];r.current.filtered.groups.forEach(m=>{let w=d.current.get(m),j=0;w.forEach(T=>{let D=n.get(T);j=Math.max(D,j)}),x.push([m,j])});let y=B.current;p().sort((m,w)=>{var j,T;let D=m.getAttribute("id"),oe=w.getAttribute("id");return((j=n.get(oe))!=null?j:0)-((T=n.get(D))!=null?T:0)}).forEach(m=>{let w=m.closest(he);w?w.appendChild(m.parentElement===w?m:m.closest(`${he} > *`)):y.appendChild(m.parentElement===y?m:m.closest(`${he} > *`))}),x.sort((m,w)=>w[1]-m[1]).forEach(m=>{var w;let j=(w=B.current)==null?void 0:w.querySelector(`${Z}[${U}="${encodeURIComponent(m[0])}"]`);j==null||j.parentElement.appendChild(j)})}function H(){let n=p().find(y=>y.getAttribute("aria-disabled")!=="true"),x=n==null?void 0:n.getAttribute(U);S.setState("value",x||void 0)}function F(){var n,x,y,m;if(!r.current.search||g.current.shouldFilter===!1){r.current.filtered.count=h.current.size;return}r.current.filtered.groups=new Set;let w=0;for(let j of h.current){let T=(x=(n=u.current.get(j))==null?void 0:n.value)!=null?x:"",D=(m=(y=u.current.get(j))==null?void 0:y.keywords)!=null?m:[],oe=ne(T,D);r.current.filtered.items.set(j,oe),oe>0&&w++}for(let[j,T]of d.current)for(let D of T)if(r.current.filtered.items.get(D)>0){r.current.filtered.groups.add(j);break}r.current.filtered.count=w}function se(){var n,x,y;let m=c();m&&(((n=m.parentElement)==null?void 0:n.firstChild)===m&&((y=(x=m.closest(Z))==null?void 0:x.querySelector(It))==null||y.scrollIntoView({block:"nearest"})),m.scrollIntoView({block:"nearest"}))}function c(){var n;return(n=B.current)==null?void 0:n.querySelector(`${Me}[aria-selected="true"]`)}function p(){var n;return Array.from(((n=B.current)==null?void 0:n.querySelectorAll(Ie))||[])}function I(n){let x=p()[n];x&&S.setState("value",x.getAttribute(U))}function W(n){var x;let y=c(),m=p(),w=m.findIndex(T=>T===y),j=m[w+n];(x=g.current)!=null&&x.loop&&(j=w+n<0?m[m.length-1]:w+n===m.length?m[0]:m[w+n]),j&&S.setState("value",j.getAttribute(U))}function le(n){let x=c(),y=x==null?void 0:x.closest(Z),m;for(;y&&!m;)y=n>0?Pt(y,Z):_t(y,Z),m=y==null?void 0:y.querySelector(Ie);m?S.setState("value",m.getAttribute(U)):W(n)}let X=()=>I(p().length-1),R=n=>{n.preventDefault(),n.metaKey?X():n.altKey?le(1):W(1)},Q=n=>{n.preventDefault(),n.metaKey?I(0):n.altKey?le(-1):W(-1)};return s.createElement(O.div,{ref:a,tabIndex:-1,...$,"cmdk-root":"",onKeyDown:n=>{var x;(x=$.onKeyDown)==null||x.call($,n);let y=n.nativeEvent.isComposing||n.keyCode===229;if(!(n.defaultPrevented||y))switch(n.key){case"n":case"j":{k&&n.ctrlKey&&R(n);break}case"ArrowDown":{R(n);break}case"p":case"k":{k&&n.ctrlKey&&Q(n);break}case"ArrowUp":{Q(n);break}case"Home":{n.preventDefault(),I(0);break}case"End":{n.preventDefault(),X();break}case"Enter":{n.preventDefault();let m=c();if(m){let w=new Event(ye);m.dispatchEvent(w)}}}}},s.createElement("label",{"cmdk-label":"",htmlFor:_.inputId,id:_.labelId,style:Ft},v),ue(e,n=>s.createElement(Le.Provider,{value:S},s.createElement(Te.Provider,{value:_},n))))}),Rt=s.forwardRef((e,a)=>{var r,h;let d=G(),u=s.useRef(null),o=s.useContext(Be),g=re(),v=$e(e),l=(h=(r=v.current)==null?void 0:r.forceMount)!=null?h:o==null?void 0:o.forceMount;K(()=>{if(!l)return g.item(d,o==null?void 0:o.id)},[l]);let i=Pe(d,u,[e.value,e.children,u],e.keywords),f=be(),N=V(C=>C.value&&C.value===i.current),b=V(C=>l||g.filter()===!1?!0:C.search?C.filtered.items.get(d)>0:!0);s.useEffect(()=>{let C=u.current;if(!(!C||e.disabled))return C.addEventListener(ye,E),()=>C.removeEventListener(ye,E)},[b,e.onSelect,e.disabled]);function E(){var C,S;q(),(S=(C=v.current).onSelect)==null||S.call(C,i.current)}function q(){f.setState("value",i.current,!0)}if(!b)return null;let{disabled:k,value:$,onSelect:P,forceMount:ae,keywords:A,...B}=e;return s.createElement(O.div,{ref:te(u,a),...B,id:d,"cmdk-item":"",role:"option","aria-disabled":!!k,"aria-selected":!!N,"data-disabled":!!k,"data-selected":!!N,onPointerMove:k||g.getDisablePointerSelection()?void 0:q,onClick:k?void 0:E},e.children)}),Dt=s.forwardRef((e,a)=>{let{heading:r,children:h,forceMount:d,...u}=e,o=G(),g=s.useRef(null),v=s.useRef(null),l=G(),i=re(),f=V(b=>d||i.filter()===!1?!0:b.search?b.filtered.groups.has(o):!0);K(()=>i.group(o),[]),Pe(o,g,[e.value,e.heading,v]);let N=s.useMemo(()=>({id:o,forceMount:d}),[d]);return s.createElement(O.div,{ref:te(g,a),...u,"cmdk-group":"",role:"presentation",hidden:f?void 0:!0},r&&s.createElement("div",{ref:v,"cmdk-group-heading":"","aria-hidden":!0,id:l},r),ue(e,b=>s.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?l:void 0},s.createElement(Be.Provider,{value:N},b))))}),Mt=s.forwardRef((e,a)=>{let{alwaysRender:r,...h}=e,d=s.useRef(null),u=V(o=>!o.search);return!r&&!u?null:s.createElement(O.div,{ref:te(d,a),...h,"cmdk-separator":"",role:"separator"})}),Tt=s.forwardRef((e,a)=>{let{onValueChange:r,...h}=e,d=e.value!=null,u=be(),o=V(l=>l.search),g=V(l=>l.selectedItemId),v=re();return s.useEffect(()=>{e.value!=null&&u.setState("search",e.value)},[e.value]),s.createElement(O.input,{ref:a,...h,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":v.listId,"aria-labelledby":v.labelId,"aria-activedescendant":g,id:v.inputId,type:"text",value:d?e.value:o,onChange:l=>{d||u.setState("search",l.target.value),r==null||r(l.target.value)}})}),Lt=s.forwardRef((e,a)=>{let{children:r,label:h="Suggestions",...d}=e,u=s.useRef(null),o=s.useRef(null),g=V(l=>l.selectedItemId),v=re();return s.useEffect(()=>{if(o.current&&u.current){let l=o.current,i=u.current,f,N=new ResizeObserver(()=>{f=requestAnimationFrame(()=>{let b=l.offsetHeight;i.style.setProperty("--cmdk-list-height",b.toFixed(1)+"px")})});return N.observe(l),()=>{cancelAnimationFrame(f),N.unobserve(l)}}},[]),s.createElement(O.div,{ref:te(u,a),...d,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":g,"aria-label":h,id:v.listId},ue(e,l=>s.createElement("div",{ref:te(o,v.listInnerRef),"cmdk-list-sizer":""},l)))}),Bt=s.forwardRef((e,a)=>{let{open:r,onOpenChange:h,overlayClassName:d,contentClassName:u,container:o,...g}=e;return s.createElement(tt,{open:r,onOpenChange:h},s.createElement(rt,{container:o},s.createElement(at,{"cmdk-overlay":"",className:d}),s.createElement(nt,{"aria-label":e.label,"cmdk-dialog":"",className:u},s.createElement(Oe,{ref:a,...g}))))}),Ot=s.forwardRef((e,a)=>V(r=>r.filtered.count===0)?s.createElement(O.div,{ref:a,...e,"cmdk-empty":"",role:"presentation"}):null),$t=s.forwardRef((e,a)=>{let{progress:r,children:h,label:d="Loading...",...u}=e;return s.createElement(O.div,{ref:a,...u,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":d},ue(e,o=>s.createElement("div",{"aria-hidden":!0},o)))}),M=Object.assign(Oe,{List:Lt,Item:Rt,Input:Tt,Group:Dt,Separator:Mt,Dialog:Bt,Empty:Ot,Loading:$t});function Pt(e,a){let r=e.nextElementSibling;for(;r;){if(r.matches(a))return r;r=r.nextElementSibling}}function _t(e,a){let r=e.previousElementSibling;for(;r;){if(r.matches(a))return r;r=r.previousElementSibling}}function $e(e){let a=s.useRef(e);return K(()=>{a.current=e}),a}var K=typeof window>"u"?s.useEffect:s.useLayoutEffect;function Y(e){let a=s.useRef();return a.current===void 0&&(a.current=e()),a}function V(e){let a=be(),r=()=>e(a.snapshot());return s.useSyncExternalStore(a.subscribe,r,r)}function Pe(e,a,r,h=[]){let d=s.useRef(),u=re();return K(()=>{var o;let g=(()=>{var l;for(let i of r){if(typeof i=="string")return i.trim();if(typeof i=="object"&&"current"in i)return i.current?(l=i.current.textContent)==null?void 0:l.trim():d.current}})(),v=h.map(l=>l.trim());u.value(e,g,v),(o=a.current)==null||o.setAttribute(U,g),d.current=g}),d}var zt=()=>{let[e,a]=s.useState(),r=Y(()=>new Map);return K(()=>{r.current.forEach(h=>h()),r.current=new Map},[e]),(h,d)=>{r.current.set(h,d),a({})}};function Vt(e){let a=e.type;return typeof a=="function"?a(e.props):"render"in a?a.render(e.props):e}function ue({asChild:e,children:a},r){return e&&s.isValidElement(a)?s.cloneElement(Vt(a),{ref:a.ref},r(a.props.children)):r(a)}var Ft={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const _e=s.forwardRef(({className:e,...a},r)=>t.jsx(M,{ref:r,className:L("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...a}));_e.displayName=M.displayName;const ze=s.forwardRef(({className:e,...a},r)=>t.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[t.jsx(ut,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),t.jsx(M.Input,{ref:r,className:L("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...a})]}));ze.displayName=M.Input.displayName;const Kt=s.forwardRef(({className:e,...a},r)=>t.jsx(M.List,{ref:r,className:L("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...a}));Kt.displayName=M.List.displayName;const Ve=s.forwardRef((e,a)=>t.jsx(M.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));Ve.displayName=M.Empty.displayName;const Fe=s.forwardRef(({className:e,...a},r)=>t.jsx(M.Group,{ref:r,className:L("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...a}));Fe.displayName=M.Group.displayName;const qt=s.forwardRef(({className:e,...a},r)=>t.jsx(M.Separator,{ref:r,className:L("-mx-1 h-px bg-border",e),...a}));qt.displayName=M.Separator.displayName;const Ke=s.forwardRef(({className:e,...a},r)=>t.jsx(M.Item,{ref:r,className:L("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...a}));Ke.displayName=M.Item.displayName;var Jt="Separator",Ae="horizontal",Ut=["horizontal","vertical"],qe=s.forwardRef((e,a)=>{const{decorative:r,orientation:h=Ae,...d}=e,u=Yt(h)?h:Ae,g=r?{role:"none"}:{"aria-orientation":u==="vertical"?u:void 0,role:"separator"};return t.jsx(O.div,{"data-orientation":u,...g,...d,ref:a})});qe.displayName=Jt;function Yt(e){return Ut.includes(e)}var Je=qe;const Ue=s.forwardRef(({className:e,orientation:a="horizontal",decorative:r=!0,...h},d)=>t.jsx(Je,{ref:d,decorative:r,orientation:a,className:L("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...h}));Ue.displayName=Je.displayName;function J({title:e,options:a,selected:r,onChange:h,placeholder:d="Select...",isLocation:u=!1}){const[o,g]=s.useState(!1),v=i=>{r.includes(i)?h(r.filter(f=>f!==i)):h([...r,i])},l=i=>{i.stopPropagation(),h([])};return t.jsxs("div",{className:"flex flex-col gap-1.5 min-w-[180px]",children:[t.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:e}),t.jsxs(pe,{open:o,onOpenChange:g,children:[t.jsx(xe,{asChild:!0,children:t.jsxs(de,{variant:"outline",role:"combobox","aria-expanded":o,className:"w-full justify-between h-9 px-3 text-sm",children:[t.jsxs("div",{className:"flex flex-wrap gap-1 items-center overflow-hidden",children:[r.length===0&&t.jsx("span",{className:"text-muted-foreground font-normal truncate",children:d}),r.length===1&&t.jsx("span",{className:"truncate",children:u?Se(r[0]):r[0]}),r.length>1&&t.jsxs("span",{className:"truncate",children:[r.length," selected"]})]}),t.jsxs("div",{className:"flex items-center gap-2 shrink-0 opacity-50 ml-2",children:[r.length>0&&t.jsx(Ge,{className:"h-3 w-3 cursor-pointer hover:opacity-100",onClick:l}),t.jsx(gt,{className:"h-3 w-3"})]})]})}),t.jsx(ge,{className:"w-[200px] p-0",align:"start",children:t.jsxs(_e,{children:[t.jsx(ze,{placeholder:`Search ${e.toLowerCase()}...`}),t.jsxs(Ve,{children:["No ",e.toLowerCase()," found."]}),t.jsx(Fe,{className:"max-h-64 overflow-auto",children:a.map(i=>t.jsxs(Ke,{value:i,onSelect:()=>v(i),children:[t.jsx(xt,{className:L("mr-2 h-4 w-4",r.includes(i)?"opacity-100":"opacity-0")}),u?t.jsx(He,{delayDuration:300,children:t.jsxs(We,{children:[t.jsx(Xe,{asChild:!0,children:t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("span",{className:"font-medium",children:Se(i)}),t.jsx("span",{className:"text-[10px] text-muted-foreground truncate opacity-70",children:i})]})}),t.jsx(Qe,{side:"right",children:t.jsx("p",{children:i})})]})}):i]},i))})]})})]})]})}function Gt({availableFilters:e,filters:a,onFilterChange:r,orientation:h="vertical",hideSites:d=!1}){s.useMemo(()=>{if(a.locations.length===0)return e.clients;const l=e.locations.filter(f=>a.locations.includes(f.name)),i=new Set;return l.forEach(f=>{f.clients&&f.clients.forEach(N=>i.add(N))}),Array.from(i).sort()},[e,a.locations]);const u=s.useMemo(()=>{if(a.locations.length===0)return Array.from(new Set(e.locations.flatMap(f=>f.sites))).sort();const l=e.locations.filter(f=>a.locations.includes(f.name)),i=new Set;return l.forEach(f=>{f.sites.forEach(N=>i.add(N))}),Array.from(i).sort()},[e.locations,a.locations]),o=l=>{const i=e.locations.filter(b=>l.includes(b.name)),f=l.length===0?e.clients:Array.from(new Set(i.flatMap(b=>b.clients||[]))),N=l.length===0?Array.from(new Set(e.locations.flatMap(b=>b.sites))):Array.from(new Set(i.flatMap(b=>b.sites)));r({...a,locations:l,clients:a.clients.filter(b=>f.includes(b)),sites:a.sites.filter(b=>N.includes(b))})},g=l=>{r({...a,clients:l})},v=l=>{r({...a,sites:l})};return h==="horizontal"?t.jsxs("div",{className:"flex flex-wrap items-end gap-4 p-1",children:[t.jsx("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mr-2 pb-2",children:t.jsx("span",{children:"ðŸŒªï¸ Filters:"})}),t.jsx(J,{title:"Clients",options:e.clients,selected:a.clients,onChange:g,placeholder:"All Clients"}),t.jsx(J,{title:"Locations",options:e.locations.map(l=>l.name),selected:a.locations,onChange:o,placeholder:"All Locations",isLocation:!0}),!d&&t.jsx(J,{title:"Sites",options:u,selected:a.sites,onChange:v,placeholder:"All Sites"})]}):t.jsxs(mt,{className:"h-full flex flex-col",children:[t.jsx(ft,{className:"pb-3",children:t.jsx(ht,{className:"text-lg flex items-center gap-2",children:"ðŸŒªï¸ Filters"})}),t.jsxs(pt,{className:"space-y-4 flex-1 overflow-y-auto",children:[t.jsx(J,{title:"Clients",options:e.clients,selected:a.clients,onChange:g,placeholder:"All Clients"}),t.jsx(Ue,{}),t.jsx(J,{title:"Locations",options:e.locations.map(l=>l.name),selected:a.locations,onChange:o,placeholder:"All Locations",isLocation:!0}),t.jsx(J,{title:"Sites",options:u,selected:a.sites,onChange:v,placeholder:"All Sites"})]})]})}const Ht=s.lazy(()=>Re(()=>import("./MetricPalette-DldkV41i.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),ee=s.lazy(()=>Re(()=>import("./ChartCanvas-ZNj2eQsU.js"),__vite__mapDeps([10,1,2,11,12,13,14,15])));function cr(){const{state:e,setDimensions:a,setMetrics:r,setChartType:h,setDateRange:d}=vt(),{toast:u}=Ze(),[o,g]=s.useState(()=>{const c=localStorage.getItem("chartBuilderDate");if(c)try{const p=JSON.parse(c);return{from:p.from?new Date(p.from):void 0,to:p.to?new Date(p.to):void 0}}catch(p){console.error(p)}return{from:new Date,to:dt(new Date,30)}}),[v,l]=s.useState(()=>{const c=localStorage.getItem("chartBuilderAppliedDate");if(c)try{const p=JSON.parse(c);return{from:p.from?new Date(p.from):void 0,to:p.to?new Date(p.to):void 0}}catch(p){console.error(p)}return o});s.useEffect(()=>{o&&localStorage.setItem("chartBuilderDate",JSON.stringify(o))},[o]),s.useEffect(()=>{v&&localStorage.setItem("chartBuilderAppliedDate",JSON.stringify(v))},[v]);const[i,f]=s.useState(!1),[N,b]=s.useState(!1),[E,q]=s.useState(()=>localStorage.getItem("chartBuilderSplitByLocation")==="true"),[k,$]=s.useState(()=>localStorage.getItem("chartBuilderSplitBySite")==="true"&&!E);s.useEffect(()=>{localStorage.setItem("chartBuilderSplitByLocation",String(E))},[E]),s.useEffect(()=>{localStorage.setItem("chartBuilderSplitBySite",String(k))},[k]);const[P,ae]=s.useState({clients:[],locations:[]}),[A,B]=s.useState({clients:[],locations:[],sites:[]});s.useEffect(()=>{(async()=>{try{const p=await fetch("/api/filters",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(p.ok){const I=await p.json();ae(I)}}catch(p){console.error("Error fetching filters:",p)}})()},[]);const C=()=>{l(o)},[S,_]=s.useState([]),[ne,z]=s.useState([]);s.useEffect(()=>{(async()=>{var X;if(e.dimensions.length===0||e.metrics.length===0||!(v!=null&&v.from)||!(v!=null&&v.to)){_([]),z([]);return}const p=e.dimensions[0],I=e.metrics,W=ce(v.from,"yyyy-MM-dd"),le=ce(v.to,"yyyy-MM-dd");try{const R=new URLSearchParams;R.append("start",W),R.append("end",le),R.append("dimension",p),I.forEach(n=>R.append("metrics",n)),A.clients.forEach(n=>R.append("clients",n)),A.locations.forEach(n=>R.append("locations",n)),A.sites.forEach(n=>R.append("sites",n)),E&&R.append("split_by_location","true"),k&&R.append("split_by_site","true");const Q=await fetch(`/api/chart-data?${R.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(Q.ok){const n=await Q.json();_(n.data||[]),z(((X=n.summary)==null?void 0:X.topClients)||[])}else console.error("Failed to fetch chart data"),_([]),z([])}catch(R){console.error("Error fetching chart data:",R),_([]),z([])}})()},[e.dimensions,e.metrics,v,A,E,k]);const{showSiteFilter:H,showSiteSplit:F}=s.useMemo(()=>{const c=A.locations.length===0?P.locations.flatMap(I=>I.sites):P.locations.filter(I=>A.locations.includes(I.name)).flatMap(I=>I.sites),p=Array.from(new Set(c));return{showSiteFilter:p.length>1,showSiteSplit:p.length>1}},[P.locations,A.locations]);s.useEffect(()=>{!F&&k&&$(!1)},[F,k]);const se=c=>{c.type==="dimension"?e.dimensions.includes(c.name)?(a([]),u({description:`Removed ${c.name} from chart`,duration:2e3})):(a([c.name]),u({description:`Added ${c.name} to chart`,duration:2e3})):c.type==="metric"&&(e.metrics.includes(c.name)?(r(e.metrics.filter(p=>p!==c.name)),u({description:`Removed ${c.name} from chart`,duration:2e3})):(r([...e.metrics,c.name]),u({description:`Added ${c.name} to chart`,duration:2e3})))};return t.jsx(st,{noPadding:!0,fullWidth:!0,children:t.jsx("div",{className:"p-2 md:p-3 h-full flex flex-col",children:t.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[t.jsx("div",{className:"sticky lg:top-0 z-30 pb-2 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-1 shadow-sm bg-background",children:t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[t.jsx("div",{children:t.jsx("h1",{className:"text-xl font-bold",children:"Chart Builder"})}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("div",{className:"w-32",children:t.jsxs(lt,{value:e.chartType,onValueChange:h,children:[t.jsx(ot,{className:"h-8 text-xs",children:t.jsx(it,{placeholder:"Chart Type"})}),t.jsxs(ct,{children:[t.jsx(ie,{value:"bar",children:"Bar Chart"}),t.jsx(ie,{value:"line",children:"Line Chart"}),t.jsx(ie,{value:"area",children:"Area Chart"}),t.jsx(ie,{value:"pie",children:"Pie Chart"})]})]})}),t.jsxs("div",{className:"flex items-center gap-6 px-2 border-l ml-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ne,{id:"split-location",checked:E,onCheckedChange:c=>{q(c),c&&$(!1)}}),t.jsx(we,{htmlFor:"split-location",className:"text-xs font-medium cursor-pointer flex items-center gap-1.5",children:"Split by Location"})]}),F&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ne,{id:"split-site",checked:k,onCheckedChange:c=>{$(c),c&&q(!1)}}),t.jsx(we,{htmlFor:"split-site",className:"text-xs font-medium cursor-pointer flex items-center gap-1.5",children:"Split by Site"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(pe,{open:i,onOpenChange:f,children:[t.jsx(xe,{asChild:!0,children:t.jsxs(de,{variant:"outline",className:L("w-32 justify-start text-left font-normal h-8 text-xs",!(o!=null&&o.from)&&"text-muted-foreground"),children:[t.jsx(je,{className:"mr-2 h-3 w-3"}),o!=null&&o.from?ce(o.from,"MMM dd, y"):t.jsx("span",{children:"From"})]})}),t.jsx(ge,{className:"w-auto p-0",align:"start",children:t.jsx(Ce,{mode:"single",selected:o==null?void 0:o.from,onSelect:c=>{g(p=>({...p,from:c})),f(!1)},defaultMonth:o==null?void 0:o.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),t.jsxs(pe,{open:N,onOpenChange:b,children:[t.jsx(xe,{asChild:!0,children:t.jsxs(de,{variant:"outline",className:L("w-32 justify-start text-left font-normal h-8 text-xs",!(o!=null&&o.to)&&"text-muted-foreground"),children:[t.jsx(je,{className:"mr-2 h-3 w-3"}),o!=null&&o.to?ce(o.to,"MMM dd, y"):t.jsx("span",{children:"To"})]})}),t.jsx(ge,{className:"w-auto p-0",align:"start",children:t.jsx(Ce,{mode:"single",selected:o==null?void 0:o.to,onSelect:c=>{g(p=>({...p,to:c})),b(!1)},defaultMonth:o==null?void 0:o.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),t.jsx(de,{onClick:C,className:"h-8 text-xs px-4",disabled:!(o!=null&&o.from)||!(o!=null&&o.to),children:"Apply Range"})]})]})]})}),t.jsx(s.Suspense,{fallback:t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsx(et,{className:"h-8 w-8 rounded-full"})}),children:t.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-2 min-h-0 h-full",children:[t.jsx("div",{className:"lg:w-72 shrink-0 h-full flex flex-col overflow-hidden",children:t.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2",children:t.jsx(Ht,{selectedDimensions:e.dimensions,selectedMetrics:e.metrics,onItemClick:se})})}),t.jsxs("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:[t.jsx("div",{className:"shrink-0 pb-2 border-b mb-2",children:t.jsx(Gt,{availableFilters:P,filters:A,onFilterChange:B,orientation:"horizontal",hideSites:!H})}),t.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2 custom-scrollbar",children:[!E&&!k&&t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 h-full min-h-[500px]",children:t.jsx(ee,{chartData:S,chartType:e.chartType,metrics:e.metrics,title:"Aggregated View",topClients:ne})}),E&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[A.locations.length>0?A.locations.map(c=>{const p=S.filter(I=>I.location===c);return p.length===0?null:t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(ee,{chartData:p,chartType:e.chartType,metrics:e.metrics,title:c,isCompact:!0})},c)}):Array.from(new Set(S.map(c=>c.location).filter(Boolean))).map(c=>t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(ee,{chartData:S.filter(p=>p.location===c),chartType:e.chartType,metrics:e.metrics,title:c,isCompact:!0})},c)),S.length===0&&t.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground bg-muted/20 rounded-xl border border-dashed",children:"No data available for selected locations"})]}),k&&t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[A.sites.length>0?A.sites.map(c=>{const p=S.filter(I=>I.site===c);return p.length===0?null:t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(ee,{chartData:p,chartType:e.chartType,metrics:e.metrics,title:c,isCompact:!0})},c)}):Array.from(new Set(S.map(c=>c.site).filter(Boolean))).map(c=>t.jsx("div",{className:"bg-card rounded-xl border shadow-sm p-4 min-h-[400px]",children:t.jsx(ee,{chartData:S.filter(p=>p.site===c),chartType:e.chartType,metrics:e.metrics,title:c,isCompact:!0})},c)),S.length===0&&t.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground bg-muted/20 rounded-xl border border-dashed",children:"No data available for selected sites"})]})]})]})]})})]})})})}export{cr as default};
