import{ab as Y,r as p,j as e,T as te,e as L,B as P,I as $,k as re,l as se,m as ae,ac as le}from"./index-DzPh1YNR.js";import{D as oe,T as ie}from"./DashboardLayout-Cv5uwAq6.js";import{L as ne}from"./label-DS0XJsZd.js";import{T as z}from"./trash-2-Rigxistp.js";import{e as ue,f as M,P as de,a as ce,C as me,b as fe,d as be,s as he}from"./popover-2UEAdKDl.js";import{D as B,a as J,b as K,c as G,d as V,e as R}from"./dialog-CaE7_Bli.js";import{P as U}from"./plus-2Db8-MXq.js";import"./users-Df_drMvq.js";function pe(r,a){const d=Y(r.start),t=Y(r.end);let v=+d>+t;const j=v?+d:+t,m=v?t:d;m.setHours(0,0,0,0),m.setDate(1);let x=1;const w=[];for(;+m<=j;)w.push(Y(m)),m.setMonth(m.getMonth()+x);return v?w.reverse():w}function xe(r){const a=Y(r),d=a.getFullYear();return a.setFullYear(d+1,0,0),a.setHours(23,59,59,999),a}function ge(r,a){return r===null||r===0?"":a.isPercentage?`${r.toFixed(2)}%`:a.isCurrency?`£${r.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}`:r.toLocaleString("en-GB",{maximumFractionDigits:2})}function ye({rowId:r,colId:a,value:d,row:t,isActive:v,source:j,onFocus:m,onUpdate:x,onNavigate:w,updateRowFormula:S}){const[o,f]=p.useState(!1),[y,l]=p.useState(""),k=p.useRef(null),[_,N]=p.useState(!1),[n,s]=p.useState(t.formulaString||"");p.useEffect(()=>{s(t.formulaString||"")},[t.formulaString]);const b=p.useCallback(i=>{f(!0),l(i!==void 0?i:d!==null?String(d):""),setTimeout(()=>{var u;return(u=k.current)==null?void 0:u.focus()},0)},[d]),c=p.useCallback(()=>{f(!1);const i=y.replace(/[£$€,\s]/g,"").trim(),u=parseFloat(i);x(i===""?null:isNaN(u)?d:u)},[y,x,d]),h=p.useCallback(()=>{N(!1),S&&n!==t.formulaString&&S(r,n)},[n,t.formulaString,r,S]),g=p.useCallback(i=>{i.key==="Enter"?c():i.key==="Escape"&&f(!1)},[c]);return p.useEffect(()=>{if(v&&!o&&!_){const i=u=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(u.key)?(u.preventDefault(),w({ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"}[u.key])):!u.ctrlKey&&!u.altKey&&!u.metaKey&&u.key.length===1?b(u.key):u.key==="Enter"?(u.preventDefault(),b()):(u.key==="Backspace"||u.key==="Delete")&&x(null)};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)}},[v,o,_,w,b,x]),o?e.jsx("input",{ref:k,type:"text",className:"w-full h-full px-2 py-1 outline-none bg-background text-center font-lato",value:y,onChange:i=>l(i.target.value),onBlur:c,onKeyDown:g}):e.jsxs(re,{delayDuration:800,children:[e.jsx(se,{asChild:!0,children:e.jsxs("div",{className:L("w-full h-full px-2 py-1 cursor-cell flex items-center justify-center font-lato relative group",t.isHeader&&"font-bold",!t.isHeader&&j==="calculated"&&"bg-blue-50/60 dark:bg-blue-950/20",!t.isHeader&&j==="manual"&&"bg-amber-50/70 dark:bg-amber-950/20",!t.isHeader&&j==="database"&&"bg-green-50/60 dark:bg-green-950/20"),tabIndex:-1,onClick:m,onDoubleClick:i=>{i.preventDefault(),b()},children:[ge(d,t),j==="manual"&&t.isAutoCalculated&&e.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 bg-amber-400 rounded-bl-full",title:"Manual Override"})]})}),(j||t.formulaString||t.isAutoCalculated)&&e.jsx(ae,{className:"p-3 min-w-[200px] pointer-events-auto",side:"bottom",children:e.jsxs("div",{className:"text-xs space-y-2",children:[(j||t.isAutoCalculated)&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"font-semibold text-muted-foreground",children:"Source:"}),e.jsx("span",{className:L("capitalize font-medium",(j==="calculated"||t.isAutoCalculated)&&"text-blue-600 dark:text-blue-400",j==="manual"&&"text-amber-600 dark:text-amber-400",j==="database"&&"text-green-600 dark:text-green-400"),children:j??(t.isAutoCalculated?"calculated":void 0)})]}),t.formulaString&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-semibold text-muted-foreground",children:"Formula:"}),_?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{value:n,onChange:i=>s(i.target.value),className:"h-6 text-xs",onKeyDown:i=>{i.key==="Enter"&&h(),i.key==="Escape"&&N(!1)}}),e.jsx(P,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:h,children:e.jsx("span",{className:"text-green-500",children:"✓"})})]}):e.jsxs("div",{className:"bg-muted px-2 py-1 rounded font-mono cursor-pointer hover:bg-muted/80 flex justify-between items-center group/formula",onClick:i=>{i.preventDefault(),N(!0),s(t.formulaString||"")},children:[t.formulaString,e.jsx("span",{className:"opacity-0 group-hover/formula:opacity-100 text-[10px] text-muted-foreground ml-2",children:"Edit"})]})]})]})})]})}function _e(r){let a="",d=r;for(;d>=0;)a=String.fromCharCode(d%26+65)+a,d=Math.floor(d/26)-1;return a}function Ce({rows:r,columns:a,data:d,activeCell:t,setActiveCell:v,updateCell:j,deleteRow:m,deleteColumn:x,navigateCell:w,updateRowFormula:S,renameColumn:o}){const[f,y]=p.useState(null);return e.jsxs("div",{className:"flex-1 overflow-auto relative border border-border rounded-md bg-background",children:[e.jsx(te,{children:e.jsxs("table",{className:"w-full border-collapse table-fixed text-sm",children:[e.jsxs("thead",{className:"sticky top-0 z-20 bg-muted/90 backdrop-blur-sm shadow-sm",children:[e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 border-b border-border bg-muted p-1 text-center text-xs text-muted-foreground font-normal select-none relative group",children:e.jsx("div",{className:"absolute inset-0 bg-muted/50"})}),e.jsx("th",{className:"w-64 border-b border-r border-border bg-muted p-2 text-left font-medium text-muted-foreground"}),a.map((l,k)=>e.jsx("th",{className:"border-b border-r border-border bg-muted p-1 text-center text-xs font-normal text-muted-foreground select-none relative min-w-[120px]",children:_e(k)},`excel-${k}`))]}),e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 border-b border-border bg-background p-2"}),e.jsx("th",{className:"w-64 border-b border-r border-border bg-background p-2 text-left font-semibold text-foreground",children:"Metric / Account"}),a.map(l=>e.jsx("th",{className:L("relative border-b border-r border-border bg-background p-2 text-right font-semibold min-w-[120px]",l.isYearEnd?"text-primary/80 bg-primary/5":"text-foreground"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2 group",children:[e.jsx("span",{className:"cursor-pointer hover:text-primary transition-colors py-1",onDoubleClick:()=>!l.isProtected&&y({id:l.id,type:"col",value:l.label}),children:l.label}),!l.isProtected&&e.jsx(P,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity absolute top-1 right-1",onClick:()=>x(l.id),children:e.jsx(z,{className:"h-3 w-3 text-destructive"})})]})},l.id))]})]}),e.jsx("tbody",{children:r.map((l,k)=>e.jsxs("tr",{className:"group/row hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"border-r border-b border-border bg-muted/30 p-2 text-center text-xs text-muted-foreground font-mono select-none sticky left-0 z-10 w-12 text-lato",children:k+1}),e.jsx("td",{className:"border-r border-b border-border p-2 font-medium bg-background relative w-64",children:e.jsxs("div",{className:"flex items-center justify-between group",children:[l.isHeader?e.jsx("span",{className:"font-bold text-primary",children:l.label}):e.jsx("span",{className:"cursor-pointer hover:text-primary transition-colors w-full",onDoubleClick:()=>!l.isAutoCalculated&&y({id:l.id,type:"row",value:l.label}),children:l.label}),!l.isAutoCalculated&&e.jsx(P,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity absolute right-2",onClick:()=>m(l.id),children:e.jsx(z,{className:"h-3 w-3 text-destructive"})})]})}),a.map(_=>{var b;const N=(b=d[l.id])==null?void 0:b[_.id],n=(N==null?void 0:N.value)??null,s=(t==null?void 0:t.row)===l.id&&(t==null?void 0:t.col)===_.id;return e.jsx("td",{className:L("border-r border-b border-border p-0 relative min-w-[120px]",s?"ring-2 ring-primary z-10":"",l.isHeader?"bg-muted/20 font-semibold":"",_.isYearEnd?"bg-primary/5 font-semibold":""),onClick:()=>v({row:l.id,col:_.id}),children:e.jsx(ye,{rowId:l.id,colId:_.id,value:n,row:l,isActive:s,onFocus:()=>v({row:l.id,col:_.id}),onUpdate:c=>j(l.id,_.id,c),onNavigate:w})},`${l.id}-${_.id}`)})]},l.id))})]})}),f&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",onClick:()=>y(null),children:e.jsxs("div",{className:"bg-card p-4 rounded-lg shadow-lg border w-96",onClick:l=>l.stopPropagation(),children:[e.jsxs(ne,{children:["Edit ",f.type==="row"?"Row":"Column"," Label"]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx($,{autoFocus:!0,value:f.value,onChange:l=>y({...f,value:l.target.value}),onKeyDown:l=>{l.key==="Enter"&&(f.type==="col"&&o&&o(f.id,f.value),y(null))}}),e.jsx(P,{onClick:()=>y(null),children:"Done"})]})]})})]})}const T=r=>{if(!(r!=null&&r.from)||!(r!=null&&r.to))return new Date().getFullYear(),[{id:"jan",label:"January",isProtected:!0},{id:"feb",label:"February",isProtected:!0},{id:"mar",label:"March",isProtected:!0},{id:"apr",label:"April",isProtected:!0},{id:"may",label:"May",isProtected:!0},{id:"jun",label:"June",isProtected:!0},{id:"jul",label:"July",isProtected:!0},{id:"aug",label:"August",isProtected:!0},{id:"sep",label:"September",isProtected:!0},{id:"oct",label:"October",isProtected:!0},{id:"nov",label:"November",isProtected:!0},{id:"dec",label:"December",isProtected:!0},{id:"year_end",label:"Year End",isProtected:!0,isYearEnd:!0}];const d=pe({start:le(r.from),end:ue(r.to)}).map(t=>({id:M(t,"MMM-yyyy").toLowerCase(),label:M(t,"MMM yyyy"),isProtected:!0}));return d.push({id:"year_end",label:"Period Total",isProtected:!0,isYearEnd:!0}),d},W=(r,a,d)=>{var t,v;try{const j=Object.keys(a).sort((w,S)=>S.length-w.length);let m=r;for(const w of j){const S=new RegExp(`\\b${w}\\b`,"g");if(S.test(m)){const o=((v=(t=a[w])==null?void 0:t[d])==null?void 0:v.value)??0;m=m.replace(S,`(${o})`)}}if(!/^[0-9+\-*/().\s]*$/.test(m))return null;const x=new Function(`return ${m}`)();return typeof x=="number"&&!isNaN(x)&&isFinite(x)?x:null}catch{return null}},H=[{id:"total_sales",label:"Total Sales",isAutoCalculated:!1,isCurrency:!0},{id:"sales_split_pct",label:"% Sales Split for the Year",isAutoCalculated:!1,isPercentage:!0},{id:"cost_sales_se",label:"Cost of Sales SE",isAutoCalculated:!1,isCurrency:!0},{id:"cost_sales_paye",label:"Cost of Sales PAYE Gross",isAutoCalculated:!1,isCurrency:!0},{id:"employee_ni",label:"Employee NI",isAutoCalculated:!1,isCurrency:!0},{id:"employee_pension",label:"Employee Pension",isAutoCalculated:!1,isCurrency:!0},{id:"total_cost_sales",label:"Total Cost of Sales",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"cost_sales_se + cost_sales_paye + employee_ni + employee_pension"},{id:"apprenticeship_levy",label:"Apprenticeship Levy",isAutoCalculated:!1,isCurrency:!0},{id:"annual_leave",label:"Annual Leave Accrual",isAutoCalculated:!1,isCurrency:!0},{id:"other_expenses",label:"Other Expenses",isAutoCalculated:!1,isCurrency:!0},{id:"recruitment_cost",label:"Recruitment & Pass Cost",isAutoCalculated:!1,isCurrency:!0},{id:"overheads_mgmt",label:"Mgmt & Office Cost",isAutoCalculated:!1,isCurrency:!0},{id:"bank_interest",label:"Bank Interest",isAutoCalculated:!1,isCurrency:!0},{id:"cooperation_tax",label:"Cooperation Tax",isAutoCalculated:!1,isCurrency:!0},{id:"total_overheads",label:"Total Overheads",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"apprenticeship_levy + annual_leave + other_expenses + recruitment_cost + overheads_mgmt + bank_interest + cooperation_tax"},{id:"total_cost",label:"Total Cost",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"total_cost_sales + total_overheads"},{id:"worked_hours",label:"Total Worked Hours",isAutoCalculated:!1,isCurrency:!1},{id:"avg_hourly_charge",label:"Avg Hourly Charge",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales / worked_hours"},{id:"gross_hourly_pay",label:"Gross Hourly Pay",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_cost_sales / worked_hours"},{id:"gross_hourly_margin",label:"Gross Hourly Margin",isAutoCalculated:!0,isCurrency:!0,formulaString:"avg_hourly_charge - gross_hourly_pay"},{id:"net_cost_per_hour",label:"Net Cost per Hour",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_cost / worked_hours"},{id:"gross_pl_value",label:"Gross P&L Value",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales - cost_sales_se"},{id:"net_pl",label:"Net P&L",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales - total_cost"},{id:"total_net_margin",label:"Total Net Margin",isAutoCalculated:!0,isCurrency:!0,formulaString:"net_pl / worked_hours"},{id:"hours_breakeven",label:"Hours for Breakeven",isAutoCalculated:!0,formulaString:"(other_expenses + overheads_mgmt) / gross_hourly_margin"},{id:"value_breakeven",label:"Total Value for Breakeven",isAutoCalculated:!0,isCurrency:!0,formulaString:"hours_breakeven * net_cost_per_hour"},{id:"avg_hourly_charge_2026",label:"Avg Hourly Charge Rate Future",isAutoCalculated:!0,isCurrency:!0,formulaString:"avg_hourly_charge * 1.06"},{id:"sales_budget_2026",label:"Projected Sales Budget 30% Uplift",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales * 1.3"},{id:"sales_target_hours",label:"Sales Target in Hours",isAutoCalculated:!0,formulaString:"sales_budget_2026 / avg_hourly_charge_2026"},{id:"variance_2025",label:"Variance",isAutoCalculated:!0,formulaString:"sales_target_hours - worked_hours"}];function q(r,a){const d={};for(const t of r){d[t.id]={};for(const v of a)d[t.id][v.id]={value:null,isEditable:!t.isAutoCalculated&&!v.isYearEnd,source:"manual"}}return d}function E(r,a,d){var w,S;const t=JSON.parse(JSON.stringify(r));for(const o of d.filter(f=>!f.isYearEnd))for(const f of a)f.formulaString?t[f.id][o.id]={...t[f.id][o.id],value:W(f.formulaString,t,o.id),isEditable:!1,source:"calculated"}:f.formula&&(t[f.id][o.id]={...t[f.id][o.id],value:f.formula(t,f.id,o.id),isEditable:!1,source:"calculated"});const v=a.find(o=>o.id==="total_sales"),j=a.find(o=>o.id==="sales_split_pct"),m=d.find(o=>o.isYearEnd);if(v&&j&&m){let o=0;const f=d.filter(y=>!y.isYearEnd);o=f.reduce((y,l)=>{var k,_;return y+(((_=(k=t.total_sales)==null?void 0:k[l.id])==null?void 0:_.value)??0)},0);for(const y of f){const l=((S=(w=t.total_sales)==null?void 0:w[y.id])==null?void 0:S.value)??0,k=o!==0?l/o*100:0;t.sales_split_pct[y.id]={value:k,isEditable:!1,source:"calculated"}}t.sales_split_pct[m.id]={value:o!==0?100:0,isEditable:!1,source:"calculated"}}const x=d.find(o=>o.isYearEnd);if(x)for(const o of a){if(o.id==="sales_split_pct")continue;const f=d.filter(y=>!y.isYearEnd).reduce((y,l)=>{var k,_;return y+(((_=(k=t[o.id])==null?void 0:k[l.id])==null?void 0:_.value)??0)},0);o.formulaString||o.isAutoCalculated?o.formulaString?t[o.id][x.id]={value:W(o.formulaString,t,x.id),isEditable:!1,source:"calculated"}:o.formula?t[o.id][x.id]={value:o.formula(t,o.id,x.id),isEditable:!1,source:"calculated"}:t[o.id][x.id]={value:f,isEditable:!1,source:"calculated"}:t[o.id][x.id]={value:f,isEditable:!1,source:"calculated"}}return t}function ve(r){const[a,d]=p.useState(H),[t,v]=p.useState(()=>T(r)),[j,m]=p.useState(()=>E(q(H,T(r)),H,T(r))),[x,w]=p.useState(null);p.useEffect(()=>{const n=T(r);v(n);let s=q(a,n);r!=null&&r.from&&(r!=null&&r.to)?(async()=>{try{const c=M(r.from,"yyyy-MM-dd"),h=M(r.to,"yyyy-MM-dd"),g=localStorage.getItem("auth_token"),i=await fetch(`/api/financial-summary/metrics?start=${c}&end=${h}`,{headers:{Authorization:`Bearer ${g}`},credentials:"include"});if(i.status===401){console.error("Unauthorized: Redirecting to login"),window.location.href="/auth";return}if(i.ok){const u=i.headers.get("content-type");if(u&&u.indexOf("application/json")!==-1){const C=await i.json(),X={January:"jan",February:"feb",March:"mar",April:"apr",May:"may",June:"jun",July:"jul",August:"aug",September:"sep",October:"oct",November:"nov",December:"dec"};for(const[O,F]of Object.entries(C)){const[D,Z]=O.split("-"),I=X[Z];if(!I)continue;const A=`${I}-${D}`;n.find(ee=>ee.id===A)&&(s.total_sales&&s.total_sales[A]&&(s.total_sales[A].value=F.total_sales,s.total_sales[A].source="backend"),s.cost_sales_se&&s.cost_sales_se[A]&&(s.cost_sales_se[A].value=F.cost_sales_se,s.cost_sales_se[A].source="backend"),s.cost_sales_paye&&s.cost_sales_paye[A]&&(s.cost_sales_paye[A].value=F.cost_sales_paye,s.cost_sales_paye[A].source="backend"),s.worked_hours&&s.worked_hours[A]&&(s.worked_hours[A].value=F.total_hours,s.worked_hours[A].source="backend"))}try{const O=await fetch("/api/financial-summary/overrides",{headers:{Authorization:`Bearer ${g}`},credentials:"include"});if(O.ok){const F=await O.json();for(const D of F)s[D.row_id]&&s[D.row_id][D.col_id]!==void 0&&(s[D.row_id][D.col_id]={...s[D.row_id][D.col_id],value:D.value,source:"manual"})}}catch{}m(E(s,a,n))}else console.error("Received non-JSON response from API"),m(E(s,a,n))}else console.error("API Error",i.status,i.statusText),m(E(s,a,n))}catch(c){console.error("Failed to fetch metrics",c),m(E(s,a,n))}})():m(E(s,a,n))},[r]);const S=p.useCallback((n,s,b)=>{m(h=>{const g={...h};return g[n]={...g[n]},g[n][s]={...g[n][s],value:b,source:"manual"},E(g,a,t)});const c=localStorage.getItem("auth_token");fetch("/api/financial-summary/overrides",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},credentials:"include",body:JSON.stringify({row_id:n,col_id:s,value:b})}).catch(h=>console.warn("Failed to save override:",h))},[a,t]),o=p.useCallback((n,s)=>{d(b=>{const c=b.map(h=>h.id===n?{...h,formulaString:s}:h);return m(h=>E(h,c,t)),c})},[t]),f=p.useCallback(n=>{const s=`custom_${Date.now()}`,b={id:s,label:n,isAutoCalculated:!1,isCurrency:!0};d(c=>{const h=[...c,b];return m(g=>{const i={...g};i[s]={};for(const u of t)i[s][u.id]={value:null,isEditable:!u.isYearEnd,source:"manual"};return E(i,h,t)}),h})},[t]),y=p.useCallback(n=>{d(s=>s.filter(b=>b.id!==n)),m(s=>{const b={...s};return delete b[n],b})},[]),l=p.useCallback(n=>{const s=`col_${Date.now()}`,b={id:s,label:n};v(c=>{const h=c.findIndex(i=>i.isYearEnd),g=[...c];return g.splice(h,0,b),m(i=>{const u={...i};for(const C of a)u[C.id]={...u[C.id]},u[C.id][s]={value:null,isEditable:!C.isAutoCalculated,source:"manual"};return E(u,a,g)}),g})},[a]),k=p.useCallback(n=>{v(s=>{const b=s.filter(c=>c.id!==n);return m(c=>{const h={...c};for(const g of Object.keys(h)){const{[n]:i,...u}=h[g];h[g]=u}return E(h,a,b)}),b})},[a]),_=p.useCallback((n,s)=>{v(b=>b.map(c=>c.id===n?{...c,label:s}:c))},[]),N=p.useCallback(n=>{if(!x)return;const s=a.filter(u=>!u.isAutoCalculated),b=t.filter(u=>!u.isYearEnd),c=s.findIndex(u=>u.id===x.row),h=b.findIndex(u=>u.id===x.col);if(c===-1||h===-1)return;let g=c,i=h;switch(n){case"up":g=Math.max(0,c-1);break;case"down":g=Math.min(s.length-1,c+1);break;case"left":i=Math.max(0,h-1);break;case"right":i=Math.min(b.length-1,h+1);break}w({row:s[g].id,col:b[i].id})},[x,a,t]);return{rows:a,columns:t,data:j,updateCell:S,updateRowFormula:o,addRow:f,deleteRow:y,addColumn:l,deleteColumn:k,renameColumn:_,activeCell:x,setActiveCell:w,navigateCell:N}}const Q="financial_summary_date_range";function je(){try{const r=localStorage.getItem(Q);if(r){const a=JSON.parse(r);return{from:new Date(a.from),to:new Date(a.to)}}}catch{}return{from:he(new Date),to:xe(new Date)}}function Me(){const[r,a]=p.useState(je),d=C=>{a(C),C!=null&&C.from&&(C!=null&&C.to)&&localStorage.setItem(Q,JSON.stringify({from:C.from.toISOString(),to:C.to.toISOString()}))},{rows:t,columns:v,data:j,activeCell:m,setActiveCell:x,updateCell:w,addRow:S,deleteRow:o,addColumn:f,deleteColumn:y,navigateCell:l,updateRowFormula:k}=ve(r),[_,N]=p.useState(""),[n,s]=p.useState(""),[b,c]=p.useState(!1),[h,g]=p.useState(!1),i=()=>{_.trim()&&(S(_.trim()),N(""),c(!1))},u=()=>{n.trim()&&(f(n.trim()),s(""),g(!1))};return e.jsx(oe,{noPadding:!0,fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-card/50 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(ie,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Financial Summary."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Annual budget and performance spreadsheet"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(de,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs(P,{id:"date",variant:"outline",className:L("w-[260px] justify-start text-left font-normal",!r&&"text-muted-foreground"),children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),r!=null&&r.from?r.to?e.jsxs(e.Fragment,{children:[M(r.from,"LLL dd, y")," -"," ",M(r.to,"LLL dd, y")]}):M(r.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(fe,{className:"w-auto p-0",align:"end",children:e.jsx(be,{initialFocus:!0,mode:"range",defaultMonth:r==null?void 0:r.from,selected:r,onSelect:d,numberOfMonths:2,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),e.jsxs(B,{open:b,onOpenChange:c,children:[e.jsx(J,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",children:[e.jsx(U,{className:"h-4 w-4 mr-1"})," Add Row"]})}),e.jsxs(K,{children:[e.jsx(G,{children:e.jsx(V,{children:"Add New Row"})}),e.jsx($,{placeholder:"Row label...",value:_,onChange:C=>N(C.target.value),onKeyDown:C=>C.key==="Enter"&&i()}),e.jsx(R,{children:e.jsx(P,{onClick:i,disabled:!_.trim(),children:"Add"})})]})]}),e.jsxs(B,{open:h,onOpenChange:g,children:[e.jsx(J,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",children:[e.jsx(U,{className:"h-4 w-4 mr-1"})," Add Column"]})}),e.jsxs(K,{children:[e.jsx(G,{children:e.jsx(V,{children:"Add New Column"})}),e.jsx($,{placeholder:"Column label...",value:n,onChange:C=>s(C.target.value),onKeyDown:C=>C.key==="Enter"&&u()}),e.jsx(R,{children:e.jsx(P,{onClick:u,disabled:!n.trim(),children:"Add"})})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx(Ce,{rows:t,columns:v,data:j,activeCell:m,setActiveCell:x,updateCell:w,deleteRow:o,deleteColumn:y,navigateCell:l,updateRowFormula:k})})]})})}export{Me as default};
