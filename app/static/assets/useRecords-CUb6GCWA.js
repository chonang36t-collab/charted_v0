var q=e=>{throw TypeError(e)};var m=(e,t,s)=>t.has(e)||q("Cannot "+s);var o=(e,t,s)=>(m(e,t,"read from private field"),s?s.call(e):t.get(e)),p=(e,t,s)=>t.has(e)?q("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),f=(e,t,s,r)=>(m(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),b=(e,t,s)=>(m(e,t,"access private method"),s);import{u as $}from"./useQuery-BvXQayQ7.js";import{ag as K,ah as M,ai as D,aj as T,ak as F,a2 as w,r as g,al as A,am as I,A as S}from"./index-DuV79T2f.js";var c,h,n,a,u,O,v,_,x=(_=class extends K{constructor(t,s){super();p(this,u);p(this,c);p(this,h);p(this,n);p(this,a);f(this,c,t),this.setOptions(s),this.bindMethods(),b(this,u,O).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const s=this.options;this.options=o(this,c).defaultMutationOptions(t),M(this.options,s)||o(this,c).getMutationCache().notify({type:"observerOptionsUpdated",mutation:o(this,n),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&D(s.mutationKey)!==D(this.options.mutationKey)?this.reset():((r=o(this,n))==null?void 0:r.state.status)==="pending"&&o(this,n).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=o(this,n))==null||t.removeObserver(this)}onMutationUpdate(t){b(this,u,O).call(this),b(this,u,v).call(this,t)}getCurrentResult(){return o(this,h)}reset(){var t;(t=o(this,n))==null||t.removeObserver(this),f(this,n,void 0),b(this,u,O).call(this),b(this,u,v).call(this)}mutate(t,s){var r;return f(this,a,s),(r=o(this,n))==null||r.removeObserver(this),f(this,n,o(this,c).getMutationCache().build(o(this,c),this.options)),o(this,n).addObserver(this),o(this,n).execute(t)}},c=new WeakMap,h=new WeakMap,n=new WeakMap,a=new WeakMap,u=new WeakSet,O=function(){var s;const t=((s=o(this,n))==null?void 0:s.state)??T();f(this,h,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},v=function(t){F.batch(()=>{var s,r,i,d,l,E,j,k;if(o(this,a)&&this.hasListeners()){const y=o(this,h).variables,C=o(this,h).context;(t==null?void 0:t.type)==="success"?((r=(s=o(this,a)).onSuccess)==null||r.call(s,t.data,y,C),(d=(i=o(this,a)).onSettled)==null||d.call(i,t.data,null,y,C)):(t==null?void 0:t.type)==="error"&&((E=(l=o(this,a)).onError)==null||E.call(l,t.error,y,C),(k=(j=o(this,a)).onSettled)==null||k.call(j,void 0,t.error,y,C))}this.listeners.forEach(y=>{y(o(this,h))})})},_);function R(e,t){const s=w(),[r]=g.useState(()=>new x(s,e));g.useEffect(()=>{r.setOptions(e)},[r,e]);const i=g.useSyncExternalStore(g.useCallback(l=>r.subscribe(F.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),d=g.useCallback((l,E)=>{r.mutate(l,E).catch(A)},[r]);if(i.error&&I(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:d,mutateAsync:i.mutate}}const Q=e=>$({queryKey:["records",e],queryFn:async()=>{const t=new URLSearchParams;t.append("page",e.page.toString()),t.append("limit",e.limit.toString()),e.sort_by&&t.append("sort_by",e.sort_by),e.sort_order&&t.append("sort_order",e.sort_order),e.search&&t.append("search",e.search),e.start&&t.append("start",e.start),e.end&&t.append("end",e.end),e.locations&&t.append("locations",e.locations),e.sites&&t.append("sites",e.sites),e.clients&&t.append("clients",e.clients);const s=await fetch(`${S.RECORDS}?${t.toString()}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(!s.ok){const r=await s.json().catch(()=>({}));throw new Error(r.error||"Failed to fetch records")}return s.json()},placeholderData:t=>t}),U=()=>$({queryKey:["records-options"],queryFn:async()=>{const e=await fetch(`${S.RECORDS}/options`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!e.ok)throw new Error("Failed to fetch options");return e.json()}}),L=()=>{const e=w();return R({mutationFn:async t=>{const s=await fetch(S.RECORDS,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(t)});if(!s.ok){const r=await s.json();throw new Error(r.error||"Failed to create record")}return s.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["records"]})}})},N=()=>{const e=w();return R({mutationFn:async t=>{const{id:s,...r}=t,i=await fetch(`${S.RECORDS}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(r)});if(!i.ok){const d=await i.json();throw new Error(d.error||"Failed to update record")}return i.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["records"]})}})},J=()=>{const e=w();return R({mutationFn:async t=>{const s=await fetch(`${S.RECORDS}/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!s.ok){const r=await s.json();throw new Error(r.error||"Failed to delete record")}return s.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["records"]})}})},G=()=>{const e=w();return R({mutationFn:async t=>{const s=await fetch(`${S.RECORDS}/bulk`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify({record_ids:t})});if(!s.ok){const r=await s.json();throw new Error(r.error||"Failed to delete records")}return s.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["records"]})}})};export{L as a,N as b,Q as c,G as d,J as e,R as f,U as u};
