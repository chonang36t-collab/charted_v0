import{c as ke,h as Ie,r as c,U as Pe,p as Be,j as e,v as Me,P as k,q as E,w as $e,e as _,ar as Ee,u as Oe,d as we,B as _e,A as Y}from"./index-2WjsGss6.js";import{D as He}from"./DashboardLayout-DBFARWzp.js";import{C as L,d as R,a as Z,b as ee}from"./card-CRCtn11g.js";import{c as se,R as Ge,I as Ve}from"./index-DsdiBEbK.js";import{D as ze}from"./DashboardHeader-DfnZh7dP.js";import{u as Ke,O as qe}from"./OperationalTrendChart-ZnXlPgkN.js";import{u as Ue,L as We,R as Xe}from"./LoadingOverlay-DWJcCDon.js";import{R as te,C as Ye,X as Je,Y as Qe,T as ae,B as Ze,a as re,L as es}from"./generateCategoricalChart-J4N4nztS.js";import{B as ss}from"./BarChart-DVJkn9MP.js";import{P as ts,a as as}from"./PieChart-CX2DK7Ze.js";import{T as ie,a as ne,b as D,c as y,d as oe,e as p,f as rs}from"./table-CgUmovet.js";import{f as J}from"./popover-BtNFMt9u.js";import"./users-CjddGF7O.js";import"./locationUtils-Dem8sUoc.js";import"./index-CiktzzQ9.js";import"./Line-B8WfzQSP.js";import"./AreaChart-dGUxhkRH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=ke("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var I="Tabs",[ns,Fs]=Ie(I,[se]),ce=se(),[os,H]=ns(I),le=c.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,onValueChange:i,defaultValue:x,orientation:l="horizontal",dir:f,activationMode:u="automatic",...b}=s,o=Pe(f),[d,m]=Be({prop:n,onChange:i,defaultProp:x??"",caller:I});return e.jsx(os,{scope:a,baseId:Me(),value:d,onValueChange:m,orientation:l,dir:o,activationMode:u,children:e.jsx(k.div,{dir:o,"data-orientation":l,...b,ref:t})})});le.displayName=I;var de="TabsList",ue=c.forwardRef((s,t)=>{const{__scopeTabs:a,loop:n=!0,...i}=s,x=H(de,a),l=ce(a);return e.jsx(Ge,{asChild:!0,...l,orientation:x.orientation,dir:x.dir,loop:n,children:e.jsx(k.div,{role:"tablist","aria-orientation":x.orientation,...i,ref:t})})});ue.displayName=de;var me="TabsTrigger",he=c.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,disabled:i=!1,...x}=s,l=H(me,a),f=ce(a),u=fe(l.baseId,n),b=ve(l.baseId,n),o=n===l.value;return e.jsx(Ve,{asChild:!0,...f,focusable:!i,active:o,children:e.jsx(k.button,{type:"button",role:"tab","aria-selected":o,"aria-controls":b,"data-state":o?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:u,...x,ref:t,onMouseDown:E(s.onMouseDown,d=>{!i&&d.button===0&&d.ctrlKey===!1?l.onValueChange(n):d.preventDefault()}),onKeyDown:E(s.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&l.onValueChange(n)}),onFocus:E(s.onFocus,()=>{const d=l.activationMode!=="manual";!o&&!i&&d&&l.onValueChange(n)})})})});he.displayName=me;var xe="TabsContent",ge=c.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,forceMount:i,children:x,...l}=s,f=H(xe,a),u=fe(f.baseId,n),b=ve(f.baseId,n),o=n===f.value,d=c.useRef(o);return c.useEffect(()=>{const m=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(m)},[]),e.jsx($e,{present:i||o,children:({present:m})=>e.jsx(k.div,{"data-state":o?"active":"inactive","data-orientation":f.orientation,role:"tabpanel","aria-labelledby":u,hidden:!m,id:b,tabIndex:0,...l,ref:t,style:{...s.style,animationDuration:d.current?"0s":void 0},children:m&&x})})});ge.displayName=xe;function fe(s,t){return`${s}-trigger-${t}`}function ve(s,t){return`${s}-content-${t}`}var cs=le,je=ue,pe=he,be=ge;const ls=cs,ye=c.forwardRef(({className:s,...t},a)=>e.jsx(je,{ref:a,className:_("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t}));ye.displayName=je.displayName;const C=c.forwardRef(({className:s,...t},a)=>e.jsx(pe,{ref:a,className:_("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...t}));C.displayName=pe.displayName;const S=c.forwardRef(({className:s,...t},a)=>e.jsx(be,{ref:a,className:_("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t}));S.displayName=be.displayName;const ds=({active:s,payload:t,label:a})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:a}),e.jsx("p",{className:"text-sm",children:t[0].value.toLocaleString(void 0,{style:"currency",currency:"GBP"})})]}):null,O=({data:s,metric:t,onBarClick:a})=>!s||s.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No breakdown data available"})}):e.jsx(L,{children:e.jsx(R,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(ss,{data:s,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(Ye,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(Je,{type:"number",hide:!0}),e.jsx(Qe,{dataKey:"name",type:"category",width:120,tick:{fontSize:12}}),e.jsx(ae,{content:e.jsx(ds,{})}),e.jsx(Ze,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0],onClick:a,children:s.map((n,i)=>e.jsx(re,{fill:"hsl(var(--primary))",fillOpacity:.8+i*.05},`cell-${i}`))})]})})})})}),Q=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#8dd1e1","#a4de6c","#d0ed57"],us=({active:s,payload:t})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:t[0].name}),e.jsx("p",{className:"text-sm",children:Number(t[0].value).toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:`${(t[0].payload.percent*100).toFixed(1)}%`})]}):null,w=({data:s,metric:t})=>{if(!s||s.length===0)return e.jsx(L,{children:e.jsx(R,{className:"pt-6",children:e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No distribution data available"})})})});const a=[...s].sort((n,i)=>i.value-n.value);return e.jsx(L,{children:e.jsx(R,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(ts,{children:[e.jsx(as,{data:a,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",children:a.map((n,i)=>e.jsx(re,{fill:Q[i%Q.length]},`cell-${i}`))}),e.jsx(ae,{content:e.jsx(us,{})}),e.jsx(es,{})]})})})})})},ms=({data:s})=>!s||s.length===0?e.jsx("div",{className:"h-[200px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No overhead details available"})}):e.jsxs(L,{children:[e.jsx(Z,{children:e.jsx(ee,{children:"Overheads Details"})}),e.jsx(R,{children:e.jsxs(ie,{children:[e.jsx(ne,{children:e.jsxs(D,{children:[e.jsx(y,{children:"Title"}),e.jsx(y,{children:"Month"}),e.jsx(y,{children:"Location"}),e.jsx(y,{children:"Site"}),e.jsx(y,{className:"text-right",children:"Amount"})]})}),e.jsx(oe,{children:s.map(t=>e.jsxs(D,{children:[e.jsx(p,{className:"font-medium",children:t.name}),e.jsxs(p,{children:[t.month," ",t.year]}),e.jsx(p,{children:t.location||"-"}),e.jsx(p,{children:t.site||"-"}),e.jsx(p,{className:"text-right",children:t.value.toLocaleString(void 0,{style:"currency",currency:"GBP"})})]},t.id))})]})})]}),ks=()=>{const{metricId:s}=Ee(),t=Oe(),{dateRange:a,setDateRange:n}=we(),[i,x]=c.useState(!1),[l,f]=c.useState(a),[u,b]=c.useState([]),[o,d]=c.useState([]),[m,Ne]=c.useState("trend"),[N,Te]=c.useState([]),[Ce,Se]=c.useState([]),[Le,G]=c.useState(!1),F=["revenue","cost","profit","employees","clientRate","staffRate","overheads"].includes(s||""),P=["shifts","hours","clients","targetAchievement","missedTargets"].includes(s||""),B=s==="overheads",{operationalData:v,isLoading:Re}=Ke(a,u,o),{financialData:j,isLoading:Ae}=Ue(a,u,o),De=F?Ae:P?Re:!1;c.useEffect(()=>{if(m==="trend"||!s)return;(async()=>{G(!0);try{const g=new URLSearchParams({start:J(a.from,"yyyy-MM-dd"),end:J(a.to,"yyyy-MM-dd"),metric:s,limit:"20"});u&&u.length>0&&u.forEach(h=>g.append("locations",h)),o&&o.length>0&&o.forEach(h=>g.append("sites",h));const A={Authorization:`Bearer ${localStorage.getItem("auth_token")}`};if(m==="details"&&B){const h=await fetch(`${Y.FINANCIAL_METRICS_LIST}?${g.toString()}`,{headers:A});if(h.ok){const T=await h.json();Se(T)}}else if(["location","site","client"].includes(m)){g.append("dimension",m);const h=await fetch(`${Y.BREAKDOWN}?${g.toString()}`,{headers:A});if(h.ok){const T=await h.json();Te(T)}}}catch(g){console.error("Error fetching breakdown:",g)}finally{G(!1)}})()},[m,s,a,u,o]);const V=r=>{switch(r){case"revenue":return"Revenue Analysis";case"cost":return"Cost Analysis";case"profit":return"Profit Analysis";case"shifts":return"Shifts Analysis";case"hours":return"Hours Analysis";case"clients":return"Client Analysis";case"employees":return"Employee Analysis";case"targetAchievement":return"Target Achievement Analysis";case"missedTargets":return"Missed Targets Analysis";case"clientRate":return"Client Rate Analysis";case"staffRate":return"Staff Rate Analysis";case"overheads":return"Overheads Analysis";default:return"Metric Analysis"}},Fe=(r,g)=>{var A,h,T,z,K,q,U,W,X;if(!r)return"-";switch(g){case"revenue":return`£${((A=r.revenue)==null?void 0:A.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"cost":return`£${((h=r.cost)==null?void 0:h.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"profit":const $=r.profit??r.revenue-r.cost-(r.overheads||0);return`£${($==null?void 0:$.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"shifts":return((T=r.totalShifts)==null?void 0:T.toLocaleString())??0;case"hours":return((z=r.paidHours)==null?void 0:z.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"clients":return((K=r.clientCount)==null?void 0:K.toLocaleString())??0;case"employees":return((q=r.paidHours)==null?void 0:q.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"targetAchievement":return`${((U=r.achievementPercentage)==null?void 0:U.toFixed(1))??0}%`;case"missedTargets":return`${((W=r.achievementPercentage)==null?void 0:W.toFixed(1))??0}%`;case"clientRate":return`£${(r.revenue/r.paidHours||0).toFixed(2)}`;case"staffRate":return`£${(r.cost/r.paidHours||0).toFixed(2)}`;case"overheads":return`£${((X=r.overheads)==null?void 0:X.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;default:return"-"}},M=F?j==null?void 0:j.timeSeries:v==null?void 0:v.timeSeries;return e.jsx(He,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(ze,{dateRange:a,onDateRangeChange:n,calendarOpen:i,onCalendarOpenChange:x,tempDateRange:l,onTempDateRangeChange:f,selectedLocations:u,onLocationsChange:b,selectedSites:o,onSitesChange:d}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6 relative",children:[(De||Le)&&e.jsx(We,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(_e,{variant:"ghost",size:"sm",onClick:()=>t(-1),className:"gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold",children:V(s)})]}),e.jsxs(ls,{value:m,onValueChange:Ne,className:"space-y-4",children:[e.jsxs(ye,{children:[e.jsx(C,{value:"trend",children:"Trend"}),e.jsx(C,{value:"location",children:"By Location"}),e.jsx(C,{value:"site",children:"By Site"}),!B&&e.jsx(C,{value:"client",children:"By Client"}),B&&e.jsx(C,{value:"details",children:"All Details"})]}),e.jsx(S,{value:"trend",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[F&&e.jsx(Xe,{data:(j==null?void 0:j.timeSeries)||[],aggregationLevel:(j==null?void 0:j.aggregationLevel)||"monthly",selectedMetric:s}),P&&e.jsx(qe,{data:(v==null?void 0:v.timeSeries)||[],aggregationLevel:(v==null?void 0:v.aggregationLevel)||"monthly",selectedMetric:s}),!F&&!P&&e.jsx(L,{children:e.jsx(R,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Metric type not recognized or data unavailable."})})}),e.jsxs(L,{children:[e.jsx(Z,{children:e.jsx(ee,{children:"Historical Data"})}),e.jsx(R,{children:e.jsxs(ie,{children:[e.jsxs(rs,{children:["Detailed historical data for ",V(s)]}),e.jsx(ne,{children:e.jsxs(D,{children:[e.jsx(y,{children:"Period"}),e.jsx(y,{className:"text-right",children:"Value"})]})}),e.jsx(oe,{children:M&&M.length>0?[...M].reverse().map((r,g)=>e.jsxs(D,{children:[e.jsx(p,{className:"font-medium",children:r.display}),e.jsx(p,{className:"text-right font-medium",children:Fe(r,s)})]},g)):e.jsx(D,{children:e.jsx(p,{colSpan:2,className:"text-center",children:"No data available"})})})]})})]})]})}),e.jsx(S,{value:"location",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(O,{data:N,metric:s||"revenue"}),e.jsx(w,{data:N,metric:s||"revenue"})]})}),e.jsx(S,{value:"site",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(O,{data:N,metric:s||"revenue"}),e.jsx(w,{data:N,metric:s||"revenue"})]})}),e.jsx(S,{value:"client",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(O,{data:N,metric:s||"revenue"}),e.jsx(w,{data:N,metric:s||"revenue"})]})}),e.jsx(S,{value:"details",children:e.jsx(ms,{data:Ce})})]})]})]})})};export{ks as default};
