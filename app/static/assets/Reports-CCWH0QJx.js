import{r as s,a as $,A as D,j as e}from"./index-x1jOpyAd.js";import{D as q}from"./DashboardLayout-CtHP5bMv.js";import{C as E,a as B,b as I,d as K}from"./card-D392RIoY.js";import{L as l}from"./label-BplZB6mx.js";import{I as p}from"./input-03jyLLai.js";import{S as j,b as v,c as y,d as f,e as n}from"./select-DGhIds80.js";import{B as W}from"./button-B7kWtLSy.js";import{R as Q,C as g,X as C,Y as S,T as N,L as R,B as Z,A as ee}from"./generateCategoricalChart-B0LDNrSa.js";import{B as ae,L as se}from"./BarChart-DZgzss2Y.js";import{A as re}from"./AreaChart-Be9qvjCp.js";import{L as te}from"./Line-BJGSej2Y.js";import"./users-DlKlsLy-.js";const P=[{name:"Jan",value:4e3},{name:"Feb",value:3e3},{name:"Mar",value:5e3},{name:"Apr",value:4500},{name:"May",value:6e3},{name:"Jun",value:5500}];function ve(){const[o,X]=s.useState("bar"),[c,F]=s.useState("date"),[d,b]=s.useState("total_pay"),[h,Y]=s.useState(""),[m,G]=s.useState(""),[u,M]=s.useState(""),[x,w]=s.useState({numeric:[],categorical:[]}),[O,A]=s.useState(P),[L,T]=s.useState(!1),{toast:i}=$();s.useEffect(()=>{V()},[]);const V=async()=>{try{const a=await fetch(D.REPORT_COLUMNS,{credentials:"include"});if(!a.ok)throw new Error("Failed to load columns");const t=await a.json();w(t),F(r=>r||t.categorical[0]||t.numeric[0]||""),b(r=>r||t.numeric[0]||"")}catch{i({title:"Using demo columns",description:"Could not load report columns"}),w({numeric:["value"],categorical:["name"]})}},U=async()=>{if(!c||!d){i({title:"Select columns",description:"X and Y columns are required",variant:"destructive"});return}T(!0);try{const a=new URLSearchParams({chartType:o,x:c,y:d});h&&a.append("site",h),m&&a.append("role",m),u&&a.append("month",u);const t=await fetch(`${D.REPORT_DATA}?${a.toString()}`,{credentials:"include"}),r=await t.json();if(!t.ok||r.error)throw new Error(r.error||"Report failed");const z=(r.labels||[]).map((H,J)=>{var k;return{name:H,value:Number(((k=r.values)==null?void 0:k[J])??0)}});A(z),i({title:"Report generated"})}catch{A(P),i({title:"Using demo data",description:"Could not connect to backend"})}finally{T(!1)}},_=()=>{const a={data:O,margin:{top:5,right:30,left:20,bottom:5}};switch(o){case"line":return e.jsxs(se,{...a,children:[e.jsx(g,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"name"}),e.jsx(S,{}),e.jsx(N,{}),e.jsx(R,{}),e.jsx(te,{type:"monotone",dataKey:"value",stroke:"hsl(var(--primary))",strokeWidth:2})]});case"area":return e.jsxs(re,{...a,children:[e.jsx(g,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"name"}),e.jsx(S,{}),e.jsx(N,{}),e.jsx(R,{}),e.jsx(ee,{type:"monotone",dataKey:"value",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3})]});default:return e.jsxs(ae,{...a,children:[e.jsx(g,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"name"}),e.jsx(S,{}),e.jsx(N,{}),e.jsx(R,{}),e.jsx(Z,{dataKey:"value",fill:"hsl(var(--primary))"})]})}};return e.jsx(q,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Advanced Reports"}),e.jsx("p",{className:"text-muted-foreground",children:"Customize and generate detailed analytics reports"})]}),e.jsxs(E,{children:[e.jsx(B,{children:e.jsx(I,{children:"Report Configuration"})}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"chart-type",children:"Chart Type"}),e.jsxs(j,{value:o,onValueChange:X,children:[e.jsx(v,{id:"chart-type",children:e.jsx(y,{placeholder:"Select chart type"})}),e.jsxs(f,{children:[e.jsx(n,{value:"bar",children:"Bar Chart"}),e.jsx(n,{value:"line",children:"Line Chart"}),e.jsx(n,{value:"area",children:"Area Chart"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"x-column",children:"X Column"}),e.jsxs(j,{value:c,onValueChange:F,children:[e.jsx(v,{id:"x-column",children:e.jsx(y,{placeholder:"Select X"})}),e.jsx(f,{children:[...x.categorical,...x.numeric].map(a=>e.jsx(n,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"y-column",children:"Y Column"}),e.jsxs(j,{value:d,onValueChange:b,children:[e.jsx(v,{id:"y-column",children:e.jsx(y,{placeholder:"Select Y"})}),e.jsx(f,{children:x.numeric.map(a=>e.jsx(n,{value:a,children:a},a))})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(W,{onClick:U,className:"w-full",disabled:L,children:L?"Generating...":"Generate Report"})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"site-filter",children:"Site (optional)"}),e.jsx(p,{id:"site-filter",value:h,onChange:a=>Y(a.target.value),placeholder:"e.g., Heathrow"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"role-filter",children:"Role (optional)"}),e.jsx(p,{id:"role-filter",value:m,onChange:a=>G(a.target.value),placeholder:"e.g., Sales"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"month-filter",children:"Month (optional)"}),e.jsx(p,{id:"month-filter",value:u,onChange:a=>M(a.target.value),placeholder:"e.g., 2025-01"})]})]})]})]}),e.jsxs(E,{children:[e.jsx(B,{children:e.jsx(I,{children:"Visualization"})}),e.jsx(K,{children:e.jsx(Q,{width:"100%",height:400,children:_()})})]})]})})}export{ve as default};
