import{r as m,a as A,A as g,j as e}from"./index-DCuD3XHh.js";import{f as k}from"./popover-DcAis7Kp.js";import{C as S,a as N,b,d as T}from"./card-BAZ-eILp.js";import{R as L,C as D,X as O,Y as R,T as E,L as K,A as i}from"./generateCategoricalChart-DZn2t-K_.js";import{A as F}from"./AreaChart-DmQeLqPE.js";const _=(r,s,t)=>{const[a,o]=m.useState(null),[h,l]=m.useState(!1),{toast:c}=A(),f=async()=>{l(!0);try{const d=new URLSearchParams({start:k(r.from,"yyyy-MM-dd"),end:k(r.to,"yyyy-MM-dd")});s&&s.length>0&&s.forEach(n=>d.append("locations",n)),t&&t.length>0&&t.forEach(n=>d.append("sites",n));const u=d.toString(),p={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},[x,y]=await Promise.all([fetch(`${g.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${u}`,{headers:p}),fetch(`${g.CLIENT_DISTRIBUTION}?${u}`,{headers:p})]);if(x.ok){const n=await x.json();if(y.ok){const v=await y.json();v.timeSeries&&(n.timeSeries=n.timeSeries.map(j=>{const C=v.timeSeries.find(w=>w.period===j.period);return{...j,clientCount:C?C.clientCount:0}}))}o(n)}else c({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch(d){console.error(d),c({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{l(!1)}};return m.useEffect(()=>{f()},[r,s,t]),{financialData:a,isLoading:h,refetch:f}},I=({active:r,payload:s,label:t})=>r&&s&&s.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:t}),s.map((a,o)=>e.jsxs("p",{className:"text-sm",style:{color:a.color},children:[a.name,": ",a.name.includes("Revenue")||a.name.includes("Cost")||a.name.includes("Profit")?`£${Number(a.value).toLocaleString()}`:a.value.toLocaleString()]},o))]}):null,z=({data:r,aggregationLevel:s,selectedMetric:t="revenue"})=>{var l;const a={dataKey:"display",interval:0};if(!r||r.length===0)return e.jsxs(S,{className:"flex-1",children:[e.jsx(N,{children:e.jsx(b,{children:"Financial Trend"})}),e.jsx(T,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const o=()=>{switch(t){case"revenue":return"Revenue vs Cost Trend";case"cost":return"Cost Overview";case"profit":return"Profit Trend";case"shifts":return"Total Shifts Trend";case"clients":return"Total Clients Trend";case"employees":return"Staff Hours Trend";default:return"Financial Trend"}},h=()=>{switch(t){case"revenue":case"cost":case"profit":return"Amount (£)";case"shifts":return"Shifts";case"clients":return"Clients";case"employees":return"Hours";default:return""}};return e.jsxs(S,{className:"flex-1",children:[e.jsxs(N,{children:[e.jsx(b,{children:o()}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s==="daily"&&"Daily view",s==="weekly"&&"Weekly view",s==="monthly"&&"Monthly view"]})]}),e.jsx(T,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(F,{data:r,children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:a.dataKey,tick:{fontSize:12},interval:a.interval}),e.jsx(R,{label:{value:h(),angle:-90,position:"insideLeft"}}),e.jsx(E,{content:e.jsx(I,{})}),e.jsx(K,{}),t==="revenue"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(i,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]}),t==="cost"&&e.jsx(i,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.5,strokeWidth:2}),t==="profit"&&e.jsx(i,{type:"monotone",dataKey:((l=r[0])==null?void 0:l.profit)!==void 0?"profit":c=>c.revenue-c.cost,name:"Profit",stroke:"hsl(142, 76%, 36%)",fill:"hsl(142, 76%, 36%)",fillOpacity:.5,strokeWidth:2}),t==="shifts"&&e.jsx(i,{type:"monotone",dataKey:"totalShifts",name:"Total Shifts",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.5,strokeWidth:2}),t==="clients"&&e.jsx(i,{type:"monotone",dataKey:"clientCount",name:"Clients",stroke:"hsl(262, 83%, 58%)",fill:"hsl(262, 83%, 58%)",fillOpacity:.5,strokeWidth:2}),t==="employees"&&e.jsx(i,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.5,strokeWidth:2})]})})})})]})},U=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})});export{U as L,z as R,_ as u};
