import{c as ne,r as p,j as e,e as O,B as T,T as ee,k as te,l as re,m as ae,I as z}from"./index-CMojH-7l.js";import{D as ie,T as de}from"./DashboardLayout-DpDYUboG.js";import{D as B,b as Y,c as V,d as K,e as W,a as Z}from"./dialog-qKpchKC4.js";import{L as ue}from"./label-ctoW4DR7.js";import{T as J}from"./trash-2-BXVMBh9e.js";import{P as G}from"./plus-D0oJ0QDg.js";import"./users-B_YgPzau.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=ne("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),be=o=>{let t="";for(;o>=0;)t=String.fromCharCode(o%26+65)+t,o=Math.floor(o/26)-1;return t},U=(o,t)=>`${be(t)}${o+1}`,se=o=>{const t=o.match(/^([A-Z]+)([0-9]+)$/);if(!t)return null;const i=t[1],s=t[2];let m=0;for(let n=0;n<i.length;n++)m=m*26+(i.charCodeAt(n)-64);return m-=1,{rowIdx:parseInt(s,10)-1,colIdx:m}},q=(o,t,i,s)=>{if(!o)return"";const m=i.findIndex(c=>c.id===s),h=new Map(t.map((c,g)=>[c.id,g])),n=new Map(i.map((c,g)=>[c.id,g]));let l=o;l=l.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(c,g,v)=>{const C=h.get(g),j=n.get(v);return C!==void 0&&j!==void 0?U(C,j):c});const u=Array.from(h.keys()).sort((c,g)=>g.length-c.length);for(const c of u){const g=new RegExp(`\\b${c}\\b`,"g");if(g.test(l)){const v=h.get(c);l=l.replace(g,U(v,m))}}return l},me=(o,t,i,s)=>{if(!o)return"";let m=o;const h=i.findIndex(n=>n.id===s);return m=m.replace(/\b([A-Z]+)([0-9]+)\b/g,n=>{const l=se(n);if(!l)return n;const u=t[l.rowIdx],c=i[l.colIdx];return!u||!c?n:l.colIdx===h?u.id:`${u.id}:${c.id}`}),m},L=o=>[{id:"jan",label:"January",isProtected:!0},{id:"feb",label:"February",isProtected:!0},{id:"mar",label:"March",isProtected:!0},{id:"apr",label:"April",isProtected:!0},{id:"may",label:"May",isProtected:!0},{id:"jun",label:"June",isProtected:!0},{id:"jul",label:"July",isProtected:!0},{id:"aug",label:"August",isProtected:!0},{id:"sep",label:"September",isProtected:!0},{id:"oct",label:"October",isProtected:!0},{id:"nov",label:"November",isProtected:!0},{id:"dec",label:"December",isProtected:!0},{id:"year_end",label:"Year End",isProtected:!0,isYearEnd:!0}],Q=(o,t,i)=>{var s,m;try{const h=Object.keys(t).sort((u,c)=>c.length-u.length);let n=o;n=n.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(u,c,g)=>{var C,j;return`(${((j=(C=t[c])==null?void 0:C[g])==null?void 0:j.value)??0})`});for(const u of h){const c=new RegExp(`\\b${u}\\b`,"g");if(c.test(n)){const g=((m=(s=t[u])==null?void 0:s[i])==null?void 0:m.value)??0;n=n.replace(c,`(${g})`)}}if(!/^[0-9+\-*/().\s]*$/.test(n))return null;const l=new Function(`return ${n}`)();return typeof l=="number"&&!isNaN(l)&&isFinite(l)?l:null}catch{return null}},pe=["cost_sales_se","cost_sales_paye","employee_ni","employee_pension"],fe=["apprenticeship_levy","annual_leave","other_expenses","recruitment_cost","overheads_mgmt","bank_interest","cooperation_tax"],H=[{id:"total_sales",label:"Total Sales",isAutoCalculated:!1,isCurrency:!0},{id:"sales_split_pct",label:"% Sales Split",isAutoCalculated:!0,isPercentage:!0,formulaString:"total_sales / total_sales:year_end"},{id:"cost_sales_se",label:"Cost of Sales SE",isAutoCalculated:!1,isCurrency:!0},{id:"cost_sales_paye",label:"Cost of Sales PAYE Gross",isAutoCalculated:!1,isCurrency:!0},{id:"employee_ni",label:"Employee NI",isAutoCalculated:!1,isCurrency:!0},{id:"employee_pension",label:"Employee Pension",isAutoCalculated:!1,isCurrency:!0},{id:"total_cost_sales",label:"Total Cost of Sales",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:pe.join(" + ")},{id:"apprenticeship_levy",label:"Apprenticeship Levy",isAutoCalculated:!1,isCurrency:!0},{id:"annual_leave",label:"Annual Leave Accrual",isAutoCalculated:!1,isCurrency:!0},{id:"other_expenses",label:"Other Expenses",isAutoCalculated:!1,isCurrency:!0},{id:"recruitment_cost",label:"Recruitment & Pass Cost",isAutoCalculated:!1,isCurrency:!0},{id:"overheads_mgmt",label:"Total Mgmt & Office Cost",isAutoCalculated:!1,isCurrency:!0},{id:"bank_interest",label:"Bank Interest",isAutoCalculated:!1,isCurrency:!0},{id:"cooperation_tax",label:"Cooperation Tax",isAutoCalculated:!1,isCurrency:!0},{id:"total_overheads",label:"Total Overheads",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:fe.join(" + ")},{id:"total_cost",label:"Total Cost",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"total_cost_sales + total_overheads"},{id:"avg_hourly_charge",label:"Avg Hourly Charge Rate",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_pay",label:"Avg Hourly Pay",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_margin",label:"Gross Hourly Margin",isAutoCalculated:!0,isCurrency:!0,formulaString:"avg_hourly_charge - gross_hourly_pay"},{id:"net_cost_per_hour",label:"Net Cost per Hour",isAutoCalculated:!1,isCurrency:!0},{id:"gross_pl_value",label:"Gross P&L Value",isAutoCalculated:!1,isCurrency:!0},{id:"net_pl",label:"Net P&L",isAutoCalculated:!1,isCurrency:!0},{id:"total_net_margin",label:"Total Net Margin",isAutoCalculated:!1,isPercentage:!0},{id:"worked_hours",label:"Worked Hours",isAutoCalculated:!1},{id:"hours_breakeven",label:"Hours for Breakeven",isAutoCalculated:!0,formulaString:"total_cost / gross_hourly_margin"},{id:"value_breakeven",label:"Total Value for Breakeven",isAutoCalculated:!0,isCurrency:!0,formulaString:"hours_breakeven * avg_hourly_charge"},{id:"sales_budget",label:"Sales Budget 30% Uplift",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales * 1.3"},{id:"avg_hourly_charge_2026",label:"Avg Hourly Charge Rate 2026",isAutoCalculated:!1,isCurrency:!0},{id:"sales_target_hours",label:"Sales Target in Hours",isAutoCalculated:!1},{id:"variance_2025",label:"Variance Against 2025",isAutoCalculated:!1,isCurrency:!0}];function X(o,t){const i={};for(const s of o){i[s.id]={};for(const m of t)i[s.id][m.id]={value:null,isEditable:!s.isAutoCalculated&&!m.isYearEnd,source:"manual"}}return i}function I(o,t,i){const s=JSON.parse(JSON.stringify(o)),m=i.filter(l=>!l.isYearEnd),h=i.find(l=>l.isYearEnd);for(const l of m)for(const u of t)u.id!=="sales_split_pct"&&(u.formulaString?s[u.id][l.id]={...s[u.id][l.id],value:Q(u.formulaString,s,l.id),isEditable:!1,source:"formula"}:u.formula&&(s[u.id][l.id]={...s[u.id][l.id],value:u.formula(s,u.id,l.id),isEditable:!1,source:"formula"}));if(h)for(const l of t){if(l.id==="sales_split_pct")continue;const u=m.reduce((c,g)=>{var v,C;return c+(((C=(v=s[l.id])==null?void 0:v[g.id])==null?void 0:C.value)??0)},0);s[l.id][h.id]={value:u,isEditable:!1,source:"calculated"}}const n=t.find(l=>l.id==="sales_split_pct");if(n&&n.formulaString&&h){for(const l of m){const u=Q(n.formulaString,s,l.id);s[n.id][l.id]={value:u?u*100:0,isEditable:!1,source:"formula"}}s[n.id][h.id]={value:100,isEditable:!1,source:"calculated"}}return s}function he(o){const[t,i]=p.useState(H),[s,m]=p.useState(()=>L()),[h,n]=p.useState(()=>I(X(H,L()),H,L())),[l,u]=p.useState(null);p.useEffect(()=>{const r=L();m(r);let d=X(t,r);n(I(d,t,r))},[o]);const c=p.useCallback((r,d,x)=>{n(f=>{const b={...f};return b[r]={...b[r]},b[r][d]={...b[r][d],value:x,source:"manual"},I(b,t,s)})},[t,s]),g=p.useCallback((r,d)=>{i(x=>{const f=x.map(b=>b.id===r?{...b,formulaString:d}:b);return n(b=>I(b,f,s)),f})},[s]),v=p.useCallback(r=>{const d=`custom_${Date.now()}`,x={id:d,label:r,isAutoCalculated:!1,isCurrency:!0};i(f=>{const b=[...f,x];return n(k=>{const S={...k};S[d]={};for(const a of s)S[d][a.id]={value:null,isEditable:!a.isYearEnd,source:"manual"};return I(S,b,s)}),b})},[s]),C=p.useCallback(r=>{i(d=>d.filter(x=>x.id!==r)),n(d=>{const x={...d};return delete x[r],x})},[]),j=p.useCallback(r=>{const d=`col_${Date.now()}`,x={id:d,label:r};m(f=>{const b=f.findIndex(S=>S.isYearEnd),k=[...f];return k.splice(b,0,x),n(S=>{const a={...S};for(const y of t)a[y.id]={...a[y.id]},a[y.id][d]={value:null,isEditable:!y.isAutoCalculated,source:"manual"};return I(a,t,k)}),k})},[t]),A=p.useCallback(r=>{m(d=>{const x=d.filter(f=>f.id!==r);return n(f=>{const b={...f};for(const k of Object.keys(b)){const{[r]:S,...a}=b[k];b[k]=a}return I(b,t,x)}),x})},[t]),N=p.useCallback((r,d)=>{m(x=>x.map(f=>f.id===r?{...f,label:d}:f))},[]),E=p.useCallback(r=>{if(!l)return;const d=t.filter(a=>!a.isAutoCalculated),x=s.filter(a=>!a.isYearEnd),f=d.findIndex(a=>a.id===l.row),b=x.findIndex(a=>a.id===l.col);if(f===-1||b===-1)return;let k=f,S=b;switch(r){case"up":k=Math.max(0,f-1);break;case"down":k=Math.min(d.length-1,f+1);break;case"left":S=Math.max(0,b-1);break;case"right":S=Math.min(x.length-1,b+1);break}u({row:d[k].id,col:x[S].id})},[l,t,s]),D=p.useCallback(async r=>{if(r)try{const d={year:new Date().getFullYear(),data:h,rows:t,columns:s},x=localStorage.getItem("auth_token");if(!(await fetch("undefined/api/financial-summary/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify(d)})).ok)throw new Error("Failed to save")}catch(d){throw console.error("Save failed",d),d}},[h,t,s]);return{rows:t,columns:s,data:h,activeCell:l,setActiveCell:u,updateCell:c,addRow:v,deleteRow:C,addColumn:j,deleteColumn:A,renameColumn:N,navigateCell:E,saveData:D,updateRowFormula:g}}function xe(o){let t="",i=o;for(;i>=0;)t=String.fromCharCode(65+i%26)+t,i=Math.floor(i/26)-1;return t}const ge={database:{bg:"border-l-blue-500",border:"border-l-2",label:"Database"},manual:{bg:"border-l-transparent",border:"",label:"Manual"},formula:{bg:"border-l-orange-500",border:"border-l-2",label:"Formula"},calculated:{bg:"border-l-emerald-500",border:"border-l-2",label:"Calculated"}};function le(o,t){return o===null||o===0?"":t.isPercentage?`${o.toFixed(2)}%`:t.isCurrency?`Â£${o.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}`:o.toLocaleString("en-GB",{maximumFractionDigits:2})}function oe({source:o}){if(!o||o==="manual")return null;const t={database:"border-t-blue-500 border-r-blue-500",formula:"border-t-orange-500 border-r-orange-500",calculated:"border-t-emerald-500 border-r-emerald-500"};return e.jsx(ee,{delayDuration:200,children:e.jsxs(te,{children:[e.jsx(re,{asChild:!0,children:e.jsx("div",{className:O("absolute top-0 right-0 w-0 h-0 border-t-[6px] border-r-[6px] border-b-0 border-l-0 border-solid border-b-transparent border-l-transparent",t[o])})}),e.jsxs(ae,{side:"top",className:"text-xs",children:["Source: ",ge[o].label]})]})})}function ye({rowId:o,colId:t,value:i,source:s,row:m,isActive:h,isHighlighted:n,onFocus:l,onUpdate:u,onNavigate:c}){const[g,v]=p.useState(!1),[C,j]=p.useState(""),A=p.useRef(null),N=p.useCallback(()=>{v(!0),j(i!==null?String(i):""),setTimeout(()=>{var r;return(r=A.current)==null?void 0:r.focus()},0)},[i]),E=p.useCallback(()=>{v(!1);const r=parseFloat(C);u(C===""?null:isNaN(r)?i:r)},[C,u,i]),D=r=>{g?r.key==="Enter"||r.key==="Tab"?(r.preventDefault(),E(),c(r.shiftKey?"up":"down")):r.key==="Escape"&&v(!1):r.key==="Enter"||r.key==="F2"?(r.preventDefault(),N()):r.key==="ArrowUp"?(r.preventDefault(),c("up")):r.key==="ArrowDown"?(r.preventDefault(),c("down")):r.key==="ArrowLeft"?(r.preventDefault(),c("left")):r.key==="ArrowRight"?(r.preventDefault(),c("right")):r.key==="Delete"||r.key==="Backspace"?(r.preventDefault(),u(null)):/^[0-9.\-]$/.test(r.key)&&(r.preventDefault(),j(r.key),v(!0),setTimeout(()=>{var d;return(d=A.current)==null?void 0:d.focus()},0))};return e.jsxs("td",{className:O("relative border-r border-b border-border/40 px-2 py-[5px] text-right text-[13px] min-w-[120px] cursor-cell select-none transition-all duration-75",h&&"outline outline-2 outline-primary z-10 bg-primary/5",n&&"ring-2 ring-orange-400/70 bg-orange-50/30 dark:bg-orange-950/20",!h&&!n&&"hover:bg-muted/30"),onClick:l,onDoubleClick:N,onKeyDown:D,tabIndex:0,onFocus:l,children:[e.jsx(oe,{source:s}),g?e.jsx("input",{ref:A,type:"text",value:C,onChange:r=>j(r.target.value),onBlur:E,className:"w-full bg-background text-right outline-none text-[13px] font-mono border border-primary/30 rounded px-1 -mx-1"}):e.jsx("span",{className:"font-mono text-[13px] text-foreground/90",children:le(i,m)})]})}function Ce({value:o,row:t,source:i,isHighlighted:s}){return e.jsxs("td",{className:O("relative border-r border-b border-border/40 px-2 py-[5px] text-right text-[13px] min-w-[120px] select-none",t.isHeader?"bg-primary/[0.06] font-semibold":"bg-muted/20",s&&"ring-2 ring-orange-400/70 bg-orange-50/30 dark:bg-orange-950/20"),children:[e.jsx(oe,{source:i}),e.jsx("span",{className:O("font-mono text-[13px]",t.isHeader?"text-foreground font-semibold":"text-muted-foreground"),children:le(o,t)})]})}function _e({isOpen:o,onClose:t,row:i,initialFormula:s,onSave:m}){const[h,n]=p.useState(s);return p.useEffect(()=>{n(s)},[s]),i?e.jsx(B,{open:o,onOpenChange:l=>!l&&t(),children:e.jsxs(Y,{children:[e.jsx(V,{children:e.jsxs(K,{children:["Edit Formula: ",i.label]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ue,{htmlFor:"formula",className:"text-right",children:"Formula"}),e.jsx(z,{id:"formula",value:h,onChange:l=>n(l.target.value),className:"col-span-3 font-mono"})]}),e.jsx("div",{className:"text-xs text-muted-foreground ml-[25%]",children:"Supported: A1, B2, +, -, *, /, ( )"})]}),e.jsx(W,{children:e.jsx(T,{type:"submit",onClick:()=>m(h),children:"Save changes"})})]})}):null}function ve({rows:o,columns:t,data:i,activeCell:s,setActiveCell:m,updateCell:h,deleteRow:n,deleteColumn:l,navigateCell:u,onRenameColumn:c,updateRowFormula:g}){const[v,C]=p.useState(null),[j,A]=p.useState(""),[N,E]=p.useState(null),D=p.useRef(null),[r,d]=p.useState(null),x=a=>{C(a.id),A(a.label),setTimeout(()=>{var y;return(y=D.current)==null?void 0:y.focus()},0)},f=()=>{v&&c&&c(v,j),C(null)},b=a=>{d(a)},k=a=>{if(r&&g){const y=me(a,o,t,t[0].id);g(r.id,y)}d(null)},S=p.useMemo(()=>{if(!N)return new Set;const a=o.find(w=>w.id===N),y=a==null?void 0:a.formulaString;if(!y){const w=["cost_sales_se","cost_sales_paye","employee_ni","employee_pension"],_=["apprenticeship_levy","annual_leave","other_expenses","recruitment_cost","overheads_mgmt","bank_interest","cooperation_tax"],P={total_cost_sales:w,total_overheads:_,total_cost:[...w,..._],gross_hourly_margin:["avg_hourly_charge","gross_hourly_pay"],hours_breakeven:["total_cost","gross_hourly_margin"],value_breakeven:["hours_breakeven","avg_hourly_charge"],sales_budget_2026:["total_sales"],gross_pl_value:["total_sales","total_cost"],net_pl:["gross_pl_value","total_overheads"]}[N]||[],R=new Set;for(const F of P)for(const M of t)R.add(`${F}:${M.id}`);return R}if(y){const w=q(y,o,t,t[0].id),_=new Set,$=/\b[A-Z]+[0-9]+\b/g;let P;for(;(P=$.exec(w))!==null;){const R=se(P[0]);if(R){const F=o[R.rowIdx],M=t[R.colIdx];F&&M&&_.add(`${F.id}:${M.id}`)}}return _}return new Set},[N,o,t]);return e.jsxs("div",{className:"border border-border rounded-md bg-card overflow-hidden shadow-sm",children:[e.jsx("div",{className:"overflow-auto max-h-[calc(100vh-200px)]",children:e.jsxs("table",{className:"border-collapse w-full",children:[e.jsxs("thead",{className:"sticky top-0 z-30",children:[e.jsxs("tr",{className:"bg-muted/60",children:[e.jsx("th",{className:"sticky left-0 z-40 bg-muted/80 border-r border-b border-border/50 w-10 min-w-[40px]"}),e.jsx("th",{className:"sticky left-10 z-40 bg-muted/80 border-r border-b border-border/50 w-[200px] min-w-[200px]"}),t.map((a,y)=>e.jsx("th",{className:"border-r border-b border-border/50 px-1 py-1 text-center text-[11px] font-medium text-muted-foreground bg-muted/60 min-w-[120px]",children:xe(y)},y)),e.jsx("th",{className:"bg-muted/60 border-b border-border/50 w-8"})]}),e.jsxs("tr",{className:"bg-muted/40",children:[e.jsx("th",{className:"sticky left-0 z-40 bg-muted/60 border-r border-b border-border/50 w-10 min-w-[40px] text-[10px] text-muted-foreground font-medium",children:"#"}),e.jsx("th",{className:"sticky left-10 z-40 bg-muted/60 border-r border-b border-border/50 px-3 py-2 text-left text-[11px] font-semibold text-muted-foreground uppercase tracking-wider w-[200px] min-w-[200px]",children:"Description"}),t.map(a=>e.jsx("th",{className:O("border-r border-b border-border/50 px-1 py-2 text-center text-[11px] font-semibold uppercase tracking-wide min-w-[120px]",a.isYearEnd?"bg-primary/10 text-primary":"bg-muted/40 text-muted-foreground"),onDoubleClick:()=>!a.isProtected&&x(a),children:e.jsx("div",{className:"flex items-center justify-center gap-1 group relative",children:v===a.id?e.jsx("input",{ref:D,value:j,onChange:y=>A(y.target.value),onBlur:f,onKeyDown:y=>y.key==="Enter"&&f(),className:"w-full bg-background border border-border rounded px-1 text-center text-[11px]"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"truncate",children:a.label}),!a.isProtected&&e.jsx(T,{variant:"ghost",size:"icon",className:"h-4 w-4 opacity-0 group-hover:opacity-100 absolute -right-1 hover:text-destructive",onClick:y=>{y.stopPropagation(),l(a.id)},children:e.jsx(J,{className:"h-3 w-3"})})]})})},a.id)),e.jsx("th",{className:"bg-muted/40 border-b border-border/50 w-8"})]})]}),e.jsx("tbody",{children:o.map((a,y)=>e.jsxs("tr",{className:O("group",a.isHeader&&"bg-primary/[0.04]"),onMouseEnter:()=>(a.isAutoCalculated||a.formulaString)&&E(a.id),onMouseLeave:()=>E(null),children:[e.jsx("td",{className:"sticky left-0 z-10 bg-muted/60 border-r border-b border-border/50 text-center text-[11px] text-muted-foreground font-medium w-10 min-w-[40px] select-none",children:y+1}),e.jsx("td",{className:O("sticky left-10 z-10 border-r border-b border-border/50 px-3 py-[5px] whitespace-nowrap text-[13px] truncate max-w-[200px] w-[200px] min-w-[200px] bg-card",a.isHeader&&"font-bold text-primary bg-primary/[0.04]",a.isAutoCalculated&&!a.isHeader&&"text-muted-foreground italic"),title:a.label,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"truncate",children:a.label}),(a.isAutoCalculated||a.formulaString)&&e.jsx(ee,{delayDuration:200,children:e.jsxs(te,{children:[e.jsx(re,{asChild:!0,children:e.jsx("button",{className:"opacity-0 group-hover:opacity-70 hover:!opacity-100 transition-opacity",onClick:()=>b(a),children:e.jsx(ce,{className:"h-3.5 w-3.5 text-orange-500"})})}),e.jsx(ae,{side:"right",className:"text-xs",children:"Edit formula"})]})})]})}),t.map(w=>{var F;const _=(F=i[a.id])==null?void 0:F[w.id],$=(_==null?void 0:_.isEditable)&&!a.isAutoCalculated&&!w.isYearEnd,P=`${a.id}:${w.id}`,R=S.has(P);return $?e.jsx(ye,{rowId:a.id,colId:w.id,value:(_==null?void 0:_.value)??null,source:_==null?void 0:_.source,row:a,isActive:(s==null?void 0:s.row)===a.id&&(s==null?void 0:s.col)===w.id,isHighlighted:R,onFocus:()=>m({row:a.id,col:w.id}),onUpdate:M=>h(a.id,w.id,M),onNavigate:u},w.id):e.jsx(Ce,{value:(_==null?void 0:_.value)??null,row:a,source:_==null?void 0:_.source,isHighlighted:R},w.id)}),e.jsx("td",{className:"border-b border-border/40 bg-card w-8 text-center p-0",children:!a.isAutoCalculated&&e.jsx(T,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:text-destructive hover:bg-destructive/10",onClick:()=>n(a.id),children:e.jsx(J,{className:"h-3 w-3"})})})]},a.id))})]})}),r&&e.jsx(_e,{isOpen:!0,onClose:()=>d(null),row:r,initialFormula:q(r.formulaString||"",o,t,t[0].id),onSave:k})]})}function De(){const{rows:o,columns:t,data:i,activeCell:s,setActiveCell:m,updateCell:h,addRow:n,deleteRow:l,addColumn:u,deleteColumn:c,navigateCell:g,updateRowFormula:v}=he(),[C,j]=p.useState(""),[A,N]=p.useState(""),[E,D]=p.useState(!1),[r,d]=p.useState(!1),x=()=>{C.trim()&&(n(C.trim()),j(""),D(!1))},f=()=>{A.trim()&&(u(A.trim()),N(""),d(!1))};return e.jsx(ie,{noPadding:!0,fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-card/50 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(de,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Financial Summary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Annual budget and performance spreadsheet"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(B,{open:E,onOpenChange:D,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",children:[e.jsx(G,{className:"h-4 w-4 mr-1"})," Add Row"]})}),e.jsxs(Y,{children:[e.jsx(V,{children:e.jsx(K,{children:"Add New Row"})}),e.jsx(z,{placeholder:"Row label...",value:C,onChange:b=>j(b.target.value),onKeyDown:b=>b.key==="Enter"&&x()}),e.jsx(W,{children:e.jsx(T,{onClick:x,disabled:!C.trim(),children:"Add"})})]})]}),e.jsxs(B,{open:r,onOpenChange:d,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",children:[e.jsx(G,{className:"h-4 w-4 mr-1"})," Add Column"]})}),e.jsxs(Y,{children:[e.jsx(V,{children:e.jsx(K,{children:"Add New Column"})}),e.jsx(z,{placeholder:"Column label...",value:A,onChange:b=>N(b.target.value),onKeyDown:b=>b.key==="Enter"&&f()}),e.jsx(W,{children:e.jsx(T,{onClick:f,disabled:!A.trim(),children:"Add"})})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx(ve,{rows:o,columns:t,data:i,activeCell:s,setActiveCell:m,updateCell:h,deleteRow:l,deleteColumn:c,navigateCell:g,updateRowFormula:v})})]})})}export{De as default};
