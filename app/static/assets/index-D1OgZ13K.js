import{c as Ne,r as p,a as Ce,b as ke,d as he,j as e,P as te,e as ne,f as Pe,g as we,h as Se,i as q,R as k,T as Ee,k as Te,l as Ae,m as Me,n as xe}from"./index-B2rzTr7p.js";import{D as Oe}from"./DashboardLayout-BfiZPXHo.js";import{A as Z}from"./api-Da72sVOF.js";import{f as J,P as G,a as W,g as oe,b as X,C as ae,c as ie,i as le,d as Fe}from"./locationUtils-CqmqV0ov.js";import{B as H}from"./button-CWN-pghO.js";import{u as Re,C as T,a as D,b as ee,d as A}from"./UserContext-CiO66Kvx.js";import{u as He,C as Ie,a as ce}from"./index-DRYE98-r.js";import{R as _e,A as $e,C as Le,X as qe,Y as Be,T as Ye,L as ze,a as de,b as Ke}from"./AreaChart-DwZG_4VE.js";import"./users-DDAS6rlP.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=Ne("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),Ge=t=>{const[i,l]=p.useState(null),[o,c]=p.useState(!1),{toast:a}=Ce(),r=async()=>{c(!0);try{const d=new URLSearchParams({start:J(t.from,"yyyy-MM-dd"),end:J(t.to,"yyyy-MM-dd")});console.log("Fetching sales data with params:",d.toString());const s=await fetch(`${Z.SALES_SUMMARY}?${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(s.ok){const u=await s.json();console.log("DASHBOARD DATA RECEIVED:",u),l(u)}else console.error("Dashboard fetch failed:",s.status,s.statusText),a({title:"Error",description:"Could not fetch data from server",variant:"destructive"})}catch(d){console.error("Dashboard fetch error:",d),a({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{c(!1)}};return p.useEffect(()=>{r()},[t]),{salesData:i,isLoading:o,refetch:r}},We=(t,i)=>{var P,f,j,S,E,O,g,F,C,I,B,Y,z,K,U;if(!t)return{revenue:{value:0,change:0,trend:"neutral",text:"No data available"},clientPay:{value:0,change:0,trend:"neutral",text:"No data available"},staffPay:{value:0,change:0,trend:"neutral",text:"No data available"},totalShifts:{value:0,change:0,trend:"neutral",text:"No data available"},paidHours:{value:0,change:0,trend:"neutral",text:"No data available"},uniqueEmployees:{value:0,change:0,trend:"neutral",text:"No data available"},avgShiftDuration:{value:0,change:0,trend:"neutral",text:"No data available"},totalClients:{value:0,change:0,trend:"neutral",text:"No data available"}};const l=t.totalRevenue||0,o=t.avgClientPayPerHour||0,c=t.avgStaffPayPerHour||0,a=((P=t.previousPeriod)==null?void 0:P.totalRevenue)||0,r=((f=t.previousPeriod)==null?void 0:f.avgClientPayPerHour)||0,d=((j=t.previousPeriod)==null?void 0:j.avgStaffPayPerHour)||0,s=(w,R)=>R>0?(w-R)/R*100:0,u=s(l,a),N=s(o,r),v=s(c,d),h=w=>w>0?"up":w<0?"down":"neutral",b=(w,R,n)=>{if(!R)return"No previous data";let x="";return n<=7?x="last week":n<=31?x="last month":n<=93?x="last quarter":x="last period",`${w>0?"+":""}${Math.abs(w).toFixed(1)}% from ${x}`},m=Math.ceil((i.to.getTime()-i.from.getTime())/(1e3*60*60*24)),y=!!t.previousPeriod;return{revenue:{value:l,change:u,trend:h(u),text:b(u,y,m)},clientPay:{value:o,change:N,trend:h(N),text:b(N,y,m)},staffPay:{value:c,change:v,trend:h(v),text:b(v,y,m)},totalShifts:{value:t.totalShifts,change:s(t.totalShifts,((S=t.previousPeriod)==null?void 0:S.totalShifts)||0),trend:h(s(t.totalShifts,((E=t.previousPeriod)==null?void 0:E.totalShifts)||0)),text:b(s(t.totalShifts,((O=t.previousPeriod)==null?void 0:O.totalShifts)||0),y,m)},paidHours:{value:t.totalPaidHours||0,change:s(t.totalPaidHours||0,((g=t.previousPeriod)==null?void 0:g.totalPaidHours)||0)||0,trend:h(s(t.totalPaidHours||0,((F=t.previousPeriod)==null?void 0:F.totalPaidHours)||0)),text:b(s(t.totalPaidHours||0,((C=t.previousPeriod)==null?void 0:C.totalPaidHours)||0),y,m)},uniqueEmployees:{value:t.uniqueEmployees,change:s(t.uniqueEmployees,((I=t.previousPeriod)==null?void 0:I.uniqueEmployees)||0),trend:h(s(t.uniqueEmployees,((B=t.previousPeriod)==null?void 0:B.uniqueEmployees)||0)),text:b(s(t.uniqueEmployees,((Y=t.previousPeriod)==null?void 0:Y.uniqueEmployees)||0),y,m)},avgShiftDuration:{value:t.totalPaidHours&&t.totalShifts?t.totalPaidHours/t.totalShifts:0,change:0,trend:"neutral",text:"Average hours per shift"},totalClients:{value:t.totalClients,change:s(t.totalClients,((z=t.previousPeriod)==null?void 0:z.totalClients)||0),trend:h(s(t.totalClients,((K=t.previousPeriod)==null?void 0:K.totalClients)||0)),text:b(s(t.totalClients,((U=t.previousPeriod)==null?void 0:U.totalClients)||0),y,m)}}};var Q="Checkbox",[Xe,xt]=ke(Q),[Ve,re]=Xe(Q);function Je(t){const{__scopeCheckbox:i,checked:l,children:o,defaultChecked:c,disabled:a,form:r,name:d,onCheckedChange:s,required:u,value:N="on",internal_do_not_use_render:v}=t,[h,b]=Se({prop:l,defaultProp:c??!1,onChange:s,caller:Q}),[m,y]=p.useState(null),[P,f]=p.useState(null),j=p.useRef(!1),S=m?!!r||!!m.closest("form"):!0,E={checked:h,disabled:a,setChecked:b,control:m,setControl:y,name:d,form:r,value:N,hasConsumerStoppedPropagationRef:j,required:u,defaultChecked:M(c)?!1:c,isFormControl:S,bubbleInput:P,setBubbleInput:f};return e.jsx(Ve,{scope:i,...E,children:Qe(v)?v(E):o})}var me="CheckboxTrigger",fe=p.forwardRef(({__scopeCheckbox:t,onKeyDown:i,onClick:l,...o},c)=>{const{control:a,value:r,disabled:d,checked:s,required:u,setControl:N,setChecked:v,hasConsumerStoppedPropagationRef:h,isFormControl:b,bubbleInput:m}=re(me,t),y=he(c,N),P=p.useRef(s);return p.useEffect(()=>{const f=a==null?void 0:a.form;if(f){const j=()=>v(P.current);return f.addEventListener("reset",j),()=>f.removeEventListener("reset",j)}},[a,v]),e.jsx(te.button,{type:"button",role:"checkbox","aria-checked":M(s)?"mixed":s,"aria-required":u,"data-state":be(s),"data-disabled":d?"":void 0,disabled:d,value:r,...o,ref:y,onKeyDown:ne(i,f=>{f.key==="Enter"&&f.preventDefault()}),onClick:ne(l,f=>{v(j=>M(j)?!0:!j),m&&b&&(h.current=f.isPropagationStopped(),h.current||f.stopPropagation())})})});fe.displayName=me;var se=p.forwardRef((t,i)=>{const{__scopeCheckbox:l,name:o,checked:c,defaultChecked:a,required:r,disabled:d,value:s,onCheckedChange:u,form:N,...v}=t;return e.jsx(Je,{__scopeCheckbox:l,checked:c,defaultChecked:a,disabled:d,required:r,onCheckedChange:u,name:o,form:N,value:s,internal_do_not_use_render:({isFormControl:h})=>e.jsxs(e.Fragment,{children:[e.jsx(fe,{...v,ref:i,__scopeCheckbox:l}),h&&e.jsx(ge,{__scopeCheckbox:l})]})})});se.displayName=Q;var pe="CheckboxIndicator",ve=p.forwardRef((t,i)=>{const{__scopeCheckbox:l,forceMount:o,...c}=t,a=re(pe,l);return e.jsx(Pe,{present:o||M(a.checked)||a.checked===!0,children:e.jsx(te.span,{"data-state":be(a.checked),"data-disabled":a.disabled?"":void 0,...c,ref:i,style:{pointerEvents:"none",...t.style}})})});ve.displayName=pe;var je="CheckboxBubbleInput",ge=p.forwardRef(({__scopeCheckbox:t,...i},l)=>{const{control:o,hasConsumerStoppedPropagationRef:c,checked:a,defaultChecked:r,required:d,disabled:s,name:u,value:N,form:v,bubbleInput:h,setBubbleInput:b}=re(je,t),m=he(l,b),y=He(a),P=we(o);p.useEffect(()=>{const j=h;if(!j)return;const S=window.HTMLInputElement.prototype,O=Object.getOwnPropertyDescriptor(S,"checked").set,g=!c.current;if(y!==a&&O){const F=new Event("click",{bubbles:g});j.indeterminate=M(a),O.call(j,M(a)?!1:a),j.dispatchEvent(F)}},[h,y,a,c]);const f=p.useRef(M(a)?!1:a);return e.jsx(te.input,{type:"checkbox","aria-hidden":!0,defaultChecked:r??f.current,required:d,disabled:s,name:u,value:N,form:v,...i,tabIndex:-1,ref:m,style:{...i.style,...P,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ge.displayName=je;function Qe(t){return typeof t=="function"}function M(t){return t==="indeterminate"}function be(t){return M(t)?"indeterminate":t?"checked":"unchecked"}const L=p.forwardRef(({className:t,...i},l)=>e.jsx(se,{ref:l,className:q("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...i,children:e.jsx(ve,{className:q("flex items-center justify-center text-current"),children:e.jsx(Ie,{className:"h-4 w-4"})})}));L.displayName=se.displayName;const Ze=({dateRange:t,onDateRangeChange:i,calendarOpen:l,onCalendarOpenChange:o,tempDateRange:c,onTempDateRangeChange:a,selectedLocations:r=[],onLocationsChange:d,selectedSites:s=[],onSitesChange:u})=>{const{role:N,locations:v}=Re(),[h,b]=k.useState([]),[m,y]=k.useState([]),[P,f]=k.useState(!1),[j,S]=k.useState(!1);k.useEffect(()=>{(async()=>{try{const x=await fetch(`${Z.SALES_SUMMARY.replace("sales-summary","locations")}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(x.ok){const _=await x.json();b(N==="admin"?_:_.filter($=>v.includes($)))}}catch(x){console.error("Failed to fetch locations:",x)}})()},[N,v]),k.useEffect(()=>{u&&(async()=>{try{const x=new URLSearchParams;r.length>0&&r.forEach($=>x.append("locations",$));const _=await fetch(`${Z.SITES}?${x}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(_.ok){const $=await _.json();y($)}}catch(x){console.error("Failed to fetch sites:",x)}})()},[r,u]);const E=n=>{d&&(r.includes(n)?d(r.filter(x=>x!==n)):d([...r,n]))},O=n=>{u&&(s.includes(n)?u(s.filter(x=>x!==n)):u([...s,n]))},[g,F]=k.useState(t==null?void 0:t.from),[C,I]=k.useState(t==null?void 0:t.to),[B,Y]=k.useState(!1),[z,K]=k.useState(!1);k.useEffect(()=>{F(t==null?void 0:t.from),I(t==null?void 0:t.to)},[t]);const U=n=>{n&&(F(n),C&&le(n,C)&&I(void 0))},w=n=>{n&&I(n)},R=()=>{g&&C&&i({from:g,to:C})};return e.jsx("div",{className:"sticky top-0 z-40 bg-background border-b border-border",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Overview of your analytics"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end justify-start sm:justify-end flex-1",children:[d&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Location"}),e.jsxs(G,{open:P,onOpenChange:f,children:[e.jsx(W,{asChild:!0,children:e.jsxs(H,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:e.jsx("span",{className:"truncate",children:r.length===0?"All Locations":r.length===1?oe(r[0]):`${r.length} locations`})}),e.jsx(ce,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),e.jsx(X,{className:"w-[200px] p-0",align:"start",children:e.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:n=>{n.stopPropagation(),r.length===h.length?d([]):d(h)},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:h.length>0&&r.length===h.length,className:"pointer-events-none"}),e.jsx("span",{className:"text-sm font-medium",children:"All Locations"})]}),r.length>0&&e.jsx(H,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:n=>{n.stopPropagation(),d([])},children:"Clear"})]}),e.jsx("div",{className:"h-px bg-border my-1"}),e.jsx(Ee,{children:h.map(n=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:x=>{x.stopPropagation(),E(n)},children:[e.jsx(L,{checked:r.includes(n),className:"pointer-events-none"}),e.jsxs(Te,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx("span",{className:"text-sm truncate font-medium",children:oe(n)})}),e.jsx(Me,{side:"right",children:e.jsx("p",{children:n})})]})]},n))})]})})]})]}),u&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Site"}),e.jsxs(G,{open:j,onOpenChange:S,children:[e.jsx(W,{asChild:!0,children:e.jsxs(H,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:e.jsx("span",{className:"truncate",children:s.length===0?"All Sites":`${s.length} sites`})}),e.jsx(ce,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),e.jsx(X,{className:"w-[200px] p-0",align:"start",children:e.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:n=>{n.stopPropagation(),s.length===m.length?u([]):u(m)},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{checked:m.length>0&&s.length===m.length,className:"pointer-events-none"}),e.jsx("span",{className:"text-sm font-medium",children:"All Sites"})]}),s.length>0&&e.jsx(H,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:n=>{n.stopPropagation(),u([])},children:"Clear"})]}),e.jsx("div",{className:"h-px bg-border my-1"}),m.map(n=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:x=>{x.stopPropagation(),O(n)},children:[e.jsx(L,{checked:s.includes(n),className:"pointer-events-none"}),e.jsx("span",{className:"text-sm truncate font-medium",children:n})]},n))]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"From Date"}),e.jsxs(G,{open:B,onOpenChange:Y,children:[e.jsx(W,{asChild:!0,children:e.jsxs(H,{variant:"outline",className:q("w-[140px] justify-start text-left font-normal",!g&&"text-muted-foreground"),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),g?J(g,"LLL dd, y"):"From"]})}),e.jsx(X,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(ie,{mode:"single",selected:g,onSelect:U,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:n=>C?le(n,C):!1,className:"rounded-md border"})})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Till Date"}),e.jsxs(G,{open:z,onOpenChange:K,children:[e.jsx(W,{asChild:!0,children:e.jsxs(H,{variant:"outline",className:q("w-[140px] justify-start text-left font-normal",!C&&"text-muted-foreground"),disabled:!g,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),C?J(C,"LLL dd, y"):"To"]})}),e.jsx(X,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(ie,{mode:"single",selected:C,onSelect:w,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:g?g.getFullYear():new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:n=>g?Fe(n,g):!1,className:"rounded-md border"})})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 pb-0.5",children:[e.jsx("div",{className:"h-4"})," ",e.jsx(H,{onClick:R,disabled:!g||!C,className:"",children:"Apply"})]})]})]})})})};function V({title:t,value:i,change:l,trend:o="neutral"}){return e.jsxs(T,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(D,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(ee,{className:"text-sm font-medium text-muted-foreground",children:t})}),e.jsxs(A,{children:[e.jsx("div",{className:"text-2xl font-bold",children:i}),l&&e.jsx("p",{className:q("text-xs mt-1",o==="up"&&"text-accent",o==="down"&&"text-destructive",o==="neutral"&&"text-muted-foreground"),children:l})]})]})}const De=({metrics:t,totalOverhead:i})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(V,{title:"Total Revenue",value:`£${t.revenue.value.toLocaleString()}`,change:t.revenue.text,trend:t.revenue.trend}),e.jsx(V,{title:"Average Client Pay",value:`£${t.clientPay.value.toFixed(2)}`,change:t.clientPay.text,trend:t.clientPay.trend}),e.jsx(V,{title:"Average Staff Pay",value:`£${t.staffPay.value.toFixed(2)}`,change:t.staffPay.text,trend:t.staffPay.trend}),e.jsx(V,{title:"Total Overheads",value:`£${(i||0).toLocaleString()}`,change:"Fixed costs for period",trend:"neutral"})]});function ye(t,i){try{let l=t;for(const[c,a]of Object.entries(i)){const r=new RegExp(`\\b${c}\\b`,"g");l=l.replace(r,String(a))}const o=new Function(`'use strict'; return (${l})`)();return typeof o!="number"||!isFinite(o)?null:o}catch(l){return console.error("Formula evaluation error:",l),null}}function ue(t){return t.replace(/([+\-*/])/g," $1 ").replace(/\s+/g," ").trim()}const et=({salesData:t})=>{var o;const{customMetrics:i}=xe(),l=t?{Revenue:t.totalRevenue,Cost:t.totalCost,Overheads:t.totalOverhead||0,PaidHours:t.totalPaidHours,TotalShifts:t.totalShifts,ActiveClients:t.totalClients}:{Revenue:0,Cost:0,Overheads:0,PaidHours:0,TotalShifts:0,ActiveClients:0};return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.totalShifts)||0})]})})})}),e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.totalClients)||0})]})})})}),e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(t==null?void 0:t.uniqueEmployees)||0})]})})})}),e.jsx(T,{children:e.jsx(A,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((o=t==null?void 0:t.profitMargin)==null?void 0:o.toFixed(1))||0,"%"]})]})})})}),i.map(c=>{const a=ye(c.formula,l);return e.jsx(T,{className:"border-dashed border-primary/50 bg-primary/5",children:e.jsx(A,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:c.name}),e.jsx(Ue,{className:"h-3 w-3 text-primary/70"})]}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:a!==null?a.toLocaleString(void 0,{maximumFractionDigits:2}):"N/A"}),e.jsx("p",{className:"text-[10px] text-muted-foreground font-mono mt-1 opacity-70 truncate max-w-[150px]",title:ue(c.formula),children:ue(c.formula)})]})})})},c.id)})]})},tt=({active:t,payload:i,label:l})=>t&&i&&i.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:l}),i.map((o,c)=>e.jsxs("p",{className:"text-sm",style:{color:o.stroke||o.fill||o.color},children:[o.name,": ",typeof o.value=="number"?`£${o.value.toLocaleString()}`:o.value]},c))]}):null,rt=({data:t,aggregationLevel:i})=>{const{customMetrics:l}=xe(),o={dataKey:"display",interval:0},c=t==null?void 0:t.map(r=>{const d={Revenue:r.revenue,Cost:r.cost,Overheads:0,PaidHours:r.paidHours,TotalShifts:r.totalShifts,ActiveClients:0},s={};return l.forEach(u=>{s[u.id]=ye(u.formula,d)}),{...r,...s}});if(!t||t.length===0)return e.jsxs(T,{children:[e.jsx(D,{children:e.jsx(ee,{children:"Revenue vs Cost Trend"})}),e.jsx(A,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const a=["#f59e0b","#8b5cf6","#ec4899","#14b8a6","#f43f5e"];return e.jsxs(T,{children:[e.jsxs(D,{children:[e.jsx(ee,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i==="daily"&&"Daily view",i==="weekly"&&"Weekly view",i==="monthly"&&"Monthly view"]})]}),e.jsx(A,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(_e,{width:"100%",height:"100%",children:e.jsxs($e,{data:c,children:[e.jsx(Le,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:o.dataKey,tick:{fontSize:12},interval:o.interval}),e.jsx(Be,{}),e.jsx(Ye,{content:e.jsx(tt,{})}),e.jsx(ze,{}),e.jsx(de,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(de,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2}),l.map((r,d)=>e.jsx(Ke,{type:"monotone",dataKey:r.id,name:r.name,stroke:a[d%a.length],strokeWidth:2,dot:!1,activeDot:{r:6}},r.id))]})})})})]})},st=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})});function mt(){const[t,i]=p.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[l,o]=p.useState(!1),[c,a]=p.useState(t),{salesData:r,isLoading:d}=Ge(t),s=We(r,t);return e.jsx(Oe,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(Ze,{dateRange:t,onDateRangeChange:i,calendarOpen:l,onCalendarOpenChange:o,tempDateRange:c,onTempDateRangeChange:a}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[d&&e.jsx(st,{}),e.jsx(De,{metrics:s}),e.jsx(et,{salesData:r}),e.jsx(rt,{data:(r==null?void 0:r.timeSeries)||[],aggregationLevel:(r==null?void 0:r.aggregationLevel)||"monthly"})]})})]})})}export{mt as default};
