import{c as ss,h as as,r as o,U as ts,p as rs,j as e,v as ns,P as te,q as ce,w as is,e as he,B as V,I as ye,L as os,y as L,ab as ls,u as cs,d as ds,a3 as us,a4 as hs,a5 as ms,a6 as gs,a7 as xs,a8 as fs,a9 as vs,aa as js,A as se}from"./index-CduQjfCY.js";import{D as ps}from"./DashboardLayout-DPWWQriA.js";import{C as H,d as z,a as Se,b as Ce}from"./card-ioRqaZ3n.js";import{c as Te,R as ys,I as bs,P as Ns}from"./index-CtonjOow.js";import{D as Ss}from"./DashboardHeader-CipoXDMT.js";import{u as Cs,O as Ts,T as As}from"./TargetPerformanceChart-DWCTqPZK.js";import{u as Ds,L as Ls,R as Rs}from"./LoadingOverlay-ClcjxRd8.js";import{R as Ae,C as Fs,X as Ms,Y as ks,T as De,B as Is,a as Le,L as Ps}from"./generateCategoricalChart-DYdKNBXM.js";import{B as ws}from"./BarChart-Df7ezztt.js";import{P as Es,a as Os}from"./PieChart-CKsumod9.js";import{T as Re,a as Fe,b as X,c as R,d as Me,e as T,f as $s}from"./table-zybG9vsB.js";import{P as Bs}from"./pen-BPbtWMvO.js";import{T as _s}from"./trash-2-XQ2dzJ0a.js";import{D as Vs,b as Hs,c as zs,d as Gs,f as Ks,e as Us}from"./dialog-Bosee_K7.js";import{L as k}from"./label-c09oLXlv.js";import{S as Y,a as q,b as J,c as W,d as O}from"./select-Bn06BrlH.js";import{u as Ys}from"./useRecords-BUaevyqS.js";import{f as $}from"./popover-BgfOELo4.js";import"./users-DxNVybZ4.js";import"./locationUtils-qxI8rdCU.js";import"./index-BUKs9Tbx.js";import"./AreaChart-C4HoflY0.js";import"./useQuery-CU83JWAg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=ss("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var re="Tabs",[Js,Aa]=as(re,[Te]),ke=Te(),[Ws,me]=Js(re),Ie=o.forwardRef((s,r)=>{const{__scopeTabs:a,value:i,onValueChange:c,defaultValue:u,orientation:d="horizontal",dir:j,activationMode:f="automatic",...b}=s,h=ts(j),[g,v]=rs({prop:i,onChange:c,defaultProp:u??"",caller:re});return e.jsx(Ws,{scope:a,baseId:ns(),value:g,onValueChange:v,orientation:d,dir:h,activationMode:f,children:e.jsx(te.div,{dir:h,"data-orientation":d,...b,ref:r})})});Ie.displayName=re;var Pe="TabsList",we=o.forwardRef((s,r)=>{const{__scopeTabs:a,loop:i=!0,...c}=s,u=me(Pe,a),d=ke(a);return e.jsx(ys,{asChild:!0,...d,orientation:u.orientation,dir:u.dir,loop:i,children:e.jsx(te.div,{role:"tablist","aria-orientation":u.orientation,...c,ref:r})})});we.displayName=Pe;var Ee="TabsTrigger",Oe=o.forwardRef((s,r)=>{const{__scopeTabs:a,value:i,disabled:c=!1,...u}=s,d=me(Ee,a),j=ke(a),f=_e(d.baseId,i),b=Ve(d.baseId,i),h=i===d.value;return e.jsx(bs,{asChild:!0,...j,focusable:!c,active:h,children:e.jsx(te.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":b,"data-state":h?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:f,...u,ref:r,onMouseDown:ce(s.onMouseDown,g=>{!c&&g.button===0&&g.ctrlKey===!1?d.onValueChange(i):g.preventDefault()}),onKeyDown:ce(s.onKeyDown,g=>{[" ","Enter"].includes(g.key)&&d.onValueChange(i)}),onFocus:ce(s.onFocus,()=>{const g=d.activationMode!=="manual";!h&&!c&&g&&d.onValueChange(i)})})})});Oe.displayName=Ee;var $e="TabsContent",Be=o.forwardRef((s,r)=>{const{__scopeTabs:a,value:i,forceMount:c,children:u,...d}=s,j=me($e,a),f=_e(j.baseId,i),b=Ve(j.baseId,i),h=i===j.value,g=o.useRef(h);return o.useEffect(()=>{const v=requestAnimationFrame(()=>g.current=!1);return()=>cancelAnimationFrame(v)},[]),e.jsx(is,{present:c||h,children:({present:v})=>e.jsx(te.div,{"data-state":h?"active":"inactive","data-orientation":j.orientation,role:"tabpanel","aria-labelledby":f,hidden:!v,id:b,tabIndex:0,...d,ref:r,style:{...s.style,animationDuration:g.current?"0s":void 0},children:v&&u})})});Be.displayName=$e;function _e(s,r){return`${s}-trigger-${r}`}function Ve(s,r){return`${s}-content-${r}`}var Xs=Ie,He=we,ze=Oe,Ge=Be;const Qs=Xs,Ke=o.forwardRef(({className:s,...r},a)=>e.jsx(He,{ref:a,className:he("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r}));Ke.displayName=He.displayName;const B=o.forwardRef(({className:s,...r},a)=>e.jsx(ze,{ref:a,className:he("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",s),...r}));B.displayName=ze.displayName;const _=o.forwardRef(({className:s,...r},a)=>e.jsx(Ge,{ref:a,className:he("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r}));_.displayName=Ge.displayName;const Zs=({active:s,payload:r,label:a,metric:i})=>{if(s&&r&&r.length){const c=["clients","employees","shifts"].includes(i),u=r[0].value;return e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:a}),e.jsx("p",{className:"text-sm",children:c?u.toLocaleString():u.toLocaleString(void 0,{style:"currency",currency:"GBP"})})]})}return null},de=({data:s,metric:r,onBarClick:a})=>!s||s.length===0?e.jsx("div",{className:"h-[300px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No breakdown data available"})}):e.jsx(H,{children:e.jsx(z,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(Ae,{width:"100%",height:"100%",children:e.jsxs(ws,{data:s,layout:"vertical",margin:{top:5,right:30,left:40,bottom:5},children:[e.jsx(Fs,{strokeDasharray:"3 3",horizontal:!1}),e.jsx(Ms,{type:"number",hide:!0}),e.jsx(ks,{dataKey:"name",type:"category",width:120,tick:{fontSize:12}}),e.jsx(De,{content:e.jsx(Zs,{metric:r})}),e.jsx(Is,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0],onClick:a,children:s.map((i,c)=>e.jsx(Le,{fill:"hsl(var(--primary))",fillOpacity:.8+c*.05},`cell-${c}`))})]})})})})}),be=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658","#8dd1e1","#a4de6c","#d0ed57"],ea=({active:s,payload:r})=>s&&r&&r.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:r[0].name}),e.jsx("p",{className:"text-sm",children:Number(r[0].value).toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:`${(r[0].payload.percentage||0).toFixed(1)}%`})]}):null,ae=({data:s,metric:r})=>{if(!s||s.length===0)return e.jsx(H,{children:e.jsx(z,{className:"pt-6",children:e.jsx("div",{className:"h-[300px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No distribution data available"})})})});const a=[...s].sort((u,d)=>d.value-u.value),i=a.reduce((u,d)=>u+d.value,0),c=a.map(u=>({...u,percentage:i>0?u.value/i*100:0}));return e.jsx(H,{children:e.jsx(z,{className:"pt-6",children:e.jsx("div",{className:"h-[400px]",children:e.jsx(Ae,{width:"100%",height:"100%",children:e.jsxs(Es,{children:[e.jsx(Os,{data:c,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",children:c.map((u,d)=>e.jsx(Le,{fill:be[d%be.length]},`cell-${d}`))}),e.jsx(De,{content:e.jsx(ea,{})}),e.jsx(Ps,{})]})})})})})},sa=({data:s,onEdit:r,onDelete:a})=>!s||s.length===0?e.jsx("div",{className:"h-[200px] flex items-center justify-center border rounded-md",children:e.jsx("p",{className:"text-muted-foreground",children:"No overhead details available"})}):e.jsxs(H,{children:[e.jsx(Se,{children:e.jsx(Ce,{children:"Overheads Details"})}),e.jsx(z,{children:e.jsxs(Re,{children:[e.jsx(Fe,{children:e.jsxs(X,{children:[e.jsx(R,{children:"Title"}),e.jsx(R,{children:"Month"}),e.jsx(R,{children:"Location"}),e.jsx(R,{children:"Site"}),e.jsx(R,{className:"text-right",children:"Amount"}),e.jsx(R,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Me,{children:s.map(i=>e.jsxs(X,{children:[e.jsx(T,{className:"font-medium",children:i.name}),e.jsxs(T,{children:[i.month," ",i.year]}),e.jsx(T,{children:i.location||"-"}),e.jsx(T,{children:i.site||"-"}),e.jsx(T,{className:"text-right",children:i.value.toLocaleString(void 0,{style:"currency",currency:"GBP"})}),e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-500 hover:text-blue-600",onClick:()=>r(i),children:e.jsx(Bs,{className:"h-4 w-4"})}),e.jsx(V,{variant:"ghost",size:"icon",className:"h-8 w-8 text-red-500 hover:text-red-600",onClick:()=>a(i.id),children:e.jsx(_s,{className:"h-4 w-4"})})]})})]},i.id))})]})})]}),ue=["January","February","March","April","May","June","July","August","September","October","November","December"],Ne=["Rent","Salaries","Utilities","Software","Equipment","Marketing","Travel","Insurance","Taxes","Maintenance","Custom..."],aa=({open:s,onOpenChange:r,initialData:a,onSave:i})=>{var M,Z;const{data:c}=Ys(),[u,d]=o.useState(!1),[j,f]=o.useState(new Date().getFullYear()),[b,h]=o.useState(ue[new Date().getMonth()]),[g,v]=o.useState(""),[Q,p]=o.useState(""),[F,N]=o.useState(""),[I,P]=o.useState(""),[w,E]=o.useState("");o.useEffect(()=>{s&&(a?(f(a.year),h(a.month),v(a.location||""),p(a.site||""),E(a.value.toString()),Ne.includes(a.name)?(N(a.name),P("")):(N("Custom..."),P(a.name))):(f(new Date().getFullYear()),h(ue[new Date().getMonth()]),v(""),p(""),N(""),P(""),E("")))},[s,a]);const ne=async()=>{if(!g||!F||!w){L.error("Please fill in all required fields");return}const t=F==="Custom..."?I:F;if(!t){L.error("Please specify the overhead name");return}d(!0);try{await i({id:a==null?void 0:a.id,year:j,month:b,location:g,site:Q||null,name:t,value:parseFloat(w)}),r(!1)}catch(A){console.error("Failed to save overhead:",A)}finally{d(!1)}},G=((M=c==null?void 0:c.jobs)==null?void 0:M.filter(t=>t.location===g&&t.site).map(t=>t.site).filter((t,A,K)=>K.indexOf(t)===A))||[];return e.jsx(Vs,{open:s,onOpenChange:r,children:e.jsxs(Hs,{className:"sm:max-w-[500px]",children:[e.jsxs(zs,{children:[e.jsx(Gs,{children:a?"Edit Overhead":"Add Overhead"}),e.jsx(Ks,{children:a?"Update existing overhead record.":"Create a new overhead record."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Year"}),e.jsxs(Y,{value:j.toString(),onValueChange:t=>f(Number(t)),children:[e.jsx(q,{children:e.jsx(J,{})}),e.jsx(W,{children:[2024,2025,2026,2027,2028].map(t=>e.jsx(O,{value:t.toString(),children:t},t))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Month"}),e.jsxs(Y,{value:b,onValueChange:h,children:[e.jsx(q,{children:e.jsx(J,{})}),e.jsx(W,{children:ue.map(t=>e.jsx(O,{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Location"}),e.jsxs(Y,{value:g,onValueChange:t=>{v(t),p("")},children:[e.jsx(q,{children:e.jsx(J,{placeholder:"Select location..."})}),e.jsx(W,{children:Array.from(new Set((Z=c==null?void 0:c.jobs)==null?void 0:Z.map(t=>t.location).filter(Boolean))).map(t=>e.jsx(O,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Site (Optional)"}),e.jsxs(Y,{value:Q,onValueChange:p,disabled:!g||G.length===0,children:[e.jsx(q,{children:e.jsx(J,{placeholder:G.length===0?"No sites available":"Select site..."})}),e.jsxs(W,{children:[e.jsx(O,{value:"all_sites",children:"All Sites (if applicable)"}),G.map(t=>e.jsx(O,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Category"}),e.jsxs(Y,{value:F,onValueChange:N,children:[e.jsx(q,{children:e.jsx(J,{placeholder:"Select category..."})}),e.jsx(W,{children:Ne.map(t=>e.jsx(O,{value:t,children:t},t))})]})]}),F==="Custom..."&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Custom Name"}),e.jsx(ye,{placeholder:"Enter overhead name",value:I,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Value (£)"}),e.jsx(ye,{type:"number",placeholder:"0.00",value:w,onChange:t=>E(t.target.value)})]})]}),e.jsxs(Us,{children:[e.jsx(V,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(V,{onClick:ne,disabled:u,children:[u&&e.jsx(os,{className:"mr-2 h-4 w-4 animate-spin"}),"Save"]})]})]})})},Da=()=>{const{metricId:s}=ls(),r=cs(),{dateRange:a,setDateRange:i}=ds(),[c,u]=o.useState(!1),[d,j]=o.useState(a),[f,b]=o.useState([]),[h,g]=o.useState([]),[v,Q]=o.useState("trend"),[p,F]=o.useState([]),[N,I]=o.useState([]),[P,w]=o.useState(!1),[E,ne]=o.useState([]),[G,M]=o.useState(!1),[Z,t]=o.useState(null),[A,K]=o.useState(null),U=["revenue","cost","profit","employees","clientRate","staffRate","overheads"].includes(s||""),ee=["shifts","hours","clients","targetAchievement","missedTargets"].includes(s||""),ie=s==="overheads",{operationalData:S,isLoading:Ue}=Cs(a,f,h),{financialData:C,isLoading:Ye}=Ds(a,f,h),qe=U?Ye:ee?Ue:!1;console.log("MetricDetail Debug:",{metricId:s,isOperational:ee,isFinancial:U,targetsPerformanceData:E}),o.useEffect(()=>{if(s!=="missedTargets")return;(async()=>{try{const l=new URLSearchParams({start:$(a.from,"yyyy-MM-dd"),end:$(a.to,"yyyy-MM-dd")}),x={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},m=await fetch(`${se.TARGETS_PERFORMANCE}?${l.toString()}`,{headers:x});if(m.ok){const y=await m.json();ne(y)}}catch(l){console.error("Error fetching targets performance:",l)}})()},[a,s]),o.useEffect(()=>{if(v==="trend"||!s)return;(async()=>{w(!0);try{const l=new URLSearchParams({start:$(a.from,"yyyy-MM-dd"),end:$(a.to,"yyyy-MM-dd"),metric:s,limit:"20"});f&&f.length>0&&f.forEach(m=>l.append("locations",m)),h&&h.length>0&&h.forEach(m=>l.append("sites",m));const x={Authorization:`Bearer ${localStorage.getItem("auth_token")}`};if(v==="details"&&ie){const m=await fetch(`${se.FINANCIAL_METRICS_LIST}?${l.toString()}`,{headers:x});if(m.ok){const y=await m.json();I(y)}}else if(["location","site","client"].includes(v)){l.append("dimension",v);const m=await fetch(`${se.BREAKDOWN}?${l.toString()}`,{headers:x});if(m.ok){const y=await m.json();F(y)}}}catch(l){console.error("Error fetching breakdown:",l)}finally{w(!1)}})()},[v,s,a,f,h]);const Je=()=>{t(null),M(!0)},We=n=>{t(n),M(!0)},Xe=async()=>{if(A)try{const n=await fetch(`/api/admin/financial-metrics/${A}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(n.ok)L.success("Overhead deleted"),v==="details"&&I(l=>l.filter(x=>x.id!==A));else{const l=await n.json();L.error(l.error||"Failed to delete")}}catch(n){console.error(n),L.error("Failed to delete")}finally{K(null)}},Qe=async n=>{try{const l=await fetch("/api/admin/financial-metrics",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(n)});if(l.ok){L.success("Overhead saved"),M(!1);const x=new URLSearchParams({start:$(a.from,"yyyy-MM-dd"),end:$(a.to,"yyyy-MM-dd"),metric:s||"overheads",limit:"20"});f&&f.forEach(D=>x.append("locations",D)),h&&h.forEach(D=>x.append("sites",D));const m={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},y=await fetch(`${se.FINANCIAL_METRICS_LIST}?${x.toString()}`,{headers:m});if(y.ok){const D=await y.json();I(D)}}else{const x=await l.json();L.error(x.error||"Failed to save")}}catch(l){console.error(l),L.error("Failed to save")}},ge=n=>{switch(n){case"revenue":return"Revenue Analysis";case"cost":return"Cost Analysis";case"profit":return"Profit Analysis";case"shifts":return"Shifts Analysis";case"hours":return"Hours Analysis";case"clients":return"Client Analysis";case"employees":return"Employee Analysis";case"targetAchievement":return"Target Achievement Analysis";case"missedTargets":return"Missed Targets Analysis";case"clientRate":return"Client Rate Analysis";case"staffRate":return"Staff Rate Analysis";case"overheads":return"Overheads Analysis";default:return"Metric Analysis"}},Ze=(n,l)=>{var x,m,y,D,xe,fe,ve,je,pe;if(!n)return"-";switch(l){case"revenue":return`£${((x=n.revenue)==null?void 0:x.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"cost":return`£${((m=n.cost)==null?void 0:m.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"profit":const le=n.profit??n.revenue-n.cost-(n.overheads||0);return`£${(le==null?void 0:le.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;case"shifts":return((y=n.totalShifts)==null?void 0:y.toLocaleString())??0;case"hours":return((D=n.paidHours)==null?void 0:D.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"clients":return((xe=n.clientCount)==null?void 0:xe.toLocaleString())??0;case"employees":return((fe=n.paidHours)==null?void 0:fe.toLocaleString(void 0,{maximumFractionDigits:1}))??0;case"targetAchievement":return`${((ve=n.achievementPercentage)==null?void 0:ve.toFixed(1))??0}%`;case"missedTargets":return`${((je=n.achievementPercentage)==null?void 0:je.toFixed(1))??0}%`;case"clientRate":return`£${(n.revenue/n.paidHours||0).toFixed(2)}`;case"staffRate":return`£${(n.cost/n.paidHours||0).toFixed(2)}`;case"overheads":return`£${((pe=n.overheads)==null?void 0:pe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0}`;default:return"-"}},es=o.useMemo(()=>{if(!N||N.length===0)return[];const n=N.reduce((l,x)=>{const m=x.name||"Unknown";return l[m]||(l[m]=0),l[m]+=x.value,l},{});return Object.entries(n).map(([l,x])=>({name:l,value:x}))},[N]),oe=U?C==null?void 0:C.timeSeries:S==null?void 0:S.timeSeries;return e.jsx(ps,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(Ss,{dateRange:a,onDateRangeChange:i,calendarOpen:c,onCalendarOpenChange:u,tempDateRange:d,onTempDateRangeChange:j,selectedLocations:f,onLocationsChange:b,selectedSites:h,onSitesChange:g}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6 relative",children:[(qe||P)&&e.jsx(Ls,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(V,{variant:"ghost",size:"sm",onClick:()=>r(-1),className:"gap-2",children:[e.jsx(qs,{className:"h-4 w-4"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold",children:ge(s)})]}),e.jsxs(Qs,{value:v,onValueChange:Q,className:"space-y-4",children:[e.jsxs(Ke,{children:[e.jsx(B,{value:"trend",children:"Trend"}),e.jsx(B,{value:"location",children:"By Location"}),e.jsx(B,{value:"site",children:"By Site"}),!ie&&e.jsx(B,{value:"client",children:"By Client"}),ie&&e.jsx(B,{value:"details",children:"All Details"})]}),e.jsx(_,{value:"trend",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[U&&e.jsx(Rs,{data:(C==null?void 0:C.timeSeries)||[],aggregationLevel:(C==null?void 0:C.aggregationLevel)||"monthly",selectedMetric:s}),ee&&s!=="missedTargets"&&e.jsx(Ts,{data:(S==null?void 0:S.timeSeries)||[],aggregationLevel:(S==null?void 0:S.aggregationLevel)||"monthly",selectedMetric:s}),s==="missedTargets"&&e.jsx(As,{data:E}),!U&&!ee&&e.jsx(H,{children:e.jsx(z,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Metric type not recognized or data unavailable."})})}),e.jsxs(H,{children:[e.jsx(Se,{children:e.jsx(Ce,{children:"Historical Data"})}),e.jsx(z,{children:e.jsxs(Re,{children:[e.jsxs($s,{children:["Detailed historical data for ",ge(s)]}),e.jsx(Fe,{children:e.jsxs(X,{children:[e.jsx(R,{children:"Period"}),e.jsx(R,{className:"text-right",children:"Value"})]})}),e.jsx(Me,{children:oe&&oe.length>0?[...oe].reverse().map((n,l)=>e.jsxs(X,{children:[e.jsx(T,{className:"font-medium",children:n.display}),e.jsx(T,{className:"text-right font-medium",children:Ze(n,s)})]},l)):e.jsx(X,{children:e.jsx(T,{colSpan:2,className:"text-center",children:"No data available"})})})]})})]})]})}),e.jsx(_,{value:"location",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(de,{data:p,metric:s||"revenue"}),e.jsx(ae,{data:p,metric:s||"revenue"})]})}),e.jsx(_,{value:"site",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(de,{data:p,metric:s||"revenue"}),e.jsx(ae,{data:p,metric:s||"revenue"})]})}),e.jsx(_,{value:"client",children:e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsx(de,{data:p,metric:s||"revenue"}),e.jsx(ae,{data:p,metric:s||"revenue"})]})}),e.jsx(_,{value:"details",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.jsx(ae,{data:es,metric:"overheads"})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(V,{onClick:Je,className:"gap-2",children:[e.jsx(Ns,{className:"h-4 w-4"}),"Add Overhead"]})}),e.jsx(sa,{data:N,onEdit:We,onDelete:K}),e.jsx(aa,{open:G,onOpenChange:M,initialData:Z,onSave:Qe}),e.jsx(us,{open:!!A,onOpenChange:n=>!n&&K(null),children:e.jsxs(hs,{children:[e.jsxs(ms,{children:[e.jsx(gs,{children:"Are you sure?"}),e.jsx(xs,{children:"This will permanently delete this overhead record."})]}),e.jsxs(fs,{children:[e.jsx(vs,{children:"Cancel"}),e.jsx(js,{onClick:Xe,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})})]})]})]})})};export{Da as default};
