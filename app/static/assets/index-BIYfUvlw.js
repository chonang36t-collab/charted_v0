const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-VlGx81Mt.js","assets/index-BuGwpkRC.js","assets/index-Dz7HFMlA.css","assets/card-DHm1BlvI.js","assets/trending-up-afXNJhwL.js","assets/popover-Ks03JogI.js","assets/button-BCmcOhmO.js","assets/DashboardLayout-4EsVFJ9o.js","assets/users-CBClgpGX.js","assets/ChartCanvas-BrKfdJH1.js","assets/badge-_iuabmWO.js","assets/AreaChart-BWBVSYEk.js","assets/BarChart-jTTJ519X.js"])))=>i.map(i=>d[i]);
import{r as c,a as Y,j as e,b as D,S as F,_ as T}from"./index-BuGwpkRC.js";import{D as U}from"./DashboardLayout-4EsVFJ9o.js";import{L as f}from"./label-BGNYheaE.js";import{S as q,a as G,b as H,c as J,d as x}from"./select-BoFSdNKz.js";import{B as g}from"./button-BCmcOhmO.js";import{g as N,P as b,b as S,C as M,f as u,c as L,d as R}from"./popover-Ks03JogI.js";import"./users-CBClgpGX.js";const K=()=>{const[a,l]=c.useState({dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0});return{state:a,setDimensions:r=>{l(n=>({...n,dimensions:r}))},setMetrics:r=>{l(n=>({...n,metrics:r}))},setChartType:r=>{l(n=>({...n,chartType:r}))},setDateRange:r=>{l(n=>({...n,dateRange:r}))},addCustomMetric:r=>{l(n=>({...n,customMetrics:[...n.customMetrics,r]}))},setChartData:r=>{l(n=>({...n,chartData:r}))},setDraggedItem:r=>{l(n=>({...n,draggedItem:r}))}}},Q=c.lazy(()=>T(()=>import("./MetricPalette-VlGx81Mt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),W=c.lazy(()=>T(()=>import("./ChartCanvas-BrKfdJH1.js"),__vite__mapDeps([9,1,2,10,11,12])));function ne(){const{state:a,setDimensions:l,setMetrics:h,setChartType:y,setDateRange:_,setChartData:d}=K(),{toast:m}=Y(),[s,p]=c.useState({from:new Date,to:N(new Date,30)}),[r,n]=c.useState({from:new Date,to:N(new Date,30)}),[k,v]=c.useState(!1),[P,w]=c.useState(!1),A=()=>{n(s)};c.useEffect(()=>{(async()=>{if(a.dimensions.length===0||a.metrics.length===0||!(r!=null&&r.from)||!(r!=null&&r.to)){d([]);return}const o=a.dimensions[0],$=a.metrics,z=u(r.from,"yyyy-MM-dd"),V=u(r.to,"yyyy-MM-dd");try{const i=new URLSearchParams;i.append("start",z),i.append("end",V),i.append("dimension",o),$.forEach(j=>i.append("metrics",j));const C=await fetch(`/api/chart-data?${i.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(C.ok){const j=await C.json();d(j)}else console.error("Failed to fetch chart data"),d([])}catch(i){console.error("Error fetching chart data:",i),d([])}})()},[a.dimensions,a.metrics,r]);const I=t=>{t.type==="dimension"?a.dimensions.includes(t.name)||(l([t.name]),m({description:`Added ${t.name} to chart`,duration:2e3})):t.type==="metric"&&(a.metrics.includes(t.name)||(h([...a.metrics,t.name]),m({description:`Added ${t.name} to chart`,duration:2e3})))},E=t=>{t.type==="dimension"?a.dimensions.includes(t.name)&&(l(a.dimensions.filter(o=>o!==t.name)),m({description:`Removed ${t.name} from chart`,duration:2e3})):t.type==="metric"&&a.metrics.includes(t.name)&&(h(a.metrics.filter(o=>o!==t.name)),m({description:`Removed ${t.name} from chart`,duration:2e3}))},O=t=>{l(a.dimensions.filter(o=>o!==t))},B=t=>{h(a.metrics.filter(o=>o!==t))};return e.jsx(U,{children:e.jsx("div",{className:"p-4 md:p-6 h-full flex flex-col",children:e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsx("div",{className:"sticky lg:top-0 z-30 pb-4 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-2 shadow-sm bg-background",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Chart Builder"}),e.jsx("p",{className:"text-muted-foreground text-sm md:text-base",children:"Click on metrics and dimensions to build your chart"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-1",children:[e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(f,{className:"text-xs text-muted-foreground",children:"Chart Type"}),e.jsxs(q,{value:a.chartType,onValueChange:y,children:[e.jsx(G,{className:"w-full",children:e.jsx(H,{placeholder:"Select chart type"})}),e.jsxs(J,{children:[e.jsx(x,{value:"bar",children:"Bar Chart"}),e.jsx(x,{value:"line",children:"Line Chart"}),e.jsx(x,{value:"area",children:"Area Chart"}),e.jsx(x,{value:"pie",children:"Pie Chart"})]})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(f,{className:"text-xs text-muted-foreground",children:"From Date"}),e.jsxs(b,{open:k,onOpenChange:v,children:[e.jsx(S,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:D("w-full justify-start text-left font-normal",!(s!=null&&s.from)&&"text-muted-foreground"),children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),s!=null&&s.from?u(s.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(L,{className:"w-auto p-0",align:"start",children:e.jsx(R,{mode:"single",selected:s==null?void 0:s.from,onSelect:t=>{p(o=>({...o,from:t})),v(!1)},defaultMonth:s==null?void 0:s.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]})]}),e.jsxs("div",{className:"w-full sm:w-48",children:[e.jsx(f,{className:"text-xs text-muted-foreground",children:"To Date"}),e.jsxs(b,{open:P,onOpenChange:w,children:[e.jsx(S,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:D("w-full justify-start text-left font-normal",!(s!=null&&s.to)&&"text-muted-foreground"),children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),s!=null&&s.to?u(s.to,"LLL dd, y"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(L,{className:"w-auto p-0",align:"start",children:e.jsx(R,{mode:"single",selected:s==null?void 0:s.to,onSelect:t=>{p(o=>({...o,to:t})),w(!1)},defaultMonth:s==null?void 0:s.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030,disabled:t=>t<((s==null?void 0:s.from)||new Date(0))})})]})]}),e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsx(f,{className:"text-xs text-muted-foreground opacity-0",children:"Apply"}),e.jsx(g,{onClick:A,className:"w-full",disabled:!(s!=null&&s.from)||!(s!=null&&s.to),children:"Apply Dates"})]})]})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx(F,{className:"h-8 w-8 rounded-full"})}),children:e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 min-h-0 h-full",children:[e.jsx("div",{className:"lg:w-72 shrink-0 overflow-y-auto h-full pr-2",children:e.jsx(Q,{selectedDimensions:a.dimensions,selectedMetrics:a.metrics,onItemClick:I,onItemDoubleClick:E})}),e.jsx("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-y-auto",children:e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsx(W,{dimensions:a.dimensions,metrics:a.metrics,chartType:a.chartType,chartData:a.chartData,onRemoveDimension:O,onRemoveMetric:B})})})]})})})]})})})}export{ne as default};
