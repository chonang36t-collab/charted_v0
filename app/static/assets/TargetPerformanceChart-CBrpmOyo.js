import{r as S,R as j,ac as be,a as ge,A as V,j as a}from"./index-BbAuIYhy.js";import{f as ie}from"./popover-DT5xubrl.js";import{C as R,a as L,b as M,d as F}from"./card-Duxs6LOw.js";import{S as ae,b as Ae,G as je,f as J,c as N,d as Pe,e as Oe,i as k,g as Se,h as le,E as we,j as I,k as Te,l as Ee,m as _e,n as T,o as Ce,a as Ne,p as oe,u as De,q as Ke,A as B,B as $,X as Q,Y as ee,r as $e,R as ue,C as pe,T as fe,L as de}from"./generateCategoricalChart-BqJVNZ-l.js";import{L as ze,B as ke}from"./BarChart-D__Y2No_.js";function E(t){"@babel/helpers - typeof";return E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(t)}function Ie(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Be(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ye(r.key),r)}}function Re(t,e,n){return e&&Be(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Le(t,e,n){return e=H(e),Me(t,me()?Reflect.construct(e,n||[],H(t).constructor):e.apply(t,n))}function Me(t,e){if(e&&(E(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fe(t)}function Fe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function me(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(me=function(){return!!t})()}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},H(t)}function He(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U(t,e)}function U(t,e){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},U(t,e)}function he(t,e,n){return e=ye(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ye(t){var e=We(t,"string");return E(e)=="symbol"?e:e+""}function We(t,e){if(E(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(E(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var q=function(t){function e(){return Ie(this,e),Le(this,e,arguments)}return He(e,t),Re(e,[{key:"render",value:function(){return null}}])}(S.Component);he(q,"displayName","ZAxis");he(q,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var qe=["option","isActive"];function D(){return D=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},D.apply(this,arguments)}function Ge(t,e){if(t==null)return{};var n=Ye(t,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function Ye(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function Ze(t){var e=t.option,n=t.isActive,r=Ge(t,qe);return typeof e=="string"?S.createElement(ae,D({option:S.createElement(Ae,D({type:e},r)),isActive:n,shapeType:"symbols"},r)):S.createElement(ae,D({option:e,isActive:n,shapeType:"symbols"},r))}function _(t){"@babel/helpers - typeof";return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(t)}function K(){return K=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},K.apply(this,arguments)}function se(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?se(Object(n),!0).forEach(function(r){O(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Ve(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xe(r.key),r)}}function Je(t,e,n){return e&&ce(t.prototype,e),n&&ce(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ue(t,e,n){return e=W(e),Xe(t,ve()?Reflect.construct(e,n||[],W(t).constructor):e.apply(t,n))}function Xe(t,e){if(e&&(_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Qe(t)}function Qe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ve(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ve=function(){return!!t})()}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},W(t)}function et(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},X(t,e)}function O(t,e,n){return e=xe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xe(t){var e=tt(t,"string");return _(e)=="symbol"?e:e+""}function tt(t,e){if(_(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(_(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var G=function(t){function e(){var n;Ve(this,e);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return n=Ue(this,e,[].concat(i)),O(n,"state",{isAnimationFinished:!1}),O(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0})}),O(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1})}),O(n,"id",De("recharts-scatter-")),n}return et(e,t),Je(e,[{key:"renderSymbolsStatically",value:function(r){var i=this,o=this.props,d=o.shape,g=o.activeShape,v=o.activeIndex,m=J(this.props,!1);return r.map(function(s,l){var p=v===l,u=p?g:d,x=P(P({},m),s);return j.createElement(N,K({className:"recharts-scatter-symbol",key:"symbol-".concat(s==null?void 0:s.cx,"-").concat(s==null?void 0:s.cy,"-").concat(s==null?void 0:s.size,"-").concat(l)},Pe(i.props,s,l),{role:"img"}),j.createElement(Ze,K({option:u,isActive:p,key:"symbol-".concat(l)},x)))})}},{key:"renderSymbolsWithAnimation",value:function(){var r=this,i=this.props,o=i.points,d=i.isAnimationActive,g=i.animationBegin,v=i.animationDuration,m=i.animationEasing,s=i.animationId,l=this.state.prevPoints;return j.createElement(Oe,{begin:g,duration:v,isActive:d,easing:m,from:{t:0},to:{t:1},key:"pie-".concat(s),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(p){var u=p.t,x=o.map(function(f,h){var y=l&&l[h];if(y){var b=k(y.cx,f.cx),c=k(y.cy,f.cy),A=k(y.size,f.size);return P(P({},f),{},{cx:b(u),cy:c(u),size:A(u)})}var w=k(0,f.size);return P(P({},f),{},{size:w(u)})});return j.createElement(N,null,r.renderSymbolsStatically(x))})}},{key:"renderSymbols",value:function(){var r=this.props,i=r.points,o=r.isAnimationActive,d=this.state.prevPoints;return o&&i&&i.length&&(!d||!Se(d,i))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(i)}},{key:"renderErrorBar",value:function(){var r=this.props.isAnimationActive;if(r&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.points,d=i.xAxis,g=i.yAxis,v=i.children,m=le(v,we);return m?m.map(function(s,l){var p=s.props,u=p.direction,x=p.dataKey;return j.cloneElement(s,{key:"".concat(u,"-").concat(x,"-").concat(o[l]),data:o,xAxis:d,yAxis:g,layout:u==="x"?"vertical":"horizontal",dataPointFormatter:function(h,y){return{x:h.cx,y:h.cy,value:u==="x"?+h.node.x:+h.node.y,errorVal:I(h,y)}}})}):null}},{key:"renderLine",value:function(){var r=this.props,i=r.points,o=r.line,d=r.lineType,g=r.lineJointType,v=J(this.props,!1),m=J(o,!1),s,l;if(d==="joint")s=i.map(function(c){return{x:c.cx,y:c.cy}});else if(d==="fitting"){var p=Te(i),u=p.xmin,x=p.xmax,f=p.a,h=p.b,y=function(A){return f*A+h};s=[{x:u,y:y(u)},{x,y:y(x)}]}var b=P(P(P({},v),{},{fill:"none",stroke:v&&v.fill},m),{},{points:s});return j.isValidElement(o)?l=j.cloneElement(o,b):Ee(o)?l=o(b):l=j.createElement(_e,K({},b,{type:g})),j.createElement(N,{className:"recharts-scatter-line",key:"recharts-scatter-line"},l)}},{key:"render",value:function(){var r=this.props,i=r.hide,o=r.points,d=r.line,g=r.className,v=r.xAxis,m=r.yAxis,s=r.left,l=r.top,p=r.width,u=r.height,x=r.id,f=r.isAnimationActive;if(i||!o||!o.length)return null;var h=this.state.isAnimationFinished,y=be("recharts-scatter",g),b=v&&v.allowDataOverflow,c=m&&m.allowDataOverflow,A=b||c,w=T(x)?this.id:x;return j.createElement(N,{className:y,clipPath:A?"url(#clipPath-".concat(w,")"):null},b||c?j.createElement("defs",null,j.createElement("clipPath",{id:"clipPath-".concat(w)},j.createElement("rect",{x:b?s:s-p/2,y:c?l:l-u/2,width:b?p:p*2,height:c?u:u*2}))):null,d&&this.renderLine(),this.renderErrorBar(),j.createElement(N,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!f||h)&&Ce.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(r,i){return r.animationId!==i.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:i.curPoints}:r.points!==i.curPoints?{curPoints:r.points}:null}}])}(S.PureComponent);O(G,"displayName","Scatter");O(G,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!je.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});O(G,"getComposedData",function(t){var e=t.xAxis,n=t.yAxis,r=t.zAxis,i=t.item,o=t.displayedData,d=t.xAxisTicks,g=t.yAxisTicks,v=t.offset,m=i.props.tooltipType,s=le(i.props.children,Ne),l=T(e.dataKey)?i.props.dataKey:e.dataKey,p=T(n.dataKey)?i.props.dataKey:n.dataKey,u=r&&r.dataKey,x=r?r.range:q.defaultProps.range,f=x&&x[0],h=e.scale.bandwidth?e.scale.bandwidth():0,y=n.scale.bandwidth?n.scale.bandwidth():0,b=o.map(function(c,A){var w=I(c,l),te=I(c,p),C=!T(u)&&I(c,u)||"-",re=[{name:T(e.dataKey)?i.props.name:e.name||e.dataKey,unit:e.unit||"",value:w,payload:c,dataKey:l,type:m},{name:T(n.dataKey)?i.props.name:n.name||n.dataKey,unit:n.unit||"",value:te,payload:c,dataKey:p,type:m}];C!=="-"&&re.push({name:r.name||r.dataKey,unit:r.unit||"",value:C,payload:c,dataKey:u,type:m});var Y=oe({axis:e,ticks:d,bandSize:h,entry:c,index:A,dataKey:l}),Z=oe({axis:n,ticks:g,bandSize:y,entry:c,index:A,dataKey:p}),ne=C!=="-"?r.scale(C):f,z=Math.sqrt(Math.max(ne,0)/Math.PI);return P(P({},c),{},{cx:Y,cy:Z,x:Y-z,y:Z-z,xAxis:e,yAxis:n,zAxis:r,width:2*z,height:2*z,size:ne,node:{x:w,y:te,z:C},tooltipPayload:re,tooltipPosition:{x:Y,y:Z},payload:c},s&&s[A]&&s[A].props)});return P({points:b},v)});var rt=Ke({chartName:"ComposedChart",GraphicalChild:[ze,B,$,G],axisComponents:[{axisType:"xAxis",AxisComp:Q},{axisType:"yAxis",AxisComp:ee},{axisType:"zAxis",AxisComp:q}],formatAxisMap:$e});const ut=(t,e,n)=>{const[r,i]=S.useState(null),[o,d]=S.useState(!1),{toast:g}=ge(),v=async()=>{d(!0);try{const m=new URLSearchParams({start:ie(t.from,"yyyy-MM-dd"),end:ie(t.to,"yyyy-MM-dd")});e&&e.length>0&&e.forEach(f=>m.append("locations",f)),n&&n.length>0&&n.forEach(f=>m.append("sites",f));const s=m.toString(),l={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},[p,u,x]=await Promise.all([fetch(`${V.SALES_SUMMARY.replace("sales-summary","operational-summary")}?${s}`,{headers:l}),fetch(`${V.CLIENT_DISTRIBUTION}?${s}`,{headers:l}),fetch(`${V.TARGET_ACHIEVEMENT_TREND}?${s}`,{headers:l})]);if(p.ok){const f=await p.json();if(u.ok){const h=await u.json();h.timeSeries&&(f.timeSeries=f.timeSeries.map(y=>{const b=y.period.substring(0,7),c=h.timeSeries.find(A=>A.period===b);return{...y,clientCount:c?c.clientCount:0}}))}if(x.ok){const h=await x.json();h.data&&(f.timeSeries=f.timeSeries.map(y=>{const b=y.period.substring(0,7),c=h.data.find(A=>A.period===b);return{...y,achievementPercentage:c?c.achievementPercentage:0}}))}i(f)}else g({title:"Error",description:"Could not fetch operational data",variant:"destructive"})}catch(m){console.error(m),g({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{d(!1)}};return S.useEffect(()=>{v()},[t,e,n]),{operationalData:r,isLoading:o,refetch:v}},nt=({active:t,payload:e,label:n})=>t&&e&&e.length?a.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[a.jsx("p",{className:"font-semibold text-foreground",children:n}),e.map((r,i)=>a.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",r.name==="Paid Hours"?r.value.toLocaleString(void 0,{maximumFractionDigits:1}):r.name==="Target Achievement"?`${r.value}%`:r.value]},i))]}):null,pt=({data:t,aggregationLevel:e,selectedMetric:n="shifts"})=>{const r={dataKey:"display",interval:0};if(!t||t.length===0)return a.jsxs(R,{className:"flex-1",children:[a.jsx(L,{children:a.jsx(M,{children:"Metric Trend"})}),a.jsx(F,{children:a.jsx("div",{className:"h-[400px] flex items-center justify-center",children:a.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const i=()=>{switch(n){case"hours":return"Paid Hours Trend";case"shifts":return"Hours & Shifts Trend";case"clients":return"Active Clients Trend";case"targetAchievement":return"Target Achievement Trend";case"missedTarget":return"Missed Target Trend";default:return"Metric Trend"}},o=()=>{switch(n){case"hours":return"Hours";case"shifts":return"Shifts";case"clients":return"Clients";case"targetAchievement":return"Percentage (%)";default:return"Count"}};return a.jsxs(R,{className:"flex-1",children:[a.jsxs(L,{children:[a.jsx(M,{children:i()}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[e==="daily"&&"Daily view",e==="weekly"&&"Weekly view",e==="monthly"&&"Monthly view"]})]}),a.jsx(F,{children:a.jsx("div",{className:"h-[400px]",children:a.jsx(ue,{width:"100%",height:"100%",children:a.jsxs(rt,{data:t,children:[a.jsx(pe,{strokeDasharray:"3 3"}),a.jsx(Q,{dataKey:r.dataKey,tick:{fontSize:12},interval:r.interval}),a.jsx(ee,{label:{value:o(),angle:-90,position:"insideLeft"}}),a.jsx(fe,{content:a.jsx(nt,{})}),a.jsx(de,{}),n==="shifts"&&a.jsxs(a.Fragment,{children:[a.jsx(B,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),a.jsx($,{dataKey:"totalShifts",name:"Total Shifts",barSize:20,fill:"hsl(var(--accent))",fillOpacity:.6})]}),n==="hours"&&a.jsx(B,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),n==="clients"&&a.jsx($,{dataKey:"clientCount",name:"Active Clients",barSize:30,fill:"hsl(262, 83%, 58%)",fillOpacity:.8}),n==="targetAchievement"&&a.jsx(B,{type:"monotone",dataKey:"achievementPercentage",name:"Target Achievement",stroke:"hsl(142, 71%, 45%)",fill:"hsl(142, 71%, 45%)",fillOpacity:.2,strokeWidth:2})]})})})})]})},it=({active:t,payload:e,label:n})=>t&&e&&e.length?a.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[a.jsx("p",{className:"font-semibold text-foreground",children:n}),e.map((r,i)=>a.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",r.value.toLocaleString()]},i))]}):null,ft=({data:t})=>{if(!t||t.length===0)return a.jsxs(R,{className:"flex-1",children:[a.jsx(L,{children:a.jsx(M,{children:"Target vs Actual Performance"})}),a.jsx(F,{children:a.jsx("div",{className:"h-[400px] flex items-center justify-center",children:a.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const e=new Map;t.forEach(i=>{const o=i.site?`${i.location} - ${i.site}`:i.location;e.has(o)||e.set(o,{actual:0,target:0});const d=e.get(o);d.actual+=i.actual||0,d.target+=i.target||0});const n=Array.from(e.entries()).map(([i,o])=>({name:i,actual:o.actual,target:o.target})).sort((i,o)=>i.name.localeCompare(o.name)),r=Math.max(400,n.length*40);return a.jsxs(R,{className:"flex-1",children:[a.jsxs(L,{children:[a.jsx(M,{children:"Target vs Actual Performance by Site"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Total shifts achieved compared to target for each location/site"})]}),a.jsx(F,{children:a.jsx("div",{className:"max-h-[600px] overflow-y-auto",children:a.jsx("div",{style:{height:`${r}px`,minHeight:"400px"},children:a.jsx(ue,{width:"100%",height:"100%",children:a.jsxs(ke,{data:n,layout:"vertical",margin:{top:20,right:30,left:150,bottom:20},children:[a.jsx(pe,{strokeDasharray:"3 3",horizontal:!1}),a.jsx(Q,{type:"number",domain:[0,"dataMax"],tickFormatter:i=>i.toLocaleString()}),a.jsx(ee,{type:"category",dataKey:"name",width:140,tick:{fontSize:11}}),a.jsx(fe,{content:a.jsx(it,{})}),a.jsx(de,{}),a.jsx($,{dataKey:"target",name:"Target",fill:"#94a3b8",opacity:.7}),a.jsx($,{dataKey:"actual",name:"Actual",fill:"#3b82f6"})]})})})})})]})};export{pt as O,ft as T,ut as u};
