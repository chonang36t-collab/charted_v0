import{b as Q,R as o,j as e,B as d,T as V,k as W,l as X,m as Z,e as D,A as O}from"./index-BKVo7vxm.js";import{P as u,a as j,b as N,C as A,f as C,d as T,i as F,g as R}from"./popover-C-1TWCFH.js";import{C as v}from"./checkbox-CEfhCuvA.js";import{g as P}from"./locationUtils-uPLdQhTS.js";import{a as S}from"./index-CQEiSP4q.js";const ce=({dateRange:a,onDateRangeChange:Y,calendarOpen:ee,onCalendarOpenChange:se,tempDateRange:te,onTempDateRangeChange:re,selectedLocations:r=[],onLocationsChange:m,selectedSites:i=[],onSitesChange:c})=>{const{role:b,locations:w}=Q(),[x,y]=o.useState([]),[h,E]=o.useState([]),[$,z]=o.useState(!1),[B,I]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const t=await fetch(`${O.SALES_SUMMARY.replace("sales-summary","locations")}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(t.ok){const p=await t.json();y(b==="admin"?p:p.filter(f=>w.includes(f)))}}catch(t){console.error("Failed to fetch locations:",t)}})()},[b,w]),o.useEffect(()=>{c&&(async()=>{try{const t=new URLSearchParams;r.length>0&&r.forEach(f=>t.append("locations",f));const p=await fetch(`${O.SITES}?${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(p.ok){const f=await p.json();E(f)}}catch(t){console.error("Failed to fetch sites:",t)}})()},[r,c]);const _=s=>{m&&(r.includes(s)?m(r.filter(t=>t!==s)):m([...r,s]))},U=s=>{c&&(i.includes(s)?c(i.filter(t=>t!==s)):c([...i,s]))},[l,k]=o.useState(a==null?void 0:a.from),[n,g]=o.useState(a==null?void 0:a.to),[L,M]=o.useState(!1),[H,q]=o.useState(!1);o.useEffect(()=>{k(a==null?void 0:a.from),g(a==null?void 0:a.to)},[a]);const G=s=>{s&&(k(s),n&&F(s,n)&&g(void 0))},J=s=>{s&&g(s)},K=()=>{l&&n&&Y({from:l,to:n})};return e.jsx("div",{className:"sticky top-0 z-40 bg-background border-b border-border",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Overview of your analytics"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end justify-start sm:justify-end flex-1",children:[m&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Location"}),e.jsxs(u,{open:$,onOpenChange:z,children:[e.jsx(j,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:e.jsx("span",{className:"truncate",children:r.length===0?"All Locations":r.length===1?P(r[0]):`${r.length} locations`})}),e.jsx(S,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),e.jsx(N,{className:"w-[200px] p-0",align:"start",children:e.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:s=>{s.stopPropagation(),r.length===x.length?m([]):m(x)},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{checked:x.length>0&&r.length===x.length,className:"pointer-events-none"}),e.jsx("span",{className:"text-sm font-medium",children:"All Locations"})]}),r.length>0&&e.jsx(d,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:s=>{s.stopPropagation(),m([])},children:"Clear"})]}),e.jsx("div",{className:"h-px bg-border my-1"}),e.jsx(V,{children:x.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:t=>{t.stopPropagation(),_(s)},children:[e.jsx(v,{checked:r.includes(s),className:"pointer-events-none"}),e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx("span",{className:"text-sm truncate font-medium",children:P(s)})}),e.jsx(Z,{side:"right",children:e.jsx("p",{children:s})})]})]},s))})]})})]})]}),c&&e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Site"}),e.jsxs(u,{open:B,onOpenChange:I,children:[e.jsx(j,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[e.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:e.jsx("span",{className:"truncate",children:i.length===0?"All Sites":`${i.length} sites`})}),e.jsx(S,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),e.jsx(N,{className:"w-[200px] p-0",align:"start",children:e.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:s=>{s.stopPropagation(),i.length===h.length?c([]):c(h)},children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{checked:h.length>0&&i.length===h.length,className:"pointer-events-none"}),e.jsx("span",{className:"text-sm font-medium",children:"All Sites"})]}),i.length>0&&e.jsx(d,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:s=>{s.stopPropagation(),c([])},children:"Clear"})]}),e.jsx("div",{className:"h-px bg-border my-1"}),h.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:t=>{t.stopPropagation(),U(s)},children:[e.jsx(v,{checked:i.includes(s),className:"pointer-events-none"}),e.jsx("span",{className:"text-sm truncate font-medium",children:s})]},s))]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"From Date"}),e.jsxs(u,{open:L,onOpenChange:M,children:[e.jsx(j,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:D("w-[140px] justify-start text-left font-normal",!l&&"text-muted-foreground"),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),l?C(l,"LLL dd, y"):"From"]})}),e.jsx(N,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(T,{mode:"single",selected:l,onSelect:G,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:s=>n?F(s,n):!1,className:"rounded-md border"})})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Till Date"}),e.jsxs(u,{open:H,onOpenChange:q,children:[e.jsx(j,{asChild:!0,children:e.jsxs(d,{variant:"outline",className:D("w-[140px] justify-start text-left font-normal",!n&&"text-muted-foreground"),disabled:!l,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),n?C(n,"LLL dd, y"):"To"]})}),e.jsx(N,{className:"w-auto p-0",align:"start",children:e.jsx("div",{className:"p-3",children:e.jsx(T,{mode:"single",selected:n,onSelect:J,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:l?l.getFullYear():new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:s=>l?R(s,l):!1,className:"rounded-md border"})})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 pb-0.5",children:[e.jsx("div",{className:"h-4"})," ",e.jsx(d,{onClick:K,disabled:!l||!n,className:"",children:"Apply"})]})]})]})})})};export{ce as D};
