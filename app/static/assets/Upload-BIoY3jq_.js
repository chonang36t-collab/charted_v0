import{c as L,d as Q,r as o,j as e,P as V,b as S,e as Z,a as ee}from"./index-BmNPRiw4.js";import{D as se,C as re,F as te}from"./DashboardLayout-CSpjrvj4.js";import{C as g,a as v,b as j,d as N}from"./card-w7HyG29D.js";import{B as F}from"./button-Id3E3jwP.js";import{L as ae,I as le}from"./label-QQq3R96u.js";import{A as ie}from"./api-DS5URhHX.js";import"./users-Dy879Vrt.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=L("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=L("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var U="Progress",E=100,[de,Ce]=Q(U),[ce,ue]=de(U),B=o.forwardRef((s,r)=>{const{__scopeProgress:a,value:l=null,max:i,getValueLabel:f=xe,...y}=s;(i||i===0)&&!$(i)&&console.error(pe(`${i}`,"Progress"));const x=$(i)?i:E;l!==null&&!T(l,x)&&console.error(me(`${l}`,"Progress"));const n=T(l,x)?l:null,m=w(n)?f(n,x):void 0;return e.jsx(ce,{scope:a,value:n,max:x,children:e.jsx(V.div,{"aria-valuemax":x,"aria-valuemin":0,"aria-valuenow":w(n)?n:void 0,"aria-valuetext":m,role:"progressbar","data-state":z(n,x),"data-value":n??void 0,"data-max":x,...y,ref:r})})});B.displayName=U;var _="ProgressIndicator",O=o.forwardRef((s,r)=>{const{__scopeProgress:a,...l}=s,i=ue(_,a);return e.jsx(V.div,{"data-state":z(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...l,ref:r})});O.displayName=_;function xe(s,r){return`${Math.round(s/r*100)}%`}function z(s,r){return s==null?"indeterminate":s===r?"complete":"loading"}function w(s){return typeof s=="number"}function $(s){return w(s)&&!isNaN(s)&&s>0}function T(s,r){return w(s)&&!isNaN(s)&&s<=r&&s>=0}function pe(s,r){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${E}\`.`}function me(s,r){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${E} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var q=B,fe=O;const G=o.forwardRef(({className:s,value:r,...a},l)=>e.jsx(q,{ref:l,className:S("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:e.jsx(fe,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));G.displayName=q.displayName;const he=Z("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),I=o.forwardRef(({className:s,variant:r,...a},l)=>e.jsx("div",{ref:l,role:"alert",className:S(he({variant:r}),s),...a}));I.displayName="Alert";const ge=o.forwardRef(({className:s,...r},a)=>e.jsx("h5",{ref:a,className:S("mb-1 font-medium leading-none tracking-tight",s),...r}));ge.displayName="AlertTitle";const R=o.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:S("text-sm [&_p]:leading-relaxed",s),...r}));R.displayName="AlertDescription";function Pe(){const[s,r]=o.useState(null),[a,l]=o.useState(!1),[i,f]=o.useState(0),[y,x]=o.useState({}),[n,m]=o.useState("idle"),[H,C]=o.useState(""),[p,P]=o.useState(null),h=o.useRef(null),{toast:k}=ee(),X=d=>{var c;const t=(c=d.target.files)==null?void 0:c[0];t&&(t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||t.type==="application/vnd.ms-excel"||t.name.endsWith(".csv")?(r(t),m("idle"),C("")):(k({title:"Invalid file type",description:"Please upload an Excel file (.xlsx, .xls) or CSV file",variant:"destructive"}),r(null)))},J=async()=>{if(!s)return;l(!0),f(0),m("idle"),C(""),P(null);const d=new FormData;d.append("file",s);try{const t=await fetch(ie.UPLOAD,{method:"POST",body:d,headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!t.ok)throw new Error(`Upload failed: ${t.statusText}`);if(!t.body)throw new Error("No response body");const c=t.body.getReader(),b=new TextDecoder;let A="";for(;;){const{done:W,value:Y}=await c.read();if(W)break;A+=b.decode(Y,{stream:!0});const M=A.split(`
`);A=M.pop()||"";for(const D of M)if(D.trim())try{const u=JSON.parse(D);if(u.status==="progress")u.progress&&f(u.progress);else if(u.status==="complete")m("success"),P(u.data),f(100),k({title:"Upload successful",description:"Your file has been uploaded and processed successfully"}),r(null),h.current&&(h.current.value="");else if(u.status==="error")throw new Error(u.message)}catch(u){console.error("Error parsing stream:",u)}}}catch(t){m("error"),C(t.message||"An unexpected error occurred"),k({title:"Upload failed",description:t.message||"An unexpected error occurred",variant:"destructive"})}finally{l(!1)}},K=d=>{if(d===0)return"0 Bytes";const t=1024,c=["Bytes","KB","MB","GB"],b=Math.floor(Math.log(d)/Math.log(t));return parseFloat((d/Math.pow(t,b)).toFixed(2))+" "+c[b]};return e.jsx(se,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Upload Data"}),e.jsx("p",{className:"text-muted-foreground",children:"Upload your Excel or CSV files to import data into the system"})]}),e.jsxs(g,{children:[e.jsx(v,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"File Upload"]})}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"file-upload",children:"Select File"}),e.jsx(le,{id:"file-upload",type:"file",ref:h,onChange:X,accept:".xlsx,.xls,.csv",disabled:a}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported formats: Excel (.xlsx, .xls) and CSV files"})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded-lg",children:[e.jsx(te,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:K(s.size)})]})]}),a&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[i,"%"]})]}),e.jsx(G,{value:i})]}),n==="success"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(I,{className:"border-green-200 bg-green-50",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600"}),e.jsx(R,{className:"text-green-800",children:"File uploaded successfully!"})]}),p&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(g,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Rows Inserted"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold",children:p.inserted.toLocaleString()})})]}),e.jsxs(g,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Rows Skipped"})}),e.jsxs(N,{children:[e.jsx("div",{className:`text-2xl font-bold ${p.skipped>0?"text-red-600":"text-green-600"}`,children:p.skipped.toLocaleString()}),p.skipped>0&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Duplicates or missing keys"})]})]}),e.jsxs(g,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(j,{className:"text-sm font-medium",children:"Revenue Match"})}),e.jsxs(N,{children:[e.jsx("div",{className:`text-2xl font-bold ${p.verification.match?"text-green-600":"text-red-600"}`,children:p.verification.match?"MATCHED":"MISMATCH"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["DB: $",p.verification.db_revenue.toLocaleString()]})]})]})]}),e.jsx(F,{onClick:()=>{m("idle"),f(0),r(null),P(null),h.current&&(h.current.value="")},variant:"outline",className:"w-full",children:"Upload New File"})]}),n==="error"&&e.jsxs(I,{className:"border-red-200 bg-red-50",children:[e.jsx(oe,{className:"h-4 w-4 text-red-600"}),e.jsx(R,{className:"text-red-800",children:H})]}),n!=="success"&&e.jsx(F,{onClick:J,disabled:a,className:"w-full",children:a?"Uploading...":"Upload File"})]})]})]}),Object.keys(y).length>0&&e.jsxs(g,{children:[e.jsx(v,{children:e.jsx(j,{children:"Required Columns"})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(y).map(([d,t])=>e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:d}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.map(c=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-md text-sm",children:c},c))})]},d))})})]})]})})}export{Pe as default};
