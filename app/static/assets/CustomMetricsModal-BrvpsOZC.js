import{f as createLucideIcon,h as createContextScope,r as reactExports,i as useComposedRefs,j as jsxRuntimeExports,P as Primitive,k as composeEventHandlers,l as Presence,m as useSize,n as useControllableState,d as cn,b as useUser,R as React,B as Button,T as TooltipProvider,o as Tooltip,p as TooltipTrigger,q as TooltipContent,A as API_ENDPOINTS,a as useToast,S as ScrollArea,c as useCustomMetrics,I as Input,X,s as ue}from"./index-xBVSQyN9.js";import{g as getLocationAbbreviation,C as Calendar,a as Calendar$1,i as isAfter,b as isBefore}from"./locationUtils-C3CGT2UK.js";import{P as Popover,a as PopoverTrigger,b as PopoverContent,f as format}from"./popover-B7Y4xlS9.js";import{u as usePrevious,C as Check,a as ChevronDown}from"./index-CUZU75tp.js";import{C as Card,a as CardHeader,b as CardTitle,d as CardContent}from"./card-BJv0IlGP.js";import{P as Progress}from"./progress-CWnKR804.js";import{E as Ellipsis}from"./ellipsis-DMkZ7yPv.js";import{D as Dialog,a as DialogContent,b as DialogHeader,c as DialogTitle,d as DialogDescription,e as DialogFooter}from"./dialog-C5leLp47.js";import{L as Label}from"./label-CfRPrtL3.js";import{P as Plus}from"./plus-C5yPFgbR.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Calculator=createLucideIcon("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),calculateMetrics=(e,r)=>{var y,j,v,i,f,N,S,b,I,C,w,B,_,O,H;if(!e)return{revenue:{value:0,change:0,trend:"neutral",text:"No data available"},clientPay:{value:0,change:0,trend:"neutral",text:"No data available"},staffPay:{value:0,change:0,trend:"neutral",text:"No data available"},totalShifts:{value:0,change:0,trend:"neutral",text:"No data available"},paidHours:{value:0,change:0,trend:"neutral",text:"No data available"},uniqueEmployees:{value:0,change:0,trend:"neutral",text:"No data available"},avgShiftDuration:{value:0,change:0,trend:"neutral",text:"No data available"},totalClients:{value:0,change:0,trend:"neutral",text:"No data available"}};const x=e.totalRevenue||0,R=e.avgClientPayPerHour||0,m=e.avgStaffPayPerHour||0,a=((y=e.previousPeriod)==null?void 0:y.totalRevenue)||0,n=((j=e.previousPeriod)==null?void 0:j.avgClientPayPerHour)||0,l=((v=e.previousPeriod)==null?void 0:v.avgStaffPayPerHour)||0,s=(k,P)=>P>0?(k-P)/P*100:0,o=s(x,a),c=s(R,n),E=s(m,l),d=k=>k>0?"up":k<0?"down":"neutral",p=(k,P,T)=>{if(!P)return"No previous data";let t="";return T<=7?t="last week":T<=31?t="last month":T<=93?t="last quarter":t="last period",`${k>0?"+":""}${Math.abs(k).toFixed(1)}% from ${t}`},h=Math.ceil((r.to.getTime()-r.from.getTime())/(1e3*60*60*24)),u=!!e.previousPeriod;return{revenue:{value:x,change:o,trend:d(o),text:p(o,u,h)},clientPay:{value:R,change:c,trend:d(c),text:p(c,u,h)},staffPay:{value:m,change:E,trend:d(E),text:p(E,u,h)},totalShifts:{value:e.totalShifts,change:s(e.totalShifts,((i=e.previousPeriod)==null?void 0:i.totalShifts)||0),trend:d(s(e.totalShifts,((f=e.previousPeriod)==null?void 0:f.totalShifts)||0)),text:p(s(e.totalShifts,((N=e.previousPeriod)==null?void 0:N.totalShifts)||0),u,h)},paidHours:{value:e.totalPaidHours||0,change:s(e.totalPaidHours||0,((S=e.previousPeriod)==null?void 0:S.totalPaidHours)||0)||0,trend:d(s(e.totalPaidHours||0,((b=e.previousPeriod)==null?void 0:b.totalPaidHours)||0)),text:p(s(e.totalPaidHours||0,((I=e.previousPeriod)==null?void 0:I.totalPaidHours)||0),u,h)},uniqueEmployees:{value:e.uniqueEmployees,change:s(e.uniqueEmployees,((C=e.previousPeriod)==null?void 0:C.uniqueEmployees)||0),trend:d(s(e.uniqueEmployees,((w=e.previousPeriod)==null?void 0:w.uniqueEmployees)||0)),text:p(s(e.uniqueEmployees,((B=e.previousPeriod)==null?void 0:B.uniqueEmployees)||0),u,h)},avgShiftDuration:{value:e.totalPaidHours&&e.totalShifts?e.totalPaidHours/e.totalShifts:0,change:0,trend:"neutral",text:"Average hours per shift"},totalClients:{value:e.totalClients,change:s(e.totalClients,((_=e.previousPeriod)==null?void 0:_.totalClients)||0),trend:d(s(e.totalClients,((O=e.previousPeriod)==null?void 0:O.totalClients)||0)),text:p(s(e.totalClients,((H=e.previousPeriod)==null?void 0:H.totalClients)||0),u,h)}}};var CHECKBOX_NAME="Checkbox",[createCheckboxContext,createCheckboxScope]=createContextScope(CHECKBOX_NAME),[CheckboxProviderImpl,useCheckboxContext]=createCheckboxContext(CHECKBOX_NAME);function CheckboxProvider(e){const{__scopeCheckbox:r,checked:x,children:R,defaultChecked:m,disabled:a,form:n,name:l,onCheckedChange:s,required:o,value:c="on",internal_do_not_use_render:E}=e,[d,p]=useControllableState({prop:x,defaultProp:m??!1,onChange:s,caller:CHECKBOX_NAME}),[h,u]=reactExports.useState(null),[y,j]=reactExports.useState(null),v=reactExports.useRef(!1),i=h?!!n||!!h.closest("form"):!0,f={checked:d,disabled:a,setChecked:p,control:h,setControl:u,name:l,form:n,value:c,hasConsumerStoppedPropagationRef:v,required:o,defaultChecked:isIndeterminate(m)?!1:m,isFormControl:i,bubbleInput:y,setBubbleInput:j};return jsxRuntimeExports.jsx(CheckboxProviderImpl,{scope:r,...f,children:isFunction(E)?E(f):R})}var TRIGGER_NAME="CheckboxTrigger",CheckboxTrigger=reactExports.forwardRef(({__scopeCheckbox:e,onKeyDown:r,onClick:x,...R},m)=>{const{control:a,value:n,disabled:l,checked:s,required:o,setControl:c,setChecked:E,hasConsumerStoppedPropagationRef:d,isFormControl:p,bubbleInput:h}=useCheckboxContext(TRIGGER_NAME,e),u=useComposedRefs(m,c),y=reactExports.useRef(s);return reactExports.useEffect(()=>{const j=a==null?void 0:a.form;if(j){const v=()=>E(y.current);return j.addEventListener("reset",v),()=>j.removeEventListener("reset",v)}},[a,E]),jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"checkbox","aria-checked":isIndeterminate(s)?"mixed":s,"aria-required":o,"data-state":getState(s),"data-disabled":l?"":void 0,disabled:l,value:n,...R,ref:u,onKeyDown:composeEventHandlers(r,j=>{j.key==="Enter"&&j.preventDefault()}),onClick:composeEventHandlers(x,j=>{E(v=>isIndeterminate(v)?!0:!v),h&&p&&(d.current=j.isPropagationStopped(),d.current||j.stopPropagation())})})});CheckboxTrigger.displayName=TRIGGER_NAME;var Checkbox$1=reactExports.forwardRef((e,r)=>{const{__scopeCheckbox:x,name:R,checked:m,defaultChecked:a,required:n,disabled:l,value:s,onCheckedChange:o,form:c,...E}=e;return jsxRuntimeExports.jsx(CheckboxProvider,{__scopeCheckbox:x,checked:m,defaultChecked:a,disabled:l,required:n,onCheckedChange:o,name:R,form:c,value:s,internal_do_not_use_render:({isFormControl:d})=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(CheckboxTrigger,{...E,ref:r,__scopeCheckbox:x}),d&&jsxRuntimeExports.jsx(CheckboxBubbleInput,{__scopeCheckbox:x})]})})});Checkbox$1.displayName=CHECKBOX_NAME;var INDICATOR_NAME="CheckboxIndicator",CheckboxIndicator=reactExports.forwardRef((e,r)=>{const{__scopeCheckbox:x,forceMount:R,...m}=e,a=useCheckboxContext(INDICATOR_NAME,x);return jsxRuntimeExports.jsx(Presence,{present:R||isIndeterminate(a.checked)||a.checked===!0,children:jsxRuntimeExports.jsx(Primitive.span,{"data-state":getState(a.checked),"data-disabled":a.disabled?"":void 0,...m,ref:r,style:{pointerEvents:"none",...e.style}})})});CheckboxIndicator.displayName=INDICATOR_NAME;var BUBBLE_INPUT_NAME="CheckboxBubbleInput",CheckboxBubbleInput=reactExports.forwardRef(({__scopeCheckbox:e,...r},x)=>{const{control:R,hasConsumerStoppedPropagationRef:m,checked:a,defaultChecked:n,required:l,disabled:s,name:o,value:c,form:E,bubbleInput:d,setBubbleInput:p}=useCheckboxContext(BUBBLE_INPUT_NAME,e),h=useComposedRefs(x,p),u=usePrevious(a),y=useSize(R);reactExports.useEffect(()=>{const v=d;if(!v)return;const i=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(i,"checked").set,S=!m.current;if(u!==a&&N){const b=new Event("click",{bubbles:S});v.indeterminate=isIndeterminate(a),N.call(v,isIndeterminate(a)?!1:a),v.dispatchEvent(b)}},[d,u,a,m]);const j=reactExports.useRef(isIndeterminate(a)?!1:a);return jsxRuntimeExports.jsx(Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:n??j.current,required:l,disabled:s,name:o,value:c,form:E,...r,tabIndex:-1,ref:h,style:{...r.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});CheckboxBubbleInput.displayName=BUBBLE_INPUT_NAME;function isFunction(e){return typeof e=="function"}function isIndeterminate(e){return e==="indeterminate"}function getState(e){return isIndeterminate(e)?"indeterminate":e?"checked":"unchecked"}const Checkbox=reactExports.forwardRef(({className:e,...r},x)=>jsxRuntimeExports.jsx(Checkbox$1,{ref:x,className:cn("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...r,children:jsxRuntimeExports.jsx(CheckboxIndicator,{className:cn("flex items-center justify-center text-current"),children:jsxRuntimeExports.jsx(Check,{className:"h-4 w-4"})})}));Checkbox.displayName=Checkbox$1.displayName;const DashboardHeader=({dateRange:e,onDateRangeChange:r,calendarOpen:x,onCalendarOpenChange:R,tempDateRange:m,onTempDateRangeChange:a,selectedLocations:n=[],onLocationsChange:l,selectedSites:s=[],onSitesChange:o,onCustomMetricsClick:c})=>{const{role:E,locations:d}=useUser(),[p,h]=React.useState([]),[u,y]=React.useState([]),[j,v]=React.useState(!1),[i,f]=React.useState(!1);React.useEffect(()=>{(async()=>{try{const g=await fetch(`${API_ENDPOINTS.SALES_SUMMARY.replace("sales-summary","locations")}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(g.ok){const A=await g.json();h(E==="admin"?A:A.filter(M=>d.includes(M)))}}catch(g){console.error("Failed to fetch locations:",g)}})()},[E,d]),React.useEffect(()=>{o&&(async()=>{try{const g=new URLSearchParams;n.length>0&&n.forEach(M=>g.append("locations",M));const A=await fetch(`${API_ENDPOINTS.SITES}?${g}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(A.ok){const M=await A.json();y(M)}}catch(g){console.error("Failed to fetch sites:",g)}})()},[n,o]);const N=t=>{l&&(n.includes(t)?l(n.filter(g=>g!==t)):l([...n,t]))},S=t=>{o&&(s.includes(t)?o(s.filter(g=>g!==t)):o([...s,t]))},[b,I]=React.useState(e==null?void 0:e.from),[C,w]=React.useState(e==null?void 0:e.to),[B,_]=React.useState(!1),[O,H]=React.useState(!1);React.useEffect(()=>{I(e==null?void 0:e.from),w(e==null?void 0:e.to)},[e]);const k=t=>{t&&(I(t),C&&isAfter(t,C)&&w(void 0))},P=t=>{t&&w(t)},T=()=>{b&&C&&r({from:b,to:C})};return jsxRuntimeExports.jsx("div",{className:"sticky top-0 z-40 bg-background border-b border-border",children:jsxRuntimeExports.jsx("div",{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold",children:"Dashboard"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"Overview of your analytics"})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-4 items-end justify-start sm:justify-end flex-1",children:[l&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Location"}),jsxRuntimeExports.jsxs(Popover,{open:j,onOpenChange:v,children:[jsxRuntimeExports.jsx(PopoverTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:jsxRuntimeExports.jsx("span",{className:"truncate",children:n.length===0?"All Locations":n.length===1?getLocationAbbreviation(n[0]):`${n.length} locations`})}),jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),jsxRuntimeExports.jsx(PopoverContent,{className:"w-[200px] p-0",align:"start",children:jsxRuntimeExports.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:t=>{t.stopPropagation(),n.length===p.length?l([]):l(p)},children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Checkbox,{checked:p.length>0&&n.length===p.length,className:"pointer-events-none"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"All Locations"})]}),n.length>0&&jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:t=>{t.stopPropagation(),l([])},children:"Clear"})]}),jsxRuntimeExports.jsx("div",{className:"h-px bg-border my-1"}),jsxRuntimeExports.jsx(TooltipProvider,{children:p.map(t=>jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:g=>{g.stopPropagation(),N(t)},children:[jsxRuntimeExports.jsx(Checkbox,{checked:n.includes(t),className:"pointer-events-none"}),jsxRuntimeExports.jsxs(Tooltip,{children:[jsxRuntimeExports.jsx(TooltipTrigger,{asChild:!0,children:jsxRuntimeExports.jsx("span",{className:"text-sm truncate font-medium",children:getLocationAbbreviation(t)})}),jsxRuntimeExports.jsx(TooltipContent,{side:"right",children:jsxRuntimeExports.jsx("p",{children:t})})]})]},t))})]})})]})]}),o&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Site"}),jsxRuntimeExports.jsxs(Popover,{open:i,onOpenChange:f,children:[jsxRuntimeExports.jsx(PopoverTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"w-[180px] justify-between text-left font-normal",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2 overflow-hidden mr-2",children:jsxRuntimeExports.jsx("span",{className:"truncate",children:s.length===0?"All Sites":`${s.length} sites`})}),jsxRuntimeExports.jsx(ChevronDown,{className:"h-4 w-4 opacity-50 shrink-0"})]})}),jsxRuntimeExports.jsx(PopoverContent,{className:"w-[200px] p-0",align:"start",children:jsxRuntimeExports.jsxs("div",{className:"p-2 max-h-[300px] overflow-auto",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-muted rounded-sm cursor-pointer mb-1",onClick:t=>{t.stopPropagation(),s.length===u.length?o([]):o(u)},children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Checkbox,{checked:u.length>0&&s.length===u.length,className:"pointer-events-none"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"All Sites"})]}),s.length>0&&jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",onClick:t=>{t.stopPropagation(),o([])},children:"Clear"})]}),jsxRuntimeExports.jsx("div",{className:"h-px bg-border my-1"}),u.map(t=>jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 p-2 hover:bg-muted rounded-sm cursor-pointer",onClick:g=>{g.stopPropagation(),S(t)},children:[jsxRuntimeExports.jsx(Checkbox,{checked:s.includes(t),className:"pointer-events-none"}),jsxRuntimeExports.jsx("span",{className:"text-sm truncate font-medium",children:t})]},t))]})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"From Date"}),jsxRuntimeExports.jsxs(Popover,{open:B,onOpenChange:_,children:[jsxRuntimeExports.jsx(PopoverTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",className:cn("w-[140px] justify-start text-left font-normal",!b&&"text-muted-foreground"),children:[jsxRuntimeExports.jsx(Calendar,{className:"mr-2 h-4 w-4"}),b?format(b,"LLL dd, y"):"From"]})}),jsxRuntimeExports.jsx(PopoverContent,{className:"w-auto p-0",align:"start",children:jsxRuntimeExports.jsx("div",{className:"p-3",children:jsxRuntimeExports.jsx(Calendar$1,{mode:"single",selected:b,onSelect:k,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:t=>C?isAfter(t,C):!1,className:"rounded-md border"})})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1.5",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Till Date"}),jsxRuntimeExports.jsxs(Popover,{open:O,onOpenChange:H,children:[jsxRuntimeExports.jsx(PopoverTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",className:cn("w-[140px] justify-start text-left font-normal",!C&&"text-muted-foreground"),disabled:!b,children:[jsxRuntimeExports.jsx(Calendar,{className:"mr-2 h-4 w-4"}),C?format(C,"LLL dd, y"):"To"]})}),jsxRuntimeExports.jsx(PopoverContent,{className:"w-auto p-0",align:"start",children:jsxRuntimeExports.jsx("div",{className:"p-3",children:jsxRuntimeExports.jsx(Calendar$1,{mode:"single",selected:C,onSelect:P,initialFocus:!0,captionLayout:"dropdown-buttons",fromYear:b?b.getFullYear():new Date().getFullYear()-10,toYear:new Date().getFullYear()+1,disabled:t=>b?isBefore(t,b):!1,className:"rounded-md border"})})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-1.5 pb-0.5",children:[jsxRuntimeExports.jsx("div",{className:"h-4"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[c&&jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:c,title:"Custom Metrics",className:"text-muted-foreground hover:text-foreground",children:jsxRuntimeExports.jsx(Calculator,{className:"h-4 w-4"})}),jsxRuntimeExports.jsx(Button,{onClick:T,disabled:!b||!C,className:"",children:"Apply"})]})]})]})]})})})},useRankings=(e,r,x)=>{const[R,m]=reactExports.useState([]),[a,n]=reactExports.useState([]),[l,s]=reactExports.useState([]),[o,c]=reactExports.useState(!1),[E,d]=reactExports.useState(!1),[p,h]=reactExports.useState(!1);useToast();const u=()=>{const i=new URLSearchParams({start:format(e.from,"yyyy-MM-dd"),end:format(e.to,"yyyy-MM-dd")});return r&&r.length>0&&r.forEach(f=>i.append("locations",f)),x&&x.length>0&&x.forEach(f=>i.append("sites",f)),i},y=async()=>{c(!0);try{const i=u();i.append("limit","100");const f=await fetch(`${API_ENDPOINTS.RANKINGS_STAFF}?${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(f.ok){const N=await f.json();m(N)}}catch(i){console.error(i)}finally{c(!1)}},j=async()=>{d(!0);try{const i=u();i.append("limit","100"),i.append("metric","revenue");const f=await fetch(`${API_ENDPOINTS.RANKINGS_CLIENTS}?${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(f.ok){const N=await f.json();n(N)}}catch(i){console.error(i)}finally{d(!1)}},v=async()=>{h(!0);try{const i=u();i.append("limit","100"),i.append("metric","shifts");const f=await fetch(`${API_ENDPOINTS.RANKINGS_CLIENTS}?${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(f.ok){const N=await f.json();s(N)}}catch(i){console.error(i)}finally{h(!1)}};return reactExports.useEffect(()=>{y(),j(),v()},[e,r,x]),{topStaff:R,isLoadingStaff:o,topClientsRevenue:a,isLoadingClientsRev:E,topClientsShifts:l,isLoadingClientsShifts:p}},RankingList=({title:e,data:r,isLoading:x=!1,valueFormatter:R=l=>l.toLocaleString(),icon:m,className:a,barColor:n="bg-primary"})=>{const l=Math.max(...r.map(o=>o.value),0),s=o=>o.toLowerCase().split(" ").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ");return jsxRuntimeExports.jsxs(Card,{className:cn("flex flex-col h-full shadow-sm hover:shadow-md transition-shadow min-w-0",a),children:[jsxRuntimeExports.jsxs(CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[m&&jsxRuntimeExports.jsx("div",{className:"p-1.5 bg-muted rounded-md",children:m}),jsxRuntimeExports.jsx(CardTitle,{className:"text-sm font-medium",children:e})]}),jsxRuntimeExports.jsx(Ellipsis,{className:"h-4 w-4 text-muted-foreground cursor-pointer hover:text-foreground"})]}),jsxRuntimeExports.jsx(CardContent,{className:"pt-4 flex-1 min-w-0",children:x?jsxRuntimeExports.jsx("div",{className:"space-y-4",children:[...Array(5)].map((o,c)=>jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-2",children:[jsxRuntimeExports.jsx("div",{className:"h-4 w-1/3 bg-muted animate-pulse rounded"}),jsxRuntimeExports.jsx("div",{className:"h-2 w-full bg-muted animate-pulse rounded"})]},c))}):r.length===0?jsxRuntimeExports.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground p-4",children:"No data available"}):jsxRuntimeExports.jsx(ScrollArea,{className:"h-[240px]",children:jsxRuntimeExports.jsx("div",{className:"space-y-6 pr-4",children:r.map((o,c)=>jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-2 group min-w-0",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between text-sm gap-2",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[jsxRuntimeExports.jsx("span",{className:"flex h-5 w-5 flex-shrink-0 items-center justify-center rounded-full bg-muted text-[10px] font-medium text-muted-foreground group-hover:bg-primary group-hover:text-primary-foreground transition-colors",children:c+1}),jsxRuntimeExports.jsx("span",{className:"font-medium",title:o.name,children:s(o.name)})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-1.5",children:[jsxRuntimeExports.jsx(Progress,{value:l>0?o.value/l*100:0,className:cn("h-1.5 w-full",n&&`[&>*]:${n}`)}),jsxRuntimeExports.jsx("div",{className:"flex justify-end",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-muted-foreground whitespace-nowrap",children:R(o.value)})})]})]},c))})})})]})},VARIABLES=[{id:"REV",name:"Revenue",icon:"£"},{id:"COST",name:"Cost",icon:"£"},{id:"HRS",name:"Paid Hours",icon:"H"},{id:"SHIFTS",name:"Total Shifts",icon:"S"},{id:"OVH",name:"Overheads",icon:"£"}],OPERATORS=["+","-","*","/","(",")"],CustomMetricsModal=({isOpen,onClose})=>{const{addMetric,customMetrics,removeMetric}=useCustomMetrics(),[name,setName]=reactExports.useState(""),[formula,setFormula]=reactExports.useState(""),handleAddVariable=e=>{setFormula(r=>r+(r&&!r.endsWith("(")?" ":"")+e)},handleAddOperator=e=>{setFormula(r=>r+(r&&!r.endsWith("(")?" ":"")+e)},handleSave=()=>{if(!name||!formula){ue.error("Please provide both a name and a formula");return}try{const testFormula=formula.replace(/[A-Z]+/g,"1");eval(testFormula)}catch(e){ue.error("Invalid formula syntax");return}addMetric({name,formula}),ue.success(`Metric "${name}" created!`),setName(""),setFormula("")};return jsxRuntimeExports.jsx(Dialog,{open:isOpen,onOpenChange:onClose,children:jsxRuntimeExports.jsxs(DialogContent,{className:"sm:max-w-[500px]",children:[jsxRuntimeExports.jsxs(DialogHeader,{children:[jsxRuntimeExports.jsx(DialogTitle,{children:"Custom Metrics Builder"}),jsxRuntimeExports.jsx(DialogDescription,{children:"Create session-only metrics by combining existing data variables."})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-6 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"grid gap-2",children:[jsxRuntimeExports.jsx(Label,{htmlFor:"name",children:"Metric Name"}),jsxRuntimeExports.jsx(Input,{id:"name",placeholder:"e.g. Gross Margin %",value:name,onChange:e=>setName(e.target.value)})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-2",children:[jsxRuntimeExports.jsx(Label,{children:"Formula Builder"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2 p-3 border rounded-md bg-muted/30 min-h-[60px] items-center",children:formula||jsxRuntimeExports.jsx("span",{className:"text-muted-foreground text-sm italic",children:"Build your formula below..."})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Variables"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:VARIABLES.map(e=>jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",className:"h-8 gap-1",onClick:()=>handleAddVariable(e.id),children:[jsxRuntimeExports.jsx("span",{className:"text-[10px] w-4 h-4 rounded-full bg-primary/10 flex items-center justify-center font-bold",children:e.icon}),e.name]},e.id))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Operators"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[OPERATORS.map(e=>jsxRuntimeExports.jsx(Button,{variant:"secondary",size:"sm",className:"h-8 w-8 p-0 font-mono",onClick:()=>handleAddOperator(e),children:e},e)),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",className:"h-8 px-2 ml-auto",onClick:()=>setFormula(""),children:"Clear"})]})]})]}),customMetrics.length>0&&jsxRuntimeExports.jsxs("div",{className:"pt-4 border-t",children:[jsxRuntimeExports.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:"Active Metrics"}),jsxRuntimeExports.jsx("div",{className:"mt-2 space-y-2",children:customMetrics.map(e=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 text-sm border",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("span",{className:"font-medium",children:[e.name,":"]}),jsxRuntimeExports.jsx("code",{className:"text-[10px] px-1 bg-background rounded",children:e.formula})]}),jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-destructive",onClick:()=>removeMetric(e.id),children:jsxRuntimeExports.jsx(X,{className:"h-3 w-3"})})]},e.id))})]})]}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:onClose,children:"Done"}),jsxRuntimeExports.jsxs(Button,{onClick:handleSave,className:"gap-2",children:[jsxRuntimeExports.jsx(Plus,{className:"h-4 w-4"}),"Create Metric"]})]})]})})};export{CustomMetricsModal as C,DashboardHeader as D,RankingList as R,calculateMetrics as c,useRankings as u};
