import{r as u,a as A,A as C,j as e}from"./index-BqtMKZPn.js";import{f as g}from"./popover-C1_ClfRG.js";import{C as S,a as N,b as R,d as T}from"./card-c0KSrgfz.js";import{R as O,C as w,X as K,Y as L,T as D,L as H,A as n}from"./generateCategoricalChart-OW-BsXSX.js";import{A as W}from"./AreaChart-CdErFBQt.js";const _=(o,s,t)=>{const[r,c]=u.useState(null),[f,a]=u.useState(!1),{toast:d}=A(),h=async()=>{a(!0);try{const i=new URLSearchParams({start:g(o.from,"yyyy-MM-dd"),end:g(o.to,"yyyy-MM-dd")});s&&s.length>0&&s.forEach(l=>i.append("locations",l)),t&&t.length>0&&t.forEach(l=>i.append("sites",l));const m=i.toString(),p={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},[y,x]=await Promise.all([fetch(`${C.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${m}`,{headers:p}),fetch(`${C.CLIENT_DISTRIBUTION}?${m}`,{headers:p})]);if(y.ok){const l=await y.json();if(x.ok){const v=await x.json();v.timeSeries&&(l.timeSeries=l.timeSeries.map(j=>{const k=v.timeSeries.find(b=>b.period===j.period);return{...j,clientCount:k?k.clientCount:0}}))}c(l)}else d({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch(i){console.error(i),d({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{a(!1)}};return u.useEffect(()=>{h()},[o,s,t]),{financialData:r,isLoading:f,refetch:h}},E=({active:o,payload:s,label:t})=>o&&s&&s.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:t}),s.map((r,c)=>e.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",r.name.includes("Revenue")||r.name.includes("Cost")||r.name.includes("Profit")?`£${Number(r.value).toLocaleString()}`:r.value.toLocaleString()]},c))]}):null,z=({data:o,aggregationLevel:s,selectedMetric:t="revenue"})=>{const r={dataKey:"display",interval:0};if(!o||o.length===0)return e.jsxs(S,{className:"flex-1",children:[e.jsx(N,{children:e.jsx(R,{children:"Financial Trend"})}),e.jsx(T,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const c=()=>{switch(t){case"revenue":return"Revenue vs Cost Trend";case"cost":return"Cost Overview";case"profit":return"Profit Trend";case"shifts":return"Total Shifts Trend";case"clients":return"Total Clients Trend";case"employees":return"Staff Hours Trend";case"clientRate":return"Average Client Hourly Rate";case"staffRate":return"Average Staff Hourly Rate";case"overheads":return"Total Overheads Trend";default:return"Financial Trend"}},f=()=>{switch(t){case"revenue":case"cost":case"profit":case"overheads":return"Amount (£)";case"clientRate":case"staffRate":return"Rate (£/hr)";case"shifts":return"Shifts";case"clients":return"Clients";case"employees":return"Hours";default:return""}};return e.jsxs(S,{className:"flex-1",children:[e.jsxs(N,{children:[e.jsx(R,{children:c()}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s==="daily"&&"Daily view",s==="weekly"&&"Weekly view",s==="monthly"&&"Monthly view"]})]}),e.jsx(T,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(W,{data:o,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:r.dataKey,tick:{fontSize:12},interval:r.interval}),e.jsx(L,{label:{value:f(),angle:-90,position:"insideLeft"}}),e.jsx(D,{content:e.jsx(E,{})}),e.jsx(H,{}),t==="revenue"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(n,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]}),t==="cost"&&e.jsx(n,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.5,strokeWidth:2}),t==="overheads"&&e.jsx(n,{type:"monotone",dataKey:"overheads",name:"Overheads",stroke:"hsl(262, 83%, 58%)",fill:"hsl(262, 83%, 58%)",fillOpacity:.5,strokeWidth:2}),t==="profit"&&e.jsx(n,{type:"monotone",dataKey:a=>{const d=a.revenue||0,h=a.cost||0,i=a.overheads||0;return d-(h+i)},name:"Net Profit",stroke:"hsl(142, 76%, 36%)",fill:"hsl(142, 76%, 36%)",fillOpacity:.5,strokeWidth:2}),t==="clientRate"&&e.jsx(n,{type:"monotone",dataKey:a=>a.paidHours>0?a.revenue/a.paidHours:0,name:"Client Rate",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),t==="staffRate"&&e.jsx(n,{type:"monotone",dataKey:a=>a.paidHours>0?a.cost/a.paidHours:0,name:"Staff Rate",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2}),t==="shifts"&&e.jsx(n,{type:"monotone",dataKey:"totalShifts",name:"Total Shifts",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.5,strokeWidth:2}),t==="clients"&&e.jsx(n,{type:"monotone",dataKey:"clientCount",name:"Clients",stroke:"hsl(262, 83%, 58%)",fill:"hsl(262, 83%, 58%)",fillOpacity:.5,strokeWidth:2}),t==="employees"&&e.jsx(n,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.5,strokeWidth:2})]})})})})]})},U=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})});export{U as L,z as R,_ as u};
