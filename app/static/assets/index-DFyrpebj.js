import{c as de,ab as Y,r as b,ac as ue,j as e,e as $,B as L,T as G,k as U,l as q,m as Q,I as R}from"./index-rPM3s_Y2.js";import{D as ce,T as me}from"./DashboardLayout-DI3MN083.js";import{D as V,b as J,c as K,d as W,e as Z,a as X}from"./dialog-CzBLNpsY.js";import{L as fe}from"./label-C2SG_JRk.js";import{e as pe,C as be,b as he}from"./calendar-wPgt8F6O.js";import{f as P,P as xe,a as ge,b as ye}from"./popover-D4Hisapw.js";import{T as ee}from"./trash-2-Bm9xyBYn.js";import{P as te}from"./plus-DasejSqt.js";import"./users-D2UsnzQI.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=de("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);function _e(t,r){const d=Y(t.start),l=Y(t.end);let c=+d>+l;const h=c?+d:+l,n=c?l:d;n.setHours(0,0,0,0),n.setDate(1);let o=1;const u=[];for(;+n<=h;)u.push(Y(n)),n.setMonth(n.getMonth()+o);return c?u.reverse():u}const ve=t=>{let r="";for(;t>=0;)r=String.fromCharCode(t%26+65)+r,t=Math.floor(t/26)-1;return r},re=(t,r)=>`${ve(r)}${t+1}`,oe=t=>{const r=t.match(/^([A-Z]+)([0-9]+)$/);if(!r)return null;const d=r[1],l=r[2];let c=0;for(let n=0;n<d.length;n++)c=c*26+(d.charCodeAt(n)-64);return c-=1,{rowIdx:parseInt(l,10)-1,colIdx:c}},se=(t,r,d,l)=>{if(!t)return"";const c=d.findIndex(m=>m.id===l),h=new Map(r.map((m,g)=>[m.id,g])),n=new Map(d.map((m,g)=>[m.id,g]));let o=t;o=o.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(m,g,v)=>{const j=h.get(g),k=n.get(v);return j!==void 0&&k!==void 0?re(j,k):m});const u=Array.from(h.keys()).sort((m,g)=>g.length-m.length);for(const m of u){const g=new RegExp(`\\b${m}\\b`,"g");if(g.test(o)){const v=h.get(m);o=o.replace(g,re(v,c))}}return o},je=(t,r,d,l)=>{if(!t)return"";let c=t;const h=d.findIndex(n=>n.id===l);return c=c.replace(/\b([A-Z]+)([0-9]+)\b/g,n=>{const o=oe(n);if(!o)return n;const u=r[o.rowIdx],m=d[o.colIdx];return!u||!m?n:o.colIdx===h?u.id:`${u.id}:${m.id}`}),c},H=t=>{if(!(t!=null&&t.from)||!(t!=null&&t.to))return[{id:"jan",label:"January",isProtected:!0},{id:"feb",label:"February",isProtected:!0},{id:"mar",label:"March",isProtected:!0},{id:"apr",label:"April",isProtected:!0},{id:"may",label:"May",isProtected:!0},{id:"jun",label:"June",isProtected:!0},{id:"jul",label:"July",isProtected:!0},{id:"aug",label:"August",isProtected:!0},{id:"sep",label:"September",isProtected:!0},{id:"oct",label:"October",isProtected:!0},{id:"nov",label:"November",isProtected:!0},{id:"dec",label:"December",isProtected:!0},{id:"year_end",label:"Year End",isProtected:!0,isYearEnd:!0}];const d=_e({start:ue(t.from),end:pe(t.to)}).map(l=>({id:P(l,"MMM-yyyy").toLowerCase(),label:P(l,"MMM yyyy"),isProtected:!0}));return d.push({id:"year_end",label:"Period Total",isProtected:!0,isYearEnd:!0}),d},ae=(t,r,d)=>{var l,c;try{const h=Object.keys(r).sort((u,m)=>m.length-u.length);let n=t;n=n.replace(/([a-zA-Z0-9_]+):([a-zA-Z0-9_]+)/g,(u,m,g)=>{var j,k;return`(${((k=(j=r[m])==null?void 0:j[g])==null?void 0:k.value)??0})`});for(const u of h){const m=new RegExp(`\\b${u}\\b`,"g");if(m.test(n)){const g=((c=(l=r[u])==null?void 0:l[d])==null?void 0:c.value)??0;n=n.replace(m,`(${g})`)}}if(!/^[0-9+\-*/().\s]*$/.test(n))return null;const o=new Function(`return ${n}`)();return typeof o=="number"&&!isNaN(o)&&isFinite(o)?o:null}catch{return null}},we=["cost_sales_se","cost_sales_paye","employee_ni","employee_pension"],Se=["apprenticeship_levy","annual_leave","other_expenses","recruitment_cost","overheads_mgmt","bank_interest","cooperation_tax"],B=[{id:"total_sales",label:"Total Sales",isAutoCalculated:!1,isCurrency:!0},{id:"sales_split_pct",label:"% Sales Split",isAutoCalculated:!0,isPercentage:!0,formulaString:"total_sales / total_sales:year_end"},{id:"cost_sales_se",label:"Cost of Sales SE",isAutoCalculated:!1,isCurrency:!0},{id:"cost_sales_paye",label:"Cost of Sales PAYE Gross",isAutoCalculated:!1,isCurrency:!0},{id:"employee_ni",label:"Employee NI",isAutoCalculated:!1,isCurrency:!0},{id:"employee_pension",label:"Employee Pension",isAutoCalculated:!1,isCurrency:!0},{id:"total_cost_sales",label:"Total Cost of Sales",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:we.join(" + ")},{id:"apprenticeship_levy",label:"Apprenticeship Levy",isAutoCalculated:!1,isCurrency:!0},{id:"annual_leave",label:"Annual Leave Accrual",isAutoCalculated:!1,isCurrency:!0},{id:"other_expenses",label:"Other Expenses",isAutoCalculated:!1,isCurrency:!0},{id:"recruitment_cost",label:"Recruitment & Pass Cost",isAutoCalculated:!1,isCurrency:!0},{id:"overheads_mgmt",label:"Total Mgmt & Office Cost",isAutoCalculated:!1,isCurrency:!0},{id:"bank_interest",label:"Bank Interest",isAutoCalculated:!1,isCurrency:!0},{id:"cooperation_tax",label:"Cooperation Tax",isAutoCalculated:!1,isCurrency:!0},{id:"total_overheads",label:"Total Overheads",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:Se.join(" + ")},{id:"total_cost",label:"Total Cost",isAutoCalculated:!0,isCurrency:!0,isHeader:!0,formulaString:"total_cost_sales + total_overheads"},{id:"avg_hourly_charge",label:"Avg Hourly Charge Rate",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_pay",label:"Avg Hourly Pay",isAutoCalculated:!1,isCurrency:!0},{id:"gross_hourly_margin",label:"Gross Hourly Margin",isAutoCalculated:!0,isCurrency:!0,formulaString:"avg_hourly_charge - gross_hourly_pay"},{id:"net_cost_per_hour",label:"Net Cost per Hour",isAutoCalculated:!1,isCurrency:!0},{id:"gross_pl_value",label:"Gross P&L Value",isAutoCalculated:!1,isCurrency:!0},{id:"net_pl",label:"Net P&L",isAutoCalculated:!1,isCurrency:!0},{id:"total_net_margin",label:"Total Net Margin",isAutoCalculated:!1,isPercentage:!0},{id:"worked_hours",label:"Worked Hours",isAutoCalculated:!1},{id:"hours_breakeven",label:"Hours for Breakeven",isAutoCalculated:!0,formulaString:"total_cost / gross_hourly_margin"},{id:"value_breakeven",label:"Total Value for Breakeven",isAutoCalculated:!0,isCurrency:!0,formulaString:"hours_breakeven * avg_hourly_charge"},{id:"sales_budget",label:"Sales Budget 30% Uplift",isAutoCalculated:!0,isCurrency:!0,formulaString:"total_sales * 1.3"},{id:"avg_hourly_charge_2026",label:"Avg Hourly Charge Rate 2026",isAutoCalculated:!1,isCurrency:!0},{id:"sales_target_hours",label:"Sales Target in Hours",isAutoCalculated:!1},{id:"variance_2025",label:"Variance Against 2025",isAutoCalculated:!1,isCurrency:!0}];function le(t,r){const d={};for(const l of t){d[l.id]={};for(const c of r)d[l.id][c.id]={value:null,isEditable:!l.isAutoCalculated&&!c.isYearEnd,source:"manual"}}return d}function F(t,r,d){const l=JSON.parse(JSON.stringify(t)),c=d.filter(o=>!o.isYearEnd),h=d.find(o=>o.isYearEnd);for(const o of c)for(const u of r)u.id!=="sales_split_pct"&&(u.formulaString?l[u.id][o.id]={...l[u.id][o.id],value:ae(u.formulaString,l,o.id),isEditable:!1,source:"formula"}:u.formula&&(l[u.id][o.id]={...l[u.id][o.id],value:u.formula(l,u.id,o.id),isEditable:!1,source:"formula"}));if(h)for(const o of r){if(o.id==="sales_split_pct")continue;const u=c.reduce((m,g)=>{var v,j;return m+(((j=(v=l[o.id])==null?void 0:v[g.id])==null?void 0:j.value)??0)},0);l[o.id][h.id]={value:u,isEditable:!1,source:"calculated"}}const n=r.find(o=>o.id==="sales_split_pct");if(n&&n.formulaString&&h){for(const o of c){const u=ae(n.formulaString,l,o.id);l[n.id][o.id]={value:u?u*100:0,isEditable:!1,source:"formula"}}l[n.id][h.id]={value:100,isEditable:!1,source:"calculated"}}return l}function ke(t){const[r,d]=b.useState(B),[l,c]=b.useState(()=>H(t)),[h,n]=b.useState(()=>F(le(B,H(t)),B,H(t))),[o,u]=b.useState(null);b.useEffect(()=>{const s=H(t);c(s);let i=le(r,s);t!=null&&t.from&&(t!=null&&t.to)?(async()=>{try{const f=P(t.from,"yyyy-MM-dd"),p=P(t.to,"yyyy-MM-dd"),w=localStorage.getItem("auth_token"),C=await fetch(`undefined/api/financial-summary/metrics?start=${f}&end=${p}`,{headers:{Authorization:`Bearer ${w}`}});if(C.ok){const a=await C.json(),y={January:"jan",February:"feb",March:"mar",April:"apr",May:"may",June:"jun",July:"jul",August:"aug",September:"sep",October:"oct",November:"nov",December:"dec"};for(const[S,_]of Object.entries(a)){const[z,T]=S.split("-"),M=y[T];if(!M)continue;const A=`${M}-${z}`;s.find(I=>I.id===A)&&(i.total_sales&&i.total_sales[A]&&(i.total_sales[A].value=_.total_sales,i.total_sales[A].source="database"),i.cost_sales_paye&&i.cost_sales_paye[A]&&(i.cost_sales_paye[A].value=_.cost_sales_paye,i.cost_sales_paye[A].source="database"))}n(F(i,r,s))}else n(F(i,r,s))}catch(f){console.error("Failed to fetch metrics",f),n(F(i,r,s))}})():n(F(i,r,s))},[t]);const m=b.useCallback((s,i,x)=>{n(f=>{const p={...f};return p[s]={...p[s]},p[s][i]={...p[s][i],value:x,source:"manual"},F(p,r,l)})},[r,l]),g=b.useCallback((s,i)=>{d(x=>{const f=x.map(p=>p.id===s?{...p,formulaString:i}:p);return n(p=>F(p,f,l)),f})},[l]),v=b.useCallback(s=>{const i=`custom_${Date.now()}`,x={id:i,label:s,isAutoCalculated:!1,isCurrency:!0};d(f=>{const p=[...f,x];return n(w=>{const C={...w};C[i]={};for(const a of l)C[i][a.id]={value:null,isEditable:!a.isYearEnd,source:"manual"};return F(C,p,l)}),p})},[l]),j=b.useCallback(s=>{d(i=>i.filter(x=>x.id!==s)),n(i=>{const x={...i};return delete x[s],x})},[]),k=b.useCallback(s=>{const i=`col_${Date.now()}`,x={id:i,label:s};c(f=>{const p=f.findIndex(C=>C.isYearEnd),w=[...f];return w.splice(p,0,x),n(C=>{const a={...C};for(const y of r)a[y.id]={...a[y.id]},a[y.id][i]={value:null,isEditable:!y.isAutoCalculated,source:"manual"};return F(a,r,w)}),w})},[r]),N=b.useCallback(s=>{c(i=>{const x=i.filter(f=>f.id!==s);return n(f=>{const p={...f};for(const w of Object.keys(p)){const{[s]:C,...a}=p[w];p[w]=a}return F(p,r,x)}),x})},[r]),D=b.useCallback((s,i)=>{c(x=>x.map(f=>f.id===s?{...f,label:i}:f))},[]),E=b.useCallback(s=>{if(!o)return;const i=r.filter(a=>!a.isAutoCalculated),x=l.filter(a=>!a.isYearEnd),f=i.findIndex(a=>a.id===o.row),p=x.findIndex(a=>a.id===o.col);if(f===-1||p===-1)return;let w=f,C=p;switch(s){case"up":w=Math.max(0,f-1);break;case"down":w=Math.min(i.length-1,f+1);break;case"left":C=Math.max(0,p-1);break;case"right":C=Math.min(x.length-1,p+1);break}u({row:i[w].id,col:x[C].id})},[o,r,l]),O=b.useCallback(async s=>{if(s)try{const i={year:new Date().getFullYear(),data:h,rows:r,columns:l},x=localStorage.getItem("auth_token");if(!(await fetch("undefined/api/financial-summary/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify(i)})).ok)throw new Error("Failed to save")}catch(i){throw console.error("Save failed",i),i}},[h,r,l]);return{rows:r,columns:l,data:h,activeCell:o,setActiveCell:u,updateCell:m,addRow:v,deleteRow:j,addColumn:k,deleteColumn:N,renameColumn:D,navigateCell:E,saveData:O,updateRowFormula:g}}function Ae(t){let r="",d=t;for(;d>=0;)r=String.fromCharCode(65+d%26)+r,d=Math.floor(d/26)-1;return r}const ne={database:{bg:"border-l-blue-500",border:"border-l-2",label:"Database"},manual:{bg:"border-l-transparent",border:"",label:"Manual"},formula:{bg:"border-l-orange-500",border:"border-l-2",label:"Formula"},calculated:{bg:"border-l-emerald-500",border:"border-l-2",label:"Calculated"}};function ie(t,r){return t===null?"":t===0?r.isCurrency?"£0.00":"0":r.isPercentage?`${t.toFixed(2)}%`:r.isCurrency?`£${t.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}`:t.toLocaleString("en-GB",{maximumFractionDigits:2})}function Ne({rowId:t,colId:r,value:d,source:l,row:c,isActive:h,isHighlighted:n,onFocus:o,onUpdate:u,onNavigate:m}){const[g,v]=b.useState(!1),[j,k]=b.useState(""),N=b.useRef(null),D=b.useCallback(()=>{v(!0),k(d!==null?String(d):""),setTimeout(()=>{var s;return(s=N.current)==null?void 0:s.focus()},0)},[d]),E=b.useCallback(()=>{v(!1);const s=parseFloat(j);u(j===""?null:isNaN(s)?d:s)},[j,u,d]),O=s=>{g?s.key==="Enter"||s.key==="Tab"?(s.preventDefault(),E(),m(s.shiftKey?"up":"down")):s.key==="Escape"&&v(!1):s.key==="Enter"||s.key==="F2"?(s.preventDefault(),D()):s.key==="ArrowUp"?(s.preventDefault(),m("up")):s.key==="ArrowDown"?(s.preventDefault(),m("down")):s.key==="ArrowLeft"?(s.preventDefault(),m("left")):s.key==="ArrowRight"?(s.preventDefault(),m("right")):s.key==="Delete"||s.key==="Backspace"?(s.preventDefault(),u(null)):/^[0-9.\-]$/.test(s.key)&&(s.preventDefault(),k(s.key),v(!0),setTimeout(()=>{var i;return(i=N.current)==null?void 0:i.focus()},0))};return e.jsx(G,{delayDuration:300,children:e.jsxs(U,{children:[e.jsx(q,{asChild:!0,children:e.jsx("td",{className:$("relative border-r border-b border-border/40 px-2 py-[5px] text-right text-[13px] min-w-[120px] cursor-cell select-none transition-all duration-75",h&&"outline outline-2 outline-primary z-10 bg-primary/5",n&&"ring-2 ring-orange-400/70 bg-orange-50/30 dark:bg-orange-950/20",!h&&!n&&"hover:bg-muted/30"),onClick:o,onDoubleClick:D,onKeyDown:O,tabIndex:0,onFocus:o,children:g?e.jsx("input",{ref:N,type:"text",value:j,onChange:s=>k(s.target.value),onBlur:E,className:"w-full bg-background text-right outline-none text-[13px] font-mono border border-primary/30 rounded px-1 -mx-1"}):e.jsx("span",{className:"font-mono text-[13px] text-foreground/90",children:ie(d,c)})})}),e.jsxs(Q,{side:"top",className:"text-xs",children:[e.jsx("div",{className:"font-semibold",children:ne[l||"manual"].label}),c.formulaString&&e.jsxs("div",{className:"mt-1 text-muted-foreground font-mono bg-muted px-1 rounded",children:["= ",c.formulaString]})]})]})})}function De({value:t,row:r,source:d,isHighlighted:l}){return e.jsx(G,{delayDuration:300,children:e.jsxs(U,{children:[e.jsx(q,{asChild:!0,children:e.jsx("td",{className:$("relative border-r border-b border-border/40 px-2 py-[5px] text-right text-[13px] min-w-[120px] select-none",r.isHeader?"bg-primary/[0.06] font-semibold":"bg-muted/20",l&&"ring-2 ring-orange-400/70 bg-orange-50/30 dark:bg-orange-950/20"),children:e.jsx("span",{className:$("font-mono text-[13px]",r.isHeader?"text-foreground font-semibold":"text-muted-foreground"),children:ie(t,r)})})}),e.jsxs(Q,{side:"top",className:"text-xs",children:[e.jsx("div",{className:"font-semibold",children:ne[d||"manual"].label}),r.formulaString&&e.jsxs("div",{className:"mt-1 text-muted-foreground font-mono bg-muted px-1 rounded",children:["= ",r.formulaString]}),!r.formulaString&&r.isAutoCalculated&&e.jsx("div",{className:"mt-1 text-muted-foreground italic",children:"Complex calculation"})]})]})})}function Ee({isOpen:t,onClose:r,row:d,initialFormula:l,onSave:c}){const[h,n]=b.useState(l);return b.useEffect(()=>{n(l)},[l]),d?e.jsx(V,{open:t,onOpenChange:o=>!o&&r(),children:e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs(W,{children:["Edit Formula: ",d.label]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(fe,{htmlFor:"formula",className:"text-right",children:"Formula"}),e.jsx(R,{id:"formula",value:h,onChange:o=>n(o.target.value),className:"col-span-3 font-mono"})]}),e.jsx("div",{className:"text-xs text-muted-foreground ml-[25%]",children:"Supported: A1, B2, +, -, *, /, ( )"})]}),e.jsx(Z,{children:e.jsx(L,{type:"submit",onClick:()=>c(h),children:"Save changes"})})]})}):null}function Me({rows:t,columns:r,data:d,activeCell:l,setActiveCell:c,updateCell:h,deleteRow:n,deleteColumn:o,navigateCell:u,onRenameColumn:m,updateRowFormula:g}){const[v,j]=b.useState(null),[k,N]=b.useState(""),[D,E]=b.useState(null),O=b.useRef(null),[s,i]=b.useState(null),x=a=>{j(a.id),N(a.label),setTimeout(()=>{var y;return(y=O.current)==null?void 0:y.focus()},0)},f=()=>{v&&m&&m(v,k),j(null)},p=a=>{i(a)},w=a=>{if(s&&g){const y=je(a,t,r,r[0].id);g(s.id,y)}i(null)},C=b.useMemo(()=>{if(!D)return new Set;const a=t.find(S=>S.id===D),y=a==null?void 0:a.formulaString;if(!y){const S=["cost_sales_se","cost_sales_paye","employee_ni","employee_pension"],_=["apprenticeship_levy","annual_leave","other_expenses","recruitment_cost","overheads_mgmt","bank_interest","cooperation_tax"],T={total_cost_sales:S,total_overheads:_,total_cost:[...S,..._],gross_hourly_margin:["avg_hourly_charge","gross_hourly_pay"],hours_breakeven:["total_cost","gross_hourly_margin"],value_breakeven:["hours_breakeven","avg_hourly_charge"],sales_budget_2026:["total_sales"],gross_pl_value:["total_sales","total_cost"],net_pl:["gross_pl_value","total_overheads"]}[D]||[],M=new Set;for(const A of T)for(const I of r)M.add(`${A}:${I.id}`);return M}if(y){const S=se(y,t,r,r[0].id),_=new Set,z=/\b[A-Z]+[0-9]+\b/g;let T;for(;(T=z.exec(S))!==null;){const M=oe(T[0]);if(M){const A=t[M.rowIdx],I=r[M.colIdx];A&&I&&_.add(`${A.id}:${I.id}`)}}return _}return new Set},[D,t,r]);return e.jsxs("div",{className:"border border-border rounded-md bg-card overflow-hidden shadow-sm",children:[e.jsx("div",{className:"overflow-auto max-h-[calc(100vh-200px)]",children:e.jsxs("table",{className:"border-collapse w-full",children:[e.jsxs("thead",{className:"sticky top-0 z-30",children:[e.jsxs("tr",{className:"bg-muted/60",children:[e.jsx("th",{className:"sticky left-0 z-40 bg-muted/80 border-r border-b border-border/50 w-10 min-w-[40px]"}),e.jsx("th",{className:"sticky left-10 z-40 bg-muted/80 border-r border-b border-border/50 w-[200px] min-w-[200px]"}),r.map((a,y)=>e.jsx("th",{className:"border-r border-b border-border/50 px-1 py-1 text-center text-[11px] font-medium text-muted-foreground bg-muted/60 min-w-[120px]",children:Ae(y)},y)),e.jsx("th",{className:"bg-muted/60 border-b border-border/50 w-8"})]}),e.jsxs("tr",{className:"bg-muted/40",children:[e.jsx("th",{className:"sticky left-0 z-40 bg-muted/60 border-r border-b border-border/50 w-10 min-w-[40px] text-[10px] text-muted-foreground font-medium",children:"#"}),e.jsx("th",{className:"sticky left-10 z-40 bg-muted/60 border-r border-b border-border/50 px-3 py-2 text-left text-[11px] font-semibold text-muted-foreground uppercase tracking-wider w-[200px] min-w-[200px]",children:"Description"}),r.map(a=>e.jsx("th",{className:$("border-r border-b border-border/50 px-1 py-2 text-center text-[11px] font-semibold uppercase tracking-wide min-w-[120px]",a.isYearEnd?"bg-primary/10 text-primary":"bg-muted/40 text-muted-foreground"),onDoubleClick:()=>!a.isProtected&&x(a),children:e.jsx("div",{className:"flex items-center justify-center gap-1 group relative",children:v===a.id?e.jsx("input",{ref:O,value:k,onChange:y=>N(y.target.value),onBlur:f,onKeyDown:y=>y.key==="Enter"&&f(),className:"w-full bg-background border border-border rounded px-1 text-center text-[11px]"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"truncate",children:a.label}),!a.isProtected&&e.jsx(L,{variant:"ghost",size:"icon",className:"h-4 w-4 opacity-0 group-hover:opacity-100 absolute -right-1 hover:text-destructive",onClick:y=>{y.stopPropagation(),o(a.id)},children:e.jsx(ee,{className:"h-3 w-3"})})]})})},a.id)),e.jsx("th",{className:"bg-muted/40 border-b border-border/50 w-8"})]})]}),e.jsx("tbody",{children:t.map((a,y)=>e.jsxs("tr",{className:$("group",a.isHeader&&"bg-primary/[0.04]"),onMouseEnter:()=>(a.isAutoCalculated||a.formulaString)&&E(a.id),onMouseLeave:()=>E(null),children:[e.jsx("td",{className:"sticky left-0 z-10 bg-muted/60 border-r border-b border-border/50 text-center text-[11px] text-muted-foreground font-medium w-10 min-w-[40px] select-none",children:y+1}),e.jsx("td",{className:$("sticky left-10 z-10 border-r border-b border-border/50 px-3 py-[5px] whitespace-nowrap text-[13px] truncate max-w-[200px] w-[200px] min-w-[200px] bg-card",a.isHeader&&"font-bold text-primary bg-primary/[0.04]",a.isAutoCalculated&&!a.isHeader&&"text-muted-foreground italic"),title:a.label,children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"truncate",children:a.label}),(a.isAutoCalculated||a.formulaString)&&e.jsx(G,{delayDuration:200,children:e.jsxs(U,{children:[e.jsx(q,{asChild:!0,children:e.jsx("button",{className:"opacity-0 group-hover:opacity-70 hover:!opacity-100 transition-opacity",onClick:()=>p(a),children:e.jsx(Ce,{className:"h-3.5 w-3.5 text-orange-500"})})}),e.jsx(Q,{side:"right",className:"text-xs",children:"Edit formula"})]})})]})}),r.map(S=>{var A;const _=(A=d[a.id])==null?void 0:A[S.id],z=(_==null?void 0:_.isEditable)&&!a.isAutoCalculated&&!S.isYearEnd,T=`${a.id}:${S.id}`,M=C.has(T);return z?e.jsx(Ne,{rowId:a.id,colId:S.id,value:(_==null?void 0:_.value)??null,source:_==null?void 0:_.source,row:a,isActive:(l==null?void 0:l.row)===a.id&&(l==null?void 0:l.col)===S.id,isHighlighted:M,onFocus:()=>c({row:a.id,col:S.id}),onUpdate:I=>h(a.id,S.id,I),onNavigate:u},S.id):e.jsx(De,{value:(_==null?void 0:_.value)??null,row:a,source:_==null?void 0:_.source,isHighlighted:M},S.id)}),e.jsx("td",{className:"border-b border-border/40 bg-card w-8 text-center p-0",children:!a.isAutoCalculated&&e.jsx(L,{variant:"ghost",size:"icon",className:"h-5 w-5 opacity-0 group-hover:opacity-100 hover:text-destructive hover:bg-destructive/10",onClick:()=>n(a.id),children:e.jsx(ee,{className:"h-3 w-3"})})})]},a.id))})]})}),s&&e.jsx(Ee,{isOpen:!0,onClose:()=>i(null),row:s,initialFormula:se(s.formulaString||"",t,r,r[0].id),onSave:w})]})}function Ye(){const[t,r]=b.useState({from:new Date(new Date().getFullYear(),0,1),to:new Date(new Date().getFullYear(),11,31)}),{rows:d,columns:l,data:c,activeCell:h,setActiveCell:n,updateCell:o,addRow:u,deleteRow:m,addColumn:g,deleteColumn:v,navigateCell:j,updateRowFormula:k}=ke(t),[N,D]=b.useState(""),[E,O]=b.useState(""),[s,i]=b.useState(!1),[x,f]=b.useState(!1),p=()=>{N.trim()&&(u(N.trim()),D(""),i(!1))},w=()=>{E.trim()&&(g(E.trim()),O(""),f(!1))};return e.jsx(ce,{noPadding:!0,fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-card/50 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(me,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Financial Summary"}),(t==null?void 0:t.from)&&(t==null?void 0:t.to)&&e.jsxs("span",{className:"text-sm font-normal text-muted-foreground bg-muted px-2 py-0.5 rounded-full border border-border",children:[P(t.from,"MMM yyyy")," - ",P(t.to,"MMM yyyy")]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Annual budget and performance spreadsheet"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(xe,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",className:$("w-[240px] justify-start text-left font-normal",!t&&"text-muted-foreground"),children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),t!=null&&t.from?t.to?e.jsxs(e.Fragment,{children:[P(t.from,"LLL dd, y")," -"," ",P(t.to,"LLL dd, y")]}):P(t.from,"LLL dd, y"):e.jsx("span",{children:"Pick a date range"})]})}),e.jsx(ye,{className:"w-auto p-0",align:"end",children:e.jsx(he,{initialFocus:!0,mode:"range",defaultMonth:t==null?void 0:t.from,selected:t,onSelect:r,numberOfMonths:2})})]}),e.jsx("div",{className:"h-6 w-px bg-border mx-2"}),e.jsxs(V,{open:s,onOpenChange:i,children:[e.jsx(X,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",children:[e.jsx(te,{className:"h-4 w-4 mr-1"})," Add Row"]})}),e.jsxs(J,{children:[e.jsx(K,{children:e.jsx(W,{children:"Add New Row"})}),e.jsx(R,{placeholder:"Row label...",value:N,onChange:C=>D(C.target.value),onKeyDown:C=>C.key==="Enter"&&p()}),e.jsx(Z,{children:e.jsx(L,{onClick:p,disabled:!N.trim(),children:"Add"})})]})]}),e.jsxs(V,{open:x,onOpenChange:f,children:[e.jsx(X,{asChild:!0,children:e.jsxs(L,{variant:"outline",size:"sm",children:[e.jsx(te,{className:"h-4 w-4 mr-1"})," Add Column"]})}),e.jsxs(J,{children:[e.jsx(K,{children:e.jsx(W,{children:"Add New Column"})}),e.jsx(R,{placeholder:"Column label...",value:E,onChange:C=>O(C.target.value),onKeyDown:C=>C.key==="Enter"&&w()}),e.jsx(Z,{children:e.jsx(L,{onClick:w,disabled:!E.trim(),children:"Add"})})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx(Me,{rows:d,columns:l,data:c,activeCell:h,setActiveCell:n,updateCell:o,deleteRow:m,deleteColumn:v,navigateCell:j,updateRowFormula:k})})]})})}export{Ye as default};
