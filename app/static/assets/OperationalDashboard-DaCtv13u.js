import{c as ue,r as A,R as S,f as be,a as je,A as Se,j as a,L as Ae,B as de,d as re,u as we,b as Oe,e as Pe}from"./index-C1WoSwjm.js";import{C as Ne,D as Te,L as Ce}from"./DashboardLayout-s2k3RHSi.js";import{f as ie}from"./popover-DFmyVwFX.js";import{u as Ee,c as _e,D as De,R as ae}from"./RankingList--J3bMKbi.js";import{C as N,a as T,b as C,d as E}from"./card-BiS670XQ.js";import{D as ke,a as Le,b as Ke,c as $e,d as ze}from"./dialog-DqDmVrT_.js";import{u as Ie}from"./useQuery-CwIZdbrb.js";import{S as ne,a as Be,G as Me,f as Z,b as K,c as Fe,d as He,i as B,e as Re,g as fe,E as We,h as M,j as qe,k as Ve,l as Ze,m as _,n as Ue,o as Ge,p as se,u as Ye,q as Je,A as G,B as Y,X as pe,Y as me,r as Xe,R as Qe,C as et,T as tt,L as rt}from"./generateCategoricalChart-DZzmMqBI.js";import{L as it}from"./Line-jwmo9KQM.js";import{C as at}from"./clock-CXf0YKCY.js";import{U as oe}from"./users-BdQYOUx8.js";import"./locationUtils-DkoNxUxm.js";import"./index-CUEhgTZr.js";import"./progress-DDWX-yF0.js";import"./ellipsis-CSjI_Icz.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=ue("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=ue("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);function D(t){"@babel/helpers - typeof";return D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(t)}function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lt(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xe(r.key),r)}}function ct(t,e,i){return e&&lt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function ut(t,e,i){return e=F(e),dt(t,he()?Reflect.construct(e,i||[],F(t).constructor):e.apply(t,i))}function dt(t,e){if(e&&(D(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ft(t)}function ft(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function he(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(he=function(){return!!t})()}function F(t){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},F(t)}function pt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&J(t,e)}function J(t,e){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},J(t,e)}function ye(t,e,i){return e=xe(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function xe(t){var e=mt(t,"string");return D(e)=="symbol"?e:e+""}function mt(t,e){if(D(t)!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e||"default");if(D(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var R=function(t){function e(){return ot(this,e),ut(this,e,arguments)}return pt(e,t),ct(e,[{key:"render",value:function(){return null}}])}(A.Component);ye(R,"displayName","ZAxis");ye(R,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var ht=["option","isActive"];function $(){return $=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},$.apply(this,arguments)}function yt(t,e){if(t==null)return{};var i=xt(t,e),r,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(s=0;s<o.length;s++)r=o[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function xt(t,e){if(t==null)return{};var i={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;i[r]=t[r]}return i}function vt(t){var e=t.option,i=t.isActive,r=yt(t,ht);return typeof e=="string"?A.createElement(ne,$({option:A.createElement(Be,$({type:e},r)),isActive:i,shapeType:"symbols"},r)):A.createElement(ne,$({option:e,isActive:i,shapeType:"symbols"},r))}function k(t){"@babel/helpers - typeof";return k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(t)}function z(){return z=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},z.apply(this,arguments)}function le(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),i.push.apply(i,r)}return i}function w(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?le(Object(i),!0).forEach(function(r){O(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):le(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ce(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ge(r.key),r)}}function bt(t,e,i){return e&&ce(t.prototype,e),i&&ce(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function jt(t,e,i){return e=H(e),St(t,ve()?Reflect.construct(e,i||[],H(t).constructor):e.apply(t,i))}function St(t,e){if(e&&(k(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return At(t)}function At(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ve(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ve=function(){return!!t})()}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},H(t)}function wt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},X(t,e)}function O(t,e,i){return e=ge(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ge(t){var e=Ot(t,"string");return k(e)=="symbol"?e:e+""}function Ot(t,e){if(k(t)!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var r=i.call(t,e||"default");if(k(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var W=function(t){function e(){var i;gt(this,e);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return i=jt(this,e,[].concat(s)),O(i,"state",{isAnimationFinished:!1}),O(i,"handleAnimationEnd",function(){i.setState({isAnimationFinished:!0})}),O(i,"handleAnimationStart",function(){i.setState({isAnimationFinished:!1})}),O(i,"id",Ye("recharts-scatter-")),i}return wt(e,t),bt(e,[{key:"renderSymbolsStatically",value:function(r){var s=this,o=this.props,f=o.shape,m=o.activeShape,h=o.activeIndex,u=Z(this.props,!1);return r.map(function(l,n){var d=h===n,c=d?m:f,y=w(w({},u),l);return S.createElement(K,z({className:"recharts-scatter-symbol",key:"symbol-".concat(l==null?void 0:l.cx,"-").concat(l==null?void 0:l.cy,"-").concat(l==null?void 0:l.size,"-").concat(n)},Fe(s.props,l,n),{role:"img"}),S.createElement(vt,z({option:c,isActive:d,key:"symbol-".concat(n)},y)))})}},{key:"renderSymbolsWithAnimation",value:function(){var r=this,s=this.props,o=s.points,f=s.isAnimationActive,m=s.animationBegin,h=s.animationDuration,u=s.animationEasing,l=s.animationId,n=this.state.prevPoints;return S.createElement(He,{begin:m,duration:h,isActive:f,easing:u,from:{t:0},to:{t:1},key:"pie-".concat(l),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(d){var c=d.t,y=o.map(function(x,v){var g=n&&n[v];if(g){var b=B(g.cx,x.cx),p=B(g.cy,x.cy),j=B(g.size,x.size);return w(w({},x),{},{cx:b(c),cy:p(c),size:j(c)})}var P=B(0,x.size);return w(w({},x),{},{size:P(c)})});return S.createElement(K,null,r.renderSymbolsStatically(y))})}},{key:"renderSymbols",value:function(){var r=this.props,s=r.points,o=r.isAnimationActive,f=this.state.prevPoints;return o&&s&&s.length&&(!f||!Re(f,s))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(s)}},{key:"renderErrorBar",value:function(){var r=this.props.isAnimationActive;if(r&&!this.state.isAnimationFinished)return null;var s=this.props,o=s.points,f=s.xAxis,m=s.yAxis,h=s.children,u=fe(h,We);return u?u.map(function(l,n){var d=l.props,c=d.direction,y=d.dataKey;return S.cloneElement(l,{key:"".concat(c,"-").concat(y,"-").concat(o[n]),data:o,xAxis:f,yAxis:m,layout:c==="x"?"vertical":"horizontal",dataPointFormatter:function(v,g){return{x:v.cx,y:v.cy,value:c==="x"?+v.node.x:+v.node.y,errorVal:M(v,g)}}})}):null}},{key:"renderLine",value:function(){var r=this.props,s=r.points,o=r.line,f=r.lineType,m=r.lineJointType,h=Z(this.props,!1),u=Z(o,!1),l,n;if(f==="joint")l=s.map(function(p){return{x:p.cx,y:p.cy}});else if(f==="fitting"){var d=qe(s),c=d.xmin,y=d.xmax,x=d.a,v=d.b,g=function(j){return x*j+v};l=[{x:c,y:g(c)},{x:y,y:g(y)}]}var b=w(w(w({},h),{},{fill:"none",stroke:h&&h.fill},u),{},{points:l});return S.isValidElement(o)?n=S.cloneElement(o,b):Ve(o)?n=o(b):n=S.createElement(Ze,z({},b,{type:m})),S.createElement(K,{className:"recharts-scatter-line",key:"recharts-scatter-line"},n)}},{key:"render",value:function(){var r=this.props,s=r.hide,o=r.points,f=r.line,m=r.className,h=r.xAxis,u=r.yAxis,l=r.left,n=r.top,d=r.width,c=r.height,y=r.id,x=r.isAnimationActive;if(s||!o||!o.length)return null;var v=this.state.isAnimationFinished,g=be("recharts-scatter",m),b=h&&h.allowDataOverflow,p=u&&u.allowDataOverflow,j=b||p,P=_(y)?this.id:y;return S.createElement(K,{className:g,clipPath:j?"url(#clipPath-".concat(P,")"):null},b||p?S.createElement("defs",null,S.createElement("clipPath",{id:"clipPath-".concat(P)},S.createElement("rect",{x:b?l:l-d/2,y:p?n:n-c/2,width:b?d:d*2,height:p?c:c*2}))):null,f&&this.renderLine(),this.renderErrorBar(),S.createElement(K,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!x||v)&&Ue.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.animationId!==s.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:s.curPoints}:r.points!==s.curPoints?{curPoints:r.points}:null}}])}(A.PureComponent);O(W,"displayName","Scatter");O(W,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Me.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});O(W,"getComposedData",function(t){var e=t.xAxis,i=t.yAxis,r=t.zAxis,s=t.item,o=t.displayedData,f=t.xAxisTicks,m=t.yAxisTicks,h=t.offset,u=s.props.tooltipType,l=fe(s.props.children,Ge),n=_(e.dataKey)?s.props.dataKey:e.dataKey,d=_(i.dataKey)?s.props.dataKey:i.dataKey,c=r&&r.dataKey,y=r?r.range:R.defaultProps.range,x=y&&y[0],v=e.scale.bandwidth?e.scale.bandwidth():0,g=i.scale.bandwidth?i.scale.bandwidth():0,b=o.map(function(p,j){var P=M(p,n),Q=M(p,d),L=!_(c)&&M(p,c)||"-",ee=[{name:_(e.dataKey)?s.props.name:e.name||e.dataKey,unit:e.unit||"",value:P,payload:p,dataKey:n,type:u},{name:_(i.dataKey)?s.props.name:i.name||i.dataKey,unit:i.unit||"",value:Q,payload:p,dataKey:d,type:u}];L!=="-"&&ee.push({name:r.name||r.dataKey,unit:r.unit||"",value:L,payload:p,dataKey:c,type:u});var q=se({axis:e,ticks:f,bandSize:v,entry:p,index:j,dataKey:n}),V=se({axis:i,ticks:m,bandSize:g,entry:p,index:j,dataKey:d}),te=L!=="-"?r.scale(L):x,I=Math.sqrt(Math.max(te,0)/Math.PI);return w(w({},p),{},{cx:q,cy:V,x:q-I,y:V-I,xAxis:e,yAxis:i,zAxis:r,width:2*I,height:2*I,size:te,node:{x:P,y:Q,z:L},tooltipPayload:ee,tooltipPosition:{x:q,y:V},payload:p},l&&l[j]&&l[j].props)});return w({points:b},h)});var Pt=Je({chartName:"ComposedChart",GraphicalChild:[it,G,Y,W],axisComponents:[{axisType:"xAxis",AxisComp:pe},{axisType:"yAxis",AxisComp:me},{axisType:"zAxis",AxisComp:R}],formatAxisMap:Xe});const Nt=(t,e,i)=>{const[r,s]=A.useState(null),[o,f]=A.useState(!1),{toast:m}=je(),h=async()=>{f(!0);try{const u=new URLSearchParams({start:ie(t.from,"yyyy-MM-dd"),end:ie(t.to,"yyyy-MM-dd")});e&&e.length>0&&e.forEach(n=>u.append("locations",n)),i&&i.length>0&&i.forEach(n=>u.append("sites",n));const l=await fetch(`${Se.SALES_SUMMARY.replace("sales-summary","operational-summary")}?${u}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(l.ok){const n=await l.json();s(n)}else m({title:"Error",description:"Could not fetch operational data",variant:"destructive"})}catch{m({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{f(!1)}};return A.useEffect(()=>{h()},[t,e,i]),{operationalData:r,isLoading:o,refetch:h}},Tt=({dateRange:t})=>{const e=t!=null&&t.from?t.from.toISOString().split("T")[0]:"",i=t!=null&&t.to?t.to.toISOString().split("T")[0]:"",{data:r,isLoading:s}=Ie({queryKey:["target-performance",e,i],queryFn:async()=>{if(!e||!i)return[];const n=await fetch(`/api/dashboard/targets-performance?start=${e}&end=${i}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!n.ok)throw new Error("Failed to fetch target Data");return n.json()},enabled:!!e&&!!i});if(s)return a.jsxs(N,{children:[a.jsx(T,{children:a.jsx(C,{children:"Target Performance"})}),a.jsx(E,{children:a.jsx(Ae,{className:"animate-spin"})})]});if(!r||r.length===0)return null;const o=new Map;r.forEach(n=>{const d=`${n.location}|${n.site||"null"}`,c=o.get(d);c?(c.actual+=n.actual,c.target+=n.target):o.set(d,{location:n.location,site:n.site,actual:n.actual,target:n.target})});const f=Array.from(o.values()),m=f.length,h=f.filter(n=>n.actual>=n.target).length,u=m-h,l=m>0?h/m*100:0;return a.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-2",children:[a.jsxs(N,{children:[a.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(C,{className:"text-sm font-medium",children:"Target Achievement"}),a.jsx(st,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsxs(E,{children:[a.jsxs("div",{className:"text-2xl font-bold",children:[l.toFixed(0),"%"]}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[h," of ",m," sites met target"]}),a.jsx("div",{className:"mt-4 h-2 w-full bg-secondary rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-primary",style:{width:`${l}%`}})})]})]}),a.jsxs(N,{children:[a.jsx(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:a.jsx(C,{className:"text-sm font-medium",children:"Missed Targets"})}),a.jsxs(E,{children:[a.jsx("div",{className:"text-2xl font-bold",children:u}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Sites below target"}),a.jsxs(ke,{children:[a.jsx(Le,{asChild:!0,children:a.jsx(de,{variant:"outline",size:"sm",className:"mt-4 w-full",children:"View Details"})}),a.jsxs(Ke,{className:"max-h-[80vh] overflow-y-auto",children:[a.jsx($e,{children:a.jsx(ze,{children:"Missed Targets Report"})}),a.jsxs("div",{className:"space-y-2",children:[f.filter(n=>n.actual<n.target).map((n,d)=>a.jsxs("div",{className:"flex justify-between items-center border-b pb-2 last:border-0",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:n.site||n.location}),a.jsx("span",{className:"text-xs text-muted-foreground",children:n.location})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("span",{className:"text-red-500 font-bold",children:[n.actual," / ",n.target]}),a.jsxs("span",{className:"text-xs text-muted-foreground block",children:["Deficit: ",n.actual-n.target]})]})]},d)),u===0&&a.jsx("p",{className:"text-center text-muted-foreground",children:"No missed targets!"})]})]})]})]})]})]})},Ct=({active:t,payload:e,label:i})=>t&&e&&e.length?a.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[a.jsx("p",{className:"font-semibold text-foreground",children:i}),e.map((r,s)=>a.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",r.name==="Paid Hours"?r.value.toLocaleString(void 0,{maximumFractionDigits:1}):r.value]},s))]}):null,Et=({data:t,aggregationLevel:e,selectedMetric:i="shifts"})=>{const r={dataKey:"display",interval:0};return!t||t.length===0?a.jsxs(N,{children:[a.jsx(T,{children:a.jsx(C,{children:"Hours & Shifts Trend"})}),a.jsx(E,{children:a.jsx("div",{className:"h-[400px] flex items-center justify-center",children:a.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):a.jsxs(N,{children:[a.jsxs(T,{children:[a.jsx(C,{children:"Hours & Shifts Trend"}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[e==="daily"&&"Daily view",e==="weekly"&&"Weekly view",e==="monthly"&&"Monthly view"]})]}),a.jsx(E,{children:a.jsx("div",{className:"h-[400px]",children:a.jsx(Qe,{width:"100%",height:"100%",children:a.jsxs(Pt,{data:t,children:[a.jsx(et,{strokeDasharray:"3 3"}),a.jsx(pe,{dataKey:r.dataKey,tick:{fontSize:12},interval:r.interval}),a.jsx(me,{label:{value:i==="hours"?"Hours":i==="shifts"?"Shifts":"Count",angle:-90,position:"insideLeft"}}),a.jsx(tt,{content:a.jsx(Ct,{})}),a.jsx(rt,{}),i==="shifts"&&a.jsxs(a.Fragment,{children:[a.jsx(G,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),a.jsx(Y,{dataKey:"totalShifts",name:"Total Shifts",barSize:20,fill:"hsl(var(--accent))",fillOpacity:.6})]}),i==="hours"&&a.jsx(G,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),i==="clients"&&a.jsx(Y,{dataKey:"totalShifts",name:"Total Shifts",barSize:20,fill:"hsl(var(--accent))",fillOpacity:.6})]})})})})]})},U=({title:t,value:e,subtitle:i,icon:r,trend:s,isSelected:o=!1,onClick:f,onViewDetails:m})=>{const h=!!f;return a.jsxs(N,{className:re("relative transition-all duration-200",h&&"cursor-pointer hover:shadow-md hover:border-primary/50",o&&"border-primary shadow-md ring-2 ring-primary/20"),onClick:f,children:[a.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(C,{className:"text-sm font-medium",children:t}),r&&a.jsx(r,{className:re("h-4 w-4 text-muted-foreground",o&&"text-primary")})]}),a.jsxs(E,{children:[a.jsx("div",{className:"text-2xl font-bold",children:e}),i&&a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i}),s&&a.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s}),m&&a.jsxs(de,{variant:"ghost",size:"sm",className:"mt-2 w-full justify-between text-xs h-8",onClick:u=>{u.stopPropagation(),m()},children:["View Details",a.jsx(Ne,{className:"h-3 w-3"})]})]})]})},Vt=()=>{const t=we();Oe();const{dateRange:e,setDateRange:i}=Pe(),[r,s]=A.useState(!1),[o,f]=A.useState(e),[m,h]=A.useState([]),[u,l]=A.useState([]),[n,d]=A.useState("shifts"),{operationalData:c,isLoading:y}=Nt(e,m,u),{topStaff:x,isLoadingStaff:v,topClientsShifts:g,isLoadingClientsShifts:b}=Ee(e,m,u),p=_e(c,e);return a.jsx(Te,{fullWidth:!0,children:a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsx(De,{dateRange:e,onDateRangeChange:i,calendarOpen:r,onCalendarOpenChange:s,tempDateRange:o,onTempDateRangeChange:f,selectedLocations:m,onLocationsChange:h,selectedSites:u,onSitesChange:l}),a.jsx("div",{className:"flex-1 overflow-auto",children:a.jsx("div",{className:"px-4 pt-6 pb-6 space-y-4",children:a.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[a.jsxs("div",{className:"col-span-5 flex flex-col gap-4",children:[a.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[a.jsx(U,{title:"Total Shifts",value:p.totalShifts.value,subtitle:p.totalShifts.text,icon:Ce,isSelected:n==="shifts",onClick:()=>d("shifts"),onViewDetails:()=>t("/dashboard/metrics/shifts")}),a.jsx(U,{title:"Total Hours",value:p.paidHours.value.toLocaleString(),subtitle:p.paidHours.text,icon:at,isSelected:n==="hours",onClick:()=>d("hours"),onViewDetails:()=>t("/dashboard/metrics/hours")}),a.jsx(U,{title:"Active Clients",value:p.totalClients.value,subtitle:"Distinct clients this period",icon:oe,isSelected:n==="clients",onClick:()=>d("clients"),onViewDetails:()=>t("/dashboard/metrics/clients")})]}),a.jsx(Tt,{dateRange:e}),a.jsxs(N,{className:"flex-1",children:[a.jsx(T,{children:a.jsxs(C,{children:[n==="shifts"&&"Hours & Shifts Trend",n==="hours"&&"Paid Hours Trend",n==="clients"&&"Active Clients Trend"]})}),a.jsx(E,{className:"pl-2",children:a.jsx(Et,{data:(c==null?void 0:c.timeSeries)||[],aggregationLevel:(c==null?void 0:c.aggregationLevel)||"monthly",selectedMetric:n})})]})]}),a.jsxs("div",{className:"col-span-2 flex flex-col gap-4",children:[a.jsx(ae,{title:"Top Staff (Paid Hours)",data:x,isLoading:v,valueFormatter:j=>`${j.toLocaleString()} hrs`,icon:a.jsx(oe,{className:"h-4 w-4"}),className:"flex-1"}),a.jsx(ae,{title:"Top Clients (Shifts)",data:g,isLoading:b,valueFormatter:j=>`${j.toLocaleString()} shifts`,icon:a.jsx(nt,{className:"h-4 w-4"}),className:"flex-1",barColor:"bg-blue-500"})]})]})})})]})})};export{Vt as OperationalDashboard,Vt as default};
