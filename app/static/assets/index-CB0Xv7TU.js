const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MetricPalette-D90OWnCK.js","assets/index-BYNlQeyg.js","assets/index-DaO3iYkk.css","assets/card-BEm4lrc8.js","assets/users-CXhHxgpA.js","assets/locationUtils-Clk9YE-1.js","assets/button-eFVU3VC6.js","assets/DashboardLayout-CSDhJyZ5.js","assets/ChartCanvas-Q1OslgyE.js","assets/badge-C4d6L3WA.js","assets/AreaChart-lO8hQzXT.js","assets/BarChart-CO6y9drS.js"])))=>i.map(i=>d[i]);
import{c as De,r as a,q as W,P as _,s as Z,j as r,k as L,X as lt,T as Me,l as Ae,m as Te,n as Pe,d as ot,e as Le,i as it,f as ct,h as dt,a as ut,S as mt,_ as $e}from"./index-BYNlQeyg.js";import{R as ft,P as ht,O as pt,a as xt,D as vt}from"./DashboardLayout-CSDhJyZ5.js";import{L as gt}from"./label-BnrtAHcU.js";import{C as bt,u as yt,S as wt,b as jt,c as Ct,d as St,e as ne}from"./select-CY1qhmro.js";import{B as se}from"./button-eFVU3VC6.js";import{P as ue,b as me,g as fe,c as he,j as je,C as Ce,f as ae,d as Se}from"./locationUtils-Clk9YE-1.js";import"./dialog-GcyXux1m.js";import{C as Nt,a as kt,b as Et,d as Rt}from"./card-BEm4lrc8.js";import"./users-CXhHxgpA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=De("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=De("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),Mt=()=>{const[e,n]=a.useState({dimensions:[],metrics:[],chartType:"bar",dateRange:{from:void 0,to:void 0},customMetrics:[],chartData:[],draggedItem:void 0});return{state:e,setDimensions:o=>{n(i=>({...i,dimensions:o}))},setMetrics:o=>{n(i=>({...i,metrics:o}))},setChartType:o=>{n(i=>({...i,chartType:o}))},setDateRange:o=>{n(i=>({...i,dateRange:o}))},addCustomMetric:o=>{n(i=>({...i,customMetrics:[...i.customMetrics,o]}))},setChartData:o=>{n(i=>({...i,chartData:o}))},setDraggedItem:o=>{n(i=>({...i,draggedItem:o}))}}};var Ne=1,At=.9,Tt=.8,Pt=.17,ie=.1,ce=.999,Lt=.9999,$t=.99,_t=/[\\\/_+.#"@\[\(\{&]/,Ot=/[\\\/_+.#"@\[\(\{&]/g,Bt=/[\s-]/,_e=/[\s-]/g;function pe(e,n,t,m,c,d,u){if(d===n.length)return c===e.length?Ne:$t;var l=`${c},${d}`;if(u[l]!==void 0)return u[l];for(var h=m.charAt(d),o=t.indexOf(h,c),i=0,g,S,C,E;o>=0;)g=pe(e,n,t,m,o+1,d+1,u),g>i&&(o===c?g*=Ne:_t.test(e.charAt(o-1))?(g*=Tt,C=e.slice(c,o-1).match(Ot),C&&c>0&&(g*=Math.pow(ce,C.length))):Bt.test(e.charAt(o-1))?(g*=At,E=e.slice(c,o-1).match(_e),E&&c>0&&(g*=Math.pow(ce,E.length))):(g*=Pt,c>0&&(g*=Math.pow(ce,o-c))),e.charAt(o)!==n.charAt(d)&&(g*=Lt)),(g<ie&&t.charAt(o-1)===m.charAt(d+1)||m.charAt(d+1)===m.charAt(d)&&t.charAt(o-1)!==m.charAt(d))&&(S=pe(e,n,t,m,o+1,d+2,u),S*ie>g&&(g=S*ie)),g>i&&(i=g),o=t.indexOf(h,o+1);return u[l]=i,i}function ke(e){return e.toLowerCase().replace(_e," ")}function zt(e,n,t){return e=t&&t.length>0?`${e+" "+t.join(" ")}`:e,pe(e,n,ke(e),ke(n),0,0,{})}var Q='[cmdk-group=""]',de='[cmdk-group-items=""]',Ft='[cmdk-group-heading=""]',Oe='[cmdk-item=""]',Ee=`${Oe}:not([aria-disabled="true"])`,xe="cmdk-item-select",G="data-value",qt=(e,n,t)=>zt(e,n,t),Be=a.createContext(void 0),ee=()=>a.useContext(Be),ze=a.createContext(void 0),ve=()=>a.useContext(ze),Fe=a.createContext(void 0),qe=a.forwardRef((e,n)=>{let t=X(()=>{var s,x;return{search:"",value:(x=(s=e.value)!=null?s:e.defaultValue)!=null?x:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),m=X(()=>new Set),c=X(()=>new Map),d=X(()=>new Map),u=X(()=>new Set),l=Ve(e),{label:h,children:o,value:i,onValueChange:g,filter:S,shouldFilter:C,loop:E,disablePointerSelection:M=!1,vimBindings:P=!0,...$}=e,F=W(),R=W(),q=W(),O=a.useRef(null),j=Zt();U(()=>{if(i!==void 0){let s=i.trim();t.current.value=s,k.emit()}},[i]),U(()=>{j(6,te)},[]);let k=a.useMemo(()=>({subscribe:s=>(u.current.add(s),()=>u.current.delete(s)),snapshot:()=>t.current,setState:(s,x,v)=>{var f,b,w,T;if(!Object.is(t.current[s],x)){if(t.current[s]=x,s==="search")V(),p(),j(1,y);else if(s==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let I=document.getElementById(q);I?I.focus():(f=document.getElementById(F))==null||f.focus()}if(j(7,()=>{var I;t.current.selectedItemId=(I=B())==null?void 0:I.id,k.emit()}),v||j(5,te),((b=l.current)==null?void 0:b.value)!==void 0){let I=x??"";(T=(w=l.current).onValueChange)==null||T.call(w,I);return}}k.emit()}},emit:()=>{u.current.forEach(s=>s())}}),[]),K=a.useMemo(()=>({value:(s,x,v)=>{var f;x!==((f=d.current.get(s))==null?void 0:f.value)&&(d.current.set(s,{value:x,keywords:v}),t.current.filtered.items.set(s,J(x,v)),j(2,()=>{p(),k.emit()}))},item:(s,x)=>(m.current.add(s),x&&(c.current.has(x)?c.current.get(x).add(s):c.current.set(x,new Set([s]))),j(3,()=>{V(),p(),t.current.value||y(),k.emit()}),()=>{d.current.delete(s),m.current.delete(s),t.current.filtered.items.delete(s);let v=B();j(4,()=>{V(),(v==null?void 0:v.getAttribute("id"))===s&&y(),k.emit()})}),group:s=>(c.current.has(s)||c.current.set(s,new Set),()=>{d.current.delete(s),c.current.delete(s)}),filter:()=>l.current.shouldFilter,label:h||e["aria-label"],getDisablePointerSelection:()=>l.current.disablePointerSelection,listId:F,inputId:q,labelId:R,listInnerRef:O}),[]);function J(s,x){var v,f;let b=(f=(v=l.current)==null?void 0:v.filter)!=null?f:qt;return s?b(s,t.current.search,x):0}function p(){if(!t.current.search||l.current.shouldFilter===!1)return;let s=t.current.filtered.items,x=[];t.current.filtered.groups.forEach(f=>{let b=c.current.get(f),w=0;b.forEach(T=>{let I=s.get(T);w=Math.max(I,w)}),x.push([f,w])});let v=O.current;N().sort((f,b)=>{var w,T;let I=f.getAttribute("id"),re=b.getAttribute("id");return((w=s.get(re))!=null?w:0)-((T=s.get(I))!=null?T:0)}).forEach(f=>{let b=f.closest(de);b?b.appendChild(f.parentElement===b?f:f.closest(`${de} > *`)):v.appendChild(f.parentElement===v?f:f.closest(`${de} > *`))}),x.sort((f,b)=>b[1]-f[1]).forEach(f=>{var b;let w=(b=O.current)==null?void 0:b.querySelector(`${Q}[${G}="${encodeURIComponent(f[0])}"]`);w==null||w.parentElement.appendChild(w)})}function y(){let s=N().find(v=>v.getAttribute("aria-disabled")!=="true"),x=s==null?void 0:s.getAttribute(G);k.setState("value",x||void 0)}function V(){var s,x,v,f;if(!t.current.search||l.current.shouldFilter===!1){t.current.filtered.count=m.current.size;return}t.current.filtered.groups=new Set;let b=0;for(let w of m.current){let T=(x=(s=d.current.get(w))==null?void 0:s.value)!=null?x:"",I=(f=(v=d.current.get(w))==null?void 0:v.keywords)!=null?f:[],re=J(T,I);t.current.filtered.items.set(w,re),re>0&&b++}for(let[w,T]of c.current)for(let I of T)if(t.current.filtered.items.get(I)>0){t.current.filtered.groups.add(w);break}t.current.filtered.count=b}function te(){var s,x,v;let f=B();f&&(((s=f.parentElement)==null?void 0:s.firstChild)===f&&((v=(x=f.closest(Q))==null?void 0:x.querySelector(Ft))==null||v.scrollIntoView({block:"nearest"})),f.scrollIntoView({block:"nearest"}))}function B(){var s;return(s=O.current)==null?void 0:s.querySelector(`${Oe}[aria-selected="true"]`)}function N(){var s;return Array.from(((s=O.current)==null?void 0:s.querySelectorAll(Ee))||[])}function H(s){let x=N()[s];x&&k.setState("value",x.getAttribute(G))}function A(s){var x;let v=B(),f=N(),b=f.findIndex(T=>T===v),w=f[b+s];(x=l.current)!=null&&x.loop&&(w=b+s<0?f[f.length-1]:b+s===f.length?f[0]:f[b+s]),w&&k.setState("value",w.getAttribute(G))}function ge(s){let x=B(),v=x==null?void 0:x.closest(Q),f;for(;v&&!f;)v=s>0?Jt(v,Q):Qt(v,Q),f=v==null?void 0:v.querySelector(Ee);f?k.setState("value",f.getAttribute(G)):A(s)}let be=()=>H(N().length-1),ye=s=>{s.preventDefault(),s.metaKey?be():s.altKey?ge(1):A(1)},we=s=>{s.preventDefault(),s.metaKey?H(0):s.altKey?ge(-1):A(-1)};return a.createElement(_.div,{ref:n,tabIndex:-1,...$,"cmdk-root":"",onKeyDown:s=>{var x;(x=$.onKeyDown)==null||x.call($,s);let v=s.nativeEvent.isComposing||s.keyCode===229;if(!(s.defaultPrevented||v))switch(s.key){case"n":case"j":{P&&s.ctrlKey&&ye(s);break}case"ArrowDown":{ye(s);break}case"p":case"k":{P&&s.ctrlKey&&we(s);break}case"ArrowUp":{we(s);break}case"Home":{s.preventDefault(),H(0);break}case"End":{s.preventDefault(),be();break}case"Enter":{s.preventDefault();let f=B();if(f){let b=new Event(xe);f.dispatchEvent(b)}}}}},a.createElement("label",{"cmdk-label":"",htmlFor:K.inputId,id:K.labelId,style:tr},h),le(e,s=>a.createElement(ze.Provider,{value:k},a.createElement(Be.Provider,{value:K},s))))}),Vt=a.forwardRef((e,n)=>{var t,m;let c=W(),d=a.useRef(null),u=a.useContext(Fe),l=ee(),h=Ve(e),o=(m=(t=h.current)==null?void 0:t.forceMount)!=null?m:u==null?void 0:u.forceMount;U(()=>{if(!o)return l.item(c,u==null?void 0:u.id)},[o]);let i=Ue(c,d,[e.value,e.children,d],e.keywords),g=ve(),S=z(j=>j.value&&j.value===i.current),C=z(j=>o||l.filter()===!1?!0:j.search?j.filtered.items.get(c)>0:!0);a.useEffect(()=>{let j=d.current;if(!(!j||e.disabled))return j.addEventListener(xe,E),()=>j.removeEventListener(xe,E)},[C,e.onSelect,e.disabled]);function E(){var j,k;M(),(k=(j=h.current).onSelect)==null||k.call(j,i.current)}function M(){g.setState("value",i.current,!0)}if(!C)return null;let{disabled:P,value:$,onSelect:F,forceMount:R,keywords:q,...O}=e;return a.createElement(_.div,{ref:Z(d,n),...O,id:c,"cmdk-item":"",role:"option","aria-disabled":!!P,"aria-selected":!!S,"data-disabled":!!P,"data-selected":!!S,onPointerMove:P||l.getDisablePointerSelection()?void 0:M,onClick:P?void 0:E},e.children)}),Ut=a.forwardRef((e,n)=>{let{heading:t,children:m,forceMount:c,...d}=e,u=W(),l=a.useRef(null),h=a.useRef(null),o=W(),i=ee(),g=z(C=>c||i.filter()===!1?!0:C.search?C.filtered.groups.has(u):!0);U(()=>i.group(u),[]),Ue(u,l,[e.value,e.heading,h]);let S=a.useMemo(()=>({id:u,forceMount:c}),[c]);return a.createElement(_.div,{ref:Z(l,n),...d,"cmdk-group":"",role:"presentation",hidden:g?void 0:!0},t&&a.createElement("div",{ref:h,"cmdk-group-heading":"","aria-hidden":!0,id:o},t),le(e,C=>a.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":t?o:void 0},a.createElement(Fe.Provider,{value:S},C))))}),Kt=a.forwardRef((e,n)=>{let{alwaysRender:t,...m}=e,c=a.useRef(null),d=z(u=>!u.search);return!t&&!d?null:a.createElement(_.div,{ref:Z(c,n),...m,"cmdk-separator":"",role:"separator"})}),Ht=a.forwardRef((e,n)=>{let{onValueChange:t,...m}=e,c=e.value!=null,d=ve(),u=z(o=>o.search),l=z(o=>o.selectedItemId),h=ee();return a.useEffect(()=>{e.value!=null&&d.setState("search",e.value)},[e.value]),a.createElement(_.input,{ref:n,...m,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":h.listId,"aria-labelledby":h.labelId,"aria-activedescendant":l,id:h.inputId,type:"text",value:c?e.value:u,onChange:o=>{c||d.setState("search",o.target.value),t==null||t(o.target.value)}})}),Yt=a.forwardRef((e,n)=>{let{children:t,label:m="Suggestions",...c}=e,d=a.useRef(null),u=a.useRef(null),l=z(o=>o.selectedItemId),h=ee();return a.useEffect(()=>{if(u.current&&d.current){let o=u.current,i=d.current,g,S=new ResizeObserver(()=>{g=requestAnimationFrame(()=>{let C=o.offsetHeight;i.style.setProperty("--cmdk-list-height",C.toFixed(1)+"px")})});return S.observe(o),()=>{cancelAnimationFrame(g),S.unobserve(o)}}},[]),a.createElement(_.div,{ref:Z(d,n),...c,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":l,"aria-label":m,id:h.listId},le(e,o=>a.createElement("div",{ref:Z(u,h.listInnerRef),"cmdk-list-sizer":""},o)))}),Gt=a.forwardRef((e,n)=>{let{open:t,onOpenChange:m,overlayClassName:c,contentClassName:d,container:u,...l}=e;return a.createElement(ft,{open:t,onOpenChange:m},a.createElement(ht,{container:u},a.createElement(pt,{"cmdk-overlay":"",className:c}),a.createElement(xt,{"aria-label":e.label,"cmdk-dialog":"",className:d},a.createElement(qe,{ref:n,...l}))))}),Xt=a.forwardRef((e,n)=>z(t=>t.filtered.count===0)?a.createElement(_.div,{ref:n,...e,"cmdk-empty":"",role:"presentation"}):null),Wt=a.forwardRef((e,n)=>{let{progress:t,children:m,label:c="Loading...",...d}=e;return a.createElement(_.div,{ref:n,...d,"cmdk-loading":"",role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":100,"aria-label":c},le(e,u=>a.createElement("div",{"aria-hidden":!0},u)))}),D=Object.assign(qe,{List:Yt,Item:Vt,Input:Ht,Group:Ut,Separator:Kt,Dialog:Gt,Empty:Xt,Loading:Wt});function Jt(e,n){let t=e.nextElementSibling;for(;t;){if(t.matches(n))return t;t=t.nextElementSibling}}function Qt(e,n){let t=e.previousElementSibling;for(;t;){if(t.matches(n))return t;t=t.previousElementSibling}}function Ve(e){let n=a.useRef(e);return U(()=>{n.current=e}),n}var U=typeof window>"u"?a.useEffect:a.useLayoutEffect;function X(e){let n=a.useRef();return n.current===void 0&&(n.current=e()),n}function z(e){let n=ve(),t=()=>e(n.snapshot());return a.useSyncExternalStore(n.subscribe,t,t)}function Ue(e,n,t,m=[]){let c=a.useRef(),d=ee();return U(()=>{var u;let l=(()=>{var o;for(let i of t){if(typeof i=="string")return i.trim();if(typeof i=="object"&&"current"in i)return i.current?(o=i.current.textContent)==null?void 0:o.trim():c.current}})(),h=m.map(o=>o.trim());d.value(e,l,h),(u=n.current)==null||u.setAttribute(G,l),c.current=l}),c}var Zt=()=>{let[e,n]=a.useState(),t=X(()=>new Map);return U(()=>{t.current.forEach(m=>m()),t.current=new Map},[e]),(m,c)=>{t.current.set(m,c),n({})}};function er(e){let n=e.type;return typeof n=="function"?n(e.props):"render"in n?n.render(e.props):e}function le({asChild:e,children:n},t){return e&&a.isValidElement(n)?a.cloneElement(er(n),{ref:n.ref},t(n.props.children)):t(n)}var tr={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Ke=a.forwardRef(({className:e,...n},t)=>r.jsx(D,{ref:t,className:L("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...n}));Ke.displayName=D.displayName;const He=a.forwardRef(({className:e,...n},t)=>r.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[r.jsx(Dt,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),r.jsx(D.Input,{ref:t,className:L("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...n})]}));He.displayName=D.Input.displayName;const rr=a.forwardRef(({className:e,...n},t)=>r.jsx(D.List,{ref:t,className:L("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...n}));rr.displayName=D.List.displayName;const Ye=a.forwardRef((e,n)=>r.jsx(D.Empty,{ref:n,className:"py-6 text-center text-sm",...e}));Ye.displayName=D.Empty.displayName;const Ge=a.forwardRef(({className:e,...n},t)=>r.jsx(D.Group,{ref:t,className:L("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...n}));Ge.displayName=D.Group.displayName;const nr=a.forwardRef(({className:e,...n},t)=>r.jsx(D.Separator,{ref:t,className:L("-mx-1 h-px bg-border",e),...n}));nr.displayName=D.Separator.displayName;const Xe=a.forwardRef(({className:e,...n},t)=>r.jsx(D.Item,{ref:t,className:L("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...n}));Xe.displayName=D.Item.displayName;var ar="Separator",Re="horizontal",sr=["horizontal","vertical"],We=a.forwardRef((e,n)=>{const{decorative:t,orientation:m=Re,...c}=e,d=lr(m)?m:Re,l=t?{role:"none"}:{"aria-orientation":d==="vertical"?d:void 0,role:"separator"};return r.jsx(_.div,{"data-orientation":d,...l,...c,ref:n})});We.displayName=ar;function lr(e){return sr.includes(e)}var Je=We;const Qe=a.forwardRef(({className:e,orientation:n="horizontal",decorative:t=!0,...m},c)=>r.jsx(Je,{ref:c,decorative:t,orientation:n,className:L("shrink-0 bg-border",n==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...m}));Qe.displayName=Je.displayName;function Y({title:e,options:n,selected:t,onChange:m,placeholder:c="Select...",isLocation:d=!1}){const[u,l]=a.useState(!1),h=i=>{t.includes(i)?m(t.filter(g=>g!==i)):m([...t,i])},o=i=>{i.stopPropagation(),m([])};return r.jsxs("div",{className:"flex flex-col gap-1.5 min-w-[180px]",children:[r.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:e}),r.jsxs(ue,{open:u,onOpenChange:l,children:[r.jsx(me,{asChild:!0,children:r.jsxs(se,{variant:"outline",role:"combobox","aria-expanded":u,className:"w-full justify-between h-9 px-3 text-sm",children:[r.jsxs("div",{className:"flex flex-wrap gap-1 items-center overflow-hidden",children:[t.length===0&&r.jsx("span",{className:"text-muted-foreground font-normal truncate",children:c}),t.length===1&&r.jsx("span",{className:"truncate",children:d?fe(t[0]):t[0]}),t.length>1&&r.jsxs("span",{className:"truncate",children:[t.length," selected"]})]}),r.jsxs("div",{className:"flex items-center gap-2 shrink-0 opacity-50 ml-2",children:[t.length>0&&r.jsx(lt,{className:"h-3 w-3 cursor-pointer hover:opacity-100",onClick:o}),r.jsx(It,{className:"h-3 w-3"})]})]})}),r.jsx(he,{className:"w-[200px] p-0",align:"start",children:r.jsxs(Ke,{children:[r.jsx(He,{placeholder:`Search ${e.toLowerCase()}...`}),r.jsxs(Ye,{children:["No ",e.toLowerCase()," found."]}),r.jsx(Ge,{className:"max-h-64 overflow-auto",children:n.map(i=>r.jsxs(Xe,{value:i,onSelect:()=>h(i),children:[r.jsx(bt,{className:L("mr-2 h-4 w-4",t.includes(i)?"opacity-100":"opacity-0")}),d?r.jsx(Me,{delayDuration:300,children:r.jsxs(Ae,{children:[r.jsx(Te,{asChild:!0,children:r.jsxs("div",{className:"flex flex-col min-w-0",children:[r.jsx("span",{className:"font-medium",children:fe(i)}),r.jsx("span",{className:"text-[10px] text-muted-foreground truncate opacity-70",children:i})]})}),r.jsx(Pe,{side:"right",children:r.jsx("p",{children:i})})]})}):i]},i))})]})})]})]})}function or({availableFilters:e,filters:n,onFilterChange:t,orientation:m="vertical"}){const c=a.useMemo(()=>{if(n.locations.length===0){const h=new Set;return e.locations.forEach(o=>{o.sites.forEach(i=>h.add(i))}),Array.from(h).sort()}else{const h=new Set;return e.locations.filter(o=>n.locations.includes(o.name)).forEach(o=>{o.sites.forEach(i=>h.add(i))}),Array.from(h).sort()}},[e.locations,n.locations]),d=h=>{t({...n,clients:h})},u=h=>{t({...n,locations:h})},l=h=>{t({...n,sites:h})};return m==="horizontal"?r.jsxs("div",{className:"flex flex-wrap items-end gap-4 p-1",children:[r.jsx("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground mr-2 pb-2",children:r.jsx("span",{children:"ðŸŒªï¸ Filters:"})}),r.jsx(Y,{title:"Clients",options:e.clients,selected:n.clients,onChange:d,placeholder:"All Clients"}),r.jsx(Y,{title:"Locations",options:e.locations.map(h=>h.name),selected:n.locations,onChange:u,placeholder:"All Locations",isLocation:!0}),r.jsx(Y,{title:"Sites",options:c,selected:n.sites,onChange:l,placeholder:"All Sites"})]}):r.jsxs(Nt,{className:"h-full flex flex-col",children:[r.jsx(kt,{className:"pb-3",children:r.jsx(Et,{className:"text-lg flex items-center gap-2",children:"ðŸŒªï¸ Filters"})}),r.jsxs(Rt,{className:"space-y-4 flex-1 overflow-y-auto",children:[r.jsx(Y,{title:"Clients",options:e.clients,selected:n.clients,onChange:d,placeholder:"All Clients"}),r.jsx(Qe,{}),r.jsx(Y,{title:"Locations",options:e.locations.map(h=>h.name),selected:n.locations,onChange:u,placeholder:"All Locations",isLocation:!0}),r.jsx(Y,{title:"Sites",options:c,selected:n.sites,onChange:l,placeholder:"All Sites"})]})]})}var oe="Switch",[ir,Cr]=ot(oe),[cr,dr]=ir(oe),Ze=a.forwardRef((e,n)=>{const{__scopeSwitch:t,name:m,checked:c,defaultChecked:d,required:u,disabled:l,value:h="on",onCheckedChange:o,form:i,...g}=e,[S,C]=a.useState(null),E=Le(n,R=>C(R)),M=a.useRef(!1),P=S?i||!!S.closest("form"):!0,[$,F]=it({prop:c,defaultProp:d??!1,onChange:o,caller:oe});return r.jsxs(cr,{scope:t,checked:$,disabled:l,children:[r.jsx(_.button,{type:"button",role:"switch","aria-checked":$,"aria-required":u,"data-state":nt($),"data-disabled":l?"":void 0,disabled:l,value:h,...g,ref:E,onClick:ct(e.onClick,R=>{F(q=>!q),P&&(M.current=R.isPropagationStopped(),M.current||R.stopPropagation())})}),P&&r.jsx(rt,{control:S,bubbles:!M.current,name:m,value:h,checked:$,required:u,disabled:l,form:i,style:{transform:"translateX(-100%)"}})]})});Ze.displayName=oe;var et="SwitchThumb",tt=a.forwardRef((e,n)=>{const{__scopeSwitch:t,...m}=e,c=dr(et,t);return r.jsx(_.span,{"data-state":nt(c.checked),"data-disabled":c.disabled?"":void 0,...m,ref:n})});tt.displayName=et;var ur="SwitchBubbleInput",rt=a.forwardRef(({__scopeSwitch:e,control:n,checked:t,bubbles:m=!0,...c},d)=>{const u=a.useRef(null),l=Le(u,d),h=yt(t),o=dt(n);return a.useEffect(()=>{const i=u.current;if(!i)return;const g=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(g,"checked").set;if(h!==t&&C){const E=new Event("click",{bubbles:m});C.call(i,t),i.dispatchEvent(E)}},[h,t,m]),r.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...c,tabIndex:-1,ref:l,style:{...c.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});rt.displayName=ur;function nt(e){return e?"checked":"unchecked"}var at=Ze,mr=tt;const st=a.forwardRef(({className:e,...n},t)=>r.jsx(at,{className:L("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...n,ref:t,children:r.jsx(mr,{className:L("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));st.displayName=at.displayName;const fr=a.lazy(()=>$e(()=>import("./MetricPalette-D90OWnCK.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Ie=a.lazy(()=>$e(()=>import("./ChartCanvas-Q1OslgyE.js"),__vite__mapDeps([8,1,2,9,10,11])));function Sr(){const{state:e,setDimensions:n,setMetrics:t,setChartType:m,setDateRange:c,setChartData:d}=Mt(),{toast:u}=ut(),[l,h]=a.useState({from:new Date,to:je(new Date,30)}),[o,i]=a.useState({from:new Date,to:je(new Date,30)}),[g,S]=a.useState(!1),[C,E]=a.useState(!1),[M,P]=a.useState(!1),[$,F]=a.useState({clients:[],locations:[]}),[R,q]=a.useState({clients:[],locations:[],sites:[]});a.useEffect(()=>{(async()=>{try{const y=await fetch("/api/filters",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(y.ok){const V=await y.json();F(V)}}catch(y){console.error("Error fetching filters:",y)}})()},[]);const O=()=>{i(l)};a.useEffect(()=>{(async()=>{if(e.dimensions.length===0||e.metrics.length===0||!(o!=null&&o.from)||!(o!=null&&o.to)){d([]);return}const y=e.dimensions[0],V=e.metrics,te=ae(o.from,"yyyy-MM-dd"),B=ae(o.to,"yyyy-MM-dd");try{const N=new URLSearchParams;N.append("start",te),N.append("end",B),N.append("dimension",y),V.forEach(A=>N.append("metrics",A)),R.clients.forEach(A=>N.append("clients",A)),R.locations.forEach(A=>N.append("locations",A)),R.sites.forEach(A=>N.append("sites",A)),M&&N.append("split_by_location","true");const H=await fetch(`/api/chart-data?${N.toString()}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(H.ok){const A=await H.json();d(A)}else console.error("Failed to fetch chart data"),d([])}catch(N){console.error("Error fetching chart data:",N),d([])}})()},[e.dimensions,e.metrics,o,R,M]);const j=p=>{p.type==="dimension"?e.dimensions.includes(p.name)||(n([p.name]),u({description:`Added ${p.name} to chart`,duration:2e3})):p.type==="metric"&&(e.metrics.includes(p.name)||(t([...e.metrics,p.name]),u({description:`Added ${p.name} to chart`,duration:2e3})))},k=p=>{p.type==="dimension"?e.dimensions.includes(p.name)&&(n(e.dimensions.filter(y=>y!==p.name)),u({description:`Removed ${p.name} from chart`,duration:2e3})):p.type==="metric"&&e.metrics.includes(p.name)&&(t(e.metrics.filter(y=>y!==p.name)),u({description:`Removed ${p.name} from chart`,duration:2e3}))},K=p=>{n(e.dimensions.filter(y=>y!==p))},J=p=>{t(e.metrics.filter(y=>y!==p))};return r.jsx(vt,{children:r.jsx("div",{className:"p-4 md:p-6 h-full flex flex-col",children:r.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[r.jsx("div",{className:"sticky lg:top-0 z-30 pb-2 border-b -mx-4 md:-mx-6 px-4 md:px-6 pt-1 shadow-sm bg-background",children:r.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[r.jsx("div",{children:r.jsx("h1",{className:"text-xl font-bold",children:"Chart Builder"})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("div",{className:"w-32",children:r.jsxs(wt,{value:e.chartType,onValueChange:m,children:[r.jsx(jt,{className:"h-8 text-xs",children:r.jsx(Ct,{placeholder:"Chart Type"})}),r.jsxs(St,{children:[r.jsx(ne,{value:"bar",children:"Bar Chart"}),r.jsx(ne,{value:"line",children:"Line Chart"}),r.jsx(ne,{value:"area",children:"Area Chart"}),r.jsx(ne,{value:"pie",children:"Pie Chart"})]})]})}),r.jsxs("div",{className:"flex items-center gap-2 px-2 border-l h-8",children:[r.jsx(gt,{htmlFor:"split-mode",className:"text-[10px] font-medium uppercase tracking-wider text-muted-foreground mr-1",children:"Split by Location"}),r.jsx(st,{id:"split-mode",checked:M,onCheckedChange:P,disabled:R.locations.length<=1&&!M&&R.locations.length!==0})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(ue,{open:g,onOpenChange:S,children:[r.jsx(me,{asChild:!0,children:r.jsxs(se,{variant:"outline",className:L("w-32 justify-start text-left font-normal h-8 text-xs",!(l!=null&&l.from)&&"text-muted-foreground"),children:[r.jsx(Ce,{className:"mr-2 h-3 w-3"}),l!=null&&l.from?ae(l.from,"MMM dd, y"):r.jsx("span",{children:"From"})]})}),r.jsx(he,{className:"w-auto p-0",align:"start",children:r.jsx(Se,{mode:"single",selected:l==null?void 0:l.from,onSelect:p=>{h(y=>({...y,from:p})),S(!1)},defaultMonth:l==null?void 0:l.from,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030})})]}),r.jsx("span",{className:"text-muted-foreground text-xs",children:"-"}),r.jsxs(ue,{open:C,onOpenChange:E,children:[r.jsx(me,{asChild:!0,children:r.jsxs(se,{variant:"outline",className:L("w-32 justify-start text-left font-normal h-8 text-xs",!(l!=null&&l.to)&&"text-muted-foreground"),children:[r.jsx(Ce,{className:"mr-2 h-3 w-3"}),l!=null&&l.to?ae(l.to,"MMM dd, y"):r.jsx("span",{children:"To"})]})}),r.jsx(he,{className:"w-auto p-0",align:"start",children:r.jsx(Se,{mode:"single",selected:l==null?void 0:l.to,onSelect:p=>{h(y=>({...y,to:p})),E(!1)},defaultMonth:l==null?void 0:l.to,captionLayout:"dropdown-buttons",fromYear:2020,toYear:2030,disabled:p=>p<((l==null?void 0:l.from)||new Date(0))})})]}),r.jsx(se,{onClick:O,size:"sm",className:"h-8 text-xs",disabled:!(l!=null&&l.from)||!(l!=null&&l.to),children:"Apply"})]})]})]})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsx(mt,{className:"h-8 w-8 rounded-full"})}),children:r.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row gap-4 min-h-0 h-full",children:[r.jsx("div",{className:"lg:w-72 shrink-0 h-full flex flex-col overflow-hidden",children:r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2",children:r.jsx(fr,{selectedDimensions:e.dimensions,selectedMetrics:e.metrics,onItemClick:j,onItemDoubleClick:k})})}),r.jsxs("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:[r.jsx("div",{className:"shrink-0 pb-2 border-b mb-2",children:r.jsx(or,{availableFilters:$,filters:R,onFilterChange:q,orientation:"horizontal"})}),r.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:M?r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 p-1",children:[Array.from(new Set(e.chartData.map(p=>p.location))).map(p=>r.jsxs("div",{className:"border rounded-lg p-4 bg-card shadow-sm",children:[r.jsx("div",{className:"flex items-center justify-between mb-4 border-b pb-2",children:r.jsx(Me,{children:r.jsxs(Ae,{children:[r.jsx(Te,{asChild:!0,children:r.jsxs("h3",{className:"text-sm font-bold flex items-center gap-2",children:[r.jsx("span",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded text-[10px]",children:fe(p)}),p.length>25?p.substring(0,25)+"...":p]})}),r.jsx(Pe,{children:r.jsx("p",{children:p})})]})})}),r.jsx("div",{className:"h-[300px]",children:r.jsx(Ie,{dimensions:e.dimensions,metrics:e.metrics,chartType:e.chartType,chartData:e.chartData.filter(y=>y.location===p),onRemoveDimension:K,onRemoveMetric:J})})]},p)),e.chartData.length===0&&r.jsx("div",{className:"col-span-full h-64 flex items-center justify-center text-muted-foreground italic",children:"No data available for the selected filters"})]}):r.jsx(Ie,{dimensions:e.dimensions,metrics:e.metrics,chartType:e.chartType,chartData:e.chartData,onRemoveDimension:K,onRemoveMetric:J})})]})]})})})]})})})}export{Sr as default};
