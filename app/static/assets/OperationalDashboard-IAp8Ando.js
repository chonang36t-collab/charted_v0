import{c as y,j as e,L as $,B as H,u as O,b as A,d as B,r as f}from"./index-DCuD3XHh.js";import{D as F,L as P}from"./DashboardLayout-Dl7t1uB5.js";import{u as V,O as q}from"./OperationalTrendChart-K_XPg6AH.js";import{M as x,T as E,u as I,c as z,R as S}from"./RankingList-Dt6HVAci.js";import{D as U}from"./DashboardHeader-CLjqoNSu.js";import{C,a as N,b as T,d as D}from"./card-BAZ-eILp.js";import{D as K,a as Q,b as R,c as W,d as Z}from"./dialog-dmJ3QYK0.js";import{u as _}from"./useQuery-vuL5_sXf.js";import{C as G}from"./clock-CvU6-KRD.js";import{U as b}from"./users-ZBRnzPAt.js";import"./popover-DcAis7Kp.js";import"./generateCategoricalChart-DZn2t-K_.js";import"./Line-B95c1t4Y.js";import"./progress-HcVbIV49.js";import"./ellipsis-DBT-xpuQ.js";import"./locationUtils-BsfjINon.js";import"./index-3amNeSfr.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=y("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=y("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Y=({dateRange:t,onMetricClick:i})=>{const c=t!=null&&t.from?t.from.toISOString().split("T")[0]:"",n=t!=null&&t.to?t.to.toISOString().split("T")[0]:"",{data:h,isLoading:v}=_({queryKey:["target-performance",c,n],queryFn:async()=>{if(!c||!n)return[];const s=await fetch(`/api/dashboard/targets-performance?start=${c}&end=${n}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!s.ok)throw new Error("Failed to fetch target Data");return s.json()},enabled:!!c&&!!n});if(v)return e.jsxs(C,{children:[e.jsx(N,{children:e.jsx(T,{children:"Target Performance"})}),e.jsx(D,{children:e.jsx($,{className:"animate-spin"})})]});if(!h||h.length===0)return null;const m=new Map;h.forEach(s=>{const a=`${s.location}|${s.site||"null"}`,j=m.get(a);j?(j.actual+=s.actual,j.target+=s.target):m.set(a,{location:s.location,site:s.site,actual:s.actual,target:s.target})});const l=Array.from(m.values()),d=l.length,o=l.filter(s=>s.actual>=s.target).length,p=d-o,r=d>0?o/d*100:0;return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-2",children:[e.jsx(x,{title:"Target Achievement",value:`${r.toFixed(0)}%`,subtitle:`${o} of ${d} sites met target`,icon:X,onClick:i?()=>i("targetAchievement"):void 0,children:e.jsx("div",{className:"mt-4 h-2 w-full bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${r}%`}})})}),e.jsx(x,{title:"Missed Targets",value:p,subtitle:"Sites below target",icon:E,onClick:i?()=>i("missedTargets"):void 0,children:e.jsxs(K,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(H,{variant:"outline",size:"sm",className:"mt-4 w-full",children:"View Details"})}),e.jsxs(R,{className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(W,{children:e.jsx(Z,{children:"Missed Targets Report"})}),e.jsxs("div",{className:"space-y-2",children:[l.filter(s=>s.actual<s.target).map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 last:border-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.site||s.location}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.location})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-red-500 font-bold",children:[s.actual," / ",s.target]}),e.jsxs("span",{className:"text-xs text-muted-foreground block",children:["Deficit: ",s.actual-s.target]})]})]},a)),p===0&&e.jsx("p",{className:"text-center text-muted-foreground",children:"No missed targets!"})]})]})]})})]})},pe=()=>{const t=O();A();const{dateRange:i,setDateRange:c}=B(),[n,h]=f.useState(!1),[v,m]=f.useState(i),[l,d]=f.useState([]),[o,p]=f.useState([]),[r,s]=f.useState("shifts"),{operationalData:a,isLoading:j}=V(i,l,o),{topStaff:k,isLoadingStaff:L,topClientsShifts:w,isLoadingClientsShifts:M}=I(i,l,o),u=z(a,i);return e.jsx(F,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(U,{dateRange:i,onDateRangeChange:c,calendarOpen:n,onCalendarOpenChange:h,tempDateRange:v,onTempDateRangeChange:m,selectedLocations:l,onLocationsChange:d,selectedSites:o,onSitesChange:p}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"px-4 pt-6 pb-6 space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs("div",{className:"col-span-5 flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(x,{title:"Total Shifts",value:u.totalShifts.value,subtitle:u.totalShifts.text,icon:P,isSelected:r==="shifts",onClick:()=>s("shifts"),onViewDetails:()=>t("/dashboard/metrics/shifts")}),e.jsx(x,{title:"Total Hours",value:u.paidHours.value.toLocaleString(),subtitle:u.paidHours.text,icon:G,isSelected:r==="hours",onClick:()=>s("hours"),onViewDetails:()=>t("/dashboard/metrics/hours")}),e.jsx(x,{title:"Active Clients",value:u.totalClients.value,subtitle:"Distinct clients this period",icon:b,isSelected:r==="clients",onClick:()=>s("clients"),onViewDetails:()=>t("/dashboard/metrics/clients")})]}),e.jsx(Y,{dateRange:i,onMetricClick:g=>s(g)}),e.jsxs(C,{className:"flex-1",children:[e.jsx(N,{children:e.jsxs(T,{children:[r==="shifts"&&"Hours & Shifts Trend",r==="hours"&&"Paid Hours Trend",r==="clients"&&"Active Clients Trend"]})}),e.jsx(D,{className:"pl-2",children:e.jsx(q,{data:(a==null?void 0:a.timeSeries)||[],aggregationLevel:(a==null?void 0:a.aggregationLevel)||"monthly",selectedMetric:r})})]})]}),e.jsxs("div",{className:"col-span-2 flex flex-col gap-4",children:[e.jsx(S,{title:"Top Staff (Paid Hours)",data:k,isLoading:L,valueFormatter:g=>`${g.toLocaleString()} hrs`,icon:e.jsx(b,{className:"h-4 w-4"}),className:"flex-1"}),e.jsx(S,{title:"Top Clients (Shifts)",data:w,isLoading:M,valueFormatter:g=>`${g.toLocaleString()} shifts`,icon:e.jsx(J,{className:"h-4 w-4"}),className:"flex-1",barColor:"bg-blue-500"})]})]})})})]})})};export{pe as OperationalDashboard,pe as default};
