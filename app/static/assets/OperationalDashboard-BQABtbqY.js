import{r as A,R as v,d as he,a as ve,A as xe,j as a,u as be,b as ge}from"./index-X6n8QLQ6.js";import{D as Ae,L as je}from"./DashboardLayout-DamfEDU6.js";import{f as J}from"./locationUtils-3wBueozB.js";import{M as L,c as Oe,D as Se,L as Pe}from"./LoadingOverlay-Dfsn-3_H.js";import{C as X,a as Q,b as ee,d as te}from"./card-DwLgY9GA.js";import{S as ne,a as we,G as Ee,f as se,b as _e,i as E,g as $,c as ie,d as q,e as C,h as De,j as Te,k as I,l as Ce,E as Ne,m as Ke,n as ze,o as Le,p as Ie,u as $e,q as Re,A as le,B as ce,X as ue,Y as W,r as Be,R as ke,C as Fe,T as Me,L as He}from"./generateCategoricalChart-Duo-jgrn.js";import{L as qe}from"./Line-DjOnZYfP.js";import{B as re}from"./button-CvIZVJXF.js";import{T as We}from"./users-B_CdESUm.js";import"./select-D8IUDuCg.js";import"./badge-UXmziVSu.js";function _(t){"@babel/helpers - typeof";return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(t)}function Ge(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ue(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,de(n.key),n)}}function Ve(t,e,i){return e&&Ue(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ze(t,e,i){return e=R(e),Ye(t,pe()?Reflect.construct(e,i||[],R(t).constructor):e.apply(t,i))}function Ye(t,e){if(e&&(_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Je(t)}function Je(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pe(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pe=function(){return!!t})()}function R(t){return R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},R(t)}function Xe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&G(t,e)}function G(t,e){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},G(t,e)}function fe(t,e,i){return e=de(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function de(t){var e=Qe(t,"string");return _(e)=="symbol"?e:e+""}function Qe(t,e){if(_(t)!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var k=function(t){function e(){return Ge(this,e),Ze(this,e,arguments)}return Xe(e,t),Ve(e,[{key:"render",value:function(){return null}}])}(A.Component);fe(k,"displayName","ZAxis");fe(k,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var et=["option","isActive"];function N(){return N=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},N.apply(this,arguments)}function tt(t,e){if(t==null)return{};var i=nt(t,e),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function nt(t,e){if(t==null)return{};var i={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;i[n]=t[n]}return i}function it(t){var e=t.option,i=t.isActive,n=tt(t,et);return typeof e=="string"?A.createElement(ne,N({option:A.createElement(we,N({type:e},n)),isActive:i,shapeType:"symbols"},n)):A.createElement(ne,N({option:e,isActive:i,shapeType:"symbols"},n))}function D(t){"@babel/helpers - typeof";return D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(t)}function K(){return K=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},K.apply(this,arguments)}function ae(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function O(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?ae(Object(i),!0).forEach(function(n){P(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ae(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oe(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ye(n.key),n)}}function at(t,e,i){return e&&oe(t.prototype,e),i&&oe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function ot(t,e,i){return e=B(e),st(t,me()?Reflect.construct(e,i||[],B(t).constructor):e.apply(t,i))}function st(t,e){if(e&&(D(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return lt(t)}function lt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function me(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(me=function(){return!!t})()}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},B(t)}function ct(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U(t,e)}function U(t,e){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},U(t,e)}function P(t,e,i){return e=ye(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ye(t){var e=ut(t,"string");return D(e)=="symbol"?e:e+""}function ut(t,e){if(D(t)!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(D(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var F=function(t){function e(){var i;rt(this,e);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return i=ot(this,e,[].concat(r)),P(i,"state",{isAnimationFinished:!1}),P(i,"handleAnimationEnd",function(){i.setState({isAnimationFinished:!0})}),P(i,"handleAnimationStart",function(){i.setState({isAnimationFinished:!1})}),P(i,"id",$e("recharts-scatter-")),i}return ct(e,t),at(e,[{key:"renderSymbolsStatically",value:function(n){var r=this,o=this.props,d=o.shape,y=o.activeShape,m=o.activeIndex,p=q(this.props,!1);return n.map(function(s,l){var c=m===l,u=c?y:d,h=O(O({},p),s);return v.createElement(C,K({className:"recharts-scatter-symbol",key:"symbol-".concat(s==null?void 0:s.cx,"-").concat(s==null?void 0:s.cy,"-").concat(s==null?void 0:s.size,"-").concat(l)},De(r.props,s,l),{role:"img"}),v.createElement(it,K({option:u,isActive:c,key:"symbol-".concat(l)},h)))})}},{key:"renderSymbolsWithAnimation",value:function(){var n=this,r=this.props,o=r.points,d=r.isAnimationActive,y=r.animationBegin,m=r.animationDuration,p=r.animationEasing,s=r.animationId,l=this.state.prevPoints;return v.createElement(Te,{begin:y,duration:m,isActive:d,easing:p,from:{t:0},to:{t:1},key:"pie-".concat(s),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(c){var u=c.t,h=o.map(function(x,b){var g=l&&l[b];if(g){var j=I(g.cx,x.cx),f=I(g.cy,x.cy),S=I(g.size,x.size);return O(O({},x),{},{cx:j(u),cy:f(u),size:S(u)})}var w=I(0,x.size);return O(O({},x),{},{size:w(u)})});return v.createElement(C,null,n.renderSymbolsStatically(h))})}},{key:"renderSymbols",value:function(){var n=this.props,r=n.points,o=n.isAnimationActive,d=this.state.prevPoints;return o&&r&&r.length&&(!d||!Ce(d,r))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(r)}},{key:"renderErrorBar",value:function(){var n=this.props.isAnimationActive;if(n&&!this.state.isAnimationFinished)return null;var r=this.props,o=r.points,d=r.xAxis,y=r.yAxis,m=r.children,p=se(m,Ne);return p?p.map(function(s,l){var c=s.props,u=c.direction,h=c.dataKey;return v.cloneElement(s,{key:"".concat(u,"-").concat(h,"-").concat(o[l]),data:o,xAxis:d,yAxis:y,layout:u==="x"?"vertical":"horizontal",dataPointFormatter:function(b,g){return{x:b.cx,y:b.cy,value:u==="x"?+b.node.x:+b.node.y,errorVal:$(b,g)}}})}):null}},{key:"renderLine",value:function(){var n=this.props,r=n.points,o=n.line,d=n.lineType,y=n.lineJointType,m=q(this.props,!1),p=q(o,!1),s,l;if(d==="joint")s=r.map(function(f){return{x:f.cx,y:f.cy}});else if(d==="fitting"){var c=Ke(r),u=c.xmin,h=c.xmax,x=c.a,b=c.b,g=function(S){return x*S+b};s=[{x:u,y:g(u)},{x:h,y:g(h)}]}var j=O(O(O({},m),{},{fill:"none",stroke:m&&m.fill},p),{},{points:s});return v.isValidElement(o)?l=v.cloneElement(o,j):ze(o)?l=o(j):l=v.createElement(Le,K({},j,{type:y})),v.createElement(C,{className:"recharts-scatter-line",key:"recharts-scatter-line"},l)}},{key:"render",value:function(){var n=this.props,r=n.hide,o=n.points,d=n.line,y=n.className,m=n.xAxis,p=n.yAxis,s=n.left,l=n.top,c=n.width,u=n.height,h=n.id,x=n.isAnimationActive;if(r||!o||!o.length)return null;var b=this.state.isAnimationFinished,g=he("recharts-scatter",y),j=m&&m.allowDataOverflow,f=p&&p.allowDataOverflow,S=j||f,w=E(h)?this.id:h;return v.createElement(C,{className:g,clipPath:S?"url(#clipPath-".concat(w,")"):null},j||f?v.createElement("defs",null,v.createElement("clipPath",{id:"clipPath-".concat(w)},v.createElement("rect",{x:j?s:s-c/2,y:f?l:l-u/2,width:j?c:c*2,height:f?u:u*2}))):null,d&&this.renderLine(),this.renderErrorBar(),v.createElement(C,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!x||b)&&Ie.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,r){return n.animationId!==r.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:r.curPoints}:n.points!==r.curPoints?{curPoints:n.points}:null}}])}(A.PureComponent);P(F,"displayName","Scatter");P(F,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Ee.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});P(F,"getComposedData",function(t){var e=t.xAxis,i=t.yAxis,n=t.zAxis,r=t.item,o=t.displayedData,d=t.xAxisTicks,y=t.yAxisTicks,m=t.offset,p=r.props.tooltipType,s=se(r.props.children,_e),l=E(e.dataKey)?r.props.dataKey:e.dataKey,c=E(i.dataKey)?r.props.dataKey:i.dataKey,u=n&&n.dataKey,h=n?n.range:k.defaultProps.range,x=h&&h[0],b=e.scale.bandwidth?e.scale.bandwidth():0,g=i.scale.bandwidth?i.scale.bandwidth():0,j=o.map(function(f,S){var w=$(f,l),V=$(f,c),T=!E(u)&&$(f,u)||"-",Z=[{name:E(e.dataKey)?r.props.name:e.name||e.dataKey,unit:e.unit||"",value:w,payload:f,dataKey:l,type:p},{name:E(i.dataKey)?r.props.name:i.name||i.dataKey,unit:i.unit||"",value:V,payload:f,dataKey:c,type:p}];T!=="-"&&Z.push({name:n.name||n.dataKey,unit:n.unit||"",value:T,payload:f,dataKey:u,type:p});var M=ie({axis:e,ticks:d,bandSize:b,entry:f,index:S,dataKey:l}),H=ie({axis:i,ticks:y,bandSize:g,entry:f,index:S,dataKey:c}),Y=T!=="-"?n.scale(T):x,z=Math.sqrt(Math.max(Y,0)/Math.PI);return O(O({},f),{},{cx:M,cy:H,x:M-z,y:H-z,xAxis:e,yAxis:i,zAxis:n,width:2*z,height:2*z,size:Y,node:{x:w,y:V,z:T},tooltipPayload:Z,tooltipPosition:{x:M,y:H},payload:f},s&&s[S]&&s[S].props)});return O({points:j},m)});var pt=Re({chartName:"ComposedChart",GraphicalChild:[qe,le,ce,F],axisComponents:[{axisType:"xAxis",AxisComp:ue},{axisType:"yAxis",AxisComp:W},{axisType:"zAxis",AxisComp:k}],formatAxisMap:Be});const ft=(t,e,i)=>{const[n,r]=A.useState(null),[o,d]=A.useState(!1),{toast:y}=ve(),m=async()=>{d(!0);try{const p=new URLSearchParams({start:J(t.from,"yyyy-MM-dd"),end:J(t.to,"yyyy-MM-dd")});e&&e.length>0&&e.forEach(l=>p.append("locations",l)),i&&i.length>0&&i.forEach(l=>p.append("sites",l));const s=await fetch(`${xe.SALES_SUMMARY.replace("sales-summary","operational-summary")}?${p}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(s.ok){const l=await s.json();r(l)}else y({title:"Error",description:"Could not fetch operational data",variant:"destructive"})}catch{y({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{d(!1)}};return A.useEffect(()=>{m()},[t,e,i]),{operationalData:n,isLoading:o,refetch:m}},dt=({metrics:t})=>a.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[a.jsx(L,{title:"Total Shifts",value:t.totalShifts.value.toLocaleString(),change:t.totalShifts.text,trend:t.totalShifts.trend}),a.jsx(L,{title:"Total Paid Hours",value:t.paidHours.value.toLocaleString(void 0,{maximumFractionDigits:1}),change:t.paidHours.text,trend:t.paidHours.trend}),a.jsx(L,{title:"Unique Employees",value:t.uniqueEmployees.value.toLocaleString(),change:t.uniqueEmployees.text,trend:t.uniqueEmployees.trend}),a.jsx(L,{title:"Avg Shift Duration",value:`${t.avgShiftDuration.value.toFixed(1)} hrs`,change:t.avgShiftDuration.text,trend:t.avgShiftDuration.trend})]}),mt=({active:t,payload:e,label:i})=>t&&e&&e.length?a.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[a.jsx("p",{className:"font-semibold text-foreground",children:i}),e.map((n,r)=>a.jsxs("p",{className:"text-sm",style:{color:n.color},children:[n.name,": ",n.name==="Paid Hours"?n.value.toLocaleString(void 0,{maximumFractionDigits:1}):n.value]},r))]}):null,yt=({data:t,aggregationLevel:e})=>{const i={dataKey:"display",interval:0};return!t||t.length===0?a.jsxs(X,{children:[a.jsx(Q,{children:a.jsx(ee,{children:"Hours & Shifts Trend"})}),a.jsx(te,{children:a.jsx("div",{className:"h-[400px] flex items-center justify-center",children:a.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):a.jsxs(X,{children:[a.jsxs(Q,{children:[a.jsx(ee,{children:"Hours & Shifts Trend"}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[e==="daily"&&"Daily view",e==="weekly"&&"Weekly view",e==="monthly"&&"Monthly view"]})]}),a.jsx(te,{children:a.jsx("div",{className:"h-[400px]",children:a.jsx(ke,{width:"100%",height:"100%",children:a.jsxs(pt,{data:t,children:[a.jsx(Fe,{strokeDasharray:"3 3"}),a.jsx(ue,{dataKey:i.dataKey,tick:{fontSize:12},interval:i.interval}),a.jsx(W,{yAxisId:"left",orientation:"left",label:{value:"Hours",angle:-90,position:"insideLeft"}}),a.jsx(W,{yAxisId:"right",orientation:"right",label:{value:"Shifts",angle:90,position:"insideRight"}}),a.jsx(Me,{content:a.jsx(mt,{})}),a.jsx(He,{}),a.jsx(le,{yAxisId:"left",type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),a.jsx(ce,{yAxisId:"right",dataKey:"totalShifts",name:"Total Shifts",barSize:20,fill:"hsl(var(--accent))",fillOpacity:.6})]})})})})]})};function Et(){const t=be(),{role:e}=ge(),[i,n]=A.useState({from:new Date(2025,0,1),to:new Date}),[r,o]=A.useState(!1),[d,y]=A.useState(i),[m,p]=A.useState([]),[s,l]=A.useState([]),{operationalData:c,isLoading:u}=ft(i,m,s),h=Oe(c,i);return a.jsx(Ae,{children:a.jsxs("div",{className:"flex flex-col h-screen",children:[a.jsx(Se,{dateRange:i,onDateRangeChange:n,calendarOpen:r,onCalendarOpenChange:o,tempDateRange:d,onTempDateRangeChange:y,selectedLocations:m,onLocationsChange:p,selectedSites:s,onSitesChange:l}),a.jsx("div",{className:"flex-1 overflow-auto",children:a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:e==="admin"?a.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[a.jsxs(re,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>t("/dashboard/financial"),children:[a.jsx(We,{className:"h-4 w-4"}),"Financial View"]}),a.jsxs(re,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[a.jsx(je,{className:"h-4 w-4"}),"Operational View"]})]}):a.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Operational Dashboard"})}),u&&a.jsx(Pe,{}),a.jsx(dt,{metrics:h}),a.jsx(yt,{data:(c==null?void 0:c.timeSeries)||[],aggregationLevel:(c==null?void 0:c.aggregationLevel)||"monthly"})]})})]})})}export{Et as default};
