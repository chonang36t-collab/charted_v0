import{r as s,a as $,j as e}from"./index-44ICaway.js";import{D as q}from"./DashboardLayout-CuBxDZGF.js";import{C as D,a as E,b as B,d as I}from"./card-uooV3kVC.js";import{L as l}from"./label-BzmJhpRX.js";import{I as p}from"./input-BgtEPxJH.js";import{S as j,a as v,b as y,c as f,d as n}from"./select-DUlR2isg.js";import{B as W}from"./button-DUhBaSqM.js";import{A as K}from"./api-DS5URhHX.js";import{R as Q,C as g,X as C,Y as S,T as N,L as R,B as Z,A as ee,a as ae}from"./AreaChart-nvrAxIwT.js";import{B as se,L as te,a as re}from"./BarChart-C7KiwJ4h.js";import"./users-DAP2fuPj.js";const P=[{name:"Jan",value:4e3},{name:"Feb",value:3e3},{name:"Mar",value:5e3},{name:"Apr",value:4500},{name:"May",value:6e3},{name:"Jun",value:5500}];function je(){const[i,X]=s.useState("bar"),[c,F]=s.useState("date"),[d,b]=s.useState("total_pay"),[h,Y]=s.useState(""),[m,G]=s.useState(""),[u,M]=s.useState(""),[x,w]=s.useState({numeric:[],categorical:[]}),[O,A]=s.useState(P),[T,k]=s.useState(!1),{toast:o}=$();s.useEffect(()=>{V()},[]);const V=async()=>{try{const a=await fetch(K.REPORT_COLUMNS);if(!a.ok)throw new Error("Failed to load columns");const r=await a.json();w(r),F(t=>t||r.categorical[0]||r.numeric[0]||""),b(t=>t||r.numeric[0]||"")}catch{o({title:"Using demo columns",description:"Could not load report columns"}),w({numeric:["value"],categorical:["name"]})}},U=async()=>{if(!c||!d){o({title:"Select columns",description:"X and Y columns are required",variant:"destructive"});return}k(!0);try{const a=new URLSearchParams({chartType:i,x:c,y:d});h&&a.append("site",h),m&&a.append("role",m),u&&a.append("month",u);const r=await fetch(`${K.REPORT_DATA}?${a.toString()}`),t=await r.json();if(!r.ok||t.error)throw new Error(t.error||"Report failed");const z=(t.labels||[]).map((H,J)=>{var L;return{name:H,value:Number(((L=t.values)==null?void 0:L[J])??0)}});A(z),o({title:"Report generated"})}catch{A(P),o({title:"Using demo data",description:"Could not connect to backend"})}finally{k(!1)}},_=()=>{const a={data:O,margin:{top:5,right:30,left:20,bottom:5}};switch(i){case"line":return e.jsxs(te,{...a,children:[e.jsx(g,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"name"}),e.jsx(S,{}),e.jsx(N,{}),e.jsx(R,{}),e.jsx(re,{type:"monotone",dataKey:"value",stroke:"hsl(var(--primary))",strokeWidth:2})]});case"area":return e.jsxs(ee,{...a,children:[e.jsx(g,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"name"}),e.jsx(S,{}),e.jsx(N,{}),e.jsx(R,{}),e.jsx(ae,{type:"monotone",dataKey:"value",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3})]});default:return e.jsxs(se,{...a,children:[e.jsx(g,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"name"}),e.jsx(S,{}),e.jsx(N,{}),e.jsx(R,{}),e.jsx(Z,{dataKey:"value",fill:"hsl(var(--primary))"})]})}};return e.jsx(q,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Advanced Reports"}),e.jsx("p",{className:"text-muted-foreground",children:"Customize and generate detailed analytics reports"})]}),e.jsxs(D,{children:[e.jsx(E,{children:e.jsx(B,{children:"Report Configuration"})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"chart-type",children:"Chart Type"}),e.jsxs(j,{value:i,onValueChange:X,children:[e.jsx(v,{id:"chart-type",children:e.jsx(y,{placeholder:"Select chart type"})}),e.jsxs(f,{children:[e.jsx(n,{value:"bar",children:"Bar Chart"}),e.jsx(n,{value:"line",children:"Line Chart"}),e.jsx(n,{value:"area",children:"Area Chart"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"x-column",children:"X Column"}),e.jsxs(j,{value:c,onValueChange:F,children:[e.jsx(v,{id:"x-column",children:e.jsx(y,{placeholder:"Select X"})}),e.jsx(f,{children:[...x.categorical,...x.numeric].map(a=>e.jsx(n,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"y-column",children:"Y Column"}),e.jsxs(j,{value:d,onValueChange:b,children:[e.jsx(v,{id:"y-column",children:e.jsx(y,{placeholder:"Select Y"})}),e.jsx(f,{children:x.numeric.map(a=>e.jsx(n,{value:a,children:a},a))})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(W,{onClick:U,className:"w-full",disabled:T,children:T?"Generating...":"Generate Report"})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"site-filter",children:"Site (optional)"}),e.jsx(p,{id:"site-filter",value:h,onChange:a=>Y(a.target.value),placeholder:"e.g., Heathrow"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"role-filter",children:"Role (optional)"}),e.jsx(p,{id:"role-filter",value:m,onChange:a=>G(a.target.value),placeholder:"e.g., Sales"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"month-filter",children:"Month (optional)"}),e.jsx(p,{id:"month-filter",value:u,onChange:a=>M(a.target.value),placeholder:"e.g., 2025-01"})]})]})]})]}),e.jsxs(D,{children:[e.jsx(E,{children:e.jsx(B,{children:"Visualization"})}),e.jsx(I,{children:e.jsx(Q,{width:"100%",height:400,children:_()})})]})]})})}export{je as default};
