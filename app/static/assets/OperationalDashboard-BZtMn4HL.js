import{r as t,a as x,A as y,u as j,b as v,j as e}from"./index-CBe1sITz.js";import{D,L}from"./DashboardLayout-Cgov8RRq.js";import{f as p}from"./locationUtils-g-xZZTOa.js";import{c as N,D as S,L as w,M as O,A as b,R as C}from"./LoadingOverlay-7NJOpvF7.js";import{B as u}from"./button-D1YWo77J.js";import{T as M}from"./users-CuwDk9Vb.js";import"./select-CJr_CTJx.js";import"./badge-CpO8mm8q.js";import"./card-3ZnNc8Bx.js";import"./AreaChart-By77bjUX.js";const R=(n,s)=>{const[r,m]=t.useState(null),[h,i]=t.useState(!1),{toast:c}=x(),l=async()=>{i(!0);try{const o=new URLSearchParams({start:p(n.from,"yyyy-MM-dd"),end:p(n.to,"yyyy-MM-dd")});s&&s.length>0&&s.forEach(a=>o.append("locations",a));const d=await fetch(`${y.SALES_SUMMARY.replace("sales-summary","operational-summary")}?${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(d.ok){const a=await d.json();m(a)}else c({title:"Error",description:"Could not fetch operational data",variant:"destructive"})}catch{c({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{i(!1)}};return t.useEffect(()=>{l()},[n,s]),{operationalData:r,isLoading:h,refetch:l}};function $(){const n=j(),{role:s}=v(),[r,m]=t.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[h,i]=t.useState(!1),[c,l]=t.useState(r),[o,d]=t.useState([]),{operationalData:a,isLoading:f}=R(r,o),g=N(a,r);return e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(S,{dateRange:r,onDateRangeChange:m,calendarOpen:h,onCalendarOpenChange:i,tempDateRange:c,onTempDateRangeChange:l,selectedLocations:o,onLocationsChange:d}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:s==="admin"?e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(u,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>n("/dashboard/financial"),children:[e.jsx(M,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(u,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(L,{className:"h-4 w-4"}),"Operational View"]})]}):e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Operational Dashboard"})}),f&&e.jsx(w,{}),e.jsx(O,{metrics:g}),e.jsx(b,{salesData:a}),e.jsx(C,{data:(a==null?void 0:a.timeSeries)||[],aggregationLevel:(a==null?void 0:a.aggregationLevel)||"monthly"})]})})]})})}export{$ as default};
