import{r as y,a as A,A as k,j as e}from"./index-C5-1ptRh.js";import{f as g}from"./popover-B6ysh9UK.js";import{C as S,a as R,b,d as N}from"./card-D15Q5HHz.js";import{R as w,C as O,X as K,Y as L,T as D,L as H,A as n}from"./generateCategoricalChart-DlQHWZ12.js";import{A as W}from"./AreaChart-C81B4QQK.js";const _=(o,s,t)=>{const[r,c]=y.useState(null),[u,a]=y.useState(!1),{toast:h}=A(),f=async()=>{a(!0);try{const l=new URLSearchParams({start:g(o.from,"yyyy-MM-dd"),end:g(o.to,"yyyy-MM-dd")});s&&s.length>0&&s.forEach(i=>l.append("locations",i)),t&&t.length>0&&t.forEach(i=>l.append("sites",i));const x=l.toString(),v={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},[d,m]=await Promise.all([fetch(`${k.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${x}`,{headers:v}),fetch(`${k.CLIENT_DISTRIBUTION}?${x}`,{headers:v})]);if(!d.ok){console.error(`❌ Financial summary API failed (${d.status})`);const i=await d.text();console.error("Response preview:",i.substring(0,200)),h({title:"Error",description:`Could not fetch financial data (${d.status})`,variant:"destructive"});return}const p=await d.json();if(m.ok){const i=await m.json();i.timeSeries&&(p.timeSeries=p.timeSeries.map(j=>{const C=i.timeSeries.find(T=>T.period===j.period);return{...j,clientCount:C?C.clientCount:0}}))}else console.error(`❌ Client distribution API failed (${m.status})`);c(p)}catch(l){console.error(l),h({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{a(!1)}};return y.useEffect(()=>{f()},[o,s,t]),{financialData:r,isLoading:u,refetch:f}},E=({active:o,payload:s,label:t})=>o&&s&&s.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:t}),s.map((r,c)=>e.jsxs("p",{className:"text-sm",style:{color:r.color},children:[r.name,": ",r.name.includes("Revenue")||r.name.includes("Cost")||r.name.includes("Profit")?`£${Number(r.value).toLocaleString()}`:r.value.toLocaleString()]},c))]}):null,z=({data:o,aggregationLevel:s,selectedMetric:t="revenue"})=>{const r={dataKey:"display",interval:0};if(!o||o.length===0)return e.jsxs(S,{className:"flex-1",children:[e.jsx(R,{children:e.jsx(b,{children:"Financial Trend"})}),e.jsx(N,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]});const c=()=>{switch(t){case"revenue":return"Revenue vs Cost Trend";case"cost":return"Cost Overview";case"profit":return"Profit Trend";case"shifts":return"Total Shifts Trend";case"clients":return"Total Clients Trend";case"employees":return"Staff Hours Trend";case"clientRate":return"Average Client Hourly Rate";case"staffRate":return"Average Staff Hourly Rate";case"overheads":return"Total Overheads Trend";default:return"Financial Trend"}},u=()=>{switch(t){case"revenue":case"cost":case"profit":case"overheads":return"Amount (£)";case"clientRate":case"staffRate":return"Rate (£/hr)";case"shifts":return"Shifts";case"clients":return"Clients";case"employees":return"Hours";default:return""}};return e.jsxs(S,{className:"flex-1",children:[e.jsxs(R,{children:[e.jsx(b,{children:c()}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s==="daily"&&"Daily view",s==="weekly"&&"Weekly view",s==="monthly"&&"Monthly view"]})]}),e.jsx(N,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(W,{data:o,children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:r.dataKey,tick:{fontSize:12},interval:r.interval}),e.jsx(L,{label:{value:u(),angle:-90,position:"insideLeft"}}),e.jsx(D,{content:e.jsx(E,{})}),e.jsx(H,{}),t==="revenue"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(n,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]}),t==="cost"&&e.jsx(n,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.5,strokeWidth:2}),t==="overheads"&&e.jsx(n,{type:"monotone",dataKey:"overheads",name:"Overheads",stroke:"hsl(262, 83%, 58%)",fill:"hsl(262, 83%, 58%)",fillOpacity:.5,strokeWidth:2}),t==="profit"&&e.jsx(n,{type:"monotone",dataKey:a=>{const h=a.revenue||0,f=a.cost||0,l=a.overheads||0;return h-(f+l)},name:"Net Profit",stroke:"hsl(142, 76%, 36%)",fill:"hsl(142, 76%, 36%)",fillOpacity:.5,strokeWidth:2}),t==="clientRate"&&e.jsx(n,{type:"monotone",dataKey:a=>a.paidHours>0?a.revenue/a.paidHours:0,name:"Client Rate",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),t==="staffRate"&&e.jsx(n,{type:"monotone",dataKey:a=>a.paidHours>0?a.cost/a.paidHours:0,name:"Staff Rate",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2}),t==="shifts"&&e.jsx(n,{type:"monotone",dataKey:"totalShifts",name:"Total Shifts",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.5,strokeWidth:2}),t==="clients"&&e.jsx(n,{type:"monotone",dataKey:"clientCount",name:"Clients",stroke:"hsl(262, 83%, 58%)",fill:"hsl(262, 83%, 58%)",fillOpacity:.5,strokeWidth:2}),t==="employees"&&e.jsx(n,{type:"monotone",dataKey:"paidHours",name:"Paid Hours",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.5,strokeWidth:2})]})})})})]})},U=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})});export{U as L,z as R,_ as u};
