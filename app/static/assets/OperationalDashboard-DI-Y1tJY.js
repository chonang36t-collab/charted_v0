import{c as b,j as e,L as F,B as I,u as P,b as q,d as B,r as f}from"./index-TOsQvIUj.js";import{D as E,L as V}from"./DashboardLayout-BOaTVYZ3.js";import{u as z,T as U,O as K}from"./TargetPerformanceChart-DkqJED40.js";import{M as x,u as _,c as Q,R as T}from"./RankingList-BqX_-Gl6.js";import{D as W}from"./DashboardHeader-BUEHzGjr.js";import{C as N,a as k,b as D,d as w}from"./card-BkXDOWoK.js";import{D as Z,a as G,b as J,c as X,d as Y}from"./dialog-B_oOeglG.js";import{u as L}from"./useQuery-BfzuJ8fS.js";import{C as R}from"./clock-U4kxMxr8.js";import{U as C}from"./users-BmK4y1FD.js";import"./popover-CuEre14U.js";import"./generateCategoricalChart-DKGmDqXn.js";import"./BarChart-DP4T3el9.js";import"./progress-DufW0u_8.js";import"./ellipsis-BgyzvGKa.js";import"./locationUtils--M_SVaRa.js";import"./index-QAMDYcWw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=b("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=b("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=b("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ae=({dateRange:a,onMetricClick:s})=>{const c=a!=null&&a.from?a.from.toISOString().split("T")[0]:"",d=a!=null&&a.to?a.to.toISOString().split("T")[0]:"",{data:m,isLoading:S}=L({queryKey:["target-performance",c,d],queryFn:async()=>{if(!c||!d)return[];const t=await fetch(`/api/dashboard/targets-performance?start=${c}&end=${d}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!t.ok)throw new Error("Failed to fetch target Data");return t.json()},enabled:!!c&&!!d});if(S)return e.jsxs(N,{children:[e.jsx(k,{children:e.jsx(D,{children:"Target Performance"})}),e.jsx(w,{children:e.jsx(F,{className:"animate-spin"})})]});if(!m||m.length===0)return null;const u=new Map;m.forEach(t=>{const i=`${t.location}|${t.site||"null"}`,j=u.get(i);j?(j.actual+=t.actual,j.target+=t.target):u.set(i,{location:t.location,site:t.site,actual:t.actual,target:t.target})});const l=Array.from(u.values()),h=l.length,n=l.filter(t=>t.actual>=t.target).length,p=h-n,r=h>0?n/h*100:0;return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-2",children:[e.jsx(x,{title:"Target Achievement",value:`${r.toFixed(0)}%`,subtitle:`${n} of ${h} sites met target`,icon:te,onClick:s?()=>s("targetAchievement"):void 0,children:e.jsx("div",{className:"mt-4 h-2 w-full bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${r}%`}})})}),e.jsx(x,{title:"Missed Targets",value:p,subtitle:"Sites below target",icon:se,onClick:s?()=>s("missedTargets"):void 0,children:e.jsxs(Z,{children:[e.jsx(G,{asChild:!0,children:e.jsx(I,{variant:"outline",size:"sm",className:"mt-4 w-full",children:"View Details"})}),e.jsxs(J,{className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(X,{children:e.jsx(Y,{children:"Missed Targets Report"})}),e.jsxs("div",{className:"space-y-2",children:[l.filter(t=>t.actual<t.target).map((t,i)=>e.jsxs("div",{className:"flex justify-between items-center border-b pb-2 last:border-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.site||t.location}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.location})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-red-500 font-bold",children:[t.actual," / ",t.target]}),e.jsxs("span",{className:"text-xs text-muted-foreground block",children:["Deficit: ",t.actual-t.target]})]})]},i)),p===0&&e.jsx("p",{className:"text-center text-muted-foreground",children:"No missed targets!"})]})]})]})})]})},Se=()=>{const a=P();q();const{dateRange:s,setDateRange:c}=B(),[d,m]=f.useState(!1),[S,u]=f.useState(s),[l,h]=f.useState([]),[n,p]=f.useState([]),[r,t]=f.useState("shifts"),{operationalData:i,isLoading:j}=z(s,l,n),{topStaff:M,isLoadingStaff:$,topClientsShifts:O,isLoadingClientsShifts:H}=_(s,l,n),g=Q(i,s),v=s!=null&&s.from?s.from.toISOString().split("T")[0]:"",y=s!=null&&s.to?s.to.toISOString().split("T")[0]:"",{data:A}=L({queryKey:["target-performance",v,y],queryFn:async()=>{if(!v||!y)return[];const o=await fetch(`/api/dashboard/targets-performance?start=${v}&end=${y}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!o.ok)throw new Error("Failed to fetch target data");return o.json()},enabled:!!v&&!!y});return e.jsx(E,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(W,{dateRange:s,onDateRangeChange:c,calendarOpen:d,onCalendarOpenChange:m,tempDateRange:S,onTempDateRangeChange:u,selectedLocations:l,onLocationsChange:h,selectedSites:n,onSitesChange:p}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"px-4 pt-6 pb-6 space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs("div",{className:"col-span-5 flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx(x,{title:"Total Shifts",value:g.totalShifts.value,subtitle:g.totalShifts.text,icon:V,isSelected:r==="shifts",onClick:()=>t("shifts"),onViewDetails:()=>a("/dashboard/metrics/shifts")}),e.jsx(x,{title:"Total Hours",value:g.paidHours.value.toLocaleString(),subtitle:g.paidHours.text,icon:R,isSelected:r==="hours",onClick:()=>t("hours"),onViewDetails:()=>a("/dashboard/metrics/hours")}),e.jsx(x,{title:"Active Clients",value:g.totalClients.value,subtitle:"Distinct clients this period",icon:C,isSelected:r==="clients",onClick:()=>t("clients"),onViewDetails:()=>a("/dashboard/metrics/clients")})]}),e.jsx(ae,{dateRange:s,onMetricClick:o=>t(o)}),r==="missedTargets"?e.jsx(U,{data:A||[]}):e.jsxs(N,{className:"flex-1",children:[e.jsx(k,{children:e.jsxs(D,{children:[r==="shifts"&&"Hours & Shifts Trend",r==="hours"&&"Paid Hours Trend",r==="clients"&&"Active Clients Trend",r==="targetAchievement"&&"Target Achievement Trend"]})}),e.jsx(w,{className:"pl-2",children:e.jsx(K,{data:(i==null?void 0:i.timeSeries)||[],aggregationLevel:(i==null?void 0:i.aggregationLevel)||"monthly",selectedMetric:r})})]})]}),e.jsxs("div",{className:"col-span-2 flex flex-col gap-4",children:[e.jsx(T,{title:"Top Staff (Paid Hours)",data:M,isLoading:$,valueFormatter:o=>`${o.toLocaleString()} hrs`,icon:e.jsx(C,{className:"h-4 w-4"}),className:"flex-1"}),e.jsx(T,{title:"Top Clients (Shifts)",data:O,isLoading:H,valueFormatter:o=>`${o.toLocaleString()} shifts`,icon:e.jsx(ee,{className:"h-4 w-4"}),className:"flex-1",barColor:"bg-blue-500"})]})]})})})]})})};export{Se as OperationalDashboard,Se as default};
