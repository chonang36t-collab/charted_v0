var H=t=>{throw TypeError(t)};var G=(t,e,o)=>e.has(t)||H("Cannot "+o);var s=(t,e,o)=>(G(t,e,"read from private field"),o?o.call(t):e.get(t)),F=(t,e,o)=>e.has(t)?H("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,o),O=(t,e,o,r)=>(G(t,e,"write to private field"),r?r.call(t,o):e.set(t,o),o),T=(t,e,o)=>(G(t,e,"access private method"),o);import{u as W}from"./useQuery-BWRrcYqm.js";import{a9 as le,aa as de,ab as J,ac as he,ad as X,a8 as M,r as i,ae as fe,af as pe,A as x,E as be,g as me,j as I,h as ve,Y as ye,m as ge,O as Se,P as Z,i as _,z as Re}from"./index-Cv9_qDm_.js";var R,E,u,m,v,K,$,V,Ee=(V=class extends le{constructor(e,o){super();F(this,v);F(this,R);F(this,E);F(this,u);F(this,m);O(this,R,e),this.setOptions(o),this.bindMethods(),T(this,v,K).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var r;const o=this.options;this.options=s(this,R).defaultMutationOptions(e),de(this.options,o)||s(this,R).getMutationCache().notify({type:"observerOptionsUpdated",mutation:s(this,u),observer:this}),o!=null&&o.mutationKey&&this.options.mutationKey&&J(o.mutationKey)!==J(this.options.mutationKey)?this.reset():((r=s(this,u))==null?void 0:r.state.status)==="pending"&&s(this,u).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=s(this,u))==null||e.removeObserver(this)}onMutationUpdate(e){T(this,v,K).call(this),T(this,v,$).call(this,e)}getCurrentResult(){return s(this,E)}reset(){var e;(e=s(this,u))==null||e.removeObserver(this),O(this,u,void 0),T(this,v,K).call(this),T(this,v,$).call(this)}mutate(e,o){var r;return O(this,m,o),(r=s(this,u))==null||r.removeObserver(this),O(this,u,s(this,R).getMutationCache().build(s(this,R),this.options)),s(this,u).addObserver(this),s(this,u).execute(e)}},R=new WeakMap,E=new WeakMap,u=new WeakMap,m=new WeakMap,v=new WeakSet,K=function(){var o;const e=((o=s(this,u))==null?void 0:o.state)??he();O(this,E,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},$=function(e){X.batch(()=>{var o,r,a,f,d,y,C,p;if(s(this,m)&&this.hasListeners()){const n=s(this,E).variables,b=s(this,E).context;(e==null?void 0:e.type)==="success"?((r=(o=s(this,m)).onSuccess)==null||r.call(o,e.data,n,b),(f=(a=s(this,m)).onSettled)==null||f.call(a,e.data,null,n,b)):(e==null?void 0:e.type)==="error"&&((y=(d=s(this,m)).onError)==null||y.call(d,e.error,n,b),(p=(C=s(this,m)).onSettled)==null||p.call(C,void 0,e.error,n,b))}this.listeners.forEach(n=>{n(s(this,E))})})},V);function z(t,e){const o=M(),[r]=i.useState(()=>new Ee(o,t));i.useEffect(()=>{r.setOptions(t)},[r,t]);const a=i.useSyncExternalStore(i.useCallback(d=>r.subscribe(X.batchCalls(d)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),f=i.useCallback((d,y)=>{r.mutate(d,y).catch(fe)},[r]);if(a.error&&pe(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:f,mutateAsync:a.mutate}}const Me=t=>W({queryKey:["records",t],queryFn:async()=>{const e=new URLSearchParams;e.append("page",t.page.toString()),e.append("limit",t.limit.toString()),t.sort_by&&e.append("sort_by",t.sort_by),t.sort_order&&e.append("sort_order",t.sort_order),t.search&&e.append("search",t.search),t.start&&e.append("start",t.start),t.end&&e.append("end",t.end),t.locations&&e.append("locations",t.locations),t.sites&&e.append("sites",t.sites),t.clients&&e.append("clients",t.clients);const o=await fetch(`${x.RECORDS}?${e.toString()}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(!o.ok){const r=await o.json().catch(()=>({}));throw new Error(r.error||"Failed to fetch records")}return o.json()},placeholderData:e=>e}),Ne=()=>W({queryKey:["records-options"],queryFn:async()=>{const t=await fetch(`${x.RECORDS}/options`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!t.ok)throw new Error("Failed to fetch options");return t.json()}}),Ue=()=>{const t=M();return z({mutationFn:async e=>{const o=await fetch(x.RECORDS,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(e)});if(!o.ok){const r=await o.json();throw new Error(r.error||"Failed to create record")}return o.json()},onSuccess:()=>{t.invalidateQueries({queryKey:["records"]})}})},qe=()=>{const t=M();return z({mutationFn:async e=>{const{id:o,...r}=e,a=await fetch(`${x.RECORDS}/${o}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(r)});if(!a.ok){const f=await a.json();throw new Error(f.error||"Failed to update record")}return a.json()},onSuccess:()=>{t.invalidateQueries({queryKey:["records"]})}})},Ge=()=>{const t=M();return z({mutationFn:async e=>{const o=await fetch(`${x.RECORDS}/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!o.ok){const r=await o.json();throw new Error(r.error||"Failed to delete record")}return o.json()},onSuccess:()=>{t.invalidateQueries({queryKey:["records"]})}})};var L="rovingFocusGroup.onEntryFocus",we={bubbles:!1,cancelable:!0},A="RovingFocusGroup",[B,ee,Ie]=be(A),[Ce,Le]=me(A,[Ie]),[Fe,Oe]=Ce(A),te=i.forwardRef((t,e)=>I.jsx(B.Provider,{scope:t.__scopeRovingFocusGroup,children:I.jsx(B.Slot,{scope:t.__scopeRovingFocusGroup,children:I.jsx(Te,{...t,ref:e})})}));te.displayName=A;var Te=i.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:o,orientation:r,loop:a=!1,dir:f,currentTabStopId:d,defaultCurrentTabStopId:y,onCurrentTabStopIdChange:C,onEntryFocus:p,preventScrollOnEntryFocus:n=!1,...b}=t,D=i.useRef(null),j=ve(e,D),P=ye(f),[k,c]=ge({prop:d,defaultProp:y??null,onChange:C,caller:A}),[g,N]=i.useState(!1),h=Se(p),S=ee(o),U=i.useRef(!1),[ne,Q]=i.useState(0);return i.useEffect(()=>{const l=D.current;if(l)return l.addEventListener(L,h),()=>l.removeEventListener(L,h)},[h]),I.jsx(Fe,{scope:o,orientation:r,dir:P,loop:a,currentTabStopId:k,onItemFocus:i.useCallback(l=>c(l),[c]),onItemShiftTab:i.useCallback(()=>N(!0),[]),onFocusableItemAdd:i.useCallback(()=>Q(l=>l+1),[]),onFocusableItemRemove:i.useCallback(()=>Q(l=>l-1),[]),children:I.jsx(Z.div,{tabIndex:g||ne===0?-1:0,"data-orientation":r,...b,ref:j,style:{outline:"none",...t.style},onMouseDown:_(t.onMouseDown,()=>{U.current=!0}),onFocus:_(t.onFocus,l=>{const ie=!U.current;if(l.target===l.currentTarget&&ie&&!g){const Y=new CustomEvent(L,we);if(l.currentTarget.dispatchEvent(Y),!Y.defaultPrevented){const q=S().filter(w=>w.focusable),ae=q.find(w=>w.active),ce=q.find(w=>w.id===k),ue=[ae,ce,...q].filter(Boolean).map(w=>w.ref.current);se(ue,n)}}U.current=!1}),onBlur:_(t.onBlur,()=>N(!1))})})}),oe="RovingFocusGroupItem",re=i.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:o,focusable:r=!0,active:a=!1,tabStopId:f,children:d,...y}=t,C=Re(),p=f||C,n=Oe(oe,o),b=n.currentTabStopId===p,D=ee(o),{onFocusableItemAdd:j,onFocusableItemRemove:P,currentTabStopId:k}=n;return i.useEffect(()=>{if(r)return j(),()=>P()},[r,j,P]),I.jsx(B.ItemSlot,{scope:o,id:p,focusable:r,active:a,children:I.jsx(Z.span,{tabIndex:b?0:-1,"data-orientation":n.orientation,...y,ref:e,onMouseDown:_(t.onMouseDown,c=>{r?n.onItemFocus(p):c.preventDefault()}),onFocus:_(t.onFocus,()=>n.onItemFocus(p)),onKeyDown:_(t.onKeyDown,c=>{if(c.key==="Tab"&&c.shiftKey){n.onItemShiftTab();return}if(c.target!==c.currentTarget)return;const g=Ae(c,n.orientation,n.dir);if(g!==void 0){if(c.metaKey||c.ctrlKey||c.altKey||c.shiftKey)return;c.preventDefault();let h=D().filter(S=>S.focusable).map(S=>S.ref.current);if(g==="last")h.reverse();else if(g==="prev"||g==="next"){g==="prev"&&h.reverse();const S=h.indexOf(c.currentTarget);h=n.loop?De(h,S+1):h.slice(S+1)}setTimeout(()=>se(h))}}),children:typeof d=="function"?d({isCurrentTabStop:b,hasTabStop:k!=null}):d})})});re.displayName=oe;var _e={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function xe(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Ae(t,e,o){const r=xe(t.key,o);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return _e[r]}function se(t,e=!1){const o=document.activeElement;for(const r of t)if(r===o||(r.focus({preventScroll:e}),document.activeElement!==o))return}function De(t,e){return t.map((o,r)=>t[(e+r)%t.length])}var $e=te,Be=re;export{Be as I,$e as R,Ue as a,qe as b,Le as c,Me as d,Ge as e,z as f,Ne as u};
