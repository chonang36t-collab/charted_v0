import{r as d,a as T,A as k,j as e,c as A,u as P,b as M,d as F,B as v}from"./index-C_MOlcpr.js";import{D as E,L as O}from"./DashboardLayout-CqleDoHt.js";import{f as N}from"./popover-GgzXAnRD.js";import{u as $,c as z,D as K,R as I}from"./RankingList-BosYUUZu.js";import{C as i,a as m,b as h,d as l}from"./card-2XUXgBcb.js";import{R as U,C as W,X as B,Y,T as _,L as G,A as y}from"./generateCategoricalChart-BrYbJKo-.js";import{A as H}from"./AreaChart-BQnADtMD.js";import{T as V}from"./users-1MYWmI5H.js";import{P as b}from"./pound-sterling-CWboOkra.js";import"./locationUtils-CqMXmfmx.js";import"./index-D7a5WBKQ.js";import"./progress-BDOEatTK.js";import"./ellipsis-Dju-3LN3.js";const X=(s,t,r)=>{const[n,x]=d.useState(null),[p,u]=d.useState(!1),{toast:c}=T(),f=async()=>{u(!0);try{const o=new URLSearchParams({start:N(s.from,"yyyy-MM-dd"),end:N(s.to,"yyyy-MM-dd")});t&&t.length>0&&t.forEach(a=>o.append("locations",a)),r&&r.length>0&&r.forEach(a=>o.append("sites",a));const j=await fetch(`${k.SALES_SUMMARY.replace("sales-summary","financial-summary")}?${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(j.ok){const a=await j.json();x(a)}else c({title:"Error",description:"Could not fetch financial data",variant:"destructive"})}catch{c({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{u(!1)}};return d.useEffect(()=>{f()},[s,t,r]),{financialData:n,isLoading:p,refetch:f}};function g({title:s,value:t,change:r,trend:n="neutral"}){return e.jsxs(i,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(m,{className:"flex flex-row items-center justify-between pb-2",children:e.jsx(h,{className:"text-sm font-medium text-muted-foreground",children:s})}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t}),r&&e.jsx("p",{className:A("text-xs mt-1",n==="up"&&"text-accent",n==="down"&&"text-destructive",n==="neutral"&&"text-muted-foreground"),children:r})]})]})}const q=({metrics:s})=>e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 w-full",children:[e.jsx(g,{title:"Total Revenue",value:`£${s.revenue.value.toLocaleString()}`,change:s.revenue.text,trend:s.revenue.trend}),e.jsx(g,{title:"Average Client Pay",value:`£${s.clientPay.value.toFixed(2)}`,change:s.clientPay.text,trend:s.clientPay.trend}),e.jsx(g,{title:"Average Staff Pay",value:`£${s.staffPay.value.toFixed(2)}`,change:s.staffPay.text,trend:s.staffPay.trend})]}),J=({salesData:s})=>{var t;return e.jsxs("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 w-full",children:[e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Shifts"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalShifts)||0})]})})})}),e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Clients"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalClients)||0})]})})})}),e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Employees"}),e.jsx("p",{className:"text-2xl font-bold",children:(s==null?void 0:s.uniqueEmployees)||0})]})})})}),e.jsx(i,{children:e.jsx(l,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profit Margin"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((t=s==null?void 0:s.profitMargin)==null?void 0:t.toFixed(1))||0,"%"]})]})})})})]})},Q=({active:s,payload:t,label:r})=>s&&t&&t.length?e.jsxs("div",{className:"bg-background border border-border p-3 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-foreground",children:r}),t.map((n,x)=>e.jsxs("p",{className:"text-sm",style:{color:n.color},children:[n.name,": £",Number(n.value).toLocaleString()]},x))]}):null,Z=({data:s,aggregationLevel:t})=>{const r={dataKey:"display",interval:0};return!s||s.length===0?e.jsxs(i,{children:[e.jsx(m,{children:e.jsx(h,{children:"Revenue vs Cost Trend"})}),e.jsx(l,{children:e.jsx("div",{className:"h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No data available for the selected period"})})})]}):e.jsxs(i,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Revenue vs Cost Trend"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t==="daily"&&"Daily view",t==="weekly"&&"Weekly view",t==="monthly"&&"Monthly view"]})]}),e.jsx(l,{children:e.jsx("div",{className:"h-[400px]",children:e.jsx(U,{width:"100%",height:"100%",children:e.jsxs(H,{data:s,children:[e.jsx(W,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:r.dataKey,tick:{fontSize:12},interval:r.interval}),e.jsx(Y,{}),e.jsx(_,{content:e.jsx(Q,{})}),e.jsx(G,{}),e.jsx(y,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.3,strokeWidth:2}),e.jsx(y,{type:"monotone",dataKey:"cost",name:"Cost",stroke:"hsl(var(--accent))",fill:"hsl(var(--accent))",fillOpacity:.3,strokeWidth:2})]})})})})]})},D=()=>e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Loading Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fetching your data..."})]})]})}),he=()=>{const s=P();M();const{dateRange:t,setDateRange:r}=F(),[n,x]=d.useState(!1),[p,u]=d.useState(t),[c,f]=d.useState([]),[o,j]=d.useState([]),{financialData:a,isLoading:C}=X(t,c,o),{topClientsRevenue:w,isLoadingClientsRev:S}=$(t,c,o),L=z(a,t);return e.jsx(E,{fullWidth:!0,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(K,{dateRange:t,onDateRangeChange:r,calendarOpen:n,onCalendarOpenChange:x,tempDateRange:p,onTempDateRangeChange:u,selectedLocations:c,onLocationsChange:f,selectedSites:o,onSitesChange:j}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"px-4 pt-6 pb-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(v,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(V,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(v,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>s("/dashboard/operational"),children:[e.jsx(O,{className:"h-4 w-4"}),"Operational View"]})]})}),C&&e.jsx(D,{}),e.jsx(q,{metrics:L}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:e.jsxs(i,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium text-muted-foreground",children:"Total Overheads"}),e.jsx(b,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["£",((a==null?void 0:a.totalOverhead)||0).toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fixed costs for selected period"})]})]})}),e.jsx(J,{salesData:a}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(i,{className:"col-span-5",children:[e.jsx(m,{children:e.jsx(h,{children:"Revenue Overview"})}),e.jsx(l,{className:"pl-2",children:e.jsx(Z,{data:(a==null?void 0:a.timeSeries)||[],aggregationLevel:(a==null?void 0:a.aggregationLevel)||"monthly"})})]}),e.jsx("div",{className:"col-span-2 flex flex-col gap-4 h-full",children:e.jsx(I,{title:"Top Clients (Revenue)",data:w,isLoading:S,valueFormatter:R=>`£${R.toLocaleString()}`,icon:e.jsx(b,{className:"h-4 w-4"}),className:"h-full",barColor:"bg-green-500"})})]})]})})]})})};export{he as FinancialDashboard,he as default};
