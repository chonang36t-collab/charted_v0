import{r as s,a as x,A as y,u as j,b as v,j as e}from"./index-ChjL3gMt.js";import{D,L}from"./DashboardLayout-Cvmluo7Z.js";import{f as p}from"./locationUtils-riTT5MyB.js";import{c as N,D as S,L as w,M as O,A as b,R as C}from"./LoadingOverlay-B3kam8WQ.js";import{B as u}from"./button-n7xU_b-Z.js";import{T as M}from"./users-B0ErQngF.js";import"./select-Cx6WFVvs.js";import"./badge-CcFY3A0L.js";import"./card-BQ6wMQt5.js";import"./AreaChart-t5bMKBVq.js";const R=(n,t)=>{const[r,m]=s.useState(null),[h,i]=s.useState(!1),{toast:c}=x(),l=async()=>{i(!0);try{const o=new URLSearchParams({start:p(n.from,"yyyy-MM-dd"),end:p(n.to,"yyyy-MM-dd")});t&&t.length>0&&t.forEach(a=>o.append("locations",a));const d=await fetch(`${y.SALES_SUMMARY.replace("sales-summary","operational-summary")}?${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(d.ok){const a=await d.json();m(a)}else c({title:"Error",description:"Could not fetch operational data",variant:"destructive"})}catch{c({title:"Error",description:"Failed to connect to server",variant:"destructive"})}finally{i(!1)}};return s.useEffect(()=>{l()},[n,t]),{operationalData:r,isLoading:h,refetch:l}};function $(){const n=j(),{role:t}=v(),[r,m]=s.useState({from:new Date(2025,0,1),to:new Date(2025,8,30)}),[h,i]=s.useState(!1),[c,l]=s.useState(r),[o,d]=s.useState([]),{operationalData:a,isLoading:f}=R(r,o),g=N(a,r);return e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col h-screen",children:[e.jsx(S,{dateRange:r,onDateRangeChange:m,calendarOpen:h,onCalendarOpenChange:i,tempDateRange:c,onTempDateRangeChange:l,selectedLocations:o,onLocationsChange:d}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:t==="admin"?e.jsxs("div",{className:"flex items-center gap-2 px-1 py-1 bg-muted rounded-lg",children:[e.jsxs(u,{variant:"ghost",size:"sm",className:"gap-2 text-muted-foreground hover:text-foreground",onClick:()=>n("/dashboard/financial"),children:[e.jsx(M,{className:"h-4 w-4"}),"Financial View"]}),e.jsxs(u,{variant:"secondary",size:"sm",className:"gap-2 shadow-sm",children:[e.jsx(L,{className:"h-4 w-4"}),"Operational View"]})]}):e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Operational Dashboard"})}),f&&e.jsx(w,{}),e.jsx(O,{metrics:g}),e.jsx(b,{salesData:a}),t==="admin"&&e.jsx(C,{data:(a==null?void 0:a.timeSeries)||[],aggregationLevel:(a==null?void 0:a.aggregationLevel)||"monthly"})]})})]})})}export{$ as default};
